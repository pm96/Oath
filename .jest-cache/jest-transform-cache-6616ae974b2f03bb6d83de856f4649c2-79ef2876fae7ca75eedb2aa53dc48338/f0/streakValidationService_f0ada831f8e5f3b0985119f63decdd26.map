{"version":3,"names":["_firestore","require","_dateUtils","_dataIntegrityService","_securityAuditService","StreakValidationService","exports","_classCallCheck2","default","_createClass2","key","value","_validateStreakCalculation","_asyncToGenerator2","streak","completions","userId","errors","warnings","correctedData","suspiciousActivity","push","calculatedStreak","calculateStreakFromCompletions","habitId","Math","abs","currentStreak","Object","assign","bestStreak","milestoneValidation","validateMilestones","isValid","apply","_toConsumableArray2","freezeValidation","validateFreezeUsage","suspiciousCheck","detectSuspiciousStreakActivity","isSuspicious","flags","length","error","validateStreakCalculation","_x","_x2","_x3","arguments","_validateCompletionData","completion","existingCompletions","now","Timestamp","completionTime","completedAt","timeDiff","toMillis","userTimezone","timezone","getUserTimezone","completionDateString","timestampToDateString","currentDateString","getCurrentDateString","sameDay","filter","comp","compDateString","validDifficulties","includes","difficulty","detectSuspiciousCompletionActivity","validateCompletionData","_x4","_x5","_x6","_validateDataForFriendDisplay","friendId","integrityCheck","dataIntegrityService","verifyStreakIntegrity","displayValidation","validateStreakForDisplay","logFriendAccess","validateDataForFriendDisplay","_x7","_x8","_x9","_createAuditLog","action","entityType","entityId","oldData","newData","validationResult","metadata","_validationResult$war","_validationResult$war2","eventTypeMap","completion_recorded","completion_validation_failed","streak_calculated","streak_calculation_validation_failed","streak_integrity_check_failed","friend_accessed_streak","friend_display_validation_failed","streak_freeze_used","eventType","suspiciousFlags","undefined","securityAuditService","createAuditEntry","validationErrors","ipAddress","userAgent","timestamp","Date","console","createAuditLog","_x0","_x1","_x10","_x11","_x12","_x13","_x14","_x15","_completions$","lastCompletionDate","streakStartDate","freezesAvailable","freezesUsed","milestones","completionDates","map","date","index","arr","indexOf","sort","today","yesterday","formatDateToString","i","currentDate","previousDate","dayDiff","getTime","tempStreak","max","invalidMilestones","m","days","milestoneDays","uniqueDays","Set","size","invalidTimestamps","achievedAt","totalFreezesEarned","floor","_detectSuspiciousStreakActivity","impossibleMilestones","completionsAtTime","c","_x16","_x17","_detectSuspiciousCompletionActivity","recentCompletions","MAX_COMPLETIONS_PER_HOUR","todayCompletions","MAX_COMPLETIONS_PER_DAY","identicalTimestamps","_x18","_x19","_logFriendAccess","accessTime","_x20","_x21","_x22","SUSPICIOUS_ACTIVITY_THRESHOLD","streakValidationService"],"sources":["streakValidationService.ts"],"sourcesContent":["/**\n * Server-side Streak Validation Service\n *\n * Handles server-side validation for all streak calculations to prevent manipulation\n * Requirements: 12.2, 12.3, 12.4, 12.5\n */\n\nimport { Timestamp } from \"firebase/firestore\";\nimport { HabitCompletion, HabitStreak } from \"../../types/habit-streaks\";\nimport {\n    formatDateToString,\n    getCurrentDateString,\n    getUserTimezone,\n    timestampToDateString,\n} from \"../../utils/dateUtils\";\nimport { dataIntegrityService } from \"./dataIntegrityService\";\nimport { securityAuditService } from \"./securityAuditService\";\n\n/**\n * Validation result interface\n */\nexport interface ValidationResult {\n    isValid: boolean;\n    errors: string[];\n    warnings: string[];\n    correctedData?: any;\n    suspiciousActivity?: boolean;\n}\n\n/**\n * Audit log entry interface\n */\nexport interface AuditLogEntry {\n    timestamp: Timestamp;\n    userId: string;\n    action: string;\n    entityType: \"completion\" | \"streak\" | \"analytics\";\n    entityId: string;\n    oldData?: any;\n    newData?: any;\n    ipAddress?: string;\n    userAgent?: string;\n    validationResult?: ValidationResult;\n}\n\n/**\n * Server-side Streak Validation Service\n */\nexport class StreakValidationService {\n    private static readonly MAX_COMPLETIONS_PER_HOUR = 10;\n    private static readonly MAX_COMPLETIONS_PER_DAY = 50;\n    private static readonly SUSPICIOUS_ACTIVITY_THRESHOLD = 5;\n\n    /**\n     * Validate streak calculation against completion data\n     * Requirements: 12.2\n     */\n    async validateStreakCalculation(\n        streak: HabitStreak,\n        completions: HabitCompletion[],\n        userId: string,\n    ): Promise<ValidationResult> {\n        const errors: string[] = [];\n        const warnings: string[] = [];\n        let correctedData: HabitStreak | undefined;\n        let suspiciousActivity = false;\n\n        try {\n            // Validate user ownership\n            if (streak.userId !== userId) {\n                errors.push(\"User ID mismatch in streak data\");\n                suspiciousActivity = true;\n            }\n\n            // Validate streak logic against actual completions\n            const calculatedStreak = this.calculateStreakFromCompletions(\n                completions,\n                streak.habitId,\n                userId,\n            );\n\n            // Check current streak accuracy\n            if (Math.abs(streak.currentStreak - calculatedStreak.currentStreak) > 1) {\n                warnings.push(\n                    `Current streak mismatch: reported ${streak.currentStreak}, calculated ${calculatedStreak.currentStreak}`,\n                );\n                correctedData = {\n                    ...streak,\n                    currentStreak: calculatedStreak.currentStreak,\n                };\n            }\n\n            // Check best streak accuracy (should never decrease)\n            if (streak.bestStreak < calculatedStreak.bestStreak) {\n                warnings.push(\n                    `Best streak should be updated: current ${streak.bestStreak}, calculated ${calculatedStreak.bestStreak}`,\n                );\n                correctedData = {\n                    ...correctedData,\n                    bestStreak: calculatedStreak.bestStreak,\n                } as HabitStreak;\n            }\n\n            // Validate milestone consistency\n            const milestoneValidation = this.validateMilestones(streak, completions);\n            if (!milestoneValidation.isValid) {\n                errors.push(...milestoneValidation.errors);\n                warnings.push(...milestoneValidation.warnings);\n            }\n\n            // Validate freeze usage\n            const freezeValidation = this.validateFreezeUsage(streak);\n            if (!freezeValidation.isValid) {\n                errors.push(...freezeValidation.errors);\n                warnings.push(...freezeValidation.warnings);\n            }\n\n            // Check for suspicious patterns\n            const suspiciousCheck = await this.detectSuspiciousStreakActivity(\n                streak,\n                completions,\n            );\n            if (suspiciousCheck.isSuspicious) {\n                suspiciousActivity = true;\n                warnings.push(...suspiciousCheck.flags);\n            }\n\n            return {\n                isValid: errors.length === 0,\n                errors,\n                warnings,\n                correctedData,\n                suspiciousActivity,\n            };\n        } catch (error) {\n            errors.push(`Validation failed: ${error}`);\n            return {\n                isValid: false,\n                errors,\n                warnings,\n                suspiciousActivity: true,\n            };\n        }\n    }\n\n    /**\n     * Validate completion data before recording\n     * Requirements: 12.1, 12.3\n     */\n    async validateCompletionData(\n        completion: Omit<HabitCompletion, \"id\">,\n        userId: string,\n        existingCompletions: HabitCompletion[],\n    ): Promise<ValidationResult> {\n        const errors: string[] = [];\n        const warnings: string[] = [];\n        let suspiciousActivity = false;\n\n        try {\n            // Validate user ownership\n            if (completion.userId !== userId) {\n                errors.push(\"User ID mismatch in completion data\");\n                suspiciousActivity = true;\n            }\n\n            // Validate timestamp is within acceptable range (Requirements 12.1)\n            const now = Timestamp.now();\n            const completionTime = completion.completedAt;\n            const timeDiff = now.toMillis() - completionTime.toMillis();\n\n            // Allow completions up to 24 hours in the past, but not in the future\n            if (timeDiff < 0) {\n                errors.push(\"Completion timestamp is in the future\");\n                suspiciousActivity = true;\n            } else if (timeDiff > 24 * 60 * 60 * 1000) {\n                warnings.push(\"Completion is more than 24 hours old\");\n            }\n\n            // Validate timezone\n            const userTimezone = completion.timezone || getUserTimezone();\n            const completionDateString = timestampToDateString(\n                completionTime,\n                userTimezone,\n            );\n            const currentDateString = getCurrentDateString(userTimezone);\n\n            if (completionDateString > currentDateString) {\n                errors.push(\"Completion date is in the future\");\n                suspiciousActivity = true;\n            }\n\n            // Check for duplicate completions on the same date\n            const sameDay = existingCompletions.filter((comp) => {\n                const compDateString = timestampToDateString(\n                    comp.completedAt,\n                    userTimezone,\n                );\n                return compDateString === completionDateString;\n            });\n\n            if (sameDay.length > 0) {\n                errors.push(\"Completion already exists for this date\");\n            }\n\n            // Validate difficulty level\n            const validDifficulties = [\"easy\", \"medium\", \"hard\"];\n            if (!validDifficulties.includes(completion.difficulty)) {\n                errors.push(\"Invalid difficulty level\");\n            }\n\n            // Check for suspicious completion patterns\n            const suspiciousCheck = await this.detectSuspiciousCompletionActivity(\n                completion,\n                existingCompletions,\n            );\n            if (suspiciousCheck.isSuspicious) {\n                suspiciousActivity = true;\n                warnings.push(...suspiciousCheck.flags);\n            }\n\n            return {\n                isValid: errors.length === 0,\n                errors,\n                warnings,\n                suspiciousActivity,\n            };\n        } catch (error) {\n            errors.push(`Validation failed: ${error}`);\n            return {\n                isValid: false,\n                errors,\n                warnings,\n                suspiciousActivity: true,\n            };\n        }\n    }\n\n    /**\n     * Validate data integrity before displaying to friends\n     * Requirements: 12.4\n     */\n    async validateDataForFriendDisplay(\n        streak: HabitStreak,\n        userId: string,\n        friendId: string,\n    ): Promise<ValidationResult> {\n        const errors: string[] = [];\n        const warnings: string[] = [];\n\n        try {\n            // Verify data integrity\n            const integrityCheck = await dataIntegrityService.verifyStreakIntegrity(\n                streak.habitId,\n                userId,\n                streak,\n            );\n\n            if (!integrityCheck.isValid) {\n                errors.push(\"Data integrity check failed\");\n                warnings.push(...integrityCheck.errors);\n            }\n\n            // Validate that the streak belongs to the user\n            if (streak.userId !== userId) {\n                errors.push(\"Streak data ownership mismatch\");\n            }\n\n            // Check if the data is suitable for friend display\n            const displayValidation = this.validateStreakForDisplay(streak);\n            if (!displayValidation.isValid) {\n                errors.push(...displayValidation.errors);\n                warnings.push(...displayValidation.warnings);\n            }\n\n            // Log the friend access for audit purposes\n            await this.logFriendAccess(userId, friendId, streak.habitId);\n\n            return {\n                isValid: errors.length === 0,\n                errors,\n                warnings,\n            };\n        } catch (error) {\n            errors.push(`Friend display validation failed: ${error}`);\n            return {\n                isValid: false,\n                errors,\n                warnings,\n            };\n        }\n    }\n\n    /**\n     * Create audit log entry for data modifications\n     * Requirements: 12.5\n     */\n    async createAuditLog(\n        userId: string,\n        action: string,\n        entityType: \"completion\" | \"streak\" | \"analytics\",\n        entityId: string,\n        oldData?: any,\n        newData?: any,\n        validationResult?: ValidationResult,\n        metadata?: {\n            ipAddress?: string;\n            userAgent?: string;\n        },\n    ): Promise<void> {\n        try {\n            // Map action to audit event type\n            const eventTypeMap: Record<string, any> = {\n                completion_recorded: \"completion_recorded\",\n                completion_validation_failed: \"completion_validation_failed\",\n                streak_calculated: \"streak_calculated\",\n                streak_calculation_validation_failed: \"streak_validation_failed\",\n                streak_integrity_check_failed: \"streak_integrity_check_failed\",\n                friend_accessed_streak: \"friend_accessed_streak\",\n                friend_display_validation_failed: \"friend_display_validation_failed\",\n                streak_freeze_used: \"streak_freeze_used\",\n            };\n\n            const eventType = eventTypeMap[action] || action;\n\n            // Use the security audit service for comprehensive logging\n            const suspiciousFlags =\n                validationResult?.suspiciousActivity &&\n                    (validationResult?.warnings?.length ?? 0) > 0\n                    ? validationResult.warnings\n                    : undefined;\n\n            await securityAuditService.createAuditEntry(\n                userId,\n                eventType,\n                entityType,\n                entityId,\n                {\n                    action,\n                    oldData,\n                    newData,\n                    validationErrors: validationResult?.errors,\n                    suspiciousFlags,\n                    ipAddress: metadata?.ipAddress,\n                    userAgent: metadata?.userAgent,\n                    metadata: {\n                        validationResult,\n                        timestamp: Date.now(),\n                    },\n                },\n            );\n        } catch (error) {\n            console.error(\"Failed to create audit log:\", error);\n            // Don't throw - audit logging failure shouldn't block the operation\n        }\n    }\n\n    // Private helper methods\n\n    /**\n     * Calculate streak from completions (server-side validation)\n     */\n    private calculateStreakFromCompletions(\n        completions: HabitCompletion[],\n        habitId: string,\n        userId: string,\n    ): HabitStreak {\n        if (completions.length === 0) {\n            return {\n                habitId,\n                userId,\n                currentStreak: 0,\n                bestStreak: 0,\n                lastCompletionDate: \"\",\n                streakStartDate: getCurrentDateString(getUserTimezone()),\n                freezesAvailable: 0,\n                freezesUsed: 0,\n                milestones: [],\n            };\n        }\n\n        const timezone = completions[0]?.timezone || getUserTimezone();\n        const completionDates = completions\n            .map((comp) => timestampToDateString(comp.completedAt, timezone))\n            .filter((date, index, arr) => arr.indexOf(date) === index) // Remove duplicates\n            .sort();\n\n        // Calculate current streak\n        let currentStreak = 0;\n        let streakStartDate = \"\";\n        const today = getCurrentDateString(timezone);\n        const yesterday = formatDateToString(\n            new Date(Date.now() - 24 * 60 * 60 * 1000),\n            timezone,\n        );\n\n        const lastCompletionDate = completionDates[completionDates.length - 1];\n        if (lastCompletionDate === today || lastCompletionDate === yesterday) {\n            currentStreak = 1;\n            streakStartDate = lastCompletionDate;\n\n            // Count backwards for consecutive days\n            for (let i = completionDates.length - 2; i >= 0; i--) {\n                const currentDate = new Date(completionDates[i + 1]);\n                const previousDate = new Date(completionDates[i]);\n                const dayDiff =\n                    (currentDate.getTime() - previousDate.getTime()) /\n                    (1000 * 60 * 60 * 24);\n\n                if (dayDiff === 1) {\n                    currentStreak++;\n                    streakStartDate = completionDates[i];\n                } else {\n                    break;\n                }\n            }\n        }\n\n        // Calculate best streak\n        let bestStreak = 0;\n        let tempStreak = 1;\n\n        for (let i = 1; i < completionDates.length; i++) {\n            const currentDate = new Date(completionDates[i]);\n            const previousDate = new Date(completionDates[i - 1]);\n            const dayDiff =\n                (currentDate.getTime() - previousDate.getTime()) /\n                (1000 * 60 * 60 * 24);\n\n            if (dayDiff === 1) {\n                tempStreak++;\n            } else {\n                bestStreak = Math.max(bestStreak, tempStreak);\n                tempStreak = 1;\n            }\n        }\n        bestStreak = Math.max(bestStreak, tempStreak, currentStreak);\n\n        return {\n            habitId,\n            userId,\n            currentStreak,\n            bestStreak,\n            lastCompletionDate,\n            streakStartDate,\n            freezesAvailable: 0,\n            freezesUsed: 0,\n            milestones: [],\n        };\n    }\n\n    /**\n     * Validate milestone consistency\n     */\n    private validateMilestones(\n        streak: HabitStreak,\n        completions: HabitCompletion[],\n    ): ValidationResult {\n        const errors: string[] = [];\n        const warnings: string[] = [];\n\n        // Check that milestones don't exceed best streak\n        const invalidMilestones = streak.milestones.filter(\n            (m) => m.days > streak.bestStreak,\n        );\n        if (invalidMilestones.length > 0) {\n            warnings.push(\n                `${invalidMilestones.length} milestones exceed best streak`,\n            );\n        }\n\n        // Check for duplicate milestone days\n        const milestoneDays = streak.milestones.map((m) => m.days);\n        const uniqueDays = new Set(milestoneDays);\n        if (uniqueDays.size !== milestoneDays.length) {\n            errors.push(\"Duplicate milestone days found\");\n        }\n\n        // Validate milestone timestamps\n        const invalidTimestamps = streak.milestones.filter(\n            (m) => !m.achievedAt || m.achievedAt.toMillis() > Date.now(),\n        );\n        if (invalidTimestamps.length > 0) {\n            errors.push(\"Invalid milestone timestamps found\");\n        }\n\n        return {\n            isValid: errors.length === 0,\n            errors,\n            warnings,\n        };\n    }\n\n    /**\n     * Validate freeze usage\n     */\n    private validateFreezeUsage(streak: HabitStreak): ValidationResult {\n        const errors: string[] = [];\n        const warnings: string[] = [];\n\n        // Validate freeze counts are non-negative\n        if (streak.freezesAvailable < 0 || streak.freezesUsed < 0) {\n            errors.push(\"Freeze counts cannot be negative\");\n        }\n\n        // Validate freeze usage doesn't exceed theoretical maximum\n        const totalFreezesEarned = Math.floor(streak.bestStreak / 30);\n        if (streak.freezesUsed > totalFreezesEarned) {\n            warnings.push(\"Freeze usage exceeds theoretical maximum\");\n        }\n\n        return {\n            isValid: errors.length === 0,\n            errors,\n            warnings,\n        };\n    }\n\n    /**\n     * Detect suspicious streak activity\n     */\n    private async detectSuspiciousStreakActivity(\n        streak: HabitStreak,\n        completions: HabitCompletion[],\n    ): Promise<{ isSuspicious: boolean; flags: string[] }> {\n        const flags: string[] = [];\n\n        // Check for unrealistic streak growth\n        if (streak.currentStreak > completions.length) {\n            flags.push(\"Current streak exceeds total completions\");\n        }\n\n        // Check for impossible milestone achievements\n        const impossibleMilestones = streak.milestones.filter((m) => {\n            const completionsAtTime = completions.filter(\n                (c) => c.completedAt.toMillis() <= m.achievedAt.toMillis(),\n            ).length;\n            return m.days > completionsAtTime;\n        });\n\n        if (impossibleMilestones.length > 0) {\n            flags.push(\"Milestones achieved without sufficient completions\");\n        }\n\n        return {\n            isSuspicious: flags.length > 0,\n            flags,\n        };\n    }\n\n    /**\n     * Detect suspicious completion activity\n     */\n    private async detectSuspiciousCompletionActivity(\n        completion: Omit<HabitCompletion, \"id\">,\n        existingCompletions: HabitCompletion[],\n    ): Promise<{ isSuspicious: boolean; flags: string[] }> {\n        const flags: string[] = [];\n\n        // Check completion frequency\n        const now = Date.now();\n        const recentCompletions = existingCompletions.filter(\n            (c) => now - c.completedAt.toMillis() < 60 * 60 * 1000, // Last hour\n        );\n\n        if (\n            recentCompletions.length >=\n            StreakValidationService.MAX_COMPLETIONS_PER_HOUR\n        ) {\n            flags.push(\"Excessive completions in the last hour\");\n        }\n\n        const todayCompletions = existingCompletions.filter(\n            (c) => now - c.completedAt.toMillis() < 24 * 60 * 60 * 1000, // Last 24 hours\n        );\n\n        if (\n            todayCompletions.length >= StreakValidationService.MAX_COMPLETIONS_PER_DAY\n        ) {\n            flags.push(\"Excessive completions in the last 24 hours\");\n        }\n\n        // Check for identical timestamps\n        const identicalTimestamps = existingCompletions.filter(\n            (c) => c.completedAt.toMillis() === completion.completedAt.toMillis(),\n        );\n\n        if (identicalTimestamps.length > 0) {\n            flags.push(\"Identical completion timestamps detected\");\n        }\n\n        return {\n            isSuspicious: flags.length > 0,\n            flags,\n        };\n    }\n\n    /**\n     * Validate streak data for display to friends\n     */\n    private validateStreakForDisplay(streak: HabitStreak): ValidationResult {\n        const errors: string[] = [];\n        const warnings: string[] = [];\n\n        // Basic data validation\n        if (!streak.habitId || !streak.userId) {\n            errors.push(\"Missing required streak fields\");\n        }\n\n        if (streak.currentStreak < 0 || streak.bestStreak < 0) {\n            errors.push(\"Invalid streak values\");\n        }\n\n        if (streak.currentStreak > streak.bestStreak) {\n            warnings.push(\"Current streak exceeds best streak\");\n        }\n\n        return {\n            isValid: errors.length === 0,\n            errors,\n            warnings,\n        };\n    }\n\n    /**\n     * Log friend access for audit purposes\n     */\n    private async logFriendAccess(\n        userId: string,\n        friendId: string,\n        habitId: string,\n    ): Promise<void> {\n        try {\n            await securityAuditService.createAuditEntry(\n                userId,\n                \"friend_accessed_streak\",\n                \"streak\",\n                habitId,\n                {\n                    action: \"friend_access\",\n                    friendId,\n                    metadata: {\n                        habitId,\n                        accessTime: Date.now(),\n                    },\n                },\n            );\n        } catch (error) {\n            console.error(\"Failed to log friend access:\", error);\n        }\n    }\n}\n\n// Export singleton instance\nexport const streakValidationService = new StreakValidationService();\n"],"mappings":"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","ignoreList":[]}