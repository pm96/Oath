{"version":3,"names":["_firestore","require","_firebaseConfig","_habitStreaks","_dateUtils","_errorHandling","_collections","_habitStreakSchemas","StreakService","exports","_classCallCheck2","default","_createClass2","key","value","_calculateStreak","_asyncToGenerator2","habitId","userId","_this","Error","retryWithBackoff","runTransaction","db","_ref2","transaction","streakId","generateStreakId","streaksCollection","getHabitStreaksCollection","streakDocRef","doc","streakDoc","get","completionsCollection","getHabitCompletionsCollection","completionsQuery","query","where","completionsSnapshot","getDocs","completions","docs","map","transformFirestoreToCompletion","id","data","sort","a","b","completedAt","toMillis","calculatedStreak","calculateStreakFromCompletions","existingStreak","exists","transformFirestoreToStreak","updatedStreak","mergeStreakData","streakData","transformStreakToFirestore","set","_x3","apply","arguments","error","message","getUserFriendlyErrorMessage","calculateStreak","_x","_x2","_recordCompletion","completion","recordedCompletion","completionService","recordCompletion","_x4","_useStreakFreeze","missedDate","_ref4","streak","validateUserOwnership","freezesAvailable","Object","assign","freezesUsed","protectedCompletion","Timestamp","fromDate","parseDateString","timezone","getUserTimezone","notes","difficulty","createdAt","serverTimestamp","completionRef","_x8","useStreakFreeze","_x5","_x6","_x7","_getHabitCalendar","days","_this2","endDate","getCurrentDateString","startDate","formatDateToString","Date","now","filter","compDateString","timestampToDateString","getHabitStreak","dateRange","generateDateRange","calendarDays","date","find","comp","isInStreak","isDateInCurrentStreak","completed","isToday","completionTime","toDate","toLocaleTimeString","undefined","getHabitCalendar","_x9","_x0","_x1","_x10","_checkMilestones","newMilestones","existingMilestoneDays","milestones","m","milestoneDay","MILESTONE_DAYS","currentStreak","includes","milestone","achievedAt","celebrated","push","length","concat","_toConsumableArray2","_ref6","_x12","checkMilestones","_x11","_getHabitStreak","getDoc","validateStreakDocument","_x13","_x14","_initializeHabitStreak","currentDate","initialStreak","bestStreak","lastCompletionDate","streakStartDate","_ref7","_x17","initializeHabitStreak","_x15","_x16","_resetStreak","resetDate","_ref9","resetStreak","_x21","_x18","_x19","_x20","_completions$","completionDates","uniqueDates","Set","today","yesterday","i","previousDate","areConsecutiveDays","tempStreak","Math","max","calculated","existing","streakStart","checkDate","streakEnd","setDate","getDate","streakService"],"sources":["streakService.ts"],"sourcesContent":["import {\n    doc,\n    getDoc,\n    getDocs,\n    query,\n    runTransaction,\n    serverTimestamp,\n    Timestamp,\n    where,\n} from \"firebase/firestore\";\nimport { db } from \"../../firebaseConfig\";\nimport {\n    CalendarDay,\n    HabitCompletion,\n    HabitStreak,\n    MILESTONE_DAYS,\n    StreakMilestone,\n} from \"../../types/habit-streaks\";\nimport {\n    areConsecutiveDays,\n    formatDateToString,\n    generateDateRange,\n    getCurrentDateString,\n    getUserTimezone,\n    isToday,\n    parseDateString,\n    timestampToDateString,\n} from \"../../utils/dateUtils\";\nimport {\n    getUserFriendlyErrorMessage,\n    retryWithBackoff,\n} from \"../../utils/errorHandling\";\nimport {\n    getHabitCompletionsCollection,\n    getHabitStreaksCollection,\n} from \"./collections\";\nimport { StreakService as IStreakService } from \"./habitStreakInterfaces\";\nimport {\n    generateStreakId,\n    transformFirestoreToCompletion,\n    transformFirestoreToStreak,\n    transformStreakToFirestore,\n    validateStreakDocument,\n    validateUserOwnership,\n} from \"./habitStreakSchemas\";\n\n/**\n * StreakService Implementation\n *\n * Handles all streak calculation, tracking, and management functionality\n * with timezone awareness and data integrity protection.\n */\nexport class StreakService implements IStreakService {\n    /**\n     * Calculate and update streak information for a habit\n     * Requirements: 1.1, 1.2, 1.3\n     */\n    async calculateStreak(habitId: string, userId: string): Promise<HabitStreak> {\n        if (!habitId || !userId) {\n            throw new Error(\"Habit ID and User ID are required\");\n        }\n\n        try {\n            return await retryWithBackoff(async () => {\n                return await runTransaction(db, async (transaction) => {\n                    // Get current streak data\n                    const streakId = generateStreakId(userId, habitId);\n                    const streaksCollection = getHabitStreaksCollection();\n                    const streakDocRef = doc(streaksCollection, streakId);\n                    const streakDoc = await transaction.get(streakDocRef);\n\n                    // Get all completions for this habit\n                    const completionsCollection = getHabitCompletionsCollection();\n                    const completionsQuery = query(\n                        completionsCollection,\n                        where(\"habitId\", \"==\", habitId),\n                        where(\"userId\", \"==\", userId),\n                    );\n                    const completionsSnapshot = await getDocs(completionsQuery);\n\n                    // Transform completions and sort by date\n                    const completions = completionsSnapshot.docs\n                        .map((doc) => transformFirestoreToCompletion(doc.id, doc.data()))\n                        .sort(\n                            (a, b) => a.completedAt.toMillis() - b.completedAt.toMillis(),\n                        );\n\n                    // Calculate streak from completions\n                    const calculatedStreak = this.calculateStreakFromCompletions(\n                        completions,\n                        habitId,\n                        userId,\n                    );\n\n                    // Merge with existing data if available\n                    let existingStreak: HabitStreak | null = null;\n                    if (streakDoc.exists()) {\n                        existingStreak = transformFirestoreToStreak(streakDoc.data());\n                    }\n\n                    const updatedStreak = this.mergeStreakData(\n                        calculatedStreak,\n                        existingStreak,\n                    );\n\n                    // Save updated streak\n                    const streakData = transformStreakToFirestore(updatedStreak);\n                    transaction.set(streakDocRef, streakData);\n\n                    return updatedStreak;\n                });\n            });\n        } catch (error) {\n            const message = getUserFriendlyErrorMessage(error);\n            throw new Error(`Failed to calculate streak: ${message}`);\n        }\n    }\n\n    /**\n     * Record a new habit completion and update streak\n     * Requirements: 5.1, 12.1\n     */\n    async recordCompletion(\n        completion: Omit<HabitCompletion, \"id\">,\n    ): Promise<HabitCompletion> {\n        // Delegate to completion service for recording\n        const recordedCompletion =\n            await completionService.recordCompletion(completion);\n\n        // Update streak after successful completion recording\n        await this.calculateStreak(completion.habitId, completion.userId);\n\n        return recordedCompletion;\n    }\n\n    /**\n     * Use a streak freeze to protect from a missed day\n     * Requirements: 4.1, 4.2, 4.5\n     */\n    async useStreakFreeze(\n        habitId: string,\n        userId: string,\n        missedDate: string,\n    ): Promise<boolean> {\n        if (!habitId || !userId || !missedDate) {\n            throw new Error(\"Habit ID, User ID, and missed date are required\");\n        }\n\n        try {\n            return await retryWithBackoff(async () => {\n                return await runTransaction(db, async (transaction) => {\n                    const streakId = generateStreakId(userId, habitId);\n                    const streaksCollection = getHabitStreaksCollection();\n                    const streakDocRef = doc(streaksCollection, streakId);\n                    const streakDoc = await transaction.get(streakDocRef);\n\n                    if (!streakDoc.exists()) {\n                        throw new Error(\"Streak data not found\");\n                    }\n\n                    const streak = transformFirestoreToStreak(streakDoc.data());\n\n                    // Validate user ownership\n                    if (!validateUserOwnership(userId, streak.userId)) {\n                        throw new Error(\"Unauthorized access to streak data\");\n                    }\n\n                    // Check if freeze is available\n                    if (streak.freezesAvailable <= 0) {\n                        return false;\n                    }\n\n                    // Use the freeze\n                    const updatedStreak: HabitStreak = {\n                        ...streak,\n                        freezesAvailable: streak.freezesAvailable - 1,\n                        freezesUsed: streak.freezesUsed + 1,\n                    };\n\n                    // Create a \"protected\" completion record for the missed date\n                    const protectedCompletion = {\n                        habitId,\n                        userId,\n                        completedAt: Timestamp.fromDate(parseDateString(missedDate)),\n                        timezone: getUserTimezone(),\n                        notes: \"Protected by streak freeze\",\n                        difficulty: \"easy\" as const,\n                        createdAt: serverTimestamp(),\n                    };\n\n                    const completionsCollection = getHabitCompletionsCollection();\n                    const completionRef = doc(completionsCollection);\n                    transaction.set(completionRef, protectedCompletion);\n\n                    // Update streak data\n                    const streakData = transformStreakToFirestore(updatedStreak);\n                    transaction.set(streakDocRef, streakData);\n\n                    return true;\n                });\n            });\n        } catch (error) {\n            const message = getUserFriendlyErrorMessage(error);\n            throw new Error(`Failed to use streak freeze: ${message}`);\n        }\n    }\n\n    /**\n     * Get calendar data for a habit showing completion status\n     * Requirements: 2.1, 2.2, 2.3, 2.4, 2.5\n     */\n    async getHabitCalendar(\n        habitId: string,\n        userId: string,\n        days: number,\n        timezone: string,\n    ): Promise<CalendarDay[]> {\n        if (!habitId || !userId) {\n            throw new Error(\"Habit ID and User ID are required\");\n        }\n\n        try {\n            return await retryWithBackoff(async () => {\n                // Get date range for calendar\n                const endDate = getCurrentDateString(timezone);\n                const startDate = formatDateToString(\n                    new Date(Date.now() - (days - 1) * 24 * 60 * 60 * 1000),\n                    timezone,\n                );\n\n                // Get completions for the date range\n                const completionsCollection = getHabitCompletionsCollection();\n                const completionsQuery = query(\n                    completionsCollection,\n                    where(\"habitId\", \"==\", habitId),\n                    where(\"userId\", \"==\", userId),\n                );\n                const completionsSnapshot = await getDocs(completionsQuery);\n\n                const completions = completionsSnapshot.docs\n                    .map((doc) => transformFirestoreToCompletion(doc.id, doc.data()))\n                    .filter((completion) => {\n                        const compDateString = timestampToDateString(\n                            completion.completedAt,\n                            timezone,\n                        );\n                        return compDateString >= startDate && compDateString <= endDate;\n                    });\n\n                // Get streak data for highlighting\n                const streak = await this.getHabitStreak(habitId, userId);\n\n                // Generate calendar days\n                const dateRange = generateDateRange(startDate, endDate);\n                const calendarDays: CalendarDay[] = dateRange.map((date) => {\n                    const completion = completions.find(\n                        (comp) =>\n                            timestampToDateString(comp.completedAt, timezone) === date,\n                    );\n\n                    const isInStreak = this.isDateInCurrentStreak(date, streak);\n\n                    return {\n                        date,\n                        completed: !!completion,\n                        isToday: isToday(date, timezone),\n                        isInStreak,\n                        completionTime: completion\n                            ? completion.completedAt.toDate().toLocaleTimeString()\n                            : undefined,\n                        notes: completion?.notes,\n                    };\n                });\n\n                return calendarDays;\n            });\n        } catch (error) {\n            const message = getUserFriendlyErrorMessage(error);\n            throw new Error(`Failed to get habit calendar: ${message}`);\n        }\n    }\n\n    /**\n     * Check for new milestones and return any that should be celebrated\n     * Requirements: 3.1, 3.2, 4.4\n     */\n    async checkMilestones(streak: HabitStreak): Promise<StreakMilestone[]> {\n        const newMilestones: StreakMilestone[] = [];\n        const existingMilestoneDays = streak.milestones.map((m) => m.days);\n\n        for (const milestoneDay of MILESTONE_DAYS) {\n            if (\n                streak.currentStreak >= milestoneDay &&\n                !existingMilestoneDays.includes(milestoneDay)\n            ) {\n                const milestone: StreakMilestone = {\n                    days: milestoneDay,\n                    achievedAt: Timestamp.now(),\n                    celebrated: false,\n                };\n                newMilestones.push(milestone);\n\n                // Award streak freeze for 30-day milestones\n                if (milestoneDay === 30) {\n                    streak.freezesAvailable += 1;\n                }\n            }\n        }\n\n        // Update streak with new milestones\n        if (newMilestones.length > 0) {\n            const updatedStreak: HabitStreak = {\n                ...streak,\n                milestones: [...streak.milestones, ...newMilestones],\n            };\n\n            const streakId = generateStreakId(streak.userId, streak.habitId);\n            const streaksCollection = getHabitStreaksCollection();\n            const streakDocRef = doc(streaksCollection, streakId);\n            const streakData = transformStreakToFirestore(updatedStreak);\n\n            await runTransaction(db, async (transaction) => {\n                transaction.set(streakDocRef, streakData);\n            });\n        }\n\n        return newMilestones;\n    }\n\n    /**\n     * Get streak information for a specific habit\n     */\n    async getHabitStreak(\n        habitId: string,\n        userId: string,\n    ): Promise<HabitStreak | null> {\n        if (!habitId || !userId) {\n            throw new Error(\"Habit ID and User ID are required\");\n        }\n\n        try {\n            const streakId = generateStreakId(userId, habitId);\n            const streaksCollection = getHabitStreaksCollection();\n            const streakDocRef = doc(streaksCollection, streakId);\n            const streakDoc = await getDoc(streakDocRef);\n\n            if (!streakDoc.exists()) {\n                return null;\n            }\n\n            const streakData = streakDoc.data();\n            if (!validateStreakDocument(streakData)) {\n                throw new Error(\"Invalid streak data format\");\n            }\n\n            return transformFirestoreToStreak(streakData);\n        } catch (error) {\n            const message = getUserFriendlyErrorMessage(error);\n            throw new Error(`Failed to get habit streak: ${message}`);\n        }\n    }\n\n    /**\n     * Initialize streak data for a new habit\n     */\n    async initializeHabitStreak(\n        habitId: string,\n        userId: string,\n    ): Promise<HabitStreak> {\n        if (!habitId || !userId) {\n            throw new Error(\"Habit ID and User ID are required\");\n        }\n\n        const currentDate = getCurrentDateString(getUserTimezone());\n        const initialStreak: HabitStreak = {\n            habitId,\n            userId,\n            currentStreak: 0,\n            bestStreak: 0,\n            lastCompletionDate: \"\",\n            streakStartDate: currentDate,\n            freezesAvailable: 0,\n            freezesUsed: 0,\n            milestones: [],\n        };\n\n        try {\n            const streakId = generateStreakId(userId, habitId);\n            const streaksCollection = getHabitStreaksCollection();\n            const streakDocRef = doc(streaksCollection, streakId);\n            const streakData = transformStreakToFirestore(initialStreak);\n\n            await runTransaction(db, async (transaction) => {\n                transaction.set(streakDocRef, streakData);\n            });\n\n            return initialStreak;\n        } catch (error) {\n            const message = getUserFriendlyErrorMessage(error);\n            throw new Error(`Failed to initialize habit streak: ${message}`);\n        }\n    }\n\n    /**\n     * Reset a streak (used when streak is broken and no freeze available)\n     * Requirements: 1.2\n     */\n    async resetStreak(\n        habitId: string,\n        userId: string,\n        resetDate: string,\n    ): Promise<HabitStreak> {\n        if (!habitId || !userId || !resetDate) {\n            throw new Error(\"Habit ID, User ID, and reset date are required\");\n        }\n\n        try {\n            return await retryWithBackoff(async () => {\n                return await runTransaction(db, async (transaction) => {\n                    const streakId = generateStreakId(userId, habitId);\n                    const streaksCollection = getHabitStreaksCollection();\n                    const streakDocRef = doc(streaksCollection, streakId);\n                    const streakDoc = await transaction.get(streakDocRef);\n\n                    if (!streakDoc.exists()) {\n                        throw new Error(\"Streak data not found\");\n                    }\n\n                    const streak = transformFirestoreToStreak(streakDoc.data());\n\n                    // Validate user ownership\n                    if (!validateUserOwnership(userId, streak.userId)) {\n                        throw new Error(\"Unauthorized access to streak data\");\n                    }\n\n                    const resetStreak: HabitStreak = {\n                        ...streak,\n                        currentStreak: 0,\n                        lastCompletionDate: \"\",\n                        streakStartDate: resetDate,\n                    };\n\n                    const streakData = transformStreakToFirestore(resetStreak);\n                    transaction.set(streakDocRef, streakData);\n\n                    return resetStreak;\n                });\n            });\n        } catch (error) {\n            const message = getUserFriendlyErrorMessage(error);\n            throw new Error(`Failed to reset streak: ${message}`);\n        }\n    }\n\n    // Private helper methods\n\n    /**\n     * Calculate streak from completion records\n     */\n    private calculateStreakFromCompletions(\n        completions: HabitCompletion[],\n        habitId: string,\n        userId: string,\n    ): HabitStreak {\n        if (completions.length === 0) {\n            return {\n                habitId,\n                userId,\n                currentStreak: 0,\n                bestStreak: 0,\n                lastCompletionDate: \"\",\n                streakStartDate: getCurrentDateString(getUserTimezone()),\n                freezesAvailable: 0,\n                freezesUsed: 0,\n                milestones: [],\n            };\n        }\n\n        const timezone = completions[0]?.timezone || getUserTimezone();\n        const completionDates = completions.map((comp) =>\n            timestampToDateString(comp.completedAt, timezone),\n        );\n\n        // Remove duplicates and sort\n        const uniqueDates = [...new Set(completionDates)].sort();\n\n        // Calculate current streak (from most recent completion backwards)\n        let currentStreak = 0;\n        let streakStartDate = \"\";\n        const today = getCurrentDateString(timezone);\n        const yesterday = formatDateToString(\n            new Date(Date.now() - 24 * 60 * 60 * 1000),\n            timezone,\n        );\n\n        // Check if there's a completion today or yesterday to start counting\n        const lastCompletionDate = uniqueDates[uniqueDates.length - 1];\n        if (lastCompletionDate === today || lastCompletionDate === yesterday) {\n            currentStreak = 1;\n            streakStartDate = lastCompletionDate;\n\n            // Count backwards for consecutive days\n            for (let i = uniqueDates.length - 2; i >= 0; i--) {\n                const currentDate = uniqueDates[i + 1];\n                const previousDate = uniqueDates[i];\n\n                if (areConsecutiveDays(previousDate, currentDate)) {\n                    currentStreak++;\n                    streakStartDate = previousDate;\n                } else {\n                    break;\n                }\n            }\n        }\n\n        // Calculate best streak (longest consecutive sequence)\n        let bestStreak = 0;\n        let tempStreak = 1;\n\n        for (let i = 1; i < uniqueDates.length; i++) {\n            if (areConsecutiveDays(uniqueDates[i - 1], uniqueDates[i])) {\n                tempStreak++;\n            } else {\n                bestStreak = Math.max(bestStreak, tempStreak);\n                tempStreak = 1;\n            }\n        }\n        bestStreak = Math.max(bestStreak, tempStreak, currentStreak);\n\n        return {\n            habitId,\n            userId,\n            currentStreak,\n            bestStreak,\n            lastCompletionDate,\n            streakStartDate,\n            freezesAvailable: 0,\n            freezesUsed: 0,\n            milestones: [],\n        };\n    }\n\n    /**\n     * Merge calculated streak with existing streak data\n     */\n    private mergeStreakData(\n        calculated: HabitStreak,\n        existing: HabitStreak | null,\n    ): HabitStreak {\n        if (!existing) {\n            return calculated;\n        }\n\n        return {\n            ...calculated,\n            freezesAvailable: existing.freezesAvailable,\n            freezesUsed: existing.freezesUsed,\n            milestones: existing.milestones,\n            // Ensure best streak never decreases\n            bestStreak: Math.max(calculated.bestStreak, existing.bestStreak),\n        };\n    }\n\n    /**\n     * Check if a date is within the current streak period\n     */\n    private isDateInCurrentStreak(\n        date: string,\n        streak: HabitStreak | null,\n    ): boolean {\n        if (!streak || streak.currentStreak === 0 || !streak.streakStartDate) {\n            return false;\n        }\n\n        const streakStart = parseDateString(streak.streakStartDate);\n        const checkDate = parseDateString(date);\n        const streakEnd = new Date(streakStart);\n        streakEnd.setDate(streakEnd.getDate() + streak.currentStreak - 1);\n\n        return checkDate >= streakStart && checkDate <= streakEnd;\n    }\n}\n\n// Export singleton instance\nexport const streakService = new StreakService();\n"],"mappings":"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","ignoreList":[]}