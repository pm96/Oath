fb0934863cf1934047ed70cb51291bf7
var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault").default;
Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.streakService = exports.StreakService = void 0;
var _toConsumableArray2 = _interopRequireDefault(require("@babel/runtime/helpers/toConsumableArray"));
var _asyncToGenerator2 = _interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));
var _classCallCheck2 = _interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));
var _createClass2 = _interopRequireDefault(require("@babel/runtime/helpers/createClass"));
var _firestore = require("firebase/firestore");
var _firebaseConfig = require("../../firebaseConfig");
var _habitStreaks = require("../../types/habit-streaks");
var _dateUtils = require("../../utils/dateUtils");
var _errorHandling = require("../../utils/errorHandling");
var _collections = require("./collections");
var _habitStreakSchemas = require("./habitStreakSchemas");
var StreakService = exports.StreakService = function () {
  function StreakService() {
    (0, _classCallCheck2.default)(this, StreakService);
  }
  return (0, _createClass2.default)(StreakService, [{
    key: "calculateStreak",
    value: (function () {
      var _calculateStreak = (0, _asyncToGenerator2.default)(function* (habitId, userId) {
        var _this = this;
        if (!habitId || !userId) {
          throw new Error("Habit ID and User ID are required");
        }
        try {
          return yield (0, _errorHandling.retryWithBackoff)((0, _asyncToGenerator2.default)(function* () {
            return yield (0, _firestore.runTransaction)(_firebaseConfig.db, function () {
              var _ref2 = (0, _asyncToGenerator2.default)(function* (transaction) {
                var streakId = (0, _habitStreakSchemas.generateStreakId)(userId, habitId);
                var streaksCollection = (0, _collections.getHabitStreaksCollection)();
                var streakDocRef = (0, _firestore.doc)(streaksCollection, streakId);
                var streakDoc = yield transaction.get(streakDocRef);
                var completionsCollection = (0, _collections.getHabitCompletionsCollection)();
                var completionsQuery = (0, _firestore.query)(completionsCollection, (0, _firestore.where)("habitId", "==", habitId), (0, _firestore.where)("userId", "==", userId));
                var completionsSnapshot = yield (0, _firestore.getDocs)(completionsQuery);
                var completions = completionsSnapshot.docs.map(function (doc) {
                  return (0, _habitStreakSchemas.transformFirestoreToCompletion)(doc.id, doc.data());
                }).sort(function (a, b) {
                  return a.completedAt.toMillis() - b.completedAt.toMillis();
                });
                var calculatedStreak = _this.calculateStreakFromCompletions(completions, habitId, userId);
                var existingStreak = null;
                if (streakDoc.exists()) {
                  existingStreak = (0, _habitStreakSchemas.transformFirestoreToStreak)(streakDoc.data());
                }
                var updatedStreak = _this.mergeStreakData(calculatedStreak, existingStreak);
                var streakData = (0, _habitStreakSchemas.transformStreakToFirestore)(updatedStreak);
                transaction.set(streakDocRef, streakData);
                return updatedStreak;
              });
              return function (_x3) {
                return _ref2.apply(this, arguments);
              };
            }());
          }));
        } catch (error) {
          var message = (0, _errorHandling.getUserFriendlyErrorMessage)(error);
          throw new Error(`Failed to calculate streak: ${message}`);
        }
      });
      function calculateStreak(_x, _x2) {
        return _calculateStreak.apply(this, arguments);
      }
      return calculateStreak;
    }())
  }, {
    key: "recordCompletion",
    value: (function () {
      var _recordCompletion = (0, _asyncToGenerator2.default)(function* (completion) {
        var recordedCompletion = yield completionService.recordCompletion(completion);
        yield this.calculateStreak(completion.habitId, completion.userId);
        return recordedCompletion;
      });
      function recordCompletion(_x4) {
        return _recordCompletion.apply(this, arguments);
      }
      return recordCompletion;
    }())
  }, {
    key: "useStreakFreeze",
    value: (function () {
      var _useStreakFreeze = (0, _asyncToGenerator2.default)(function* (habitId, userId, missedDate) {
        if (!habitId || !userId || !missedDate) {
          throw new Error("Habit ID, User ID, and missed date are required");
        }
        try {
          return yield (0, _errorHandling.retryWithBackoff)((0, _asyncToGenerator2.default)(function* () {
            return yield (0, _firestore.runTransaction)(_firebaseConfig.db, function () {
              var _ref4 = (0, _asyncToGenerator2.default)(function* (transaction) {
                var streakId = (0, _habitStreakSchemas.generateStreakId)(userId, habitId);
                var streaksCollection = (0, _collections.getHabitStreaksCollection)();
                var streakDocRef = (0, _firestore.doc)(streaksCollection, streakId);
                var streakDoc = yield transaction.get(streakDocRef);
                if (!streakDoc.exists()) {
                  throw new Error("Streak data not found");
                }
                var streak = (0, _habitStreakSchemas.transformFirestoreToStreak)(streakDoc.data());
                if (!(0, _habitStreakSchemas.validateUserOwnership)(userId, streak.userId)) {
                  throw new Error("Unauthorized access to streak data");
                }
                if (streak.freezesAvailable <= 0) {
                  return false;
                }
                var updatedStreak = Object.assign({}, streak, {
                  freezesAvailable: streak.freezesAvailable - 1,
                  freezesUsed: streak.freezesUsed + 1
                });
                var protectedCompletion = {
                  habitId: habitId,
                  userId: userId,
                  completedAt: _firestore.Timestamp.fromDate((0, _dateUtils.parseDateString)(missedDate)),
                  timezone: (0, _dateUtils.getUserTimezone)(),
                  notes: "Protected by streak freeze",
                  difficulty: "easy",
                  createdAt: (0, _firestore.serverTimestamp)()
                };
                var completionsCollection = (0, _collections.getHabitCompletionsCollection)();
                var completionRef = (0, _firestore.doc)(completionsCollection);
                transaction.set(completionRef, protectedCompletion);
                var streakData = (0, _habitStreakSchemas.transformStreakToFirestore)(updatedStreak);
                transaction.set(streakDocRef, streakData);
                return true;
              });
              return function (_x8) {
                return _ref4.apply(this, arguments);
              };
            }());
          }));
        } catch (error) {
          var message = (0, _errorHandling.getUserFriendlyErrorMessage)(error);
          throw new Error(`Failed to use streak freeze: ${message}`);
        }
      });
      function useStreakFreeze(_x5, _x6, _x7) {
        return _useStreakFreeze.apply(this, arguments);
      }
      return useStreakFreeze;
    }())
  }, {
    key: "getHabitCalendar",
    value: (function () {
      var _getHabitCalendar = (0, _asyncToGenerator2.default)(function* (habitId, userId, days, timezone) {
        var _this2 = this;
        if (!habitId || !userId) {
          throw new Error("Habit ID and User ID are required");
        }
        try {
          return yield (0, _errorHandling.retryWithBackoff)((0, _asyncToGenerator2.default)(function* () {
            var endDate = (0, _dateUtils.getCurrentDateString)(timezone);
            var startDate = (0, _dateUtils.formatDateToString)(new Date(Date.now() - (days - 1) * 24 * 60 * 60 * 1000), timezone);
            var completionsCollection = (0, _collections.getHabitCompletionsCollection)();
            var completionsQuery = (0, _firestore.query)(completionsCollection, (0, _firestore.where)("habitId", "==", habitId), (0, _firestore.where)("userId", "==", userId));
            var completionsSnapshot = yield (0, _firestore.getDocs)(completionsQuery);
            var completions = completionsSnapshot.docs.map(function (doc) {
              return (0, _habitStreakSchemas.transformFirestoreToCompletion)(doc.id, doc.data());
            }).filter(function (completion) {
              var compDateString = (0, _dateUtils.timestampToDateString)(completion.completedAt, timezone);
              return compDateString >= startDate && compDateString <= endDate;
            });
            var streak = yield _this2.getHabitStreak(habitId, userId);
            var dateRange = (0, _dateUtils.generateDateRange)(startDate, endDate);
            var calendarDays = dateRange.map(function (date) {
              var completion = completions.find(function (comp) {
                return (0, _dateUtils.timestampToDateString)(comp.completedAt, timezone) === date;
              });
              var isInStreak = _this2.isDateInCurrentStreak(date, streak);
              return {
                date: date,
                completed: !!completion,
                isToday: (0, _dateUtils.isToday)(date, timezone),
                isInStreak: isInStreak,
                completionTime: completion ? completion.completedAt.toDate().toLocaleTimeString() : undefined,
                notes: completion == null ? void 0 : completion.notes
              };
            });
            return calendarDays;
          }));
        } catch (error) {
          var message = (0, _errorHandling.getUserFriendlyErrorMessage)(error);
          throw new Error(`Failed to get habit calendar: ${message}`);
        }
      });
      function getHabitCalendar(_x9, _x0, _x1, _x10) {
        return _getHabitCalendar.apply(this, arguments);
      }
      return getHabitCalendar;
    }())
  }, {
    key: "checkMilestones",
    value: (function () {
      var _checkMilestones = (0, _asyncToGenerator2.default)(function* (streak) {
        var newMilestones = [];
        var existingMilestoneDays = streak.milestones.map(function (m) {
          return m.days;
        });
        for (var milestoneDay of _habitStreaks.MILESTONE_DAYS) {
          if (streak.currentStreak >= milestoneDay && !existingMilestoneDays.includes(milestoneDay)) {
            var milestone = {
              days: milestoneDay,
              achievedAt: _firestore.Timestamp.now(),
              celebrated: false
            };
            newMilestones.push(milestone);
            if (milestoneDay === 30) {
              streak.freezesAvailable += 1;
            }
          }
        }
        if (newMilestones.length > 0) {
          var updatedStreak = Object.assign({}, streak, {
            milestones: [].concat((0, _toConsumableArray2.default)(streak.milestones), newMilestones)
          });
          var streakId = (0, _habitStreakSchemas.generateStreakId)(streak.userId, streak.habitId);
          var streaksCollection = (0, _collections.getHabitStreaksCollection)();
          var streakDocRef = (0, _firestore.doc)(streaksCollection, streakId);
          var streakData = (0, _habitStreakSchemas.transformStreakToFirestore)(updatedStreak);
          yield (0, _firestore.runTransaction)(_firebaseConfig.db, function () {
            var _ref6 = (0, _asyncToGenerator2.default)(function* (transaction) {
              transaction.set(streakDocRef, streakData);
            });
            return function (_x12) {
              return _ref6.apply(this, arguments);
            };
          }());
        }
        return newMilestones;
      });
      function checkMilestones(_x11) {
        return _checkMilestones.apply(this, arguments);
      }
      return checkMilestones;
    }())
  }, {
    key: "getHabitStreak",
    value: (function () {
      var _getHabitStreak = (0, _asyncToGenerator2.default)(function* (habitId, userId) {
        if (!habitId || !userId) {
          throw new Error("Habit ID and User ID are required");
        }
        try {
          var streakId = (0, _habitStreakSchemas.generateStreakId)(userId, habitId);
          var streaksCollection = (0, _collections.getHabitStreaksCollection)();
          var streakDocRef = (0, _firestore.doc)(streaksCollection, streakId);
          var streakDoc = yield (0, _firestore.getDoc)(streakDocRef);
          if (!streakDoc.exists()) {
            return null;
          }
          var streakData = streakDoc.data();
          if (!(0, _habitStreakSchemas.validateStreakDocument)(streakData)) {
            throw new Error("Invalid streak data format");
          }
          return (0, _habitStreakSchemas.transformFirestoreToStreak)(streakData);
        } catch (error) {
          var message = (0, _errorHandling.getUserFriendlyErrorMessage)(error);
          throw new Error(`Failed to get habit streak: ${message}`);
        }
      });
      function getHabitStreak(_x13, _x14) {
        return _getHabitStreak.apply(this, arguments);
      }
      return getHabitStreak;
    }())
  }, {
    key: "initializeHabitStreak",
    value: (function () {
      var _initializeHabitStreak = (0, _asyncToGenerator2.default)(function* (habitId, userId) {
        if (!habitId || !userId) {
          throw new Error("Habit ID and User ID are required");
        }
        var currentDate = (0, _dateUtils.getCurrentDateString)((0, _dateUtils.getUserTimezone)());
        var initialStreak = {
          habitId: habitId,
          userId: userId,
          currentStreak: 0,
          bestStreak: 0,
          lastCompletionDate: "",
          streakStartDate: currentDate,
          freezesAvailable: 0,
          freezesUsed: 0,
          milestones: []
        };
        try {
          var streakId = (0, _habitStreakSchemas.generateStreakId)(userId, habitId);
          var streaksCollection = (0, _collections.getHabitStreaksCollection)();
          var streakDocRef = (0, _firestore.doc)(streaksCollection, streakId);
          var streakData = (0, _habitStreakSchemas.transformStreakToFirestore)(initialStreak);
          yield (0, _firestore.runTransaction)(_firebaseConfig.db, function () {
            var _ref7 = (0, _asyncToGenerator2.default)(function* (transaction) {
              transaction.set(streakDocRef, streakData);
            });
            return function (_x17) {
              return _ref7.apply(this, arguments);
            };
          }());
          return initialStreak;
        } catch (error) {
          var message = (0, _errorHandling.getUserFriendlyErrorMessage)(error);
          throw new Error(`Failed to initialize habit streak: ${message}`);
        }
      });
      function initializeHabitStreak(_x15, _x16) {
        return _initializeHabitStreak.apply(this, arguments);
      }
      return initializeHabitStreak;
    }())
  }, {
    key: "resetStreak",
    value: (function () {
      var _resetStreak = (0, _asyncToGenerator2.default)(function* (habitId, userId, resetDate) {
        if (!habitId || !userId || !resetDate) {
          throw new Error("Habit ID, User ID, and reset date are required");
        }
        try {
          return yield (0, _errorHandling.retryWithBackoff)((0, _asyncToGenerator2.default)(function* () {
            return yield (0, _firestore.runTransaction)(_firebaseConfig.db, function () {
              var _ref9 = (0, _asyncToGenerator2.default)(function* (transaction) {
                var streakId = (0, _habitStreakSchemas.generateStreakId)(userId, habitId);
                var streaksCollection = (0, _collections.getHabitStreaksCollection)();
                var streakDocRef = (0, _firestore.doc)(streaksCollection, streakId);
                var streakDoc = yield transaction.get(streakDocRef);
                if (!streakDoc.exists()) {
                  throw new Error("Streak data not found");
                }
                var streak = (0, _habitStreakSchemas.transformFirestoreToStreak)(streakDoc.data());
                if (!(0, _habitStreakSchemas.validateUserOwnership)(userId, streak.userId)) {
                  throw new Error("Unauthorized access to streak data");
                }
                var resetStreak = Object.assign({}, streak, {
                  currentStreak: 0,
                  lastCompletionDate: "",
                  streakStartDate: resetDate
                });
                var streakData = (0, _habitStreakSchemas.transformStreakToFirestore)(resetStreak);
                transaction.set(streakDocRef, streakData);
                return resetStreak;
              });
              return function (_x21) {
                return _ref9.apply(this, arguments);
              };
            }());
          }));
        } catch (error) {
          var message = (0, _errorHandling.getUserFriendlyErrorMessage)(error);
          throw new Error(`Failed to reset streak: ${message}`);
        }
      });
      function resetStreak(_x18, _x19, _x20) {
        return _resetStreak.apply(this, arguments);
      }
      return resetStreak;
    }())
  }, {
    key: "calculateStreakFromCompletions",
    value: function calculateStreakFromCompletions(completions, habitId, userId) {
      var _completions$;
      if (completions.length === 0) {
        return {
          habitId: habitId,
          userId: userId,
          currentStreak: 0,
          bestStreak: 0,
          lastCompletionDate: "",
          streakStartDate: (0, _dateUtils.getCurrentDateString)((0, _dateUtils.getUserTimezone)()),
          freezesAvailable: 0,
          freezesUsed: 0,
          milestones: []
        };
      }
      var timezone = ((_completions$ = completions[0]) == null ? void 0 : _completions$.timezone) || (0, _dateUtils.getUserTimezone)();
      var completionDates = completions.map(function (comp) {
        return (0, _dateUtils.timestampToDateString)(comp.completedAt, timezone);
      });
      var uniqueDates = (0, _toConsumableArray2.default)(new Set(completionDates)).sort();
      var currentStreak = 0;
      var streakStartDate = "";
      var today = (0, _dateUtils.getCurrentDateString)(timezone);
      var yesterday = (0, _dateUtils.formatDateToString)(new Date(Date.now() - 24 * 60 * 60 * 1000), timezone);
      var lastCompletionDate = uniqueDates[uniqueDates.length - 1];
      if (lastCompletionDate === today || lastCompletionDate === yesterday) {
        currentStreak = 1;
        streakStartDate = lastCompletionDate;
        for (var i = uniqueDates.length - 2; i >= 0; i--) {
          var currentDate = uniqueDates[i + 1];
          var previousDate = uniqueDates[i];
          if ((0, _dateUtils.areConsecutiveDays)(previousDate, currentDate)) {
            currentStreak++;
            streakStartDate = previousDate;
          } else {
            break;
          }
        }
      }
      var bestStreak = 0;
      var tempStreak = 1;
      for (var _i = 1; _i < uniqueDates.length; _i++) {
        if ((0, _dateUtils.areConsecutiveDays)(uniqueDates[_i - 1], uniqueDates[_i])) {
          tempStreak++;
        } else {
          bestStreak = Math.max(bestStreak, tempStreak);
          tempStreak = 1;
        }
      }
      bestStreak = Math.max(bestStreak, tempStreak, currentStreak);
      return {
        habitId: habitId,
        userId: userId,
        currentStreak: currentStreak,
        bestStreak: bestStreak,
        lastCompletionDate: lastCompletionDate,
        streakStartDate: streakStartDate,
        freezesAvailable: 0,
        freezesUsed: 0,
        milestones: []
      };
    }
  }, {
    key: "mergeStreakData",
    value: function mergeStreakData(calculated, existing) {
      if (!existing) {
        return calculated;
      }
      return Object.assign({}, calculated, {
        freezesAvailable: existing.freezesAvailable,
        freezesUsed: existing.freezesUsed,
        milestones: existing.milestones,
        bestStreak: Math.max(calculated.bestStreak, existing.bestStreak)
      });
    }
  }, {
    key: "isDateInCurrentStreak",
    value: function isDateInCurrentStreak(date, streak) {
      if (!streak || streak.currentStreak === 0 || !streak.streakStartDate) {
        return false;
      }
      var streakStart = (0, _dateUtils.parseDateString)(streak.streakStartDate);
      var checkDate = (0, _dateUtils.parseDateString)(date);
      var streakEnd = new Date(streakStart);
      streakEnd.setDate(streakEnd.getDate() + streak.currentStreak - 1);
      return checkDate >= streakStart && checkDate <= streakEnd;
    }
  }]);
}();
var streakService = exports.streakService = new StreakService();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfZmlyZXN0b3JlIiwicmVxdWlyZSIsIl9maXJlYmFzZUNvbmZpZyIsIl9oYWJpdFN0cmVha3MiLCJfZGF0ZVV0aWxzIiwiX2Vycm9ySGFuZGxpbmciLCJfY29sbGVjdGlvbnMiLCJfaGFiaXRTdHJlYWtTY2hlbWFzIiwiU3RyZWFrU2VydmljZSIsImV4cG9ydHMiLCJfY2xhc3NDYWxsQ2hlY2syIiwiZGVmYXVsdCIsIl9jcmVhdGVDbGFzczIiLCJrZXkiLCJ2YWx1ZSIsIl9jYWxjdWxhdGVTdHJlYWsiLCJfYXN5bmNUb0dlbmVyYXRvcjIiLCJoYWJpdElkIiwidXNlcklkIiwiX3RoaXMiLCJFcnJvciIsInJldHJ5V2l0aEJhY2tvZmYiLCJydW5UcmFuc2FjdGlvbiIsImRiIiwiX3JlZjIiLCJ0cmFuc2FjdGlvbiIsInN0cmVha0lkIiwiZ2VuZXJhdGVTdHJlYWtJZCIsInN0cmVha3NDb2xsZWN0aW9uIiwiZ2V0SGFiaXRTdHJlYWtzQ29sbGVjdGlvbiIsInN0cmVha0RvY1JlZiIsImRvYyIsInN0cmVha0RvYyIsImdldCIsImNvbXBsZXRpb25zQ29sbGVjdGlvbiIsImdldEhhYml0Q29tcGxldGlvbnNDb2xsZWN0aW9uIiwiY29tcGxldGlvbnNRdWVyeSIsInF1ZXJ5Iiwid2hlcmUiLCJjb21wbGV0aW9uc1NuYXBzaG90IiwiZ2V0RG9jcyIsImNvbXBsZXRpb25zIiwiZG9jcyIsIm1hcCIsInRyYW5zZm9ybUZpcmVzdG9yZVRvQ29tcGxldGlvbiIsImlkIiwiZGF0YSIsInNvcnQiLCJhIiwiYiIsImNvbXBsZXRlZEF0IiwidG9NaWxsaXMiLCJjYWxjdWxhdGVkU3RyZWFrIiwiY2FsY3VsYXRlU3RyZWFrRnJvbUNvbXBsZXRpb25zIiwiZXhpc3RpbmdTdHJlYWsiLCJleGlzdHMiLCJ0cmFuc2Zvcm1GaXJlc3RvcmVUb1N0cmVhayIsInVwZGF0ZWRTdHJlYWsiLCJtZXJnZVN0cmVha0RhdGEiLCJzdHJlYWtEYXRhIiwidHJhbnNmb3JtU3RyZWFrVG9GaXJlc3RvcmUiLCJzZXQiLCJfeDMiLCJhcHBseSIsImFyZ3VtZW50cyIsImVycm9yIiwibWVzc2FnZSIsImdldFVzZXJGcmllbmRseUVycm9yTWVzc2FnZSIsImNhbGN1bGF0ZVN0cmVhayIsIl94IiwiX3gyIiwiX3JlY29yZENvbXBsZXRpb24iLCJjb21wbGV0aW9uIiwicmVjb3JkZWRDb21wbGV0aW9uIiwiY29tcGxldGlvblNlcnZpY2UiLCJyZWNvcmRDb21wbGV0aW9uIiwiX3g0IiwiX3VzZVN0cmVha0ZyZWV6ZSIsIm1pc3NlZERhdGUiLCJfcmVmNCIsInN0cmVhayIsInZhbGlkYXRlVXNlck93bmVyc2hpcCIsImZyZWV6ZXNBdmFpbGFibGUiLCJPYmplY3QiLCJhc3NpZ24iLCJmcmVlemVzVXNlZCIsInByb3RlY3RlZENvbXBsZXRpb24iLCJUaW1lc3RhbXAiLCJmcm9tRGF0ZSIsInBhcnNlRGF0ZVN0cmluZyIsInRpbWV6b25lIiwiZ2V0VXNlclRpbWV6b25lIiwibm90ZXMiLCJkaWZmaWN1bHR5IiwiY3JlYXRlZEF0Iiwic2VydmVyVGltZXN0YW1wIiwiY29tcGxldGlvblJlZiIsIl94OCIsInVzZVN0cmVha0ZyZWV6ZSIsIl94NSIsIl94NiIsIl94NyIsIl9nZXRIYWJpdENhbGVuZGFyIiwiZGF5cyIsIl90aGlzMiIsImVuZERhdGUiLCJnZXRDdXJyZW50RGF0ZVN0cmluZyIsInN0YXJ0RGF0ZSIsImZvcm1hdERhdGVUb1N0cmluZyIsIkRhdGUiLCJub3ciLCJmaWx0ZXIiLCJjb21wRGF0ZVN0cmluZyIsInRpbWVzdGFtcFRvRGF0ZVN0cmluZyIsImdldEhhYml0U3RyZWFrIiwiZGF0ZVJhbmdlIiwiZ2VuZXJhdGVEYXRlUmFuZ2UiLCJjYWxlbmRhckRheXMiLCJkYXRlIiwiZmluZCIsImNvbXAiLCJpc0luU3RyZWFrIiwiaXNEYXRlSW5DdXJyZW50U3RyZWFrIiwiY29tcGxldGVkIiwiaXNUb2RheSIsImNvbXBsZXRpb25UaW1lIiwidG9EYXRlIiwidG9Mb2NhbGVUaW1lU3RyaW5nIiwidW5kZWZpbmVkIiwiZ2V0SGFiaXRDYWxlbmRhciIsIl94OSIsIl94MCIsIl94MSIsIl94MTAiLCJfY2hlY2tNaWxlc3RvbmVzIiwibmV3TWlsZXN0b25lcyIsImV4aXN0aW5nTWlsZXN0b25lRGF5cyIsIm1pbGVzdG9uZXMiLCJtIiwibWlsZXN0b25lRGF5IiwiTUlMRVNUT05FX0RBWVMiLCJjdXJyZW50U3RyZWFrIiwiaW5jbHVkZXMiLCJtaWxlc3RvbmUiLCJhY2hpZXZlZEF0IiwiY2VsZWJyYXRlZCIsInB1c2giLCJsZW5ndGgiLCJjb25jYXQiLCJfdG9Db25zdW1hYmxlQXJyYXkyIiwiX3JlZjYiLCJfeDEyIiwiY2hlY2tNaWxlc3RvbmVzIiwiX3gxMSIsIl9nZXRIYWJpdFN0cmVhayIsImdldERvYyIsInZhbGlkYXRlU3RyZWFrRG9jdW1lbnQiLCJfeDEzIiwiX3gxNCIsIl9pbml0aWFsaXplSGFiaXRTdHJlYWsiLCJjdXJyZW50RGF0ZSIsImluaXRpYWxTdHJlYWsiLCJiZXN0U3RyZWFrIiwibGFzdENvbXBsZXRpb25EYXRlIiwic3RyZWFrU3RhcnREYXRlIiwiX3JlZjciLCJfeDE3IiwiaW5pdGlhbGl6ZUhhYml0U3RyZWFrIiwiX3gxNSIsIl94MTYiLCJfcmVzZXRTdHJlYWsiLCJyZXNldERhdGUiLCJfcmVmOSIsInJlc2V0U3RyZWFrIiwiX3gyMSIsIl94MTgiLCJfeDE5IiwiX3gyMCIsIl9jb21wbGV0aW9ucyQiLCJjb21wbGV0aW9uRGF0ZXMiLCJ1bmlxdWVEYXRlcyIsIlNldCIsInRvZGF5IiwieWVzdGVyZGF5IiwiaSIsInByZXZpb3VzRGF0ZSIsImFyZUNvbnNlY3V0aXZlRGF5cyIsInRlbXBTdHJlYWsiLCJNYXRoIiwibWF4IiwiY2FsY3VsYXRlZCIsImV4aXN0aW5nIiwic3RyZWFrU3RhcnQiLCJjaGVja0RhdGUiLCJzdHJlYWtFbmQiLCJzZXREYXRlIiwiZ2V0RGF0ZSIsInN0cmVha1NlcnZpY2UiXSwic291cmNlcyI6WyJzdHJlYWtTZXJ2aWNlLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XG4gICAgZG9jLFxuICAgIGdldERvYyxcbiAgICBnZXREb2NzLFxuICAgIHF1ZXJ5LFxuICAgIHJ1blRyYW5zYWN0aW9uLFxuICAgIHNlcnZlclRpbWVzdGFtcCxcbiAgICBUaW1lc3RhbXAsXG4gICAgd2hlcmUsXG59IGZyb20gXCJmaXJlYmFzZS9maXJlc3RvcmVcIjtcbmltcG9ydCB7IGRiIH0gZnJvbSBcIi4uLy4uL2ZpcmViYXNlQ29uZmlnXCI7XG5pbXBvcnQge1xuICAgIENhbGVuZGFyRGF5LFxuICAgIEhhYml0Q29tcGxldGlvbixcbiAgICBIYWJpdFN0cmVhayxcbiAgICBNSUxFU1RPTkVfREFZUyxcbiAgICBTdHJlYWtNaWxlc3RvbmUsXG59IGZyb20gXCIuLi8uLi90eXBlcy9oYWJpdC1zdHJlYWtzXCI7XG5pbXBvcnQge1xuICAgIGFyZUNvbnNlY3V0aXZlRGF5cyxcbiAgICBmb3JtYXREYXRlVG9TdHJpbmcsXG4gICAgZ2VuZXJhdGVEYXRlUmFuZ2UsXG4gICAgZ2V0Q3VycmVudERhdGVTdHJpbmcsXG4gICAgZ2V0VXNlclRpbWV6b25lLFxuICAgIGlzVG9kYXksXG4gICAgcGFyc2VEYXRlU3RyaW5nLFxuICAgIHRpbWVzdGFtcFRvRGF0ZVN0cmluZyxcbn0gZnJvbSBcIi4uLy4uL3V0aWxzL2RhdGVVdGlsc1wiO1xuaW1wb3J0IHtcbiAgICBnZXRVc2VyRnJpZW5kbHlFcnJvck1lc3NhZ2UsXG4gICAgcmV0cnlXaXRoQmFja29mZixcbn0gZnJvbSBcIi4uLy4uL3V0aWxzL2Vycm9ySGFuZGxpbmdcIjtcbmltcG9ydCB7XG4gICAgZ2V0SGFiaXRDb21wbGV0aW9uc0NvbGxlY3Rpb24sXG4gICAgZ2V0SGFiaXRTdHJlYWtzQ29sbGVjdGlvbixcbn0gZnJvbSBcIi4vY29sbGVjdGlvbnNcIjtcbmltcG9ydCB7IFN0cmVha1NlcnZpY2UgYXMgSVN0cmVha1NlcnZpY2UgfSBmcm9tIFwiLi9oYWJpdFN0cmVha0ludGVyZmFjZXNcIjtcbmltcG9ydCB7XG4gICAgZ2VuZXJhdGVTdHJlYWtJZCxcbiAgICB0cmFuc2Zvcm1GaXJlc3RvcmVUb0NvbXBsZXRpb24sXG4gICAgdHJhbnNmb3JtRmlyZXN0b3JlVG9TdHJlYWssXG4gICAgdHJhbnNmb3JtU3RyZWFrVG9GaXJlc3RvcmUsXG4gICAgdmFsaWRhdGVTdHJlYWtEb2N1bWVudCxcbiAgICB2YWxpZGF0ZVVzZXJPd25lcnNoaXAsXG59IGZyb20gXCIuL2hhYml0U3RyZWFrU2NoZW1hc1wiO1xuXG4vKipcbiAqIFN0cmVha1NlcnZpY2UgSW1wbGVtZW50YXRpb25cbiAqXG4gKiBIYW5kbGVzIGFsbCBzdHJlYWsgY2FsY3VsYXRpb24sIHRyYWNraW5nLCBhbmQgbWFuYWdlbWVudCBmdW5jdGlvbmFsaXR5XG4gKiB3aXRoIHRpbWV6b25lIGF3YXJlbmVzcyBhbmQgZGF0YSBpbnRlZ3JpdHkgcHJvdGVjdGlvbi5cbiAqL1xuZXhwb3J0IGNsYXNzIFN0cmVha1NlcnZpY2UgaW1wbGVtZW50cyBJU3RyZWFrU2VydmljZSB7XG4gICAgLyoqXG4gICAgICogQ2FsY3VsYXRlIGFuZCB1cGRhdGUgc3RyZWFrIGluZm9ybWF0aW9uIGZvciBhIGhhYml0XG4gICAgICogUmVxdWlyZW1lbnRzOiAxLjEsIDEuMiwgMS4zXG4gICAgICovXG4gICAgYXN5bmMgY2FsY3VsYXRlU3RyZWFrKGhhYml0SWQ6IHN0cmluZywgdXNlcklkOiBzdHJpbmcpOiBQcm9taXNlPEhhYml0U3RyZWFrPiB7XG4gICAgICAgIGlmICghaGFiaXRJZCB8fCAhdXNlcklkKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJIYWJpdCBJRCBhbmQgVXNlciBJRCBhcmUgcmVxdWlyZWRcIik7XG4gICAgICAgIH1cblxuICAgICAgICB0cnkge1xuICAgICAgICAgICAgcmV0dXJuIGF3YWl0IHJldHJ5V2l0aEJhY2tvZmYoYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgICAgIHJldHVybiBhd2FpdCBydW5UcmFuc2FjdGlvbihkYiwgYXN5bmMgKHRyYW5zYWN0aW9uKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIC8vIEdldCBjdXJyZW50IHN0cmVhayBkYXRhXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHN0cmVha0lkID0gZ2VuZXJhdGVTdHJlYWtJZCh1c2VySWQsIGhhYml0SWQpO1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBzdHJlYWtzQ29sbGVjdGlvbiA9IGdldEhhYml0U3RyZWFrc0NvbGxlY3Rpb24oKTtcbiAgICAgICAgICAgICAgICAgICAgY29uc3Qgc3RyZWFrRG9jUmVmID0gZG9jKHN0cmVha3NDb2xsZWN0aW9uLCBzdHJlYWtJZCk7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHN0cmVha0RvYyA9IGF3YWl0IHRyYW5zYWN0aW9uLmdldChzdHJlYWtEb2NSZWYpO1xuXG4gICAgICAgICAgICAgICAgICAgIC8vIEdldCBhbGwgY29tcGxldGlvbnMgZm9yIHRoaXMgaGFiaXRcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgY29tcGxldGlvbnNDb2xsZWN0aW9uID0gZ2V0SGFiaXRDb21wbGV0aW9uc0NvbGxlY3Rpb24oKTtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgY29tcGxldGlvbnNRdWVyeSA9IHF1ZXJ5KFxuICAgICAgICAgICAgICAgICAgICAgICAgY29tcGxldGlvbnNDb2xsZWN0aW9uLFxuICAgICAgICAgICAgICAgICAgICAgICAgd2hlcmUoXCJoYWJpdElkXCIsIFwiPT1cIiwgaGFiaXRJZCksXG4gICAgICAgICAgICAgICAgICAgICAgICB3aGVyZShcInVzZXJJZFwiLCBcIj09XCIsIHVzZXJJZCksXG4gICAgICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGNvbXBsZXRpb25zU25hcHNob3QgPSBhd2FpdCBnZXREb2NzKGNvbXBsZXRpb25zUXVlcnkpO1xuXG4gICAgICAgICAgICAgICAgICAgIC8vIFRyYW5zZm9ybSBjb21wbGV0aW9ucyBhbmQgc29ydCBieSBkYXRlXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGNvbXBsZXRpb25zID0gY29tcGxldGlvbnNTbmFwc2hvdC5kb2NzXG4gICAgICAgICAgICAgICAgICAgICAgICAubWFwKChkb2MpID0+IHRyYW5zZm9ybUZpcmVzdG9yZVRvQ29tcGxldGlvbihkb2MuaWQsIGRvYy5kYXRhKCkpKVxuICAgICAgICAgICAgICAgICAgICAgICAgLnNvcnQoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgKGEsIGIpID0+IGEuY29tcGxldGVkQXQudG9NaWxsaXMoKSAtIGIuY29tcGxldGVkQXQudG9NaWxsaXMoKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICk7XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gQ2FsY3VsYXRlIHN0cmVhayBmcm9tIGNvbXBsZXRpb25zXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGNhbGN1bGF0ZWRTdHJlYWsgPSB0aGlzLmNhbGN1bGF0ZVN0cmVha0Zyb21Db21wbGV0aW9ucyhcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbXBsZXRpb25zLFxuICAgICAgICAgICAgICAgICAgICAgICAgaGFiaXRJZCxcbiAgICAgICAgICAgICAgICAgICAgICAgIHVzZXJJZCxcbiAgICAgICAgICAgICAgICAgICAgKTtcblxuICAgICAgICAgICAgICAgICAgICAvLyBNZXJnZSB3aXRoIGV4aXN0aW5nIGRhdGEgaWYgYXZhaWxhYmxlXG4gICAgICAgICAgICAgICAgICAgIGxldCBleGlzdGluZ1N0cmVhazogSGFiaXRTdHJlYWsgfCBudWxsID0gbnVsbDtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHN0cmVha0RvYy5leGlzdHMoKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgZXhpc3RpbmdTdHJlYWsgPSB0cmFuc2Zvcm1GaXJlc3RvcmVUb1N0cmVhayhzdHJlYWtEb2MuZGF0YSgpKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHVwZGF0ZWRTdHJlYWsgPSB0aGlzLm1lcmdlU3RyZWFrRGF0YShcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhbGN1bGF0ZWRTdHJlYWssXG4gICAgICAgICAgICAgICAgICAgICAgICBleGlzdGluZ1N0cmVhayxcbiAgICAgICAgICAgICAgICAgICAgKTtcblxuICAgICAgICAgICAgICAgICAgICAvLyBTYXZlIHVwZGF0ZWQgc3RyZWFrXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHN0cmVha0RhdGEgPSB0cmFuc2Zvcm1TdHJlYWtUb0ZpcmVzdG9yZSh1cGRhdGVkU3RyZWFrKTtcbiAgICAgICAgICAgICAgICAgICAgdHJhbnNhY3Rpb24uc2V0KHN0cmVha0RvY1JlZiwgc3RyZWFrRGF0YSk7XG5cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVwZGF0ZWRTdHJlYWs7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgIGNvbnN0IG1lc3NhZ2UgPSBnZXRVc2VyRnJpZW5kbHlFcnJvck1lc3NhZ2UoZXJyb3IpO1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBGYWlsZWQgdG8gY2FsY3VsYXRlIHN0cmVhazogJHttZXNzYWdlfWApO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogUmVjb3JkIGEgbmV3IGhhYml0IGNvbXBsZXRpb24gYW5kIHVwZGF0ZSBzdHJlYWtcbiAgICAgKiBSZXF1aXJlbWVudHM6IDUuMSwgMTIuMVxuICAgICAqL1xuICAgIGFzeW5jIHJlY29yZENvbXBsZXRpb24oXG4gICAgICAgIGNvbXBsZXRpb246IE9taXQ8SGFiaXRDb21wbGV0aW9uLCBcImlkXCI+LFxuICAgICk6IFByb21pc2U8SGFiaXRDb21wbGV0aW9uPiB7XG4gICAgICAgIC8vIERlbGVnYXRlIHRvIGNvbXBsZXRpb24gc2VydmljZSBmb3IgcmVjb3JkaW5nXG4gICAgICAgIGNvbnN0IHJlY29yZGVkQ29tcGxldGlvbiA9XG4gICAgICAgICAgICBhd2FpdCBjb21wbGV0aW9uU2VydmljZS5yZWNvcmRDb21wbGV0aW9uKGNvbXBsZXRpb24pO1xuXG4gICAgICAgIC8vIFVwZGF0ZSBzdHJlYWsgYWZ0ZXIgc3VjY2Vzc2Z1bCBjb21wbGV0aW9uIHJlY29yZGluZ1xuICAgICAgICBhd2FpdCB0aGlzLmNhbGN1bGF0ZVN0cmVhayhjb21wbGV0aW9uLmhhYml0SWQsIGNvbXBsZXRpb24udXNlcklkKTtcblxuICAgICAgICByZXR1cm4gcmVjb3JkZWRDb21wbGV0aW9uO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFVzZSBhIHN0cmVhayBmcmVlemUgdG8gcHJvdGVjdCBmcm9tIGEgbWlzc2VkIGRheVxuICAgICAqIFJlcXVpcmVtZW50czogNC4xLCA0LjIsIDQuNVxuICAgICAqL1xuICAgIGFzeW5jIHVzZVN0cmVha0ZyZWV6ZShcbiAgICAgICAgaGFiaXRJZDogc3RyaW5nLFxuICAgICAgICB1c2VySWQ6IHN0cmluZyxcbiAgICAgICAgbWlzc2VkRGF0ZTogc3RyaW5nLFxuICAgICk6IFByb21pc2U8Ym9vbGVhbj4ge1xuICAgICAgICBpZiAoIWhhYml0SWQgfHwgIXVzZXJJZCB8fCAhbWlzc2VkRGF0ZSkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiSGFiaXQgSUQsIFVzZXIgSUQsIGFuZCBtaXNzZWQgZGF0ZSBhcmUgcmVxdWlyZWRcIik7XG4gICAgICAgIH1cblxuICAgICAgICB0cnkge1xuICAgICAgICAgICAgcmV0dXJuIGF3YWl0IHJldHJ5V2l0aEJhY2tvZmYoYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgICAgIHJldHVybiBhd2FpdCBydW5UcmFuc2FjdGlvbihkYiwgYXN5bmMgKHRyYW5zYWN0aW9uKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHN0cmVha0lkID0gZ2VuZXJhdGVTdHJlYWtJZCh1c2VySWQsIGhhYml0SWQpO1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBzdHJlYWtzQ29sbGVjdGlvbiA9IGdldEhhYml0U3RyZWFrc0NvbGxlY3Rpb24oKTtcbiAgICAgICAgICAgICAgICAgICAgY29uc3Qgc3RyZWFrRG9jUmVmID0gZG9jKHN0cmVha3NDb2xsZWN0aW9uLCBzdHJlYWtJZCk7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHN0cmVha0RvYyA9IGF3YWl0IHRyYW5zYWN0aW9uLmdldChzdHJlYWtEb2NSZWYpO1xuXG4gICAgICAgICAgICAgICAgICAgIGlmICghc3RyZWFrRG9jLmV4aXN0cygpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJTdHJlYWsgZGF0YSBub3QgZm91bmRcIik7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICBjb25zdCBzdHJlYWsgPSB0cmFuc2Zvcm1GaXJlc3RvcmVUb1N0cmVhayhzdHJlYWtEb2MuZGF0YSgpKTtcblxuICAgICAgICAgICAgICAgICAgICAvLyBWYWxpZGF0ZSB1c2VyIG93bmVyc2hpcFxuICAgICAgICAgICAgICAgICAgICBpZiAoIXZhbGlkYXRlVXNlck93bmVyc2hpcCh1c2VySWQsIHN0cmVhay51c2VySWQpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJVbmF1dGhvcml6ZWQgYWNjZXNzIHRvIHN0cmVhayBkYXRhXCIpO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gQ2hlY2sgaWYgZnJlZXplIGlzIGF2YWlsYWJsZVxuICAgICAgICAgICAgICAgICAgICBpZiAoc3RyZWFrLmZyZWV6ZXNBdmFpbGFibGUgPD0gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gVXNlIHRoZSBmcmVlemVcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgdXBkYXRlZFN0cmVhazogSGFiaXRTdHJlYWsgPSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAuLi5zdHJlYWssXG4gICAgICAgICAgICAgICAgICAgICAgICBmcmVlemVzQXZhaWxhYmxlOiBzdHJlYWsuZnJlZXplc0F2YWlsYWJsZSAtIDEsXG4gICAgICAgICAgICAgICAgICAgICAgICBmcmVlemVzVXNlZDogc3RyZWFrLmZyZWV6ZXNVc2VkICsgMSxcbiAgICAgICAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgICAgICAgICAvLyBDcmVhdGUgYSBcInByb3RlY3RlZFwiIGNvbXBsZXRpb24gcmVjb3JkIGZvciB0aGUgbWlzc2VkIGRhdGVcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgcHJvdGVjdGVkQ29tcGxldGlvbiA9IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGhhYml0SWQsXG4gICAgICAgICAgICAgICAgICAgICAgICB1c2VySWQsXG4gICAgICAgICAgICAgICAgICAgICAgICBjb21wbGV0ZWRBdDogVGltZXN0YW1wLmZyb21EYXRlKHBhcnNlRGF0ZVN0cmluZyhtaXNzZWREYXRlKSksXG4gICAgICAgICAgICAgICAgICAgICAgICB0aW1lem9uZTogZ2V0VXNlclRpbWV6b25lKCksXG4gICAgICAgICAgICAgICAgICAgICAgICBub3RlczogXCJQcm90ZWN0ZWQgYnkgc3RyZWFrIGZyZWV6ZVwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgZGlmZmljdWx0eTogXCJlYXN5XCIgYXMgY29uc3QsXG4gICAgICAgICAgICAgICAgICAgICAgICBjcmVhdGVkQXQ6IHNlcnZlclRpbWVzdGFtcCgpLFxuICAgICAgICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGNvbXBsZXRpb25zQ29sbGVjdGlvbiA9IGdldEhhYml0Q29tcGxldGlvbnNDb2xsZWN0aW9uKCk7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGNvbXBsZXRpb25SZWYgPSBkb2MoY29tcGxldGlvbnNDb2xsZWN0aW9uKTtcbiAgICAgICAgICAgICAgICAgICAgdHJhbnNhY3Rpb24uc2V0KGNvbXBsZXRpb25SZWYsIHByb3RlY3RlZENvbXBsZXRpb24pO1xuXG4gICAgICAgICAgICAgICAgICAgIC8vIFVwZGF0ZSBzdHJlYWsgZGF0YVxuICAgICAgICAgICAgICAgICAgICBjb25zdCBzdHJlYWtEYXRhID0gdHJhbnNmb3JtU3RyZWFrVG9GaXJlc3RvcmUodXBkYXRlZFN0cmVhayk7XG4gICAgICAgICAgICAgICAgICAgIHRyYW5zYWN0aW9uLnNldChzdHJlYWtEb2NSZWYsIHN0cmVha0RhdGEpO1xuXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICBjb25zdCBtZXNzYWdlID0gZ2V0VXNlckZyaWVuZGx5RXJyb3JNZXNzYWdlKGVycm9yKTtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgRmFpbGVkIHRvIHVzZSBzdHJlYWsgZnJlZXplOiAke21lc3NhZ2V9YCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBHZXQgY2FsZW5kYXIgZGF0YSBmb3IgYSBoYWJpdCBzaG93aW5nIGNvbXBsZXRpb24gc3RhdHVzXG4gICAgICogUmVxdWlyZW1lbnRzOiAyLjEsIDIuMiwgMi4zLCAyLjQsIDIuNVxuICAgICAqL1xuICAgIGFzeW5jIGdldEhhYml0Q2FsZW5kYXIoXG4gICAgICAgIGhhYml0SWQ6IHN0cmluZyxcbiAgICAgICAgdXNlcklkOiBzdHJpbmcsXG4gICAgICAgIGRheXM6IG51bWJlcixcbiAgICAgICAgdGltZXpvbmU6IHN0cmluZyxcbiAgICApOiBQcm9taXNlPENhbGVuZGFyRGF5W10+IHtcbiAgICAgICAgaWYgKCFoYWJpdElkIHx8ICF1c2VySWQpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkhhYml0IElEIGFuZCBVc2VyIElEIGFyZSByZXF1aXJlZFwiKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICByZXR1cm4gYXdhaXQgcmV0cnlXaXRoQmFja29mZihhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICAgICAgLy8gR2V0IGRhdGUgcmFuZ2UgZm9yIGNhbGVuZGFyXG4gICAgICAgICAgICAgICAgY29uc3QgZW5kRGF0ZSA9IGdldEN1cnJlbnREYXRlU3RyaW5nKHRpbWV6b25lKTtcbiAgICAgICAgICAgICAgICBjb25zdCBzdGFydERhdGUgPSBmb3JtYXREYXRlVG9TdHJpbmcoXG4gICAgICAgICAgICAgICAgICAgIG5ldyBEYXRlKERhdGUubm93KCkgLSAoZGF5cyAtIDEpICogMjQgKiA2MCAqIDYwICogMTAwMCksXG4gICAgICAgICAgICAgICAgICAgIHRpbWV6b25lLFxuICAgICAgICAgICAgICAgICk7XG5cbiAgICAgICAgICAgICAgICAvLyBHZXQgY29tcGxldGlvbnMgZm9yIHRoZSBkYXRlIHJhbmdlXG4gICAgICAgICAgICAgICAgY29uc3QgY29tcGxldGlvbnNDb2xsZWN0aW9uID0gZ2V0SGFiaXRDb21wbGV0aW9uc0NvbGxlY3Rpb24oKTtcbiAgICAgICAgICAgICAgICBjb25zdCBjb21wbGV0aW9uc1F1ZXJ5ID0gcXVlcnkoXG4gICAgICAgICAgICAgICAgICAgIGNvbXBsZXRpb25zQ29sbGVjdGlvbixcbiAgICAgICAgICAgICAgICAgICAgd2hlcmUoXCJoYWJpdElkXCIsIFwiPT1cIiwgaGFiaXRJZCksXG4gICAgICAgICAgICAgICAgICAgIHdoZXJlKFwidXNlcklkXCIsIFwiPT1cIiwgdXNlcklkKSxcbiAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgICAgIGNvbnN0IGNvbXBsZXRpb25zU25hcHNob3QgPSBhd2FpdCBnZXREb2NzKGNvbXBsZXRpb25zUXVlcnkpO1xuXG4gICAgICAgICAgICAgICAgY29uc3QgY29tcGxldGlvbnMgPSBjb21wbGV0aW9uc1NuYXBzaG90LmRvY3NcbiAgICAgICAgICAgICAgICAgICAgLm1hcCgoZG9jKSA9PiB0cmFuc2Zvcm1GaXJlc3RvcmVUb0NvbXBsZXRpb24oZG9jLmlkLCBkb2MuZGF0YSgpKSlcbiAgICAgICAgICAgICAgICAgICAgLmZpbHRlcigoY29tcGxldGlvbikgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgY29tcERhdGVTdHJpbmcgPSB0aW1lc3RhbXBUb0RhdGVTdHJpbmcoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29tcGxldGlvbi5jb21wbGV0ZWRBdCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aW1lem9uZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gY29tcERhdGVTdHJpbmcgPj0gc3RhcnREYXRlICYmIGNvbXBEYXRlU3RyaW5nIDw9IGVuZERhdGU7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgLy8gR2V0IHN0cmVhayBkYXRhIGZvciBoaWdobGlnaHRpbmdcbiAgICAgICAgICAgICAgICBjb25zdCBzdHJlYWsgPSBhd2FpdCB0aGlzLmdldEhhYml0U3RyZWFrKGhhYml0SWQsIHVzZXJJZCk7XG5cbiAgICAgICAgICAgICAgICAvLyBHZW5lcmF0ZSBjYWxlbmRhciBkYXlzXG4gICAgICAgICAgICAgICAgY29uc3QgZGF0ZVJhbmdlID0gZ2VuZXJhdGVEYXRlUmFuZ2Uoc3RhcnREYXRlLCBlbmREYXRlKTtcbiAgICAgICAgICAgICAgICBjb25zdCBjYWxlbmRhckRheXM6IENhbGVuZGFyRGF5W10gPSBkYXRlUmFuZ2UubWFwKChkYXRlKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGNvbXBsZXRpb24gPSBjb21wbGV0aW9ucy5maW5kKFxuICAgICAgICAgICAgICAgICAgICAgICAgKGNvbXApID0+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGltZXN0YW1wVG9EYXRlU3RyaW5nKGNvbXAuY29tcGxldGVkQXQsIHRpbWV6b25lKSA9PT0gZGF0ZSxcbiAgICAgICAgICAgICAgICAgICAgKTtcblxuICAgICAgICAgICAgICAgICAgICBjb25zdCBpc0luU3RyZWFrID0gdGhpcy5pc0RhdGVJbkN1cnJlbnRTdHJlYWsoZGF0ZSwgc3RyZWFrKTtcblxuICAgICAgICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgZGF0ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbXBsZXRlZDogISFjb21wbGV0aW9uLFxuICAgICAgICAgICAgICAgICAgICAgICAgaXNUb2RheTogaXNUb2RheShkYXRlLCB0aW1lem9uZSksXG4gICAgICAgICAgICAgICAgICAgICAgICBpc0luU3RyZWFrLFxuICAgICAgICAgICAgICAgICAgICAgICAgY29tcGxldGlvblRpbWU6IGNvbXBsZXRpb25cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA/IGNvbXBsZXRpb24uY29tcGxldGVkQXQudG9EYXRlKCkudG9Mb2NhbGVUaW1lU3RyaW5nKClcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA6IHVuZGVmaW5lZCxcbiAgICAgICAgICAgICAgICAgICAgICAgIG5vdGVzOiBjb21wbGV0aW9uPy5ub3RlcyxcbiAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIHJldHVybiBjYWxlbmRhckRheXM7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgIGNvbnN0IG1lc3NhZ2UgPSBnZXRVc2VyRnJpZW5kbHlFcnJvck1lc3NhZ2UoZXJyb3IpO1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBGYWlsZWQgdG8gZ2V0IGhhYml0IGNhbGVuZGFyOiAke21lc3NhZ2V9YCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBDaGVjayBmb3IgbmV3IG1pbGVzdG9uZXMgYW5kIHJldHVybiBhbnkgdGhhdCBzaG91bGQgYmUgY2VsZWJyYXRlZFxuICAgICAqIFJlcXVpcmVtZW50czogMy4xLCAzLjIsIDQuNFxuICAgICAqL1xuICAgIGFzeW5jIGNoZWNrTWlsZXN0b25lcyhzdHJlYWs6IEhhYml0U3RyZWFrKTogUHJvbWlzZTxTdHJlYWtNaWxlc3RvbmVbXT4ge1xuICAgICAgICBjb25zdCBuZXdNaWxlc3RvbmVzOiBTdHJlYWtNaWxlc3RvbmVbXSA9IFtdO1xuICAgICAgICBjb25zdCBleGlzdGluZ01pbGVzdG9uZURheXMgPSBzdHJlYWsubWlsZXN0b25lcy5tYXAoKG0pID0+IG0uZGF5cyk7XG5cbiAgICAgICAgZm9yIChjb25zdCBtaWxlc3RvbmVEYXkgb2YgTUlMRVNUT05FX0RBWVMpIHtcbiAgICAgICAgICAgIGlmIChcbiAgICAgICAgICAgICAgICBzdHJlYWsuY3VycmVudFN0cmVhayA+PSBtaWxlc3RvbmVEYXkgJiZcbiAgICAgICAgICAgICAgICAhZXhpc3RpbmdNaWxlc3RvbmVEYXlzLmluY2x1ZGVzKG1pbGVzdG9uZURheSlcbiAgICAgICAgICAgICkge1xuICAgICAgICAgICAgICAgIGNvbnN0IG1pbGVzdG9uZTogU3RyZWFrTWlsZXN0b25lID0ge1xuICAgICAgICAgICAgICAgICAgICBkYXlzOiBtaWxlc3RvbmVEYXksXG4gICAgICAgICAgICAgICAgICAgIGFjaGlldmVkQXQ6IFRpbWVzdGFtcC5ub3coKSxcbiAgICAgICAgICAgICAgICAgICAgY2VsZWJyYXRlZDogZmFsc2UsXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICBuZXdNaWxlc3RvbmVzLnB1c2gobWlsZXN0b25lKTtcblxuICAgICAgICAgICAgICAgIC8vIEF3YXJkIHN0cmVhayBmcmVlemUgZm9yIDMwLWRheSBtaWxlc3RvbmVzXG4gICAgICAgICAgICAgICAgaWYgKG1pbGVzdG9uZURheSA9PT0gMzApIHtcbiAgICAgICAgICAgICAgICAgICAgc3RyZWFrLmZyZWV6ZXNBdmFpbGFibGUgKz0gMTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICAvLyBVcGRhdGUgc3RyZWFrIHdpdGggbmV3IG1pbGVzdG9uZXNcbiAgICAgICAgaWYgKG5ld01pbGVzdG9uZXMubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgY29uc3QgdXBkYXRlZFN0cmVhazogSGFiaXRTdHJlYWsgPSB7XG4gICAgICAgICAgICAgICAgLi4uc3RyZWFrLFxuICAgICAgICAgICAgICAgIG1pbGVzdG9uZXM6IFsuLi5zdHJlYWsubWlsZXN0b25lcywgLi4ubmV3TWlsZXN0b25lc10sXG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICBjb25zdCBzdHJlYWtJZCA9IGdlbmVyYXRlU3RyZWFrSWQoc3RyZWFrLnVzZXJJZCwgc3RyZWFrLmhhYml0SWQpO1xuICAgICAgICAgICAgY29uc3Qgc3RyZWFrc0NvbGxlY3Rpb24gPSBnZXRIYWJpdFN0cmVha3NDb2xsZWN0aW9uKCk7XG4gICAgICAgICAgICBjb25zdCBzdHJlYWtEb2NSZWYgPSBkb2Moc3RyZWFrc0NvbGxlY3Rpb24sIHN0cmVha0lkKTtcbiAgICAgICAgICAgIGNvbnN0IHN0cmVha0RhdGEgPSB0cmFuc2Zvcm1TdHJlYWtUb0ZpcmVzdG9yZSh1cGRhdGVkU3RyZWFrKTtcblxuICAgICAgICAgICAgYXdhaXQgcnVuVHJhbnNhY3Rpb24oZGIsIGFzeW5jICh0cmFuc2FjdGlvbikgPT4ge1xuICAgICAgICAgICAgICAgIHRyYW5zYWN0aW9uLnNldChzdHJlYWtEb2NSZWYsIHN0cmVha0RhdGEpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gbmV3TWlsZXN0b25lcztcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBHZXQgc3RyZWFrIGluZm9ybWF0aW9uIGZvciBhIHNwZWNpZmljIGhhYml0XG4gICAgICovXG4gICAgYXN5bmMgZ2V0SGFiaXRTdHJlYWsoXG4gICAgICAgIGhhYml0SWQ6IHN0cmluZyxcbiAgICAgICAgdXNlcklkOiBzdHJpbmcsXG4gICAgKTogUHJvbWlzZTxIYWJpdFN0cmVhayB8IG51bGw+IHtcbiAgICAgICAgaWYgKCFoYWJpdElkIHx8ICF1c2VySWQpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkhhYml0IElEIGFuZCBVc2VyIElEIGFyZSByZXF1aXJlZFwiKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBjb25zdCBzdHJlYWtJZCA9IGdlbmVyYXRlU3RyZWFrSWQodXNlcklkLCBoYWJpdElkKTtcbiAgICAgICAgICAgIGNvbnN0IHN0cmVha3NDb2xsZWN0aW9uID0gZ2V0SGFiaXRTdHJlYWtzQ29sbGVjdGlvbigpO1xuICAgICAgICAgICAgY29uc3Qgc3RyZWFrRG9jUmVmID0gZG9jKHN0cmVha3NDb2xsZWN0aW9uLCBzdHJlYWtJZCk7XG4gICAgICAgICAgICBjb25zdCBzdHJlYWtEb2MgPSBhd2FpdCBnZXREb2Moc3RyZWFrRG9jUmVmKTtcblxuICAgICAgICAgICAgaWYgKCFzdHJlYWtEb2MuZXhpc3RzKCkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgY29uc3Qgc3RyZWFrRGF0YSA9IHN0cmVha0RvYy5kYXRhKCk7XG4gICAgICAgICAgICBpZiAoIXZhbGlkYXRlU3RyZWFrRG9jdW1lbnQoc3RyZWFrRGF0YSkpIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJJbnZhbGlkIHN0cmVhayBkYXRhIGZvcm1hdFwiKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcmV0dXJuIHRyYW5zZm9ybUZpcmVzdG9yZVRvU3RyZWFrKHN0cmVha0RhdGEpO1xuICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgY29uc3QgbWVzc2FnZSA9IGdldFVzZXJGcmllbmRseUVycm9yTWVzc2FnZShlcnJvcik7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYEZhaWxlZCB0byBnZXQgaGFiaXQgc3RyZWFrOiAke21lc3NhZ2V9YCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBJbml0aWFsaXplIHN0cmVhayBkYXRhIGZvciBhIG5ldyBoYWJpdFxuICAgICAqL1xuICAgIGFzeW5jIGluaXRpYWxpemVIYWJpdFN0cmVhayhcbiAgICAgICAgaGFiaXRJZDogc3RyaW5nLFxuICAgICAgICB1c2VySWQ6IHN0cmluZyxcbiAgICApOiBQcm9taXNlPEhhYml0U3RyZWFrPiB7XG4gICAgICAgIGlmICghaGFiaXRJZCB8fCAhdXNlcklkKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJIYWJpdCBJRCBhbmQgVXNlciBJRCBhcmUgcmVxdWlyZWRcIik7XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBjdXJyZW50RGF0ZSA9IGdldEN1cnJlbnREYXRlU3RyaW5nKGdldFVzZXJUaW1lem9uZSgpKTtcbiAgICAgICAgY29uc3QgaW5pdGlhbFN0cmVhazogSGFiaXRTdHJlYWsgPSB7XG4gICAgICAgICAgICBoYWJpdElkLFxuICAgICAgICAgICAgdXNlcklkLFxuICAgICAgICAgICAgY3VycmVudFN0cmVhazogMCxcbiAgICAgICAgICAgIGJlc3RTdHJlYWs6IDAsXG4gICAgICAgICAgICBsYXN0Q29tcGxldGlvbkRhdGU6IFwiXCIsXG4gICAgICAgICAgICBzdHJlYWtTdGFydERhdGU6IGN1cnJlbnREYXRlLFxuICAgICAgICAgICAgZnJlZXplc0F2YWlsYWJsZTogMCxcbiAgICAgICAgICAgIGZyZWV6ZXNVc2VkOiAwLFxuICAgICAgICAgICAgbWlsZXN0b25lczogW10sXG4gICAgICAgIH07XG5cbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGNvbnN0IHN0cmVha0lkID0gZ2VuZXJhdGVTdHJlYWtJZCh1c2VySWQsIGhhYml0SWQpO1xuICAgICAgICAgICAgY29uc3Qgc3RyZWFrc0NvbGxlY3Rpb24gPSBnZXRIYWJpdFN0cmVha3NDb2xsZWN0aW9uKCk7XG4gICAgICAgICAgICBjb25zdCBzdHJlYWtEb2NSZWYgPSBkb2Moc3RyZWFrc0NvbGxlY3Rpb24sIHN0cmVha0lkKTtcbiAgICAgICAgICAgIGNvbnN0IHN0cmVha0RhdGEgPSB0cmFuc2Zvcm1TdHJlYWtUb0ZpcmVzdG9yZShpbml0aWFsU3RyZWFrKTtcblxuICAgICAgICAgICAgYXdhaXQgcnVuVHJhbnNhY3Rpb24oZGIsIGFzeW5jICh0cmFuc2FjdGlvbikgPT4ge1xuICAgICAgICAgICAgICAgIHRyYW5zYWN0aW9uLnNldChzdHJlYWtEb2NSZWYsIHN0cmVha0RhdGEpO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHJldHVybiBpbml0aWFsU3RyZWFrO1xuICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgY29uc3QgbWVzc2FnZSA9IGdldFVzZXJGcmllbmRseUVycm9yTWVzc2FnZShlcnJvcik7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYEZhaWxlZCB0byBpbml0aWFsaXplIGhhYml0IHN0cmVhazogJHttZXNzYWdlfWApO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogUmVzZXQgYSBzdHJlYWsgKHVzZWQgd2hlbiBzdHJlYWsgaXMgYnJva2VuIGFuZCBubyBmcmVlemUgYXZhaWxhYmxlKVxuICAgICAqIFJlcXVpcmVtZW50czogMS4yXG4gICAgICovXG4gICAgYXN5bmMgcmVzZXRTdHJlYWsoXG4gICAgICAgIGhhYml0SWQ6IHN0cmluZyxcbiAgICAgICAgdXNlcklkOiBzdHJpbmcsXG4gICAgICAgIHJlc2V0RGF0ZTogc3RyaW5nLFxuICAgICk6IFByb21pc2U8SGFiaXRTdHJlYWs+IHtcbiAgICAgICAgaWYgKCFoYWJpdElkIHx8ICF1c2VySWQgfHwgIXJlc2V0RGF0ZSkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiSGFiaXQgSUQsIFVzZXIgSUQsIGFuZCByZXNldCBkYXRlIGFyZSByZXF1aXJlZFwiKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICByZXR1cm4gYXdhaXQgcmV0cnlXaXRoQmFja29mZihhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGF3YWl0IHJ1blRyYW5zYWN0aW9uKGRiLCBhc3luYyAodHJhbnNhY3Rpb24pID0+IHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3Qgc3RyZWFrSWQgPSBnZW5lcmF0ZVN0cmVha0lkKHVzZXJJZCwgaGFiaXRJZCk7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHN0cmVha3NDb2xsZWN0aW9uID0gZ2V0SGFiaXRTdHJlYWtzQ29sbGVjdGlvbigpO1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBzdHJlYWtEb2NSZWYgPSBkb2Moc3RyZWFrc0NvbGxlY3Rpb24sIHN0cmVha0lkKTtcbiAgICAgICAgICAgICAgICAgICAgY29uc3Qgc3RyZWFrRG9jID0gYXdhaXQgdHJhbnNhY3Rpb24uZ2V0KHN0cmVha0RvY1JlZik7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKCFzdHJlYWtEb2MuZXhpc3RzKCkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIlN0cmVhayBkYXRhIG5vdCBmb3VuZFwiKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHN0cmVhayA9IHRyYW5zZm9ybUZpcmVzdG9yZVRvU3RyZWFrKHN0cmVha0RvYy5kYXRhKCkpO1xuXG4gICAgICAgICAgICAgICAgICAgIC8vIFZhbGlkYXRlIHVzZXIgb3duZXJzaGlwXG4gICAgICAgICAgICAgICAgICAgIGlmICghdmFsaWRhdGVVc2VyT3duZXJzaGlwKHVzZXJJZCwgc3RyZWFrLnVzZXJJZCkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIlVuYXV0aG9yaXplZCBhY2Nlc3MgdG8gc3RyZWFrIGRhdGFcIik7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICBjb25zdCByZXNldFN0cmVhazogSGFiaXRTdHJlYWsgPSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAuLi5zdHJlYWssXG4gICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50U3RyZWFrOiAwLFxuICAgICAgICAgICAgICAgICAgICAgICAgbGFzdENvbXBsZXRpb25EYXRlOiBcIlwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgc3RyZWFrU3RhcnREYXRlOiByZXNldERhdGUsXG4gICAgICAgICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICAgICAgICAgY29uc3Qgc3RyZWFrRGF0YSA9IHRyYW5zZm9ybVN0cmVha1RvRmlyZXN0b3JlKHJlc2V0U3RyZWFrKTtcbiAgICAgICAgICAgICAgICAgICAgdHJhbnNhY3Rpb24uc2V0KHN0cmVha0RvY1JlZiwgc3RyZWFrRGF0YSk7XG5cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlc2V0U3RyZWFrO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICBjb25zdCBtZXNzYWdlID0gZ2V0VXNlckZyaWVuZGx5RXJyb3JNZXNzYWdlKGVycm9yKTtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgRmFpbGVkIHRvIHJlc2V0IHN0cmVhazogJHttZXNzYWdlfWApO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLy8gUHJpdmF0ZSBoZWxwZXIgbWV0aG9kc1xuXG4gICAgLyoqXG4gICAgICogQ2FsY3VsYXRlIHN0cmVhayBmcm9tIGNvbXBsZXRpb24gcmVjb3Jkc1xuICAgICAqL1xuICAgIHByaXZhdGUgY2FsY3VsYXRlU3RyZWFrRnJvbUNvbXBsZXRpb25zKFxuICAgICAgICBjb21wbGV0aW9uczogSGFiaXRDb21wbGV0aW9uW10sXG4gICAgICAgIGhhYml0SWQ6IHN0cmluZyxcbiAgICAgICAgdXNlcklkOiBzdHJpbmcsXG4gICAgKTogSGFiaXRTdHJlYWsge1xuICAgICAgICBpZiAoY29tcGxldGlvbnMubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIGhhYml0SWQsXG4gICAgICAgICAgICAgICAgdXNlcklkLFxuICAgICAgICAgICAgICAgIGN1cnJlbnRTdHJlYWs6IDAsXG4gICAgICAgICAgICAgICAgYmVzdFN0cmVhazogMCxcbiAgICAgICAgICAgICAgICBsYXN0Q29tcGxldGlvbkRhdGU6IFwiXCIsXG4gICAgICAgICAgICAgICAgc3RyZWFrU3RhcnREYXRlOiBnZXRDdXJyZW50RGF0ZVN0cmluZyhnZXRVc2VyVGltZXpvbmUoKSksXG4gICAgICAgICAgICAgICAgZnJlZXplc0F2YWlsYWJsZTogMCxcbiAgICAgICAgICAgICAgICBmcmVlemVzVXNlZDogMCxcbiAgICAgICAgICAgICAgICBtaWxlc3RvbmVzOiBbXSxcbiAgICAgICAgICAgIH07XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCB0aW1lem9uZSA9IGNvbXBsZXRpb25zWzBdPy50aW1lem9uZSB8fCBnZXRVc2VyVGltZXpvbmUoKTtcbiAgICAgICAgY29uc3QgY29tcGxldGlvbkRhdGVzID0gY29tcGxldGlvbnMubWFwKChjb21wKSA9PlxuICAgICAgICAgICAgdGltZXN0YW1wVG9EYXRlU3RyaW5nKGNvbXAuY29tcGxldGVkQXQsIHRpbWV6b25lKSxcbiAgICAgICAgKTtcblxuICAgICAgICAvLyBSZW1vdmUgZHVwbGljYXRlcyBhbmQgc29ydFxuICAgICAgICBjb25zdCB1bmlxdWVEYXRlcyA9IFsuLi5uZXcgU2V0KGNvbXBsZXRpb25EYXRlcyldLnNvcnQoKTtcblxuICAgICAgICAvLyBDYWxjdWxhdGUgY3VycmVudCBzdHJlYWsgKGZyb20gbW9zdCByZWNlbnQgY29tcGxldGlvbiBiYWNrd2FyZHMpXG4gICAgICAgIGxldCBjdXJyZW50U3RyZWFrID0gMDtcbiAgICAgICAgbGV0IHN0cmVha1N0YXJ0RGF0ZSA9IFwiXCI7XG4gICAgICAgIGNvbnN0IHRvZGF5ID0gZ2V0Q3VycmVudERhdGVTdHJpbmcodGltZXpvbmUpO1xuICAgICAgICBjb25zdCB5ZXN0ZXJkYXkgPSBmb3JtYXREYXRlVG9TdHJpbmcoXG4gICAgICAgICAgICBuZXcgRGF0ZShEYXRlLm5vdygpIC0gMjQgKiA2MCAqIDYwICogMTAwMCksXG4gICAgICAgICAgICB0aW1lem9uZSxcbiAgICAgICAgKTtcblxuICAgICAgICAvLyBDaGVjayBpZiB0aGVyZSdzIGEgY29tcGxldGlvbiB0b2RheSBvciB5ZXN0ZXJkYXkgdG8gc3RhcnQgY291bnRpbmdcbiAgICAgICAgY29uc3QgbGFzdENvbXBsZXRpb25EYXRlID0gdW5pcXVlRGF0ZXNbdW5pcXVlRGF0ZXMubGVuZ3RoIC0gMV07XG4gICAgICAgIGlmIChsYXN0Q29tcGxldGlvbkRhdGUgPT09IHRvZGF5IHx8IGxhc3RDb21wbGV0aW9uRGF0ZSA9PT0geWVzdGVyZGF5KSB7XG4gICAgICAgICAgICBjdXJyZW50U3RyZWFrID0gMTtcbiAgICAgICAgICAgIHN0cmVha1N0YXJ0RGF0ZSA9IGxhc3RDb21wbGV0aW9uRGF0ZTtcblxuICAgICAgICAgICAgLy8gQ291bnQgYmFja3dhcmRzIGZvciBjb25zZWN1dGl2ZSBkYXlzXG4gICAgICAgICAgICBmb3IgKGxldCBpID0gdW5pcXVlRGF0ZXMubGVuZ3RoIC0gMjsgaSA+PSAwOyBpLS0pIHtcbiAgICAgICAgICAgICAgICBjb25zdCBjdXJyZW50RGF0ZSA9IHVuaXF1ZURhdGVzW2kgKyAxXTtcbiAgICAgICAgICAgICAgICBjb25zdCBwcmV2aW91c0RhdGUgPSB1bmlxdWVEYXRlc1tpXTtcblxuICAgICAgICAgICAgICAgIGlmIChhcmVDb25zZWN1dGl2ZURheXMocHJldmlvdXNEYXRlLCBjdXJyZW50RGF0ZSkpIHtcbiAgICAgICAgICAgICAgICAgICAgY3VycmVudFN0cmVhaysrO1xuICAgICAgICAgICAgICAgICAgICBzdHJlYWtTdGFydERhdGUgPSBwcmV2aW91c0RhdGU7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgLy8gQ2FsY3VsYXRlIGJlc3Qgc3RyZWFrIChsb25nZXN0IGNvbnNlY3V0aXZlIHNlcXVlbmNlKVxuICAgICAgICBsZXQgYmVzdFN0cmVhayA9IDA7XG4gICAgICAgIGxldCB0ZW1wU3RyZWFrID0gMTtcblxuICAgICAgICBmb3IgKGxldCBpID0gMTsgaSA8IHVuaXF1ZURhdGVzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICBpZiAoYXJlQ29uc2VjdXRpdmVEYXlzKHVuaXF1ZURhdGVzW2kgLSAxXSwgdW5pcXVlRGF0ZXNbaV0pKSB7XG4gICAgICAgICAgICAgICAgdGVtcFN0cmVhaysrO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBiZXN0U3RyZWFrID0gTWF0aC5tYXgoYmVzdFN0cmVhaywgdGVtcFN0cmVhayk7XG4gICAgICAgICAgICAgICAgdGVtcFN0cmVhayA9IDE7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgYmVzdFN0cmVhayA9IE1hdGgubWF4KGJlc3RTdHJlYWssIHRlbXBTdHJlYWssIGN1cnJlbnRTdHJlYWspO1xuXG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBoYWJpdElkLFxuICAgICAgICAgICAgdXNlcklkLFxuICAgICAgICAgICAgY3VycmVudFN0cmVhayxcbiAgICAgICAgICAgIGJlc3RTdHJlYWssXG4gICAgICAgICAgICBsYXN0Q29tcGxldGlvbkRhdGUsXG4gICAgICAgICAgICBzdHJlYWtTdGFydERhdGUsXG4gICAgICAgICAgICBmcmVlemVzQXZhaWxhYmxlOiAwLFxuICAgICAgICAgICAgZnJlZXplc1VzZWQ6IDAsXG4gICAgICAgICAgICBtaWxlc3RvbmVzOiBbXSxcbiAgICAgICAgfTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBNZXJnZSBjYWxjdWxhdGVkIHN0cmVhayB3aXRoIGV4aXN0aW5nIHN0cmVhayBkYXRhXG4gICAgICovXG4gICAgcHJpdmF0ZSBtZXJnZVN0cmVha0RhdGEoXG4gICAgICAgIGNhbGN1bGF0ZWQ6IEhhYml0U3RyZWFrLFxuICAgICAgICBleGlzdGluZzogSGFiaXRTdHJlYWsgfCBudWxsLFxuICAgICk6IEhhYml0U3RyZWFrIHtcbiAgICAgICAgaWYgKCFleGlzdGluZykge1xuICAgICAgICAgICAgcmV0dXJuIGNhbGN1bGF0ZWQ7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgLi4uY2FsY3VsYXRlZCxcbiAgICAgICAgICAgIGZyZWV6ZXNBdmFpbGFibGU6IGV4aXN0aW5nLmZyZWV6ZXNBdmFpbGFibGUsXG4gICAgICAgICAgICBmcmVlemVzVXNlZDogZXhpc3RpbmcuZnJlZXplc1VzZWQsXG4gICAgICAgICAgICBtaWxlc3RvbmVzOiBleGlzdGluZy5taWxlc3RvbmVzLFxuICAgICAgICAgICAgLy8gRW5zdXJlIGJlc3Qgc3RyZWFrIG5ldmVyIGRlY3JlYXNlc1xuICAgICAgICAgICAgYmVzdFN0cmVhazogTWF0aC5tYXgoY2FsY3VsYXRlZC5iZXN0U3RyZWFrLCBleGlzdGluZy5iZXN0U3RyZWFrKSxcbiAgICAgICAgfTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBDaGVjayBpZiBhIGRhdGUgaXMgd2l0aGluIHRoZSBjdXJyZW50IHN0cmVhayBwZXJpb2RcbiAgICAgKi9cbiAgICBwcml2YXRlIGlzRGF0ZUluQ3VycmVudFN0cmVhayhcbiAgICAgICAgZGF0ZTogc3RyaW5nLFxuICAgICAgICBzdHJlYWs6IEhhYml0U3RyZWFrIHwgbnVsbCxcbiAgICApOiBib29sZWFuIHtcbiAgICAgICAgaWYgKCFzdHJlYWsgfHwgc3RyZWFrLmN1cnJlbnRTdHJlYWsgPT09IDAgfHwgIXN0cmVhay5zdHJlYWtTdGFydERhdGUpIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IHN0cmVha1N0YXJ0ID0gcGFyc2VEYXRlU3RyaW5nKHN0cmVhay5zdHJlYWtTdGFydERhdGUpO1xuICAgICAgICBjb25zdCBjaGVja0RhdGUgPSBwYXJzZURhdGVTdHJpbmcoZGF0ZSk7XG4gICAgICAgIGNvbnN0IHN0cmVha0VuZCA9IG5ldyBEYXRlKHN0cmVha1N0YXJ0KTtcbiAgICAgICAgc3RyZWFrRW5kLnNldERhdGUoc3RyZWFrRW5kLmdldERhdGUoKSArIHN0cmVhay5jdXJyZW50U3RyZWFrIC0gMSk7XG5cbiAgICAgICAgcmV0dXJuIGNoZWNrRGF0ZSA+PSBzdHJlYWtTdGFydCAmJiBjaGVja0RhdGUgPD0gc3RyZWFrRW5kO1xuICAgIH1cbn1cblxuLy8gRXhwb3J0IHNpbmdsZXRvbiBpbnN0YW5jZVxuZXhwb3J0IGNvbnN0IHN0cmVha1NlcnZpY2UgPSBuZXcgU3RyZWFrU2VydmljZSgpO1xuIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7QUFBQSxJQUFBQSxVQUFBLEdBQUFDLE9BQUE7QUFVQSxJQUFBQyxlQUFBLEdBQUFELE9BQUE7QUFDQSxJQUFBRSxhQUFBLEdBQUFGLE9BQUE7QUFPQSxJQUFBRyxVQUFBLEdBQUFILE9BQUE7QUFVQSxJQUFBSSxjQUFBLEdBQUFKLE9BQUE7QUFJQSxJQUFBSyxZQUFBLEdBQUFMLE9BQUE7QUFLQSxJQUFBTSxtQkFBQSxHQUFBTixPQUFBO0FBTzhCLElBUWpCTyxhQUFhLEdBQUFDLE9BQUEsQ0FBQUQsYUFBQTtFQUFBLFNBQUFBLGNBQUE7SUFBQSxJQUFBRSxn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