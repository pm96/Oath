7675afe8a22a0af881f5cc32b00c50b5
_getJestObj().mock("../firebaseConfig", function () {
  return {
    db: {},
    APP_ID: "test-app"
  };
});
_getJestObj().mock("firebase/firestore", function () {
  return {
    doc: jest.fn(),
    getDocs: jest.fn(),
    query: jest.fn(),
    runTransaction: jest.fn(),
    serverTimestamp: jest.fn(function () {
      return {
        seconds: Date.now() / 1000
      };
    }),
    Timestamp: {
      now: jest.fn(function () {
        return {
          seconds: Date.now() / 1000,
          toDate: function toDate() {
            return new Date();
          },
          toMillis: function toMillis() {
            return Date.now();
          }
        };
      }),
      fromDate: jest.fn(function (date) {
        return {
          seconds: date.getTime() / 1000,
          toDate: function toDate() {
            return date;
          },
          toMillis: function toMillis() {
            return date.getTime();
          }
        };
      })
    },
    where: jest.fn()
  };
});
_getJestObj().mock("../services/firebase/collections", function () {
  return {
    getHabitAnalyticsCollection: jest.fn(function () {
      return {};
    }),
    getHabitCompletionsCollection: jest.fn(function () {
      return {};
    }),
    getHabitStreaksCollection: jest.fn(function () {
      return {};
    })
  };
});
_getJestObj().mock("../utils/errorHandling", function () {
  return {
    getUserFriendlyErrorMessage: jest.fn(function (error) {
      return error.message || "Unknown error";
    }),
    retryWithBackoff: jest.fn(function (fn) {
      return fn();
    })
  };
});
var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault").default;
var _asyncToGenerator2 = _interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));
var _analyticsService = require("../services/firebase/analyticsService");
function _getJestObj() {
  var _require6 = require("@jest/globals"),
    jest = _require6.jest;
  _getJestObj = function _getJestObj() {
    return jest;
  };
  return jest;
}
describe("AnalyticsService", function () {
  var mockHabitId = "test-habit-id";
  var mockUserId = "test-user-id";
  beforeEach(function () {
    jest.clearAllMocks();
  });
  describe("calculateHabitAnalytics", function () {
    it("should create empty analytics for habits with no completions", (0, _asyncToGenerator2.default)(function* () {
      var _require = require("firebase/firestore"),
        getDocs = _require.getDocs;
      getDocs.mockResolvedValue({
        docs: []
      });
      var result = yield _analyticsService.analyticsService.calculateHabitAnalytics(mockHabitId, mockUserId);
      expect(result).toMatchObject({
        habitId: mockHabitId,
        userId: mockUserId,
        totalCompletions: 0,
        completionRate30Days: 0,
        averageStreakLength: 0,
        bestDayOfWeek: "Monday",
        consistencyScore: 0
      });
      expect(result.lastUpdated).toBeDefined();
    }));
    it("should throw error for missing parameters", (0, _asyncToGenerator2.default)(function* () {
      yield expect(_analyticsService.analyticsService.calculateHabitAnalytics("", mockUserId)).rejects.toThrow("Habit ID and User ID are required");
      yield expect(_analyticsService.analyticsService.calculateHabitAnalytics(mockHabitId, "")).rejects.toThrow("Habit ID and User ID are required");
    }));
  });
  describe("getCompletionTrends", function () {
    it("should return empty trends for habits with no completions", (0, _asyncToGenerator2.default)(function* () {
      var _require2 = require("firebase/firestore"),
        getDocs = _require2.getDocs;
      getDocs.mockResolvedValue({
        docs: []
      });
      var result = yield _analyticsService.analyticsService.getCompletionTrends(mockHabitId, mockUserId, "week");
      expect(Array.isArray(result)).toBe(true);
      expect(result.length).toBeGreaterThan(0);
    }));
    it("should throw error for missing parameters", (0, _asyncToGenerator2.default)(function* () {
      yield expect(_analyticsService.analyticsService.getCompletionTrends("", mockUserId, "week")).rejects.toThrow("Habit ID and User ID are required");
    }));
  });
  describe("getOverallConsistencyScore", function () {
    it("should return 0 for users with no habits", (0, _asyncToGenerator2.default)(function* () {
      var _require3 = require("firebase/firestore"),
        getDocs = _require3.getDocs;
      getDocs.mockResolvedValue({
        docs: []
      });
      var result = yield _analyticsService.analyticsService.getOverallConsistencyScore(mockUserId);
      expect(result).toBe(0);
    }));
    it("should throw error for missing user ID", (0, _asyncToGenerator2.default)(function* () {
      yield expect(_analyticsService.analyticsService.getOverallConsistencyScore("")).rejects.toThrow("User ID is required");
    }));
  });
  describe("getBestDayOfWeek", function () {
    it("should return Monday as default for habits with no completions", (0, _asyncToGenerator2.default)(function* () {
      var _require4 = require("firebase/firestore"),
        getDocs = _require4.getDocs;
      getDocs.mockResolvedValue({
        docs: []
      });
      var result = yield _analyticsService.analyticsService.getBestDayOfWeek(mockHabitId, mockUserId);
      expect(result).toBe("Monday");
    }));
  });
  describe("getCompletionRate", function () {
    it("should calculate completion rate correctly", (0, _asyncToGenerator2.default)(function* () {
      var _require5 = require("firebase/firestore"),
        getDocs = _require5.getDocs;
      getDocs.mockResolvedValue({
        docs: []
      });
      var result = yield _analyticsService.analyticsService.getCompletionRate(mockHabitId, mockUserId, "2024-01-01", "2024-01-07");
      expect(typeof result).toBe("number");
      expect(result).toBeGreaterThanOrEqual(0);
      expect(result).toBeLessThanOrEqual(100);
    }));
    it("should throw error for missing parameters", (0, _asyncToGenerator2.default)(function* () {
      yield expect(_analyticsService.analyticsService.getCompletionRate("", mockUserId, "2024-01-01", "2024-01-07")).rejects.toThrow("All parameters are required for completion rate calculation");
    }));
  });
  describe("getMultiHabitAnalytics", function () {
    it("should return empty array for empty habit IDs", (0, _asyncToGenerator2.default)(function* () {
      var result = yield _analyticsService.analyticsService.getMultiHabitAnalytics([], mockUserId);
      expect(Array.isArray(result)).toBe(true);
      expect(result.length).toBe(0);
    }));
    it("should throw error for missing parameters", (0, _asyncToGenerator2.default)(function* () {
      yield expect(_analyticsService.analyticsService.getMultiHabitAnalytics([], "")).rejects.toThrow("Habit IDs and User ID are required");
    }));
  });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfZ2V0SmVzdE9iaiIsIm1vY2siLCJkYiIsIkFQUF9JRCIsImRvYyIsImplc3QiLCJmbiIsImdldERvY3MiLCJxdWVyeSIsInJ1blRyYW5zYWN0aW9uIiwic2VydmVyVGltZXN0YW1wIiwic2Vjb25kcyIsIkRhdGUiLCJub3ciLCJUaW1lc3RhbXAiLCJ0b0RhdGUiLCJ0b01pbGxpcyIsImZyb21EYXRlIiwiZGF0ZSIsImdldFRpbWUiLCJ3aGVyZSIsImdldEhhYml0QW5hbHl0aWNzQ29sbGVjdGlvbiIsImdldEhhYml0Q29tcGxldGlvbnNDb2xsZWN0aW9uIiwiZ2V0SGFiaXRTdHJlYWtzQ29sbGVjdGlvbiIsImdldFVzZXJGcmllbmRseUVycm9yTWVzc2FnZSIsImVycm9yIiwibWVzc2FnZSIsInJldHJ5V2l0aEJhY2tvZmYiLCJfaW50ZXJvcFJlcXVpcmVEZWZhdWx0IiwicmVxdWlyZSIsImRlZmF1bHQiLCJfYXN5bmNUb0dlbmVyYXRvcjIiLCJfYW5hbHl0aWNzU2VydmljZSIsIl9yZXF1aXJlNiIsImRlc2NyaWJlIiwibW9ja0hhYml0SWQiLCJtb2NrVXNlcklkIiwiYmVmb3JlRWFjaCIsImNsZWFyQWxsTW9ja3MiLCJpdCIsIl9yZXF1aXJlIiwibW9ja1Jlc29sdmVkVmFsdWUiLCJkb2NzIiwicmVzdWx0IiwiYW5hbHl0aWNzU2VydmljZSIsImNhbGN1bGF0ZUhhYml0QW5hbHl0aWNzIiwiZXhwZWN0IiwidG9NYXRjaE9iamVjdCIsImhhYml0SWQiLCJ1c2VySWQiLCJ0b3RhbENvbXBsZXRpb25zIiwiY29tcGxldGlvblJhdGUzMERheXMiLCJhdmVyYWdlU3RyZWFrTGVuZ3RoIiwiYmVzdERheU9mV2VlayIsImNvbnNpc3RlbmN5U2NvcmUiLCJsYXN0VXBkYXRlZCIsInRvQmVEZWZpbmVkIiwicmVqZWN0cyIsInRvVGhyb3ciLCJfcmVxdWlyZTIiLCJnZXRDb21wbGV0aW9uVHJlbmRzIiwiQXJyYXkiLCJpc0FycmF5IiwidG9CZSIsImxlbmd0aCIsInRvQmVHcmVhdGVyVGhhbiIsIl9yZXF1aXJlMyIsImdldE92ZXJhbGxDb25zaXN0ZW5jeVNjb3JlIiwiX3JlcXVpcmU0IiwiZ2V0QmVzdERheU9mV2VlayIsIl9yZXF1aXJlNSIsImdldENvbXBsZXRpb25SYXRlIiwidG9CZUdyZWF0ZXJUaGFuT3JFcXVhbCIsInRvQmVMZXNzVGhhbk9yRXF1YWwiLCJnZXRNdWx0aUhhYml0QW5hbHl0aWNzIl0sInNvdXJjZXMiOlsiYW5hbHl0aWNzU2VydmljZS50ZXN0LnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGFuYWx5dGljc1NlcnZpY2UgfSBmcm9tIFwiLi4vc2VydmljZXMvZmlyZWJhc2UvYW5hbHl0aWNzU2VydmljZVwiO1xuXG4vLyBNb2NrIEZpcmViYXNlXG5qZXN0Lm1vY2soXCIuLi9maXJlYmFzZUNvbmZpZ1wiLCAoKSA9PiAoe1xuICAgIGRiOiB7fSxcbiAgICBBUFBfSUQ6IFwidGVzdC1hcHBcIixcbn0pKTtcblxuamVzdC5tb2NrKFwiZmlyZWJhc2UvZmlyZXN0b3JlXCIsICgpID0+ICh7XG4gICAgZG9jOiBqZXN0LmZuKCksXG4gICAgZ2V0RG9jczogamVzdC5mbigpLFxuICAgIHF1ZXJ5OiBqZXN0LmZuKCksXG4gICAgcnVuVHJhbnNhY3Rpb246IGplc3QuZm4oKSxcbiAgICBzZXJ2ZXJUaW1lc3RhbXA6IGplc3QuZm4oKCkgPT4gKHsgc2Vjb25kczogRGF0ZS5ub3coKSAvIDEwMDAgfSkpLFxuICAgIFRpbWVzdGFtcDoge1xuICAgICAgICBub3c6IGplc3QuZm4oKCkgPT4gKHtcbiAgICAgICAgICAgIHNlY29uZHM6IERhdGUubm93KCkgLyAxMDAwLFxuICAgICAgICAgICAgdG9EYXRlOiAoKSA9PiBuZXcgRGF0ZSgpLFxuICAgICAgICAgICAgdG9NaWxsaXM6ICgpID0+IERhdGUubm93KCksXG4gICAgICAgIH0pKSxcbiAgICAgICAgZnJvbURhdGU6IGplc3QuZm4oKGRhdGU6IERhdGUpID0+ICh7XG4gICAgICAgICAgICBzZWNvbmRzOiBkYXRlLmdldFRpbWUoKSAvIDEwMDAsXG4gICAgICAgICAgICB0b0RhdGU6ICgpID0+IGRhdGUsXG4gICAgICAgICAgICB0b01pbGxpczogKCkgPT4gZGF0ZS5nZXRUaW1lKCksXG4gICAgICAgIH0pKSxcbiAgICB9LFxuICAgIHdoZXJlOiBqZXN0LmZuKCksXG59KSk7XG5cbmplc3QubW9jayhcIi4uL3NlcnZpY2VzL2ZpcmViYXNlL2NvbGxlY3Rpb25zXCIsICgpID0+ICh7XG4gICAgZ2V0SGFiaXRBbmFseXRpY3NDb2xsZWN0aW9uOiBqZXN0LmZuKCgpID0+ICh7fSkpLFxuICAgIGdldEhhYml0Q29tcGxldGlvbnNDb2xsZWN0aW9uOiBqZXN0LmZuKCgpID0+ICh7fSkpLFxuICAgIGdldEhhYml0U3RyZWFrc0NvbGxlY3Rpb246IGplc3QuZm4oKCkgPT4gKHt9KSksXG59KSk7XG5cbmplc3QubW9jayhcIi4uL3V0aWxzL2Vycm9ySGFuZGxpbmdcIiwgKCkgPT4gKHtcbiAgICBnZXRVc2VyRnJpZW5kbHlFcnJvck1lc3NhZ2U6IGplc3QuZm4oXG4gICAgICAgIChlcnJvcikgPT4gZXJyb3IubWVzc2FnZSB8fCBcIlVua25vd24gZXJyb3JcIixcbiAgICApLFxuICAgIHJldHJ5V2l0aEJhY2tvZmY6IGplc3QuZm4oKGZuKSA9PiBmbigpKSxcbn0pKTtcblxuZGVzY3JpYmUoXCJBbmFseXRpY3NTZXJ2aWNlXCIsICgpID0+IHtcbiAgICBjb25zdCBtb2NrSGFiaXRJZCA9IFwidGVzdC1oYWJpdC1pZFwiO1xuICAgIGNvbnN0IG1vY2tVc2VySWQgPSBcInRlc3QtdXNlci1pZFwiO1xuXG4gICAgYmVmb3JlRWFjaCgoKSA9PiB7XG4gICAgICAgIGplc3QuY2xlYXJBbGxNb2NrcygpO1xuICAgIH0pO1xuXG4gICAgZGVzY3JpYmUoXCJjYWxjdWxhdGVIYWJpdEFuYWx5dGljc1wiLCAoKSA9PiB7XG4gICAgICAgIGl0KFwic2hvdWxkIGNyZWF0ZSBlbXB0eSBhbmFseXRpY3MgZm9yIGhhYml0cyB3aXRoIG5vIGNvbXBsZXRpb25zXCIsIGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgIC8vIE1vY2sgZW1wdHkgY29tcGxldGlvbnNcbiAgICAgICAgICAgIGNvbnN0IHsgZ2V0RG9jcyB9ID0gcmVxdWlyZShcImZpcmViYXNlL2ZpcmVzdG9yZVwiKTtcbiAgICAgICAgICAgIGdldERvY3MubW9ja1Jlc29sdmVkVmFsdWUoe1xuICAgICAgICAgICAgICAgIGRvY3M6IFtdLFxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGFuYWx5dGljc1NlcnZpY2UuY2FsY3VsYXRlSGFiaXRBbmFseXRpY3MoXG4gICAgICAgICAgICAgICAgbW9ja0hhYml0SWQsXG4gICAgICAgICAgICAgICAgbW9ja1VzZXJJZCxcbiAgICAgICAgICAgICk7XG5cbiAgICAgICAgICAgIGV4cGVjdChyZXN1bHQpLnRvTWF0Y2hPYmplY3Qoe1xuICAgICAgICAgICAgICAgIGhhYml0SWQ6IG1vY2tIYWJpdElkLFxuICAgICAgICAgICAgICAgIHVzZXJJZDogbW9ja1VzZXJJZCxcbiAgICAgICAgICAgICAgICB0b3RhbENvbXBsZXRpb25zOiAwLFxuICAgICAgICAgICAgICAgIGNvbXBsZXRpb25SYXRlMzBEYXlzOiAwLFxuICAgICAgICAgICAgICAgIGF2ZXJhZ2VTdHJlYWtMZW5ndGg6IDAsXG4gICAgICAgICAgICAgICAgYmVzdERheU9mV2VlazogXCJNb25kYXlcIixcbiAgICAgICAgICAgICAgICBjb25zaXN0ZW5jeVNjb3JlOiAwLFxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBleHBlY3QocmVzdWx0Lmxhc3RVcGRhdGVkKS50b0JlRGVmaW5lZCgpO1xuICAgICAgICB9KTtcblxuICAgICAgICBpdChcInNob3VsZCB0aHJvdyBlcnJvciBmb3IgbWlzc2luZyBwYXJhbWV0ZXJzXCIsIGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgIGF3YWl0IGV4cGVjdChcbiAgICAgICAgICAgICAgICBhbmFseXRpY3NTZXJ2aWNlLmNhbGN1bGF0ZUhhYml0QW5hbHl0aWNzKFwiXCIsIG1vY2tVc2VySWQpLFxuICAgICAgICAgICAgKS5yZWplY3RzLnRvVGhyb3coXCJIYWJpdCBJRCBhbmQgVXNlciBJRCBhcmUgcmVxdWlyZWRcIik7XG5cbiAgICAgICAgICAgIGF3YWl0IGV4cGVjdChcbiAgICAgICAgICAgICAgICBhbmFseXRpY3NTZXJ2aWNlLmNhbGN1bGF0ZUhhYml0QW5hbHl0aWNzKG1vY2tIYWJpdElkLCBcIlwiKSxcbiAgICAgICAgICAgICkucmVqZWN0cy50b1Rocm93KFwiSGFiaXQgSUQgYW5kIFVzZXIgSUQgYXJlIHJlcXVpcmVkXCIpO1xuICAgICAgICB9KTtcbiAgICB9KTtcblxuICAgIGRlc2NyaWJlKFwiZ2V0Q29tcGxldGlvblRyZW5kc1wiLCAoKSA9PiB7XG4gICAgICAgIGl0KFwic2hvdWxkIHJldHVybiBlbXB0eSB0cmVuZHMgZm9yIGhhYml0cyB3aXRoIG5vIGNvbXBsZXRpb25zXCIsIGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgIC8vIE1vY2sgZW1wdHkgY29tcGxldGlvbnNcbiAgICAgICAgICAgIGNvbnN0IHsgZ2V0RG9jcyB9ID0gcmVxdWlyZShcImZpcmViYXNlL2ZpcmVzdG9yZVwiKTtcbiAgICAgICAgICAgIGdldERvY3MubW9ja1Jlc29sdmVkVmFsdWUoe1xuICAgICAgICAgICAgICAgIGRvY3M6IFtdLFxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGFuYWx5dGljc1NlcnZpY2UuZ2V0Q29tcGxldGlvblRyZW5kcyhcbiAgICAgICAgICAgICAgICBtb2NrSGFiaXRJZCxcbiAgICAgICAgICAgICAgICBtb2NrVXNlcklkLFxuICAgICAgICAgICAgICAgIFwid2Vla1wiLFxuICAgICAgICAgICAgKTtcblxuICAgICAgICAgICAgZXhwZWN0KEFycmF5LmlzQXJyYXkocmVzdWx0KSkudG9CZSh0cnVlKTtcbiAgICAgICAgICAgIGV4cGVjdChyZXN1bHQubGVuZ3RoKS50b0JlR3JlYXRlclRoYW4oMCk7IC8vIFNob3VsZCByZXR1cm4gdHJlbmQgcGVyaW9kcyBldmVuIHdpdGggbm8gZGF0YVxuICAgICAgICB9KTtcblxuICAgICAgICBpdChcInNob3VsZCB0aHJvdyBlcnJvciBmb3IgbWlzc2luZyBwYXJhbWV0ZXJzXCIsIGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgIGF3YWl0IGV4cGVjdChcbiAgICAgICAgICAgICAgICBhbmFseXRpY3NTZXJ2aWNlLmdldENvbXBsZXRpb25UcmVuZHMoXCJcIiwgbW9ja1VzZXJJZCwgXCJ3ZWVrXCIpLFxuICAgICAgICAgICAgKS5yZWplY3RzLnRvVGhyb3coXCJIYWJpdCBJRCBhbmQgVXNlciBJRCBhcmUgcmVxdWlyZWRcIik7XG4gICAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgZGVzY3JpYmUoXCJnZXRPdmVyYWxsQ29uc2lzdGVuY3lTY29yZVwiLCAoKSA9PiB7XG4gICAgICAgIGl0KFwic2hvdWxkIHJldHVybiAwIGZvciB1c2VycyB3aXRoIG5vIGhhYml0c1wiLCBhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICAvLyBNb2NrIGVtcHR5IGNvbXBsZXRpb25zXG4gICAgICAgICAgICBjb25zdCB7IGdldERvY3MgfSA9IHJlcXVpcmUoXCJmaXJlYmFzZS9maXJlc3RvcmVcIik7XG4gICAgICAgICAgICBnZXREb2NzLm1vY2tSZXNvbHZlZFZhbHVlKHtcbiAgICAgICAgICAgICAgICBkb2NzOiBbXSxcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBjb25zdCByZXN1bHQgPVxuICAgICAgICAgICAgICAgIGF3YWl0IGFuYWx5dGljc1NlcnZpY2UuZ2V0T3ZlcmFsbENvbnNpc3RlbmN5U2NvcmUobW9ja1VzZXJJZCk7XG5cbiAgICAgICAgICAgIGV4cGVjdChyZXN1bHQpLnRvQmUoMCk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGl0KFwic2hvdWxkIHRocm93IGVycm9yIGZvciBtaXNzaW5nIHVzZXIgSURcIiwgYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgYXdhaXQgZXhwZWN0KFxuICAgICAgICAgICAgICAgIGFuYWx5dGljc1NlcnZpY2UuZ2V0T3ZlcmFsbENvbnNpc3RlbmN5U2NvcmUoXCJcIiksXG4gICAgICAgICAgICApLnJlamVjdHMudG9UaHJvdyhcIlVzZXIgSUQgaXMgcmVxdWlyZWRcIik7XG4gICAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgZGVzY3JpYmUoXCJnZXRCZXN0RGF5T2ZXZWVrXCIsICgpID0+IHtcbiAgICAgICAgaXQoXCJzaG91bGQgcmV0dXJuIE1vbmRheSBhcyBkZWZhdWx0IGZvciBoYWJpdHMgd2l0aCBubyBjb21wbGV0aW9uc1wiLCBhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICAvLyBNb2NrIGVtcHR5IGNvbXBsZXRpb25zXG4gICAgICAgICAgICBjb25zdCB7IGdldERvY3MgfSA9IHJlcXVpcmUoXCJmaXJlYmFzZS9maXJlc3RvcmVcIik7XG4gICAgICAgICAgICBnZXREb2NzLm1vY2tSZXNvbHZlZFZhbHVlKHtcbiAgICAgICAgICAgICAgICBkb2NzOiBbXSxcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBhbmFseXRpY3NTZXJ2aWNlLmdldEJlc3REYXlPZldlZWsoXG4gICAgICAgICAgICAgICAgbW9ja0hhYml0SWQsXG4gICAgICAgICAgICAgICAgbW9ja1VzZXJJZCxcbiAgICAgICAgICAgICk7XG5cbiAgICAgICAgICAgIGV4cGVjdChyZXN1bHQpLnRvQmUoXCJNb25kYXlcIik7XG4gICAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgZGVzY3JpYmUoXCJnZXRDb21wbGV0aW9uUmF0ZVwiLCAoKSA9PiB7XG4gICAgICAgIGl0KFwic2hvdWxkIGNhbGN1bGF0ZSBjb21wbGV0aW9uIHJhdGUgY29ycmVjdGx5XCIsIGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgIC8vIE1vY2sgZW1wdHkgY29tcGxldGlvbnMgZm9yIHNpbXBsaWNpdHlcbiAgICAgICAgICAgIGNvbnN0IHsgZ2V0RG9jcyB9ID0gcmVxdWlyZShcImZpcmViYXNlL2ZpcmVzdG9yZVwiKTtcbiAgICAgICAgICAgIGdldERvY3MubW9ja1Jlc29sdmVkVmFsdWUoe1xuICAgICAgICAgICAgICAgIGRvY3M6IFtdLFxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGFuYWx5dGljc1NlcnZpY2UuZ2V0Q29tcGxldGlvblJhdGUoXG4gICAgICAgICAgICAgICAgbW9ja0hhYml0SWQsXG4gICAgICAgICAgICAgICAgbW9ja1VzZXJJZCxcbiAgICAgICAgICAgICAgICBcIjIwMjQtMDEtMDFcIixcbiAgICAgICAgICAgICAgICBcIjIwMjQtMDEtMDdcIixcbiAgICAgICAgICAgICk7XG5cbiAgICAgICAgICAgIGV4cGVjdCh0eXBlb2YgcmVzdWx0KS50b0JlKFwibnVtYmVyXCIpO1xuICAgICAgICAgICAgZXhwZWN0KHJlc3VsdCkudG9CZUdyZWF0ZXJUaGFuT3JFcXVhbCgwKTtcbiAgICAgICAgICAgIGV4cGVjdChyZXN1bHQpLnRvQmVMZXNzVGhhbk9yRXF1YWwoMTAwKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgaXQoXCJzaG91bGQgdGhyb3cgZXJyb3IgZm9yIG1pc3NpbmcgcGFyYW1ldGVyc1wiLCBhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICBhd2FpdCBleHBlY3QoXG4gICAgICAgICAgICAgICAgYW5hbHl0aWNzU2VydmljZS5nZXRDb21wbGV0aW9uUmF0ZShcbiAgICAgICAgICAgICAgICAgICAgXCJcIixcbiAgICAgICAgICAgICAgICAgICAgbW9ja1VzZXJJZCxcbiAgICAgICAgICAgICAgICAgICAgXCIyMDI0LTAxLTAxXCIsXG4gICAgICAgICAgICAgICAgICAgIFwiMjAyNC0wMS0wN1wiLFxuICAgICAgICAgICAgICAgICksXG4gICAgICAgICAgICApLnJlamVjdHMudG9UaHJvdyhcbiAgICAgICAgICAgICAgICBcIkFsbCBwYXJhbWV0ZXJzIGFyZSByZXF1aXJlZCBmb3IgY29tcGxldGlvbiByYXRlIGNhbGN1bGF0aW9uXCIsXG4gICAgICAgICAgICApO1xuICAgICAgICB9KTtcbiAgICB9KTtcblxuICAgIGRlc2NyaWJlKFwiZ2V0TXVsdGlIYWJpdEFuYWx5dGljc1wiLCAoKSA9PiB7XG4gICAgICAgIGl0KFwic2hvdWxkIHJldHVybiBlbXB0eSBhcnJheSBmb3IgZW1wdHkgaGFiaXQgSURzXCIsIGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGFuYWx5dGljc1NlcnZpY2UuZ2V0TXVsdGlIYWJpdEFuYWx5dGljcyhcbiAgICAgICAgICAgICAgICBbXSxcbiAgICAgICAgICAgICAgICBtb2NrVXNlcklkLFxuICAgICAgICAgICAgKTtcblxuICAgICAgICAgICAgZXhwZWN0KEFycmF5LmlzQXJyYXkocmVzdWx0KSkudG9CZSh0cnVlKTtcbiAgICAgICAgICAgIGV4cGVjdChyZXN1bHQubGVuZ3RoKS50b0JlKDApO1xuICAgICAgICB9KTtcblxuICAgICAgICBpdChcInNob3VsZCB0aHJvdyBlcnJvciBmb3IgbWlzc2luZyBwYXJhbWV0ZXJzXCIsIGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgIGF3YWl0IGV4cGVjdChcbiAgICAgICAgICAgICAgICBhbmFseXRpY3NTZXJ2aWNlLmdldE11bHRpSGFiaXRBbmFseXRpY3MoW10sIFwiXCIpLFxuICAgICAgICAgICAgKS5yZWplY3RzLnRvVGhyb3coXCJIYWJpdCBJRHMgYW5kIFVzZXIgSUQgYXJlIHJlcXVpcmVkXCIpO1xuICAgICAgICB9KTtcbiAgICB9KTtcbn0pO1xuIl0sIm1hcHBpbmdzIjoiQUFHQUEsV0FBQSxHQUFLQyxJQUFJLHNCQUFzQjtFQUFBLE9BQU87SUFDbENDLEVBQUUsRUFBRSxDQUFDLENBQUM7SUFDTkMsTUFBTSxFQUFFO0VBQ1os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