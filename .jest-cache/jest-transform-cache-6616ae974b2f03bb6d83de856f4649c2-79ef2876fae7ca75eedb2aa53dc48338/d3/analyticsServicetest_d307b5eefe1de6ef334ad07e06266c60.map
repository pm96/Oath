{"version":3,"names":["_getJestObj","mock","db","APP_ID","doc","jest","fn","getDocs","query","runTransaction","serverTimestamp","seconds","Date","now","Timestamp","toDate","toMillis","fromDate","date","getTime","where","getHabitAnalyticsCollection","getHabitCompletionsCollection","getHabitStreaksCollection","getUserFriendlyErrorMessage","error","message","retryWithBackoff","_interopRequireDefault","require","default","_asyncToGenerator2","_analyticsService","_require6","describe","mockHabitId","mockUserId","beforeEach","clearAllMocks","it","_require","mockResolvedValue","docs","result","analyticsService","calculateHabitAnalytics","expect","toMatchObject","habitId","userId","totalCompletions","completionRate30Days","averageStreakLength","bestDayOfWeek","consistencyScore","lastUpdated","toBeDefined","rejects","toThrow","_require2","getCompletionTrends","Array","isArray","toBe","length","toBeGreaterThan","_require3","getOverallConsistencyScore","_require4","getBestDayOfWeek","_require5","getCompletionRate","toBeGreaterThanOrEqual","toBeLessThanOrEqual","getMultiHabitAnalytics"],"sources":["analyticsService.test.ts"],"sourcesContent":["import { analyticsService } from \"../services/firebase/analyticsService\";\n\n// Mock Firebase\njest.mock(\"../firebaseConfig\", () => ({\n    db: {},\n    APP_ID: \"test-app\",\n}));\n\njest.mock(\"firebase/firestore\", () => ({\n    doc: jest.fn(),\n    getDocs: jest.fn(),\n    query: jest.fn(),\n    runTransaction: jest.fn(),\n    serverTimestamp: jest.fn(() => ({ seconds: Date.now() / 1000 })),\n    Timestamp: {\n        now: jest.fn(() => ({\n            seconds: Date.now() / 1000,\n            toDate: () => new Date(),\n            toMillis: () => Date.now(),\n        })),\n        fromDate: jest.fn((date: Date) => ({\n            seconds: date.getTime() / 1000,\n            toDate: () => date,\n            toMillis: () => date.getTime(),\n        })),\n    },\n    where: jest.fn(),\n}));\n\njest.mock(\"../services/firebase/collections\", () => ({\n    getHabitAnalyticsCollection: jest.fn(() => ({})),\n    getHabitCompletionsCollection: jest.fn(() => ({})),\n    getHabitStreaksCollection: jest.fn(() => ({})),\n}));\n\njest.mock(\"../utils/errorHandling\", () => ({\n    getUserFriendlyErrorMessage: jest.fn(\n        (error) => error.message || \"Unknown error\",\n    ),\n    retryWithBackoff: jest.fn((fn) => fn()),\n}));\n\ndescribe(\"AnalyticsService\", () => {\n    const mockHabitId = \"test-habit-id\";\n    const mockUserId = \"test-user-id\";\n\n    beforeEach(() => {\n        jest.clearAllMocks();\n    });\n\n    describe(\"calculateHabitAnalytics\", () => {\n        it(\"should create empty analytics for habits with no completions\", async () => {\n            // Mock empty completions\n            const { getDocs } = require(\"firebase/firestore\");\n            getDocs.mockResolvedValue({\n                docs: [],\n            });\n\n            const result = await analyticsService.calculateHabitAnalytics(\n                mockHabitId,\n                mockUserId,\n            );\n\n            expect(result).toMatchObject({\n                habitId: mockHabitId,\n                userId: mockUserId,\n                totalCompletions: 0,\n                completionRate30Days: 0,\n                averageStreakLength: 0,\n                bestDayOfWeek: \"Monday\",\n                consistencyScore: 0,\n            });\n            expect(result.lastUpdated).toBeDefined();\n        });\n\n        it(\"should throw error for missing parameters\", async () => {\n            await expect(\n                analyticsService.calculateHabitAnalytics(\"\", mockUserId),\n            ).rejects.toThrow(\"Habit ID and User ID are required\");\n\n            await expect(\n                analyticsService.calculateHabitAnalytics(mockHabitId, \"\"),\n            ).rejects.toThrow(\"Habit ID and User ID are required\");\n        });\n    });\n\n    describe(\"getCompletionTrends\", () => {\n        it(\"should return empty trends for habits with no completions\", async () => {\n            // Mock empty completions\n            const { getDocs } = require(\"firebase/firestore\");\n            getDocs.mockResolvedValue({\n                docs: [],\n            });\n\n            const result = await analyticsService.getCompletionTrends(\n                mockHabitId,\n                mockUserId,\n                \"week\",\n            );\n\n            expect(Array.isArray(result)).toBe(true);\n            expect(result.length).toBeGreaterThan(0); // Should return trend periods even with no data\n        });\n\n        it(\"should throw error for missing parameters\", async () => {\n            await expect(\n                analyticsService.getCompletionTrends(\"\", mockUserId, \"week\"),\n            ).rejects.toThrow(\"Habit ID and User ID are required\");\n        });\n    });\n\n    describe(\"getOverallConsistencyScore\", () => {\n        it(\"should return 0 for users with no habits\", async () => {\n            // Mock empty completions\n            const { getDocs } = require(\"firebase/firestore\");\n            getDocs.mockResolvedValue({\n                docs: [],\n            });\n\n            const result =\n                await analyticsService.getOverallConsistencyScore(mockUserId);\n\n            expect(result).toBe(0);\n        });\n\n        it(\"should throw error for missing user ID\", async () => {\n            await expect(\n                analyticsService.getOverallConsistencyScore(\"\"),\n            ).rejects.toThrow(\"User ID is required\");\n        });\n    });\n\n    describe(\"getBestDayOfWeek\", () => {\n        it(\"should return Monday as default for habits with no completions\", async () => {\n            // Mock empty completions\n            const { getDocs } = require(\"firebase/firestore\");\n            getDocs.mockResolvedValue({\n                docs: [],\n            });\n\n            const result = await analyticsService.getBestDayOfWeek(\n                mockHabitId,\n                mockUserId,\n            );\n\n            expect(result).toBe(\"Monday\");\n        });\n    });\n\n    describe(\"getCompletionRate\", () => {\n        it(\"should calculate completion rate correctly\", async () => {\n            // Mock empty completions for simplicity\n            const { getDocs } = require(\"firebase/firestore\");\n            getDocs.mockResolvedValue({\n                docs: [],\n            });\n\n            const result = await analyticsService.getCompletionRate(\n                mockHabitId,\n                mockUserId,\n                \"2024-01-01\",\n                \"2024-01-07\",\n            );\n\n            expect(typeof result).toBe(\"number\");\n            expect(result).toBeGreaterThanOrEqual(0);\n            expect(result).toBeLessThanOrEqual(100);\n        });\n\n        it(\"should throw error for missing parameters\", async () => {\n            await expect(\n                analyticsService.getCompletionRate(\n                    \"\",\n                    mockUserId,\n                    \"2024-01-01\",\n                    \"2024-01-07\",\n                ),\n            ).rejects.toThrow(\n                \"All parameters are required for completion rate calculation\",\n            );\n        });\n    });\n\n    describe(\"getMultiHabitAnalytics\", () => {\n        it(\"should return empty array for empty habit IDs\", async () => {\n            const result = await analyticsService.getMultiHabitAnalytics(\n                [],\n                mockUserId,\n            );\n\n            expect(Array.isArray(result)).toBe(true);\n            expect(result.length).toBe(0);\n        });\n\n        it(\"should throw error for missing parameters\", async () => {\n            await expect(\n                analyticsService.getMultiHabitAnalytics([], \"\"),\n            ).rejects.toThrow(\"Habit IDs and User ID are required\");\n        });\n    });\n});\n"],"mappings":"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","ignoreList":[]}