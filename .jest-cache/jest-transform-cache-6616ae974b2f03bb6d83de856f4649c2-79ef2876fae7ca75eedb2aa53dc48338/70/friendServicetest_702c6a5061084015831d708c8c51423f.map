{"version":3,"names":["fc","_interopRequireWildcard","require","filterSearchResults","query","currentUserId","allUsers","trim","length","normalizedQuery","toLowerCase","filter","user","userId","matchesEmail","email","includes","matchesName","displayName","map","relationshipStatus","shameScore","describe","it","assert","property","string","minLength","maxLength","s","uuid","array","record","emailAddress","integer","min","max","results","result","expect","toBe","currentUserInResults","some","r","_loop","_result","existsInInput","u","userIds","uniqueUserIds","Set","size","numRuns","toEqual","lowerResults","upperResults","toUpperCase","mixedResults","lowerIds","upperIds","mixedIds"],"sources":["friendService.test.ts"],"sourcesContent":["/**\n * Property-Based Tests for Friend Service\n * Feature: friend-management-ui\n */\n\nimport * as fc from \"fast-check\";\n\n/**\n * **Feature: friend-management-ui, Property 1: Search results match query**\n * **Validates: Requirements 1.1**\n *\n * For any search query and user database, all returned results should have\n * either email or displayName matching the query, and should never include\n * the searching user's own account.\n *\n * This test validates the core logic of search result filtering without\n * requiring a live Firebase connection.\n */\n\ninterface TestUser {\n    userId: string;\n    email: string;\n    displayName: string;\n    shameScore: number;\n}\n\ninterface UserSearchResult {\n    userId: string;\n    displayName: string;\n    email: string;\n    relationshipStatus: \"none\" | \"friend\" | \"pending_sent\" | \"pending_received\";\n    shameScore?: number;\n}\n\n// Helper function that simulates the search filtering logic\nfunction filterSearchResults(\n    query: string,\n    currentUserId: string,\n    allUsers: TestUser[],\n): UserSearchResult[] {\n    if (!query || query.trim().length === 0) {\n        return [];\n    }\n\n    const normalizedQuery = query.trim().toLowerCase();\n\n    return allUsers\n        .filter((user) => {\n            // Exclude current user\n            if (user.userId === currentUserId) {\n                return false;\n            }\n\n            // Check if email or displayName matches query\n            const matchesEmail = user.email.toLowerCase().includes(normalizedQuery);\n            const matchesName = user.displayName\n                .toLowerCase()\n                .includes(normalizedQuery);\n\n            return matchesEmail || matchesName;\n        })\n        .map((user) => ({\n            userId: user.userId,\n            displayName: user.displayName,\n            email: user.email,\n            relationshipStatus: \"none\" as const,\n            shameScore: user.shameScore,\n        }));\n}\n\ndescribe(\"Friend Service Property-Based Tests\", () => {\n    describe(\"Property 1: Search results match query\", () => {\n        it(\"should return only users matching the query and exclude the current user\", () => {\n            fc.assert(\n                fc.property(\n                    fc\n                        .string({ minLength: 1, maxLength: 20 })\n                        .filter((s) => s.trim().length > 0),\n                    fc.uuid(),\n                    fc.array(\n                        fc.record({\n                            userId: fc.uuid(),\n                            email: fc.emailAddress(),\n                            displayName: fc.string({ minLength: 1, maxLength: 30 }),\n                            shameScore: fc.integer({ min: 0, max: 100 }),\n                        }),\n                        { minLength: 0, maxLength: 20 },\n                    ),\n                    (query, currentUserId, allUsers) => {\n                        const results = filterSearchResults(query, currentUserId, allUsers);\n                        const normalizedQuery = query.trim().toLowerCase();\n\n                        for (const result of results) {\n                            const matchesEmail = result.email\n                                .toLowerCase()\n                                .includes(normalizedQuery);\n                            const matchesName = result.displayName\n                                .toLowerCase()\n                                .includes(normalizedQuery);\n                            expect(matchesEmail || matchesName).toBe(true);\n                        }\n\n                        const currentUserInResults = results.some(\n                            (r) => r.userId === currentUserId,\n                        );\n                        expect(currentUserInResults).toBe(false);\n\n                        for (const result of results) {\n                            const existsInInput = allUsers.some(\n                                (u) => u.userId === result.userId,\n                            );\n                            expect(existsInInput).toBe(true);\n                        }\n\n                        const userIds = results.map((r) => r.userId);\n                        const uniqueUserIds = new Set(userIds);\n                        expect(userIds.length).toBe(uniqueUserIds.size);\n                    },\n                ),\n                { numRuns: 100 },\n            );\n        });\n\n        it(\"should return empty array for empty query\", () => {\n            fc.assert(\n                fc.property(\n                    fc.uuid(),\n                    fc.array(\n                        fc.record({\n                            userId: fc.uuid(),\n                            email: fc.emailAddress(),\n                            displayName: fc.string({ minLength: 1, maxLength: 30 }),\n                            shameScore: fc.integer({ min: 0, max: 100 }),\n                        }),\n                        { minLength: 0, maxLength: 20 },\n                    ),\n                    (currentUserId, allUsers) => {\n                        const results = filterSearchResults(\"\", currentUserId, allUsers);\n                        expect(results).toEqual([]);\n                    },\n                ),\n                { numRuns: 100 },\n            );\n        });\n\n        it(\"should perform case-insensitive matching\", () => {\n            fc.assert(\n                fc.property(\n                    fc\n                        .string({ minLength: 1, maxLength: 20 })\n                        .filter((s) => s.trim().length > 0),\n                    fc.uuid(),\n                    fc.array(\n                        fc.record({\n                            userId: fc.uuid(),\n                            email: fc.emailAddress(),\n                            displayName: fc.string({ minLength: 1, maxLength: 30 }),\n                            shameScore: fc.integer({ min: 0, max: 100 }),\n                        }),\n                        { minLength: 0, maxLength: 20 },\n                    ),\n                    (query, currentUserId, allUsers) => {\n                        const lowerResults = filterSearchResults(\n                            query.toLowerCase(),\n                            currentUserId,\n                            allUsers,\n                        );\n                        const upperResults = filterSearchResults(\n                            query.toUpperCase(),\n                            currentUserId,\n                            allUsers,\n                        );\n                        const mixedResults = filterSearchResults(\n                            query,\n                            currentUserId,\n                            allUsers,\n                        );\n\n                        const lowerIds = new Set(lowerResults.map((r) => r.userId));\n                        const upperIds = new Set(upperResults.map((r) => r.userId));\n                        const mixedIds = new Set(mixedResults.map((r) => r.userId));\n\n                        expect(lowerIds).toEqual(upperIds);\n                        expect(lowerIds).toEqual(mixedIds);\n                    },\n                ),\n                { numRuns: 100 },\n            );\n        });\n    });\n});\n"],"mappings":"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","ignoreList":[]}