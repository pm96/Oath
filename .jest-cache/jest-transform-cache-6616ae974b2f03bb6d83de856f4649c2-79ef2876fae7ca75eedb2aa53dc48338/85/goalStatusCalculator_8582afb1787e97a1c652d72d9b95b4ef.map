{"version":3,"names":["isSameDay","date1","date2","getFullYear","getMonth","getDate","getDeadlineProximity","deadline","now","Date","hoursUntilDeadline","getTime","isOverdue","displayText","hoursOverdue","Math","abs","daysOverdue","floor","minutesUntilDeadline","daysUntilDeadline","calculateStatus","goal","nextDeadline","latestCompletionDate","color","priority","text","showNudge","getStatusColor","status","getStatusText","shouldShowNudgeButton","isCompleted","arguments","length","undefined"],"sources":["goalStatusCalculator.ts"],"sourcesContent":["import { Goal, GoalStatus } from \"../services/firebase/collections\";\n\n/**\n * Goal Status Calculator Utility\n *\n * Calculates real-time goal status based on deadline proximity and completion state.\n * Implements traffic light logic: green (safe), yellow (warning), red (failed/overdue).\n */\n\nexport interface DeadlineProximity {\n    hoursUntilDeadline: number;\n    isOverdue: boolean;\n    displayText: string;\n}\n\n/**\n * Check if two dates are on the same day\n */\nfunction isSameDay(date1: Date, date2: Date): boolean {\n    return (\n        date1.getFullYear() === date2.getFullYear() &&\n        date1.getMonth() === date2.getMonth() &&\n        date1.getDate() === date2.getDate()\n    );\n}\n\n/**\n * Calculate deadline proximity information\n */\nexport function getDeadlineProximity(deadline: Date): DeadlineProximity {\n    const now = new Date();\n    const hoursUntilDeadline =\n        (deadline.getTime() - now.getTime()) / (1000 * 60 * 60);\n    const isOverdue = hoursUntilDeadline < 0;\n\n    let displayText: string;\n\n    if (isOverdue) {\n        const hoursOverdue = Math.abs(hoursUntilDeadline);\n        const daysOverdue = Math.floor(hoursOverdue / 24);\n\n        if (daysOverdue > 0) {\n            displayText = `Overdue by ${daysOverdue}d`;\n        } else {\n            displayText = `Overdue by ${Math.floor(hoursOverdue)}h`;\n        }\n    } else {\n        const minutesUntilDeadline = Math.floor(hoursUntilDeadline * 60);\n\n        if (hoursUntilDeadline < 1) {\n            displayText = `Due in ${minutesUntilDeadline}m`;\n        } else if (hoursUntilDeadline < 24) {\n            displayText = `Due in ${Math.floor(hoursUntilDeadline)}h`;\n        } else {\n            const daysUntilDeadline = Math.floor(hoursUntilDeadline / 24);\n            displayText = `Due in ${daysUntilDeadline}d`;\n        }\n    }\n\n    return {\n        hoursUntilDeadline,\n        isOverdue,\n        displayText,\n    };\n}\n\n/**\n * Calculate goal status based on deadline proximity and completion state\n *\n * Logic:\n * - Completed today: Green with checkmark\n * - Overdue: Red with overdue time\n * - Due in < 2h: Red with time remaining\n * - Due in 2-6h: Yellow with time remaining\n * - Due in > 6h: Green (safe)\n */\nexport function calculateStatus(goal: Goal): GoalStatus {\n    const now = new Date();\n    const deadline = goal.nextDeadline;\n    const hoursUntilDeadline =\n        (deadline.getTime() - now.getTime()) / (1000 * 60 * 60);\n\n    // If goal is completed today, always green\n    if (goal.latestCompletionDate && isSameDay(goal.latestCompletionDate, now)) {\n        return {\n            color: \"green\",\n            priority: 3,\n            text: \"Completed âœ“\",\n            showNudge: false,\n        };\n    }\n\n    // If overdue\n    if (hoursUntilDeadline < 0) {\n        const hoursOverdue = Math.abs(hoursUntilDeadline);\n        const daysOverdue = Math.floor(hoursOverdue / 24);\n\n        return {\n            color: \"red\",\n            priority: 1,\n            text:\n                daysOverdue > 0\n                    ? `Overdue by ${daysOverdue}d`\n                    : `Overdue by ${Math.floor(hoursOverdue)}h`,\n            showNudge: true,\n        };\n    }\n\n    // If due soon (less than 2 hours)\n    if (hoursUntilDeadline < 2) {\n        const minutesUntilDeadline = Math.floor(hoursUntilDeadline * 60);\n        return {\n            color: \"red\",\n            priority: 1,\n            text: `Due in ${minutesUntilDeadline}m`,\n            showNudge: true,\n        };\n    }\n\n    // If due within 6 hours (warning zone)\n    if (hoursUntilDeadline < 6) {\n        return {\n            color: \"yellow\",\n            priority: 2,\n            text: `Due in ${Math.floor(hoursUntilDeadline)}h`,\n            showNudge: true,\n        };\n    }\n\n    // Safe zone (more than 6 hours)\n    return {\n        color: \"green\",\n        priority: 3,\n        text: \"Safe\",\n        showNudge: false,\n    };\n}\n\n/**\n * Get status color for a goal status\n */\nexport function getStatusColor(status: GoalStatus): string {\n    switch (status.color) {\n        case \"green\":\n            return \"#22c55e\"; // green-500\n        case \"yellow\":\n            return \"#eab308\"; // yellow-500\n        case \"red\":\n            return \"#ef4444\"; // red-500\n        default:\n            return \"#6b7280\"; // gray-500\n    }\n}\n\n/**\n * Get status text for a goal\n */\nexport function getStatusText(goal: Goal): string {\n    const status = calculateStatus(goal);\n    return status.text;\n}\n\n/**\n * Determine if nudge button should be shown for a goal\n */\nexport function shouldShowNudgeButton(\n    goal: Goal,\n    isCompleted: boolean = false,\n): boolean {\n    // Never show nudge button for completed goals\n    if (isCompleted) {\n        return false;\n    }\n\n    // Check if goal is completed today\n    const now = new Date();\n    if (goal.latestCompletionDate && isSameDay(goal.latestCompletionDate, now)) {\n        return false;\n    }\n\n    const status = calculateStatus(goal);\n    return status.showNudge;\n}\n"],"mappings":"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","ignoreList":[]}