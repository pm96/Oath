6d8921802bb276eb00de1459308f0b65
var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault").default;
Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.canSendNudge = canSendNudge;
exports.getNudgeCooldowns = getNudgeCooldowns;
exports.getNudgeHistory = getNudgeHistory;
exports.getRemainingCooldownMinutes = getRemainingCooldownMinutes;
exports.sendNudge = sendNudge;
exports.subscribeToNudgeCooldowns = subscribeToNudgeCooldowns;
var _asyncToGenerator2 = _interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));
var _errorHandling = require("../../utils/errorHandling");
var _firestore = require("firebase/firestore");
var _collections = require("./collections");
function sendNudge(_x) {
  return _sendNudge.apply(this, arguments);
}
function _sendNudge() {
  _sendNudge = (0, _asyncToGenerator2.default)(function* (input) {
    if (!input.senderId || !input.receiverId || !input.goalId) {
      throw new Error("Sender ID, receiver ID, and goal ID are required");
    }
    if (!input.senderName || !input.goalDescription) {
      throw new Error("Sender name and goal description are required");
    }
    if (input.senderId === input.receiverId) {
      throw new Error("Cannot nudge yourself");
    }
    try {
      yield (0, _errorHandling.retryWithBackoff)((0, _asyncToGenerator2.default)(function* () {
        var cooldowns = yield getNudgeCooldowns(input.senderId);
        var existingCooldown = cooldowns.get(input.goalId);
        if (existingCooldown && new Date() < existingCooldown) {
          var remainingMinutes = Math.ceil((existingCooldown.getTime() - new Date().getTime()) / (1000 * 60));
          throw new Error(`Already nudged - wait ${remainingMinutes}m`);
        }
        var nudgesCollection = (0, _collections.getNudgesCollection)();
        var now = new Date();
        var cooldownUntil = new Date(now.getTime() + 60 * 60 * 1000);
        var nudgeData = {
          senderId: input.senderId,
          senderName: input.senderName,
          receiverId: input.receiverId,
          goalId: input.goalId,
          goalDescription: input.goalDescription,
          timestamp: _firestore.Timestamp.fromDate(now),
          cooldownUntil: _firestore.Timestamp.fromDate(cooldownUntil),
          createdAt: (0, _firestore.serverTimestamp)()
        };
        yield (0, _firestore.addDoc)(nudgesCollection, nudgeData);
      }));
    } catch (error) {
      var message = (0, _errorHandling.getUserFriendlyErrorMessage)(error);
      throw new Error(message);
    }
  });
  return _sendNudge.apply(this, arguments);
}
function getNudgeCooldowns(_x2) {
  return _getNudgeCooldowns.apply(this, arguments);
}
function _getNudgeCooldowns() {
  _getNudgeCooldowns = (0, _asyncToGenerator2.default)(function* (userId) {
    if (!userId) {
      throw new Error("User ID is required");
    }
    try {
      return yield (0, _errorHandling.retryWithBackoff)((0, _asyncToGenerator2.default)(function* () {
        var nudgesCollection = (0, _collections.getNudgesCollection)();
        var now = new Date();
        var q = (0, _firestore.query)(nudgesCollection, (0, _firestore.where)("senderId", "==", userId), (0, _firestore.where)("cooldownUntil", ">", _firestore.Timestamp.fromDate(now)), (0, _firestore.orderBy)("cooldownUntil", "desc"));
        var snapshot = yield (0, _firestore.getDocs)(q);
        var cooldowns = new Map();
        snapshot.docs.forEach(function (doc) {
          var data = doc.data();
          var goalId = data.goalId;
          var cooldownUntil = data.cooldownUntil.toDate();
          if (!cooldowns.has(goalId) || cooldownUntil > cooldowns.get(goalId)) {
            cooldowns.set(goalId, cooldownUntil);
          }
        });
        return cooldowns;
      }));
    } catch (error) {
      console.error("Error fetching nudge cooldowns:", error);
      var message = (0, _errorHandling.getUserFriendlyErrorMessage)(error);
      throw new Error(message);
    }
  });
  return _getNudgeCooldowns.apply(this, arguments);
}
function subscribeToNudgeCooldowns(userId, callback, onError) {
  if (!userId) {
    var error = new Error("User ID is required");
    if (onError) onError(error);
    return function () {};
  }
  var nudgesCollection = (0, _collections.getNudgesCollection)();
  var now = new Date();
  var q = (0, _firestore.query)(nudgesCollection, (0, _firestore.where)("senderId", "==", userId), (0, _firestore.where)("cooldownUntil", ">", _firestore.Timestamp.fromDate(now)), (0, _firestore.orderBy)("cooldownUntil", "desc"));
  var unsubscribe = (0, _firestore.onSnapshot)(q, function (snapshot) {
    try {
      var cooldowns = new Map();
      var currentTime = new Date();
      snapshot.docs.forEach(function (doc) {
        var data = doc.data();
        var goalId = data.goalId;
        var cooldownUntil = data.cooldownUntil.toDate();
        if (cooldownUntil > currentTime) {
          if (!cooldowns.has(goalId) || cooldownUntil > cooldowns.get(goalId)) {
            cooldowns.set(goalId, cooldownUntil);
          }
        }
      });
      callback(cooldowns);
    } catch (error) {
      console.error("Error processing nudge cooldowns snapshot:", error);
      if (onError) {
        onError(error instanceof Error ? error : new Error("Failed to process nudge cooldowns data"));
      }
    }
  }, function (error) {
    console.error("Error in nudge cooldowns snapshot listener:", error);
    if (onError) {
      var message = (0, _errorHandling.getUserFriendlyErrorMessage)(error);
      onError(new Error(message));
    }
  });
  return unsubscribe;
}
function getNudgeHistory(_x3, _x4) {
  return _getNudgeHistory.apply(this, arguments);
}
function _getNudgeHistory() {
  _getNudgeHistory = (0, _asyncToGenerator2.default)(function* (userId, type) {
    var days = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 7;
    if (!userId) {
      throw new Error("User ID is required");
    }
    if (days <= 0) {
      throw new Error("Days must be a positive number");
    }
    try {
      return yield (0, _errorHandling.retryWithBackoff)((0, _asyncToGenerator2.default)(function* () {
        var nudgesCollection = (0, _collections.getNudgesCollection)();
        var cutoffDate = new Date();
        cutoffDate.setDate(cutoffDate.getDate() - days);
        var fieldName = type === "sent" ? "senderId" : "receiverId";
        var q = (0, _firestore.query)(nudgesCollection, (0, _firestore.where)(fieldName, "==", userId), (0, _firestore.where)("timestamp", ">=", _firestore.Timestamp.fromDate(cutoffDate)), (0, _firestore.orderBy)("timestamp", "desc"), (0, _firestore.limit)(100));
        var snapshot = yield (0, _firestore.getDocs)(q);
        var nudges = snapshot.docs.map(function (doc) {
          var _data$createdAt;
          var data = doc.data();
          return {
            id: doc.id,
            senderId: data.senderId,
            senderName: data.senderName,
            receiverId: data.receiverId,
            goalId: data.goalId,
            goalDescription: data.goalDescription,
            timestamp: data.timestamp.toDate(),
            cooldownUntil: data.cooldownUntil.toDate(),
            createdAt: ((_data$createdAt = data.createdAt) == null ? void 0 : _data$createdAt.toDate()) || new Date()
          };
        });
        return nudges;
      }));
    } catch (error) {
      console.error(`Error fetching ${type} nudge history:`, error);
      var message = (0, _errorHandling.getUserFriendlyErrorMessage)(error);
      throw new Error(message);
    }
  });
  return _getNudgeHistory.apply(this, arguments);
}
function canSendNudge(_x5, _x6) {
  return _canSendNudge.apply(this, arguments);
}
function _canSendNudge() {
  _canSendNudge = (0, _asyncToGenerator2.default)(function* (userId, goalId) {
    if (!userId || !goalId) {
      return false;
    }
    try {
      var cooldowns = yield getNudgeCooldowns(userId);
      var cooldownEnd = cooldowns.get(goalId);
      if (!cooldownEnd) {
        return true;
      }
      return new Date() > cooldownEnd;
    } catch (error) {
      console.error("Error checking nudge cooldown:", error);
      return false;
    }
  });
  return _canSendNudge.apply(this, arguments);
}
function getRemainingCooldownMinutes(_x7, _x8) {
  return _getRemainingCooldownMinutes.apply(this, arguments);
}
function _getRemainingCooldownMinutes() {
  _getRemainingCooldownMinutes = (0, _asyncToGenerator2.default)(function* (userId, goalId) {
    if (!userId || !goalId) {
      return 0;
    }
    try {
      var cooldowns = yield getNudgeCooldowns(userId);
      var cooldownEnd = cooldowns.get(goalId);
      if (!cooldownEnd) {
        return 0;
      }
      var now = new Date();
      if (now >= cooldownEnd) {
        return 0;
      }
      return Math.ceil((cooldownEnd.getTime() - now.getTime()) / (1000 * 60));
    } catch (error) {
      console.error("Error getting remaining cooldown time:", error);
      return 0;
    }
  });
  return _getRemainingCooldownMinutes.apply(this, arguments);
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfZXJyb3JIYW5kbGluZyIsInJlcXVpcmUiLCJfZmlyZXN0b3JlIiwiX2NvbGxlY3Rpb25zIiwic2VuZE51ZGdlIiwiX3giLCJfc2VuZE51ZGdlIiwiYXBwbHkiLCJhcmd1bWVudHMiLCJfYXN5bmNUb0dlbmVyYXRvcjIiLCJkZWZhdWx0IiwiaW5wdXQiLCJzZW5kZXJJZCIsInJlY2VpdmVySWQiLCJnb2FsSWQiLCJFcnJvciIsInNlbmRlck5hbWUiLCJnb2FsRGVzY3JpcHRpb24iLCJyZXRyeVdpdGhCYWNrb2ZmIiwiY29vbGRvd25zIiwiZ2V0TnVkZ2VDb29sZG93bnMiLCJleGlzdGluZ0Nvb2xkb3duIiwiZ2V0IiwiRGF0ZSIsInJlbWFpbmluZ01pbnV0ZXMiLCJNYXRoIiwiY2VpbCIsImdldFRpbWUiLCJudWRnZXNDb2xsZWN0aW9uIiwiZ2V0TnVkZ2VzQ29sbGVjdGlvbiIsIm5vdyIsImNvb2xkb3duVW50aWwiLCJudWRnZURhdGEiLCJ0aW1lc3RhbXAiLCJUaW1lc3RhbXAiLCJmcm9tRGF0ZSIsImNyZWF0ZWRBdCIsInNlcnZlclRpbWVzdGFtcCIsImFkZERvYyIsImVycm9yIiwibWVzc2FnZSIsImdldFVzZXJGcmllbmRseUVycm9yTWVzc2FnZSIsIl94MiIsIl9nZXROdWRnZUNvb2xkb3ducyIsInVzZXJJZCIsInEiLCJxdWVyeSIsIndoZXJlIiwib3JkZXJCeSIsInNuYXBzaG90IiwiZ2V0RG9jcyIsIk1hcCIsImRvY3MiLCJmb3JFYWNoIiwiZG9jIiwiZGF0YSIsInRvRGF0ZSIsImhhcyIsInNldCIsImNvbnNvbGUiLCJzdWJzY3JpYmVUb051ZGdlQ29vbGRvd25zIiwiY2FsbGJhY2siLCJvbkVycm9yIiwidW5zdWJzY3JpYmUiLCJvblNuYXBzaG90IiwiY3VycmVudFRpbWUiLCJnZXROdWRnZUhpc3RvcnkiLCJfeDMiLCJfeDQiLCJfZ2V0TnVkZ2VIaXN0b3J5IiwidHlwZSIsImRheXMiLCJsZW5ndGgiLCJ1bmRlZmluZWQiLCJjdXRvZmZEYXRlIiwic2V0RGF0ZSIsImdldERhdGUiLCJmaWVsZE5hbWUiLCJsaW1pdCIsIm51ZGdlcyIsIm1hcCIsIl9kYXRhJGNyZWF0ZWRBdCIsImlkIiwiY2FuU2VuZE51ZGdlIiwiX3g1IiwiX3g2IiwiX2NhblNlbmROdWRnZSIsImNvb2xkb3duRW5kIiwiZ2V0UmVtYWluaW5nQ29vbGRvd25NaW51dGVzIiwiX3g3IiwiX3g4IiwiX2dldFJlbWFpbmluZ0Nvb2xkb3duTWludXRlcyJdLCJzb3VyY2VzIjpbIm51ZGdlU2VydmljZS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xuICAgIGdldFVzZXJGcmllbmRseUVycm9yTWVzc2FnZSxcbiAgICByZXRyeVdpdGhCYWNrb2ZmLFxufSBmcm9tIFwiQC91dGlscy9lcnJvckhhbmRsaW5nXCI7XG5pbXBvcnQge1xuICAgIGFkZERvYyxcbiAgICBnZXREb2NzLFxuICAgIGxpbWl0LFxuICAgIG9uU25hcHNob3QsXG4gICAgb3JkZXJCeSxcbiAgICBxdWVyeSxcbiAgICBzZXJ2ZXJUaW1lc3RhbXAsXG4gICAgVGltZXN0YW1wLFxuICAgIHdoZXJlLFxufSBmcm9tIFwiZmlyZWJhc2UvZmlyZXN0b3JlXCI7XG5pbXBvcnQge1xuICAgIGdldE51ZGdlc0NvbGxlY3Rpb24sXG4gICAgTnVkZ2Vcbn0gZnJvbSBcIi4vY29sbGVjdGlvbnNcIjtcblxuLyoqXG4gKiBOdWRnZSBTZXJ2aWNlIE1vZHVsZVxuICpcbiAqIEhhbmRsZXMgYWxsIG51ZGdlLXJlbGF0ZWQgb3BlcmF0aW9ucyBpbmNsdWRpbmcgY3JlYXRpb24sIHJhdGUgbGltaXRpbmcsXG4gKiBjb29sZG93biBtYW5hZ2VtZW50LCBhbmQgbnVkZ2UgaGlzdG9yeSB0cmFja2luZy5cbiAqXG4gKiBSZXF1aXJlbWVudHM6IDMuMywgMy40LCA0LjEsIDQuMiwgNC4zLCA4LjEsIDguMiwgOC4zLCA4LjRcbiAqL1xuXG4vKipcbiAqIElucHV0IGludGVyZmFjZSBmb3Igc2VuZGluZyBhIG51ZGdlXG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgU2VuZE51ZGdlSW5wdXQge1xuICAgIHNlbmRlcklkOiBzdHJpbmc7XG4gICAgc2VuZGVyTmFtZTogc3RyaW5nO1xuICAgIHJlY2VpdmVySWQ6IHN0cmluZztcbiAgICBnb2FsSWQ6IHN0cmluZztcbiAgICBnb2FsRGVzY3JpcHRpb246IHN0cmluZztcbn1cblxuLyoqXG4gKiBJbnRlcmZhY2UgZm9yIG51ZGdlIGNvb2xkb3duIHRyYWNraW5nXG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgTnVkZ2VDb29sZG93biB7XG4gICAgZ29hbElkOiBzdHJpbmc7XG4gICAgY29vbGRvd25VbnRpbDogRGF0ZTtcbiAgICBsYXN0TnVkZ2VUaW1lc3RhbXA6IERhdGU7XG59XG5cbi8qKlxuICogU2VuZCBhIG51ZGdlIHRvIGEgZnJpZW5kIGFib3V0IHRoZWlyIGdvYWxcbiAqXG4gKiBSZXF1aXJlbWVudHM6XG4gKiAtIDMuMzogQ3JlYXRlIG51ZGdlIGRvY3VtZW50IHdpdGggYWxsIHJlcXVpcmVkIGZpZWxkc1xuICogLSA0LjE6IEltcGxlbWVudCAxLWhvdXIgY29vbGRvd24gcGVyaW9kXG4gKiAtIDQuMzogUHJldmVudCByYXBpZCBudWRnaW5nIHdpdGggdmFsaWRhdGlvblxuICpcbiAqIEBwYXJhbSBpbnB1dCAtIE51ZGdlIGNyZWF0aW9uIHBhcmFtZXRlcnNcbiAqIEB0aHJvd3MgRXJyb3IgaWYgdmFsaWRhdGlvbiBmYWlscyBvciBjb29sZG93biBpcyBhY3RpdmVcbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHNlbmROdWRnZShpbnB1dDogU2VuZE51ZGdlSW5wdXQpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICAvLyBWYWxpZGF0ZSBpbnB1dFxuICAgIGlmICghaW5wdXQuc2VuZGVySWQgfHwgIWlucHV0LnJlY2VpdmVySWQgfHwgIWlucHV0LmdvYWxJZCkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJTZW5kZXIgSUQsIHJlY2VpdmVyIElELCBhbmQgZ29hbCBJRCBhcmUgcmVxdWlyZWRcIik7XG4gICAgfVxuXG4gICAgaWYgKCFpbnB1dC5zZW5kZXJOYW1lIHx8ICFpbnB1dC5nb2FsRGVzY3JpcHRpb24pIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiU2VuZGVyIG5hbWUgYW5kIGdvYWwgZGVzY3JpcHRpb24gYXJlIHJlcXVpcmVkXCIpO1xuICAgIH1cblxuICAgIGlmIChpbnB1dC5zZW5kZXJJZCA9PT0gaW5wdXQucmVjZWl2ZXJJZCkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJDYW5ub3QgbnVkZ2UgeW91cnNlbGZcIik7XG4gICAgfVxuXG4gICAgdHJ5IHtcbiAgICAgICAgYXdhaXQgcmV0cnlXaXRoQmFja29mZihhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICAvLyBDaGVjayBmb3IgZXhpc3RpbmcgY29vbGRvd25cbiAgICAgICAgICAgIGNvbnN0IGNvb2xkb3ducyA9IGF3YWl0IGdldE51ZGdlQ29vbGRvd25zKGlucHV0LnNlbmRlcklkKTtcbiAgICAgICAgICAgIGNvbnN0IGV4aXN0aW5nQ29vbGRvd24gPSBjb29sZG93bnMuZ2V0KGlucHV0LmdvYWxJZCk7XG5cbiAgICAgICAgICAgIGlmIChleGlzdGluZ0Nvb2xkb3duICYmIG5ldyBEYXRlKCkgPCBleGlzdGluZ0Nvb2xkb3duKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgcmVtYWluaW5nTWludXRlcyA9IE1hdGguY2VpbChcbiAgICAgICAgICAgICAgICAgICAgKGV4aXN0aW5nQ29vbGRvd24uZ2V0VGltZSgpIC0gbmV3IERhdGUoKS5nZXRUaW1lKCkpIC8gKDEwMDAgKiA2MCksXG4gICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYEFscmVhZHkgbnVkZ2VkIC0gd2FpdCAke3JlbWFpbmluZ01pbnV0ZXN9bWApO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBjb25zdCBudWRnZXNDb2xsZWN0aW9uID0gZ2V0TnVkZ2VzQ29sbGVjdGlvbigpO1xuICAgICAgICAgICAgY29uc3Qgbm93ID0gbmV3IERhdGUoKTtcbiAgICAgICAgICAgIGNvbnN0IGNvb2xkb3duVW50aWwgPSBuZXcgRGF0ZShub3cuZ2V0VGltZSgpICsgNjAgKiA2MCAqIDEwMDApOyAvLyAxIGhvdXJcblxuICAgICAgICAgICAgY29uc3QgbnVkZ2VEYXRhID0ge1xuICAgICAgICAgICAgICAgIHNlbmRlcklkOiBpbnB1dC5zZW5kZXJJZCxcbiAgICAgICAgICAgICAgICBzZW5kZXJOYW1lOiBpbnB1dC5zZW5kZXJOYW1lLFxuICAgICAgICAgICAgICAgIHJlY2VpdmVySWQ6IGlucHV0LnJlY2VpdmVySWQsXG4gICAgICAgICAgICAgICAgZ29hbElkOiBpbnB1dC5nb2FsSWQsXG4gICAgICAgICAgICAgICAgZ29hbERlc2NyaXB0aW9uOiBpbnB1dC5nb2FsRGVzY3JpcHRpb24sXG4gICAgICAgICAgICAgICAgdGltZXN0YW1wOiBUaW1lc3RhbXAuZnJvbURhdGUobm93KSxcbiAgICAgICAgICAgICAgICBjb29sZG93blVudGlsOiBUaW1lc3RhbXAuZnJvbURhdGUoY29vbGRvd25VbnRpbCksXG4gICAgICAgICAgICAgICAgY3JlYXRlZEF0OiBzZXJ2ZXJUaW1lc3RhbXAoKSxcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIGF3YWl0IGFkZERvYyhudWRnZXNDb2xsZWN0aW9uLCBudWRnZURhdGEpO1xuICAgICAgICB9KTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zdCBtZXNzYWdlID0gZ2V0VXNlckZyaWVuZGx5RXJyb3JNZXNzYWdlKGVycm9yKTtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKG1lc3NhZ2UpO1xuICAgIH1cbn1cblxuLyoqXG4gKiBHZXQgY3VycmVudCBudWRnZSBjb29sZG93bnMgZm9yIGEgdXNlclxuICpcbiAqIFJlcXVpcmVtZW50czpcbiAqIC0gNC4xOiBUcmFjayAxLWhvdXIgY29vbGRvd24gcGVyaW9kc1xuICogLSA0LjI6IEVuYWJsZSBudWRnZSBidXR0b24gd2hlbiBjb29sZG93biBleHBpcmVzXG4gKlxuICogQHBhcmFtIHVzZXJJZCAtIFVzZXIgSUQgdG8gZ2V0IGNvb2xkb3ducyBmb3JcbiAqIEByZXR1cm5zIE1hcCBvZiBnb2FsSWQgdG8gY29vbGRvd24gZW5kIHRpbWVcbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldE51ZGdlQ29vbGRvd25zKFxuICAgIHVzZXJJZDogc3RyaW5nLFxuKTogUHJvbWlzZTxNYXA8c3RyaW5nLCBEYXRlPj4ge1xuICAgIGlmICghdXNlcklkKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcIlVzZXIgSUQgaXMgcmVxdWlyZWRcIik7XG4gICAgfVxuXG4gICAgdHJ5IHtcbiAgICAgICAgcmV0dXJuIGF3YWl0IHJldHJ5V2l0aEJhY2tvZmYoYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgbnVkZ2VzQ29sbGVjdGlvbiA9IGdldE51ZGdlc0NvbGxlY3Rpb24oKTtcbiAgICAgICAgICAgIGNvbnN0IG5vdyA9IG5ldyBEYXRlKCk7XG5cbiAgICAgICAgICAgIC8vIFF1ZXJ5IG51ZGdlcyBzZW50IGJ5IHRoaXMgdXNlciB0aGF0IGFyZSBzdGlsbCBpbiBjb29sZG93blxuICAgICAgICAgICAgY29uc3QgcSA9IHF1ZXJ5KFxuICAgICAgICAgICAgICAgIG51ZGdlc0NvbGxlY3Rpb24sXG4gICAgICAgICAgICAgICAgd2hlcmUoXCJzZW5kZXJJZFwiLCBcIj09XCIsIHVzZXJJZCksXG4gICAgICAgICAgICAgICAgd2hlcmUoXCJjb29sZG93blVudGlsXCIsIFwiPlwiLCBUaW1lc3RhbXAuZnJvbURhdGUobm93KSksXG4gICAgICAgICAgICAgICAgb3JkZXJCeShcImNvb2xkb3duVW50aWxcIiwgXCJkZXNjXCIpLFxuICAgICAgICAgICAgKTtcblxuICAgICAgICAgICAgY29uc3Qgc25hcHNob3QgPSBhd2FpdCBnZXREb2NzKHEpO1xuICAgICAgICAgICAgY29uc3QgY29vbGRvd25zID0gbmV3IE1hcDxzdHJpbmcsIERhdGU+KCk7XG5cbiAgICAgICAgICAgIHNuYXBzaG90LmRvY3MuZm9yRWFjaCgoZG9jKSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3QgZGF0YSA9IGRvYy5kYXRhKCk7XG4gICAgICAgICAgICAgICAgY29uc3QgZ29hbElkID0gZGF0YS5nb2FsSWQ7XG4gICAgICAgICAgICAgICAgY29uc3QgY29vbGRvd25VbnRpbCA9IGRhdGEuY29vbGRvd25VbnRpbC50b0RhdGUoKTtcblxuICAgICAgICAgICAgICAgIC8vIEtlZXAgb25seSB0aGUgbGF0ZXN0IGNvb2xkb3duIGZvciBlYWNoIGdvYWxcbiAgICAgICAgICAgICAgICBpZiAoIWNvb2xkb3ducy5oYXMoZ29hbElkKSB8fCBjb29sZG93blVudGlsID4gY29vbGRvd25zLmdldChnb2FsSWQpISkge1xuICAgICAgICAgICAgICAgICAgICBjb29sZG93bnMuc2V0KGdvYWxJZCwgY29vbGRvd25VbnRpbCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHJldHVybiBjb29sZG93bnM7XG4gICAgICAgIH0pO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciBmZXRjaGluZyBudWRnZSBjb29sZG93bnM6XCIsIGVycm9yKTtcbiAgICAgICAgY29uc3QgbWVzc2FnZSA9IGdldFVzZXJGcmllbmRseUVycm9yTWVzc2FnZShlcnJvcik7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihtZXNzYWdlKTtcbiAgICB9XG59XG5cbi8qKlxuICogU3Vic2NyaWJlIHRvIHJlYWwtdGltZSBudWRnZSBjb29sZG93biB1cGRhdGVzXG4gKlxuICogUmVxdWlyZW1lbnRzOlxuICogLSA0LjQ6IERpc3BsYXkgcmVtYWluaW5nIGNvb2xkb3duIHRpbWUgaW4gcmVhbC10aW1lXG4gKiAtIDYuMTogUmVhbC10aW1lIHVwZGF0ZXMgYWNyb3NzIGRldmljZXNcbiAqXG4gKiBAcGFyYW0gdXNlcklkIC0gVXNlciBJRCB0byB0cmFjayBjb29sZG93bnMgZm9yXG4gKiBAcGFyYW0gY2FsbGJhY2sgLSBGdW5jdGlvbiBjYWxsZWQgd2hlbiBjb29sZG93bnMgY2hhbmdlXG4gKiBAcmV0dXJucyBVbnN1YnNjcmliZSBmdW5jdGlvblxuICovXG5leHBvcnQgZnVuY3Rpb24gc3Vic2NyaWJlVG9OdWRnZUNvb2xkb3ducyhcbiAgICB1c2VySWQ6IHN0cmluZyxcbiAgICBjYWxsYmFjazogKGNvb2xkb3duczogTWFwPHN0cmluZywgRGF0ZT4pID0+IHZvaWQsXG4gICAgb25FcnJvcj86IChlcnJvcjogRXJyb3IpID0+IHZvaWQsXG4pOiAoKSA9PiB2b2lkIHtcbiAgICBpZiAoIXVzZXJJZCkge1xuICAgICAgICBjb25zdCBlcnJvciA9IG5ldyBFcnJvcihcIlVzZXIgSUQgaXMgcmVxdWlyZWRcIik7XG4gICAgICAgIGlmIChvbkVycm9yKSBvbkVycm9yKGVycm9yKTtcbiAgICAgICAgcmV0dXJuICgpID0+IHsgfTtcbiAgICB9XG5cbiAgICBjb25zdCBudWRnZXNDb2xsZWN0aW9uID0gZ2V0TnVkZ2VzQ29sbGVjdGlvbigpO1xuICAgIGNvbnN0IG5vdyA9IG5ldyBEYXRlKCk7XG5cbiAgICAvLyBRdWVyeSBudWRnZXMgc2VudCBieSB0aGlzIHVzZXIgdGhhdCBhcmUgc3RpbGwgaW4gY29vbGRvd25cbiAgICBjb25zdCBxID0gcXVlcnkoXG4gICAgICAgIG51ZGdlc0NvbGxlY3Rpb24sXG4gICAgICAgIHdoZXJlKFwic2VuZGVySWRcIiwgXCI9PVwiLCB1c2VySWQpLFxuICAgICAgICB3aGVyZShcImNvb2xkb3duVW50aWxcIiwgXCI+XCIsIFRpbWVzdGFtcC5mcm9tRGF0ZShub3cpKSxcbiAgICAgICAgb3JkZXJCeShcImNvb2xkb3duVW50aWxcIiwgXCJkZXNjXCIpLFxuICAgICk7XG5cbiAgICBjb25zdCB1bnN1YnNjcmliZSA9IG9uU25hcHNob3QoXG4gICAgICAgIHEsXG4gICAgICAgIChzbmFwc2hvdCkgPT4ge1xuICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICBjb25zdCBjb29sZG93bnMgPSBuZXcgTWFwPHN0cmluZywgRGF0ZT4oKTtcbiAgICAgICAgICAgICAgICBjb25zdCBjdXJyZW50VGltZSA9IG5ldyBEYXRlKCk7XG5cbiAgICAgICAgICAgICAgICBzbmFwc2hvdC5kb2NzLmZvckVhY2goKGRvYykgPT4ge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBkYXRhID0gZG9jLmRhdGEoKTtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgZ29hbElkID0gZGF0YS5nb2FsSWQ7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGNvb2xkb3duVW50aWwgPSBkYXRhLmNvb2xkb3duVW50aWwudG9EYXRlKCk7XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gT25seSBpbmNsdWRlIGNvb2xkb3ducyB0aGF0IGhhdmVuJ3QgZXhwaXJlZFxuICAgICAgICAgICAgICAgICAgICBpZiAoY29vbGRvd25VbnRpbCA+IGN1cnJlbnRUaW1lKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBLZWVwIG9ubHkgdGhlIGxhdGVzdCBjb29sZG93biBmb3IgZWFjaCBnb2FsXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgIWNvb2xkb3ducy5oYXMoZ29hbElkKSB8fFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvb2xkb3duVW50aWwgPiBjb29sZG93bnMuZ2V0KGdvYWxJZCkhXG4gICAgICAgICAgICAgICAgICAgICAgICApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb29sZG93bnMuc2V0KGdvYWxJZCwgY29vbGRvd25VbnRpbCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIGNhbGxiYWNrKGNvb2xkb3ducyk7XG4gICAgICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciBwcm9jZXNzaW5nIG51ZGdlIGNvb2xkb3ducyBzbmFwc2hvdDpcIiwgZXJyb3IpO1xuICAgICAgICAgICAgICAgIGlmIChvbkVycm9yKSB7XG4gICAgICAgICAgICAgICAgICAgIG9uRXJyb3IoXG4gICAgICAgICAgICAgICAgICAgICAgICBlcnJvciBpbnN0YW5jZW9mIEVycm9yXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgPyBlcnJvclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDogbmV3IEVycm9yKFwiRmFpbGVkIHRvIHByb2Nlc3MgbnVkZ2UgY29vbGRvd25zIGRhdGFcIiksXG4gICAgICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICAoZXJyb3IpID0+IHtcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciBpbiBudWRnZSBjb29sZG93bnMgc25hcHNob3QgbGlzdGVuZXI6XCIsIGVycm9yKTtcbiAgICAgICAgICAgIGlmIChvbkVycm9yKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgbWVzc2FnZSA9IGdldFVzZXJGcmllbmRseUVycm9yTWVzc2FnZShlcnJvcik7XG4gICAgICAgICAgICAgICAgb25FcnJvcihuZXcgRXJyb3IobWVzc2FnZSkpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICk7XG5cbiAgICByZXR1cm4gdW5zdWJzY3JpYmU7XG59XG5cbi8qKlxuICogR2V0IG51ZGdlIGhpc3RvcnkgZm9yIGEgdXNlciAoc2VudCBvciByZWNlaXZlZClcbiAqXG4gKiBSZXF1aXJlbWVudHM6XG4gKiAtIDguMjogRGlzcGxheSBcIkxhc3QgbnVkZ2VkIFhtIGFnb1wiIGluZm9ybWF0aW9uXG4gKiAtIDguMzogU2hvdyBzZW50IG51ZGdlcyBpbiBwYXN0IDcgZGF5c1xuICogLSA4LjQ6IFNob3cgcmVjZWl2ZWQgbnVkZ2VzIGluIHBhc3QgNyBkYXlzXG4gKlxuICogQHBhcmFtIHVzZXJJZCAtIFVzZXIgSUQgdG8gZ2V0IGhpc3RvcnkgZm9yXG4gKiBAcGFyYW0gdHlwZSAtIFdoZXRoZXIgdG8gZ2V0IHNlbnQgb3IgcmVjZWl2ZWQgbnVkZ2VzXG4gKiBAcGFyYW0gZGF5cyAtIE51bWJlciBvZiBkYXlzIHRvIGxvb2sgYmFjayAoZGVmYXVsdDogNylcbiAqIEByZXR1cm5zIEFycmF5IG9mIG51ZGdlc1xuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0TnVkZ2VIaXN0b3J5KFxuICAgIHVzZXJJZDogc3RyaW5nLFxuICAgIHR5cGU6IFwic2VudFwiIHwgXCJyZWNlaXZlZFwiLFxuICAgIGRheXM6IG51bWJlciA9IDcsXG4pOiBQcm9taXNlPE51ZGdlW10+IHtcbiAgICBpZiAoIXVzZXJJZCkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJVc2VyIElEIGlzIHJlcXVpcmVkXCIpO1xuICAgIH1cblxuICAgIGlmIChkYXlzIDw9IDApIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiRGF5cyBtdXN0IGJlIGEgcG9zaXRpdmUgbnVtYmVyXCIpO1xuICAgIH1cblxuICAgIHRyeSB7XG4gICAgICAgIHJldHVybiBhd2FpdCByZXRyeVdpdGhCYWNrb2ZmKGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IG51ZGdlc0NvbGxlY3Rpb24gPSBnZXROdWRnZXNDb2xsZWN0aW9uKCk7XG4gICAgICAgICAgICBjb25zdCBjdXRvZmZEYXRlID0gbmV3IERhdGUoKTtcbiAgICAgICAgICAgIGN1dG9mZkRhdGUuc2V0RGF0ZShjdXRvZmZEYXRlLmdldERhdGUoKSAtIGRheXMpO1xuXG4gICAgICAgICAgICBjb25zdCBmaWVsZE5hbWUgPSB0eXBlID09PSBcInNlbnRcIiA/IFwic2VuZGVySWRcIiA6IFwicmVjZWl2ZXJJZFwiO1xuXG4gICAgICAgICAgICBjb25zdCBxID0gcXVlcnkoXG4gICAgICAgICAgICAgICAgbnVkZ2VzQ29sbGVjdGlvbixcbiAgICAgICAgICAgICAgICB3aGVyZShmaWVsZE5hbWUsIFwiPT1cIiwgdXNlcklkKSxcbiAgICAgICAgICAgICAgICB3aGVyZShcInRpbWVzdGFtcFwiLCBcIj49XCIsIFRpbWVzdGFtcC5mcm9tRGF0ZShjdXRvZmZEYXRlKSksXG4gICAgICAgICAgICAgICAgb3JkZXJCeShcInRpbWVzdGFtcFwiLCBcImRlc2NcIiksXG4gICAgICAgICAgICAgICAgbGltaXQoMTAwKSwgLy8gUmVhc29uYWJsZSBsaW1pdCB0byBwcmV2ZW50IGV4Y2Vzc2l2ZSBkYXRhXG4gICAgICAgICAgICApO1xuXG4gICAgICAgICAgICBjb25zdCBzbmFwc2hvdCA9IGF3YWl0IGdldERvY3MocSk7XG4gICAgICAgICAgICBjb25zdCBudWRnZXM6IE51ZGdlW10gPSBzbmFwc2hvdC5kb2NzLm1hcCgoZG9jKSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3QgZGF0YSA9IGRvYy5kYXRhKCk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICAgICAgaWQ6IGRvYy5pZCxcbiAgICAgICAgICAgICAgICAgICAgc2VuZGVySWQ6IGRhdGEuc2VuZGVySWQsXG4gICAgICAgICAgICAgICAgICAgIHNlbmRlck5hbWU6IGRhdGEuc2VuZGVyTmFtZSxcbiAgICAgICAgICAgICAgICAgICAgcmVjZWl2ZXJJZDogZGF0YS5yZWNlaXZlcklkLFxuICAgICAgICAgICAgICAgICAgICBnb2FsSWQ6IGRhdGEuZ29hbElkLFxuICAgICAgICAgICAgICAgICAgICBnb2FsRGVzY3JpcHRpb246IGRhdGEuZ29hbERlc2NyaXB0aW9uLFxuICAgICAgICAgICAgICAgICAgICB0aW1lc3RhbXA6IGRhdGEudGltZXN0YW1wLnRvRGF0ZSgpLFxuICAgICAgICAgICAgICAgICAgICBjb29sZG93blVudGlsOiBkYXRhLmNvb2xkb3duVW50aWwudG9EYXRlKCksXG4gICAgICAgICAgICAgICAgICAgIGNyZWF0ZWRBdDogZGF0YS5jcmVhdGVkQXQ/LnRvRGF0ZSgpIHx8IG5ldyBEYXRlKCksXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICByZXR1cm4gbnVkZ2VzO1xuICAgICAgICB9KTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKGBFcnJvciBmZXRjaGluZyAke3R5cGV9IG51ZGdlIGhpc3Rvcnk6YCwgZXJyb3IpO1xuICAgICAgICBjb25zdCBtZXNzYWdlID0gZ2V0VXNlckZyaWVuZGx5RXJyb3JNZXNzYWdlKGVycm9yKTtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKG1lc3NhZ2UpO1xuICAgIH1cbn1cblxuLyoqXG4gKiBDaGVjayBpZiBhIHVzZXIgY2FuIHNlbmQgYSBudWRnZSBmb3IgYSBzcGVjaWZpYyBnb2FsXG4gKlxuICogUmVxdWlyZW1lbnRzOlxuICogLSA0LjE6IEVuZm9yY2UgMS1ob3VyIGNvb2xkb3duIHBlcmlvZFxuICogLSA0LjM6IFByZXZlbnQgcmFwaWQgbnVkZ2luZ1xuICpcbiAqIEBwYXJhbSB1c2VySWQgLSBVc2VyIElEIGF0dGVtcHRpbmcgdG8gc2VuZCBudWRnZVxuICogQHBhcmFtIGdvYWxJZCAtIEdvYWwgSUQgdG8gY2hlY2sgY29vbGRvd24gZm9yXG4gKiBAcmV0dXJucyBUcnVlIGlmIG51ZGdlIGNhbiBiZSBzZW50LCBmYWxzZSBpZiBpbiBjb29sZG93blxuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gY2FuU2VuZE51ZGdlKFxuICAgIHVzZXJJZDogc3RyaW5nLFxuICAgIGdvYWxJZDogc3RyaW5nLFxuKTogUHJvbWlzZTxib29sZWFuPiB7XG4gICAgaWYgKCF1c2VySWQgfHwgIWdvYWxJZCkge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuXG4gICAgdHJ5IHtcbiAgICAgICAgY29uc3QgY29vbGRvd25zID0gYXdhaXQgZ2V0TnVkZ2VDb29sZG93bnModXNlcklkKTtcbiAgICAgICAgY29uc3QgY29vbGRvd25FbmQgPSBjb29sZG93bnMuZ2V0KGdvYWxJZCk7XG5cbiAgICAgICAgaWYgKCFjb29sZG93bkVuZCkge1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7IC8vIE5vIGNvb2xkb3duIGV4aXN0c1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIG5ldyBEYXRlKCkgPiBjb29sZG93bkVuZDtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgY2hlY2tpbmcgbnVkZ2UgY29vbGRvd246XCIsIGVycm9yKTtcbiAgICAgICAgcmV0dXJuIGZhbHNlOyAvLyBFcnIgb24gdGhlIHNpZGUgb2YgY2F1dGlvblxuICAgIH1cbn1cblxuLyoqXG4gKiBHZXQgdGhlIHJlbWFpbmluZyBjb29sZG93biB0aW1lIGluIG1pbnV0ZXMgZm9yIGEgc3BlY2lmaWMgZ29hbFxuICpcbiAqIFJlcXVpcmVtZW50czpcbiAqIC0gNC40OiBEaXNwbGF5IHJlbWFpbmluZyBjb29sZG93biB0aW1lXG4gKlxuICogQHBhcmFtIHVzZXJJZCAtIFVzZXIgSUQgdG8gY2hlY2sgY29vbGRvd24gZm9yXG4gKiBAcGFyYW0gZ29hbElkIC0gR29hbCBJRCB0byBjaGVjayBjb29sZG93biBmb3JcbiAqIEByZXR1cm5zIFJlbWFpbmluZyBtaW51dGVzIGluIGNvb2xkb3duLCBvciAwIGlmIG5vIGNvb2xkb3duXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRSZW1haW5pbmdDb29sZG93bk1pbnV0ZXMoXG4gICAgdXNlcklkOiBzdHJpbmcsXG4gICAgZ29hbElkOiBzdHJpbmcsXG4pOiBQcm9taXNlPG51bWJlcj4ge1xuICAgIGlmICghdXNlcklkIHx8ICFnb2FsSWQpIHtcbiAgICAgICAgcmV0dXJuIDA7XG4gICAgfVxuXG4gICAgdHJ5IHtcbiAgICAgICAgY29uc3QgY29vbGRvd25zID0gYXdhaXQgZ2V0TnVkZ2VDb29sZG93bnModXNlcklkKTtcbiAgICAgICAgY29uc3QgY29vbGRvd25FbmQgPSBjb29sZG93bnMuZ2V0KGdvYWxJZCk7XG5cbiAgICAgICAgaWYgKCFjb29sZG93bkVuZCkge1xuICAgICAgICAgICAgcmV0dXJuIDA7IC8vIE5vIGNvb2xkb3duIGV4aXN0c1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3Qgbm93ID0gbmV3IERhdGUoKTtcbiAgICAgICAgaWYgKG5vdyA+PSBjb29sZG93bkVuZCkge1xuICAgICAgICAgICAgcmV0dXJuIDA7IC8vIENvb2xkb3duIGhhcyBleHBpcmVkXG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gTWF0aC5jZWlsKChjb29sZG93bkVuZC5nZXRUaW1lKCkgLSBub3cuZ2V0VGltZSgpKSAvICgxMDAwICogNjApKTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgZ2V0dGluZyByZW1haW5pbmcgY29vbGRvd24gdGltZTpcIiwgZXJyb3IpO1xuICAgICAgICByZXR1cm4gMDtcbiAgICB9XG59XG4iXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7O0FBQUEsSUFBQUEsY0FBQSxHQUFBQyxPQUFBO0FBSUEsSUFBQUMsVUFBQSxHQUFBRCxPQUFBO0FBV0EsSUFBQUUsWUFBQSxHQUFBRixPQUFBO0FBR3VCLFNBMENERyxTQUFTQSxDQUFBQyxFQUFBO0VBQUEsT0FBQUMsVUFBQSxDQUFBQyxLQUFBLE9BQUFDLFNBQUE7QUFBQTtBQUFBLFNBQUFGLFdBQUE7RUFBQUEsVUFBQSxPQUFBRyxrQkFBQSxDQUFBQyxPQUFBLEVBQXhCLFdBQXlCQyxLQUFxQixFQUFpQjtJQUVsRSxJQUFJLENBQUNBLEtBQUssQ0FBQ0MsUUFBUSxJQUFJLENBQUNELEtBQUssQ0FBQ0UsVUFBVSxJQUFJLENBQUNGLEtBQUssQ0FBQ0csTUFBTSxF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