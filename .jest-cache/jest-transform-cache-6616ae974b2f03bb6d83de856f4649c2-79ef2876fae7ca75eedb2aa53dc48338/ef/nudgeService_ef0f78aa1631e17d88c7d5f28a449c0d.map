{"version":3,"names":["_errorHandling","require","_firestore","_collections","sendNudge","_x","_sendNudge","apply","arguments","_asyncToGenerator2","default","input","senderId","receiverId","goalId","Error","senderName","goalDescription","retryWithBackoff","cooldowns","getNudgeCooldowns","existingCooldown","get","Date","remainingMinutes","Math","ceil","getTime","nudgesCollection","getNudgesCollection","now","cooldownUntil","nudgeData","timestamp","Timestamp","fromDate","createdAt","serverTimestamp","addDoc","error","message","getUserFriendlyErrorMessage","_x2","_getNudgeCooldowns","userId","q","query","where","orderBy","snapshot","getDocs","Map","docs","forEach","doc","data","toDate","has","set","console","subscribeToNudgeCooldowns","callback","onError","unsubscribe","onSnapshot","currentTime","getNudgeHistory","_x3","_x4","_getNudgeHistory","type","days","length","undefined","cutoffDate","setDate","getDate","fieldName","limit","nudges","map","_data$createdAt","id","canSendNudge","_x5","_x6","_canSendNudge","cooldownEnd","getRemainingCooldownMinutes","_x7","_x8","_getRemainingCooldownMinutes"],"sources":["nudgeService.ts"],"sourcesContent":["import {\n    getUserFriendlyErrorMessage,\n    retryWithBackoff,\n} from \"@/utils/errorHandling\";\nimport {\n    addDoc,\n    getDocs,\n    limit,\n    onSnapshot,\n    orderBy,\n    query,\n    serverTimestamp,\n    Timestamp,\n    where,\n} from \"firebase/firestore\";\nimport {\n    getNudgesCollection,\n    Nudge\n} from \"./collections\";\n\n/**\n * Nudge Service Module\n *\n * Handles all nudge-related operations including creation, rate limiting,\n * cooldown management, and nudge history tracking.\n *\n * Requirements: 3.3, 3.4, 4.1, 4.2, 4.3, 8.1, 8.2, 8.3, 8.4\n */\n\n/**\n * Input interface for sending a nudge\n */\nexport interface SendNudgeInput {\n    senderId: string;\n    senderName: string;\n    receiverId: string;\n    goalId: string;\n    goalDescription: string;\n}\n\n/**\n * Interface for nudge cooldown tracking\n */\nexport interface NudgeCooldown {\n    goalId: string;\n    cooldownUntil: Date;\n    lastNudgeTimestamp: Date;\n}\n\n/**\n * Send a nudge to a friend about their goal\n *\n * Requirements:\n * - 3.3: Create nudge document with all required fields\n * - 4.1: Implement 1-hour cooldown period\n * - 4.3: Prevent rapid nudging with validation\n *\n * @param input - Nudge creation parameters\n * @throws Error if validation fails or cooldown is active\n */\nexport async function sendNudge(input: SendNudgeInput): Promise<void> {\n    // Validate input\n    if (!input.senderId || !input.receiverId || !input.goalId) {\n        throw new Error(\"Sender ID, receiver ID, and goal ID are required\");\n    }\n\n    if (!input.senderName || !input.goalDescription) {\n        throw new Error(\"Sender name and goal description are required\");\n    }\n\n    if (input.senderId === input.receiverId) {\n        throw new Error(\"Cannot nudge yourself\");\n    }\n\n    try {\n        await retryWithBackoff(async () => {\n            // Check for existing cooldown\n            const cooldowns = await getNudgeCooldowns(input.senderId);\n            const existingCooldown = cooldowns.get(input.goalId);\n\n            if (existingCooldown && new Date() < existingCooldown) {\n                const remainingMinutes = Math.ceil(\n                    (existingCooldown.getTime() - new Date().getTime()) / (1000 * 60),\n                );\n                throw new Error(`Already nudged - wait ${remainingMinutes}m`);\n            }\n\n            const nudgesCollection = getNudgesCollection();\n            const now = new Date();\n            const cooldownUntil = new Date(now.getTime() + 60 * 60 * 1000); // 1 hour\n\n            const nudgeData = {\n                senderId: input.senderId,\n                senderName: input.senderName,\n                receiverId: input.receiverId,\n                goalId: input.goalId,\n                goalDescription: input.goalDescription,\n                timestamp: Timestamp.fromDate(now),\n                cooldownUntil: Timestamp.fromDate(cooldownUntil),\n                createdAt: serverTimestamp(),\n            };\n\n            await addDoc(nudgesCollection, nudgeData);\n        });\n    } catch (error) {\n        const message = getUserFriendlyErrorMessage(error);\n        throw new Error(message);\n    }\n}\n\n/**\n * Get current nudge cooldowns for a user\n *\n * Requirements:\n * - 4.1: Track 1-hour cooldown periods\n * - 4.2: Enable nudge button when cooldown expires\n *\n * @param userId - User ID to get cooldowns for\n * @returns Map of goalId to cooldown end time\n */\nexport async function getNudgeCooldowns(\n    userId: string,\n): Promise<Map<string, Date>> {\n    if (!userId) {\n        throw new Error(\"User ID is required\");\n    }\n\n    try {\n        return await retryWithBackoff(async () => {\n            const nudgesCollection = getNudgesCollection();\n            const now = new Date();\n\n            // Query nudges sent by this user that are still in cooldown\n            const q = query(\n                nudgesCollection,\n                where(\"senderId\", \"==\", userId),\n                where(\"cooldownUntil\", \">\", Timestamp.fromDate(now)),\n                orderBy(\"cooldownUntil\", \"desc\"),\n            );\n\n            const snapshot = await getDocs(q);\n            const cooldowns = new Map<string, Date>();\n\n            snapshot.docs.forEach((doc) => {\n                const data = doc.data();\n                const goalId = data.goalId;\n                const cooldownUntil = data.cooldownUntil.toDate();\n\n                // Keep only the latest cooldown for each goal\n                if (!cooldowns.has(goalId) || cooldownUntil > cooldowns.get(goalId)!) {\n                    cooldowns.set(goalId, cooldownUntil);\n                }\n            });\n\n            return cooldowns;\n        });\n    } catch (error) {\n        console.error(\"Error fetching nudge cooldowns:\", error);\n        const message = getUserFriendlyErrorMessage(error);\n        throw new Error(message);\n    }\n}\n\n/**\n * Subscribe to real-time nudge cooldown updates\n *\n * Requirements:\n * - 4.4: Display remaining cooldown time in real-time\n * - 6.1: Real-time updates across devices\n *\n * @param userId - User ID to track cooldowns for\n * @param callback - Function called when cooldowns change\n * @returns Unsubscribe function\n */\nexport function subscribeToNudgeCooldowns(\n    userId: string,\n    callback: (cooldowns: Map<string, Date>) => void,\n    onError?: (error: Error) => void,\n): () => void {\n    if (!userId) {\n        const error = new Error(\"User ID is required\");\n        if (onError) onError(error);\n        return () => { };\n    }\n\n    const nudgesCollection = getNudgesCollection();\n    const now = new Date();\n\n    // Query nudges sent by this user that are still in cooldown\n    const q = query(\n        nudgesCollection,\n        where(\"senderId\", \"==\", userId),\n        where(\"cooldownUntil\", \">\", Timestamp.fromDate(now)),\n        orderBy(\"cooldownUntil\", \"desc\"),\n    );\n\n    const unsubscribe = onSnapshot(\n        q,\n        (snapshot) => {\n            try {\n                const cooldowns = new Map<string, Date>();\n                const currentTime = new Date();\n\n                snapshot.docs.forEach((doc) => {\n                    const data = doc.data();\n                    const goalId = data.goalId;\n                    const cooldownUntil = data.cooldownUntil.toDate();\n\n                    // Only include cooldowns that haven't expired\n                    if (cooldownUntil > currentTime) {\n                        // Keep only the latest cooldown for each goal\n                        if (\n                            !cooldowns.has(goalId) ||\n                            cooldownUntil > cooldowns.get(goalId)!\n                        ) {\n                            cooldowns.set(goalId, cooldownUntil);\n                        }\n                    }\n                });\n\n                callback(cooldowns);\n            } catch (error) {\n                console.error(\"Error processing nudge cooldowns snapshot:\", error);\n                if (onError) {\n                    onError(\n                        error instanceof Error\n                            ? error\n                            : new Error(\"Failed to process nudge cooldowns data\"),\n                    );\n                }\n            }\n        },\n        (error) => {\n            console.error(\"Error in nudge cooldowns snapshot listener:\", error);\n            if (onError) {\n                const message = getUserFriendlyErrorMessage(error);\n                onError(new Error(message));\n            }\n        },\n    );\n\n    return unsubscribe;\n}\n\n/**\n * Get nudge history for a user (sent or received)\n *\n * Requirements:\n * - 8.2: Display \"Last nudged Xm ago\" information\n * - 8.3: Show sent nudges in past 7 days\n * - 8.4: Show received nudges in past 7 days\n *\n * @param userId - User ID to get history for\n * @param type - Whether to get sent or received nudges\n * @param days - Number of days to look back (default: 7)\n * @returns Array of nudges\n */\nexport async function getNudgeHistory(\n    userId: string,\n    type: \"sent\" | \"received\",\n    days: number = 7,\n): Promise<Nudge[]> {\n    if (!userId) {\n        throw new Error(\"User ID is required\");\n    }\n\n    if (days <= 0) {\n        throw new Error(\"Days must be a positive number\");\n    }\n\n    try {\n        return await retryWithBackoff(async () => {\n            const nudgesCollection = getNudgesCollection();\n            const cutoffDate = new Date();\n            cutoffDate.setDate(cutoffDate.getDate() - days);\n\n            const fieldName = type === \"sent\" ? \"senderId\" : \"receiverId\";\n\n            const q = query(\n                nudgesCollection,\n                where(fieldName, \"==\", userId),\n                where(\"timestamp\", \">=\", Timestamp.fromDate(cutoffDate)),\n                orderBy(\"timestamp\", \"desc\"),\n                limit(100), // Reasonable limit to prevent excessive data\n            );\n\n            const snapshot = await getDocs(q);\n            const nudges: Nudge[] = snapshot.docs.map((doc) => {\n                const data = doc.data();\n                return {\n                    id: doc.id,\n                    senderId: data.senderId,\n                    senderName: data.senderName,\n                    receiverId: data.receiverId,\n                    goalId: data.goalId,\n                    goalDescription: data.goalDescription,\n                    timestamp: data.timestamp.toDate(),\n                    cooldownUntil: data.cooldownUntil.toDate(),\n                    createdAt: data.createdAt?.toDate() || new Date(),\n                };\n            });\n\n            return nudges;\n        });\n    } catch (error) {\n        console.error(`Error fetching ${type} nudge history:`, error);\n        const message = getUserFriendlyErrorMessage(error);\n        throw new Error(message);\n    }\n}\n\n/**\n * Check if a user can send a nudge for a specific goal\n *\n * Requirements:\n * - 4.1: Enforce 1-hour cooldown period\n * - 4.3: Prevent rapid nudging\n *\n * @param userId - User ID attempting to send nudge\n * @param goalId - Goal ID to check cooldown for\n * @returns True if nudge can be sent, false if in cooldown\n */\nexport async function canSendNudge(\n    userId: string,\n    goalId: string,\n): Promise<boolean> {\n    if (!userId || !goalId) {\n        return false;\n    }\n\n    try {\n        const cooldowns = await getNudgeCooldowns(userId);\n        const cooldownEnd = cooldowns.get(goalId);\n\n        if (!cooldownEnd) {\n            return true; // No cooldown exists\n        }\n\n        return new Date() > cooldownEnd;\n    } catch (error) {\n        console.error(\"Error checking nudge cooldown:\", error);\n        return false; // Err on the side of caution\n    }\n}\n\n/**\n * Get the remaining cooldown time in minutes for a specific goal\n *\n * Requirements:\n * - 4.4: Display remaining cooldown time\n *\n * @param userId - User ID to check cooldown for\n * @param goalId - Goal ID to check cooldown for\n * @returns Remaining minutes in cooldown, or 0 if no cooldown\n */\nexport async function getRemainingCooldownMinutes(\n    userId: string,\n    goalId: string,\n): Promise<number> {\n    if (!userId || !goalId) {\n        return 0;\n    }\n\n    try {\n        const cooldowns = await getNudgeCooldowns(userId);\n        const cooldownEnd = cooldowns.get(goalId);\n\n        if (!cooldownEnd) {\n            return 0; // No cooldown exists\n        }\n\n        const now = new Date();\n        if (now >= cooldownEnd) {\n            return 0; // Cooldown has expired\n        }\n\n        return Math.ceil((cooldownEnd.getTime() - now.getTime()) / (1000 * 60));\n    } catch (error) {\n        console.error(\"Error getting remaining cooldown time:\", error);\n        return 0;\n    }\n}\n"],"mappings":";;;;;;;;;;;AAAA,IAAAA,cAAA,GAAAC,OAAA;AAIA,IAAAC,UAAA,GAAAD,OAAA;AAWA,IAAAE,YAAA,GAAAF,OAAA;AAGuB,SA0CDG,SAASA,CAAAC,EAAA;EAAA,OAAAC,UAAA,CAAAC,KAAA,OAAAC,SAAA;AAAA;AAAA,SAAAF,WAAA;EAAAA,UAAA,OAAAG,kBAAA,CAAAC,OAAA,EAAxB,WAAyBC,KAAqB,EAAiB;IAElE,IAAI,CAACA,KAAK,CAACC,QAAQ,IAAI,CAACD,KAAK,CAACE,UAAU,IAAI,CAACF,KAAK,CAACG,MAAM,EAAE;MACvD,MAAM,IAAIC,KAAK,CAAC,kDAAkD,CAAC;IACvE;IAEA,IAAI,CAACJ,KAAK,CAACK,UAAU,IAAI,CAACL,KAAK,CAACM,eAAe,EAAE;MAC7C,MAAM,IAAIF,KAAK,CAAC,+CAA+C,CAAC;IACpE;IAEA,IAAIJ,KAAK,CAACC,QAAQ,KAAKD,KAAK,CAACE,UAAU,EAAE;MACrC,MAAM,IAAIE,KAAK,CAAC,uBAAuB,CAAC;IAC5C;IAEA,IAAI;MACA,MAAM,IAAAG,+BAAgB,MAAAT,kBAAA,CAAAC,OAAA,EAAC,aAAY;QAE/B,IAAMS,SAAS,SAASC,iBAAiB,CAACT,KAAK,CAACC,QAAQ,CAAC;QACzD,IAAMS,gBAAgB,GAAGF,SAAS,CAACG,GAAG,CAACX,KAAK,CAACG,MAAM,CAAC;QAEpD,IAAIO,gBAAgB,IAAI,IAAIE,IAAI,CAAC,CAAC,GAAGF,gBAAgB,EAAE;UACnD,IAAMG,gBAAgB,GAAGC,IAAI,CAACC,IAAI,CAC9B,CAACL,gBAAgB,CAACM,OAAO,CAAC,CAAC,GAAG,IAAIJ,IAAI,CAAC,CAAC,CAACI,OAAO,CAAC,CAAC,KAAK,IAAI,GAAG,EAAE,CACpE,CAAC;UACD,MAAM,IAAIZ,KAAK,CAAC,yBAAyBS,gBAAgB,GAAG,CAAC;QACjE;QAEA,IAAMI,gBAAgB,GAAG,IAAAC,gCAAmB,EAAC,CAAC;QAC9C,IAAMC,GAAG,GAAG,IAAIP,IAAI,CAAC,CAAC;QACtB,IAAMQ,aAAa,GAAG,IAAIR,IAAI,CAACO,GAAG,CAACH,OAAO,CAAC,CAAC,GAAG,EAAE,GAAG,EAAE,GAAG,IAAI,CAAC;QAE9D,IAAMK,SAAS,GAAG;UACdpB,QAAQ,EAAED,KAAK,CAACC,QAAQ;UACxBI,UAAU,EAAEL,KAAK,CAACK,UAAU;UAC5BH,UAAU,EAAEF,KAAK,CAACE,UAAU;UAC5BC,MAAM,EAAEH,KAAK,CAACG,MAAM;UACpBG,eAAe,EAAEN,KAAK,CAACM,eAAe;UACtCgB,SAAS,EAAEC,oBAAS,CAACC,QAAQ,CAACL,GAAG,CAAC;UAClCC,aAAa,EAAEG,oBAAS,CAACC,QAAQ,CAACJ,aAAa,CAAC;UAChDK,SAAS,EAAE,IAAAC,0BAAe,EAAC;QAC/B,CAAC;QAED,MAAM,IAAAC,iBAAM,EAACV,gBAAgB,EAAEI,SAAS,CAAC;MAC7C,CAAC,EAAC;IACN,CAAC,CAAC,OAAOO,KAAK,EAAE;MACZ,IAAMC,OAAO,GAAG,IAAAC,0CAA2B,EAACF,KAAK,CAAC;MAClD,MAAM,IAAIxB,KAAK,CAACyB,OAAO,CAAC;IAC5B;EACJ,CAAC;EAAA,OAAAlC,UAAA,CAAAC,KAAA,OAAAC,SAAA;AAAA;AAAA,SAYqBY,iBAAiBA,CAAAsB,GAAA;EAAA,OAAAC,kBAAA,CAAApC,KAAA,OAAAC,SAAA;AAAA;AAAA,SAAAmC,mBAAA;EAAAA,kBAAA,OAAAlC,kBAAA,CAAAC,OAAA,EAAhC,WACHkC,MAAc,EACY;IAC1B,IAAI,CAACA,MAAM,EAAE;MACT,MAAM,IAAI7B,KAAK,CAAC,qBAAqB,CAAC;IAC1C;IAEA,IAAI;MACA,aAAa,IAAAG,+BAAgB,MAAAT,kBAAA,CAAAC,OAAA,EAAC,aAAY;QACtC,IAAMkB,gBAAgB,GAAG,IAAAC,gCAAmB,EAAC,CAAC;QAC9C,IAAMC,GAAG,GAAG,IAAIP,IAAI,CAAC,CAAC;QAGtB,IAAMsB,CAAC,GAAG,IAAAC,gBAAK,EACXlB,gBAAgB,EAChB,IAAAmB,gBAAK,EAAC,UAAU,EAAE,IAAI,EAAEH,MAAM,CAAC,EAC/B,IAAAG,gBAAK,EAAC,eAAe,EAAE,GAAG,EAAEb,oBAAS,CAACC,QAAQ,CAACL,GAAG,CAAC,CAAC,EACpD,IAAAkB,kBAAO,EAAC,eAAe,EAAE,MAAM,CACnC,CAAC;QAED,IAAMC,QAAQ,SAAS,IAAAC,kBAAO,EAACL,CAAC,CAAC;QACjC,IAAM1B,SAAS,GAAG,IAAIgC,GAAG,CAAe,CAAC;QAEzCF,QAAQ,CAACG,IAAI,CAACC,OAAO,CAAC,UAACC,GAAG,EAAK;UAC3B,IAAMC,IAAI,GAAGD,GAAG,CAACC,IAAI,CAAC,CAAC;UACvB,IAAMzC,MAAM,GAAGyC,IAAI,CAACzC,MAAM;UAC1B,IAAMiB,aAAa,GAAGwB,IAAI,CAACxB,aAAa,CAACyB,MAAM,CAAC,CAAC;UAGjD,IAAI,CAACrC,SAAS,CAACsC,GAAG,CAAC3C,MAAM,CAAC,IAAIiB,aAAa,GAAGZ,SAAS,CAACG,GAAG,CAACR,MAAM,CAAE,EAAE;YAClEK,SAAS,CAACuC,GAAG,CAAC5C,MAAM,EAAEiB,aAAa,CAAC;UACxC;QACJ,CAAC,CAAC;QAEF,OAAOZ,SAAS;MACpB,CAAC,EAAC;IACN,CAAC,CAAC,OAAOoB,KAAK,EAAE;MACZoB,OAAO,CAACpB,KAAK,CAAC,iCAAiC,EAAEA,KAAK,CAAC;MACvD,IAAMC,OAAO,GAAG,IAAAC,0CAA2B,EAACF,KAAK,CAAC;MAClD,MAAM,IAAIxB,KAAK,CAACyB,OAAO,CAAC;IAC5B;EACJ,CAAC;EAAA,OAAAG,kBAAA,CAAApC,KAAA,OAAAC,SAAA;AAAA;AAaM,SAASoD,yBAAyBA,CACrChB,MAAc,EACdiB,QAAgD,EAChDC,OAAgC,EACtB;EACV,IAAI,CAAClB,MAAM,EAAE;IACT,IAAML,KAAK,GAAG,IAAIxB,KAAK,CAAC,qBAAqB,CAAC;IAC9C,IAAI+C,OAAO,EAAEA,OAAO,CAACvB,KAAK,CAAC;IAC3B,OAAO,YAAM,CAAE,CAAC;EACpB;EAEA,IAAMX,gBAAgB,GAAG,IAAAC,gCAAmB,EAAC,CAAC;EAC9C,IAAMC,GAAG,GAAG,IAAIP,IAAI,CAAC,CAAC;EAGtB,IAAMsB,CAAC,GAAG,IAAAC,gBAAK,EACXlB,gBAAgB,EAChB,IAAAmB,gBAAK,EAAC,UAAU,EAAE,IAAI,EAAEH,MAAM,CAAC,EAC/B,IAAAG,gBAAK,EAAC,eAAe,EAAE,GAAG,EAAEb,oBAAS,CAACC,QAAQ,CAACL,GAAG,CAAC,CAAC,EACpD,IAAAkB,kBAAO,EAAC,eAAe,EAAE,MAAM,CACnC,CAAC;EAED,IAAMe,WAAW,GAAG,IAAAC,qBAAU,EAC1BnB,CAAC,EACD,UAACI,QAAQ,EAAK;IACV,IAAI;MACA,IAAM9B,SAAS,GAAG,IAAIgC,GAAG,CAAe,CAAC;MACzC,IAAMc,WAAW,GAAG,IAAI1C,IAAI,CAAC,CAAC;MAE9B0B,QAAQ,CAACG,IAAI,CAACC,OAAO,CAAC,UAACC,GAAG,EAAK;QAC3B,IAAMC,IAAI,GAAGD,GAAG,CAACC,IAAI,CAAC,CAAC;QACvB,IAAMzC,MAAM,GAAGyC,IAAI,CAACzC,MAAM;QAC1B,IAAMiB,aAAa,GAAGwB,IAAI,CAACxB,aAAa,CAACyB,MAAM,CAAC,CAAC;QAGjD,IAAIzB,aAAa,GAAGkC,WAAW,EAAE;UAE7B,IACI,CAAC9C,SAAS,CAACsC,GAAG,CAAC3C,MAAM,CAAC,IACtBiB,aAAa,GAAGZ,SAAS,CAACG,GAAG,CAACR,MAAM,CAAE,EACxC;YACEK,SAAS,CAACuC,GAAG,CAAC5C,MAAM,EAAEiB,aAAa,CAAC;UACxC;QACJ;MACJ,CAAC,CAAC;MAEF8B,QAAQ,CAAC1C,SAAS,CAAC;IACvB,CAAC,CAAC,OAAOoB,KAAK,EAAE;MACZoB,OAAO,CAACpB,KAAK,CAAC,4CAA4C,EAAEA,KAAK,CAAC;MAClE,IAAIuB,OAAO,EAAE;QACTA,OAAO,CACHvB,KAAK,YAAYxB,KAAK,GAChBwB,KAAK,GACL,IAAIxB,KAAK,CAAC,wCAAwC,CAC5D,CAAC;MACL;IACJ;EACJ,CAAC,EACD,UAACwB,KAAK,EAAK;IACPoB,OAAO,CAACpB,KAAK,CAAC,6CAA6C,EAAEA,KAAK,CAAC;IACnE,IAAIuB,OAAO,EAAE;MACT,IAAMtB,OAAO,GAAG,IAAAC,0CAA2B,EAACF,KAAK,CAAC;MAClDuB,OAAO,CAAC,IAAI/C,KAAK,CAACyB,OAAO,CAAC,CAAC;IAC/B;EACJ,CACJ,CAAC;EAED,OAAOuB,WAAW;AACtB;AAAC,SAeqBG,eAAeA,CAAAC,GAAA,EAAAC,GAAA;EAAA,OAAAC,gBAAA,CAAA9D,KAAA,OAAAC,SAAA;AAAA;AAAA,SAAA6D,iBAAA;EAAAA,gBAAA,OAAA5D,kBAAA,CAAAC,OAAA,EAA9B,WACHkC,MAAc,EACd0B,IAAyB,EAET;IAAA,IADhBC,IAAY,GAAA/D,SAAA,CAAAgE,MAAA,QAAAhE,SAAA,QAAAiE,SAAA,GAAAjE,SAAA,MAAG,CAAC;IAEhB,IAAI,CAACoC,MAAM,EAAE;MACT,MAAM,IAAI7B,KAAK,CAAC,qBAAqB,CAAC;IAC1C;IAEA,IAAIwD,IAAI,IAAI,CAAC,EAAE;MACX,MAAM,IAAIxD,KAAK,CAAC,gCAAgC,CAAC;IACrD;IAEA,IAAI;MACA,aAAa,IAAAG,+BAAgB,MAAAT,kBAAA,CAAAC,OAAA,EAAC,aAAY;QACtC,IAAMkB,gBAAgB,GAAG,IAAAC,gCAAmB,EAAC,CAAC;QAC9C,IAAM6C,UAAU,GAAG,IAAInD,IAAI,CAAC,CAAC;QAC7BmD,UAAU,CAACC,OAAO,CAACD,UAAU,CAACE,OAAO,CAAC,CAAC,GAAGL,IAAI,CAAC;QAE/C,IAAMM,SAAS,GAAGP,IAAI,KAAK,MAAM,GAAG,UAAU,GAAG,YAAY;QAE7D,IAAMzB,CAAC,GAAG,IAAAC,gBAAK,EACXlB,gBAAgB,EAChB,IAAAmB,gBAAK,EAAC8B,SAAS,EAAE,IAAI,EAAEjC,MAAM,CAAC,EAC9B,IAAAG,gBAAK,EAAC,WAAW,EAAE,IAAI,EAAEb,oBAAS,CAACC,QAAQ,CAACuC,UAAU,CAAC,CAAC,EACxD,IAAA1B,kBAAO,EAAC,WAAW,EAAE,MAAM,CAAC,EAC5B,IAAA8B,gBAAK,EAAC,GAAG,CACb,CAAC;QAED,IAAM7B,QAAQ,SAAS,IAAAC,kBAAO,EAACL,CAAC,CAAC;QACjC,IAAMkC,MAAe,GAAG9B,QAAQ,CAACG,IAAI,CAAC4B,GAAG,CAAC,UAAC1B,GAAG,EAAK;UAAA,IAAA2B,eAAA;UAC/C,IAAM1B,IAAI,GAAGD,GAAG,CAACC,IAAI,CAAC,CAAC;UACvB,OAAO;YACH2B,EAAE,EAAE5B,GAAG,CAAC4B,EAAE;YACVtE,QAAQ,EAAE2C,IAAI,CAAC3C,QAAQ;YACvBI,UAAU,EAAEuC,IAAI,CAACvC,UAAU;YAC3BH,UAAU,EAAE0C,IAAI,CAAC1C,UAAU;YAC3BC,MAAM,EAAEyC,IAAI,CAACzC,MAAM;YACnBG,eAAe,EAAEsC,IAAI,CAACtC,eAAe;YACrCgB,SAAS,EAAEsB,IAAI,CAACtB,SAAS,CAACuB,MAAM,CAAC,CAAC;YAClCzB,aAAa,EAAEwB,IAAI,CAACxB,aAAa,CAACyB,MAAM,CAAC,CAAC;YAC1CpB,SAAS,EAAE,EAAA6C,eAAA,GAAA1B,IAAI,CAACnB,SAAS,qBAAd6C,eAAA,CAAgBzB,MAAM,CAAC,CAAC,KAAI,IAAIjC,IAAI,CAAC;UACpD,CAAC;QACL,CAAC,CAAC;QAEF,OAAOwD,MAAM;MACjB,CAAC,EAAC;IACN,CAAC,CAAC,OAAOxC,KAAK,EAAE;MACZoB,OAAO,CAACpB,KAAK,CAAC,kBAAkB+B,IAAI,iBAAiB,EAAE/B,KAAK,CAAC;MAC7D,IAAMC,OAAO,GAAG,IAAAC,0CAA2B,EAACF,KAAK,CAAC;MAClD,MAAM,IAAIxB,KAAK,CAACyB,OAAO,CAAC;IAC5B;EACJ,CAAC;EAAA,OAAA6B,gBAAA,CAAA9D,KAAA,OAAAC,SAAA;AAAA;AAAA,SAaqB2E,YAAYA,CAAAC,GAAA,EAAAC,GAAA;EAAA,OAAAC,aAAA,CAAA/E,KAAA,OAAAC,SAAA;AAAA;AAAA,SAAA8E,cAAA;EAAAA,aAAA,OAAA7E,kBAAA,CAAAC,OAAA,EAA3B,WACHkC,MAAc,EACd9B,MAAc,EACE;IAChB,IAAI,CAAC8B,MAAM,IAAI,CAAC9B,MAAM,EAAE;MACpB,OAAO,KAAK;IAChB;IAEA,IAAI;MACA,IAAMK,SAAS,SAASC,iBAAiB,CAACwB,MAAM,CAAC;MACjD,IAAM2C,WAAW,GAAGpE,SAAS,CAACG,GAAG,CAACR,MAAM,CAAC;MAEzC,IAAI,CAACyE,WAAW,EAAE;QACd,OAAO,IAAI;MACf;MAEA,OAAO,IAAIhE,IAAI,CAAC,CAAC,GAAGgE,WAAW;IACnC,CAAC,CAAC,OAAOhD,KAAK,EAAE;MACZoB,OAAO,CAACpB,KAAK,CAAC,gCAAgC,EAAEA,KAAK,CAAC;MACtD,OAAO,KAAK;IAChB;EACJ,CAAC;EAAA,OAAA+C,aAAA,CAAA/E,KAAA,OAAAC,SAAA;AAAA;AAAA,SAYqBgF,2BAA2BA,CAAAC,GAAA,EAAAC,GAAA;EAAA,OAAAC,4BAAA,CAAApF,KAAA,OAAAC,SAAA;AAAA;AAAA,SAAAmF,6BAAA;EAAAA,4BAAA,OAAAlF,kBAAA,CAAAC,OAAA,EAA1C,WACHkC,MAAc,EACd9B,MAAc,EACC;IACf,IAAI,CAAC8B,MAAM,IAAI,CAAC9B,MAAM,EAAE;MACpB,OAAO,CAAC;IACZ;IAEA,IAAI;MACA,IAAMK,SAAS,SAASC,iBAAiB,CAACwB,MAAM,CAAC;MACjD,IAAM2C,WAAW,GAAGpE,SAAS,CAACG,GAAG,CAACR,MAAM,CAAC;MAEzC,IAAI,CAACyE,WAAW,EAAE;QACd,OAAO,CAAC;MACZ;MAEA,IAAMzD,GAAG,GAAG,IAAIP,IAAI,CAAC,CAAC;MACtB,IAAIO,GAAG,IAAIyD,WAAW,EAAE;QACpB,OAAO,CAAC;MACZ;MAEA,OAAO9D,IAAI,CAACC,IAAI,CAAC,CAAC6D,WAAW,CAAC5D,OAAO,CAAC,CAAC,GAAGG,GAAG,CAACH,OAAO,CAAC,CAAC,KAAK,IAAI,GAAG,EAAE,CAAC,CAAC;IAC3E,CAAC,CAAC,OAAOY,KAAK,EAAE;MACZoB,OAAO,CAACpB,KAAK,CAAC,wCAAwC,EAAEA,KAAK,CAAC;MAC9D,OAAO,CAAC;IACZ;EACJ,CAAC;EAAA,OAAAoD,4BAAA,CAAApF,KAAA,OAAAC,SAAA;AAAA","ignoreList":[]}