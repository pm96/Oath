1fbce2c80ad261a12f2e9331b7348edf
var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault").default;
Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.milestoneService = exports.MilestoneService = void 0;
var _asyncToGenerator2 = _interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));
var _classCallCheck2 = _interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));
var _createClass2 = _interopRequireDefault(require("@babel/runtime/helpers/createClass"));
var _firestore = require("firebase/firestore");
var _firebaseConfig = require("../../firebaseConfig");
var _habitStreaks = require("../../types/habit-streaks");
var _celebrations = require("../../utils/celebrations");
var _errorHandling = require("../../utils/errorHandling");
var _collections = require("./collections");
var _habitStreakSchemas = require("./habitStreakSchemas");
var MilestoneService = exports.MilestoneService = function () {
  function MilestoneService() {
    (0, _classCallCheck2.default)(this, MilestoneService);
  }
  return (0, _createClass2.default)(MilestoneService, [{
    key: "triggerMilestoneCelebration",
    value: (function () {
      var _triggerMilestoneCelebration = (0, _asyncToGenerator2.default)(function* (userId, habitId, habitDescription, milestone) {
        var offerSharing = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : true;
        if (!userId || !habitId || !habitDescription || !milestone) {
          throw new Error("User ID, Habit ID, habit description, and milestone are required");
        }
        try {
          yield this.markMilestoneCelebrated(userId, habitId, milestone.days);
          if (milestone.days === 7) {
            _celebrations.celebrationManager.celebrateGoalCompletion();
          } else {
            _celebrations.celebrationManager.celebrateStreakMilestone();
          }
          console.log(`Milestone celebration triggered: ${milestone.days} days for habit ${habitId}`);
          return {
            shouldOfferSharing: offerSharing && this.shouldOfferSharing(milestone.days)
          };
        } catch (error) {
          var message = (0, _errorHandling.getUserFriendlyErrorMessage)(error);
          throw new Error(`Failed to trigger milestone celebration: ${message}`);
        }
      });
      function triggerMilestoneCelebration(_x, _x2, _x3, _x4) {
        return _triggerMilestoneCelebration.apply(this, arguments);
      }
      return triggerMilestoneCelebration;
    }())
  }, {
    key: "markMilestoneCelebrated",
    value: (function () {
      var _markMilestoneCelebrated = (0, _asyncToGenerator2.default)(function* (userId, habitId, milestoneDays) {
        if (!userId || !habitId || !milestoneDays) {
          throw new Error("User ID, Habit ID, and milestone days are required");
        }
        try {
          yield (0, _errorHandling.retryWithBackoff)((0, _asyncToGenerator2.default)(function* () {
            return yield (0, _firestore.runTransaction)(_firebaseConfig.db, function () {
              var _ref2 = (0, _asyncToGenerator2.default)(function* (transaction) {
                var streaksCollection = (0, _collections.getHabitStreaksCollection)();
                var streakId = `${userId}_${habitId}`;
                var streakDocRef = (0, _firestore.doc)(streaksCollection, streakId);
                var streakDoc = yield transaction.get(streakDocRef);
                if (!streakDoc.exists()) {
                  throw new Error("Streak data not found");
                }
                var streak = (0, _habitStreakSchemas.transformFirestoreToStreak)(streakDoc.data());
                if (!(0, _habitStreakSchemas.validateUserOwnership)(userId, streak.userId)) {
                  throw new Error("Unauthorized access to streak data");
                }
                var updatedMilestones = streak.milestones.map(function (m) {
                  return m.days === milestoneDays ? Object.assign({}, m, {
                    celebrated: true
                  }) : m;
                });
                var updatedStreak = Object.assign({}, streak, {
                  milestones: updatedMilestones
                });
                var streakData = (0, _habitStreakSchemas.transformStreakToFirestore)(updatedStreak);
                transaction.set(streakDocRef, streakData);
              });
              return function (_x8) {
                return _ref2.apply(this, arguments);
              };
            }());
          }));
        } catch (error) {
          var message = (0, _errorHandling.getUserFriendlyErrorMessage)(error);
          throw new Error(`Failed to mark milestone as celebrated: ${message}`);
        }
      });
      function markMilestoneCelebrated(_x5, _x6, _x7) {
        return _markMilestoneCelebrated.apply(this, arguments);
      }
      return markMilestoneCelebrated;
    }())
  }, {
    key: "getHabitMilestoneBadges",
    value: (function () {
      var _getHabitMilestoneBadges = (0, _asyncToGenerator2.default)(function* (userId, habitId) {
        var _this = this;
        if (!userId || !habitId) {
          throw new Error("User ID and Habit ID are required");
        }
        try {
          var streaksCollection = (0, _collections.getHabitStreaksCollection)();
          var streakId = `${userId}_${habitId}`;
          var streakDocRef = (0, _firestore.doc)(streaksCollection, streakId);
          var streakDoc = yield (0, _firestore.getDoc)(streakDocRef);
          if (!streakDoc.exists()) {
            return [];
          }
          var streak = (0, _habitStreakSchemas.transformFirestoreToStreak)(streakDoc.data());
          if (!(0, _habitStreakSchemas.validateUserOwnership)(userId, streak.userId)) {
            throw new Error("Unauthorized access to streak data");
          }
          var badges = streak.milestones.map(function (milestone) {
            return {
              days: milestone.days,
              achievedAt: milestone.achievedAt,
              celebrated: milestone.celebrated,
              badgeType: _this.getBadgeType(milestone.days),
              title: _this.getMilestoneTitle(milestone.days),
              description: _this.getMilestoneDescription(milestone.days)
            };
          });
          return badges.sort(function (a, b) {
            return a.days - b.days;
          });
        } catch (error) {
          var message = (0, _errorHandling.getUserFriendlyErrorMessage)(error);
          throw new Error(`Failed to get habit milestone badges: ${message}`);
        }
      });
      function getHabitMilestoneBadges(_x9, _x0) {
        return _getHabitMilestoneBadges.apply(this, arguments);
      }
      return getHabitMilestoneBadges;
    }())
  }, {
    key: "getTotalMilestoneCount",
    value: (function () {
      var _getTotalMilestoneCount = (0, _asyncToGenerator2.default)(function* (userId) {
        if (!userId) {
          throw new Error("User ID is required");
        }
        try {
          return yield (0, _errorHandling.retryWithBackoff)((0, _asyncToGenerator2.default)(function* () {
            var streaksCollection = (0, _collections.getHabitStreaksCollection)();
            var userStreaksQuery = (0, _firestore.query)(streaksCollection, (0, _firestore.where)("userId", "==", userId));
            var streaksSnapshot = yield (0, _firestore.getDocs)(userStreaksQuery);
            var totalMilestones = 0;
            var milestoneBreakdown = {};
            _habitStreaks.MILESTONE_DAYS.forEach(function (days) {
              milestoneBreakdown[days] = 0;
            });
            streaksSnapshot.docs.forEach(function (doc) {
              var streak = (0, _habitStreakSchemas.transformFirestoreToStreak)(doc.data());
              streak.milestones.forEach(function (milestone) {
                totalMilestones++;
                milestoneBreakdown[milestone.days] = (milestoneBreakdown[milestone.days] || 0) + 1;
              });
            });
            return {
              total: totalMilestones,
              breakdown: milestoneBreakdown,
              lastUpdated: _firestore.Timestamp.now()
            };
          }));
        } catch (error) {
          var message = (0, _errorHandling.getUserFriendlyErrorMessage)(error);
          throw new Error(`Failed to get total milestone count: ${message}`);
        }
      });
      function getTotalMilestoneCount(_x1) {
        return _getTotalMilestoneCount.apply(this, arguments);
      }
      return getTotalMilestoneCount;
    }())
  }, {
    key: "getMultiHabitMilestoneBadges",
    value: (function () {
      var _getMultiHabitMilestoneBadges = (0, _asyncToGenerator2.default)(function* (userId, habitIds) {
        if (!userId || !habitIds || habitIds.length === 0) {
          throw new Error("User ID and habit IDs are required");
        }
        try {
          var result = {};
          for (var habitId of habitIds) {
            result[habitId] = yield this.getHabitMilestoneBadges(userId, habitId);
          }
          return result;
        } catch (error) {
          var message = (0, _errorHandling.getUserFriendlyErrorMessage)(error);
          throw new Error(`Failed to get multi-habit milestone badges: ${message}`);
        }
      });
      function getMultiHabitMilestoneBadges(_x10, _x11) {
        return _getMultiHabitMilestoneBadges.apply(this, arguments);
      }
      return getMultiHabitMilestoneBadges;
    }())
  }, {
    key: "shouldTriggerCelebration",
    value: function shouldTriggerCelebration(milestone) {
      return !milestone.celebrated;
    }
  }, {
    key: "getNextMilestoneTarget",
    value: function getNextMilestoneTarget(currentStreak) {
      for (var milestoneDay of _habitStreaks.MILESTONE_DAYS) {
        if (currentStreak < milestoneDay) {
          return milestoneDay;
        }
      }
      return null;
    }
  }, {
    key: "getMilestoneProgress",
    value: function getMilestoneProgress(currentStreak) {
      var nextTarget = this.getNextMilestoneTarget(currentStreak);
      if (!nextTarget) {
        return null;
      }
      var previousTarget = _habitStreaks.MILESTONE_DAYS.find(function (days, index) {
        return _habitStreaks.MILESTONE_DAYS[index + 1] === nextTarget;
      }) || 0;
      var progress = currentStreak - previousTarget;
      var total = nextTarget - previousTarget;
      var percentage = Math.round(progress / total * 100);
      return {
        currentStreak: currentStreak,
        nextTarget: nextTarget,
        progress: progress,
        total: total,
        percentage: percentage,
        daysRemaining: nextTarget - currentStreak
      };
    }
  }, {
    key: "shouldOfferSharing",
    value: function shouldOfferSharing(milestoneDays) {
      return milestoneDays >= 7;
    }
  }, {
    key: "getBadgeType",
    value: function getBadgeType(days) {
      switch (days) {
        case 7:
          return "bronze";
        case 30:
          return "silver";
        case 60:
          return "gold";
        case 100:
          return "platinum";
        case 365:
          return "diamond";
        default:
          return "bronze";
      }
    }
  }, {
    key: "getMilestoneTitle",
    value: function getMilestoneTitle(days) {
      switch (days) {
        case 7:
          return "Week Warrior";
        case 30:
          return "Month Master";
        case 60:
          return "Consistency Champion";
        case 100:
          return "Century Achiever";
        case 365:
          return "Year Legend";
        default:
          return `${days} Day Streak`;
      }
    }
  }, {
    key: "getMilestoneDescription",
    value: function getMilestoneDescription(days) {
      switch (days) {
        case 7:
          return "Completed 7 consecutive days";
        case 30:
          return "Completed 30 consecutive days";
        case 60:
          return "Completed 60 consecutive days";
        case 100:
          return "Completed 100 consecutive days";
        case 365:
          return "Completed a full year of consistency";
        default:
          return `Completed ${days} consecutive days`;
      }
    }
  }]);
}();
var milestoneService = exports.milestoneService = new MilestoneService();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfZmlyZXN0b3JlIiwicmVxdWlyZSIsIl9maXJlYmFzZUNvbmZpZyIsIl9oYWJpdFN0cmVha3MiLCJfY2VsZWJyYXRpb25zIiwiX2Vycm9ySGFuZGxpbmciLCJfY29sbGVjdGlvbnMiLCJfaGFiaXRTdHJlYWtTY2hlbWFzIiwiTWlsZXN0b25lU2VydmljZSIsImV4cG9ydHMiLCJfY2xhc3NDYWxsQ2hlY2syIiwiZGVmYXVsdCIsIl9jcmVhdGVDbGFzczIiLCJrZXkiLCJ2YWx1ZSIsIl90cmlnZ2VyTWlsZXN0b25lQ2VsZWJyYXRpb24iLCJfYXN5bmNUb0dlbmVyYXRvcjIiLCJ1c2VySWQiLCJoYWJpdElkIiwiaGFiaXREZXNjcmlwdGlvbiIsIm1pbGVzdG9uZSIsIm9mZmVyU2hhcmluZyIsImFyZ3VtZW50cyIsImxlbmd0aCIsInVuZGVmaW5lZCIsIkVycm9yIiwibWFya01pbGVzdG9uZUNlbGVicmF0ZWQiLCJkYXlzIiwiY2VsZWJyYXRpb25NYW5hZ2VyIiwiY2VsZWJyYXRlR29hbENvbXBsZXRpb24iLCJjZWxlYnJhdGVTdHJlYWtNaWxlc3RvbmUiLCJjb25zb2xlIiwibG9nIiwic2hvdWxkT2ZmZXJTaGFyaW5nIiwiZXJyb3IiLCJtZXNzYWdlIiwiZ2V0VXNlckZyaWVuZGx5RXJyb3JNZXNzYWdlIiwidHJpZ2dlck1pbGVzdG9uZUNlbGVicmF0aW9uIiwiX3giLCJfeDIiLCJfeDMiLCJfeDQiLCJhcHBseSIsIl9tYXJrTWlsZXN0b25lQ2VsZWJyYXRlZCIsIm1pbGVzdG9uZURheXMiLCJyZXRyeVdpdGhCYWNrb2ZmIiwicnVuVHJhbnNhY3Rpb24iLCJkYiIsIl9yZWYyIiwidHJhbnNhY3Rpb24iLCJzdHJlYWtzQ29sbGVjdGlvbiIsImdldEhhYml0U3RyZWFrc0NvbGxlY3Rpb24iLCJzdHJlYWtJZCIsInN0cmVha0RvY1JlZiIsImRvYyIsInN0cmVha0RvYyIsImdldCIsImV4aXN0cyIsInN0cmVhayIsInRyYW5zZm9ybUZpcmVzdG9yZVRvU3RyZWFrIiwiZGF0YSIsInZhbGlkYXRlVXNlck93bmVyc2hpcCIsInVwZGF0ZWRNaWxlc3RvbmVzIiwibWlsZXN0b25lcyIsIm1hcCIsIm0iLCJPYmplY3QiLCJhc3NpZ24iLCJjZWxlYnJhdGVkIiwidXBkYXRlZFN0cmVhayIsInN0cmVha0RhdGEiLCJ0cmFuc2Zvcm1TdHJlYWtUb0ZpcmVzdG9yZSIsInNldCIsIl94OCIsIl94NSIsIl94NiIsIl94NyIsIl9nZXRIYWJpdE1pbGVzdG9uZUJhZGdlcyIsIl90aGlzIiwiZ2V0RG9jIiwiYmFkZ2VzIiwiYWNoaWV2ZWRBdCIsImJhZGdlVHlwZSIsImdldEJhZGdlVHlwZSIsInRpdGxlIiwiZ2V0TWlsZXN0b25lVGl0bGUiLCJkZXNjcmlwdGlvbiIsImdldE1pbGVzdG9uZURlc2NyaXB0aW9uIiwic29ydCIsImEiLCJiIiwiZ2V0SGFiaXRNaWxlc3RvbmVCYWRnZXMiLCJfeDkiLCJfeDAiLCJfZ2V0VG90YWxNaWxlc3RvbmVDb3VudCIsInVzZXJTdHJlYWtzUXVlcnkiLCJxdWVyeSIsIndoZXJlIiwic3RyZWFrc1NuYXBzaG90IiwiZ2V0RG9jcyIsInRvdGFsTWlsZXN0b25lcyIsIm1pbGVzdG9uZUJyZWFrZG93biIsIk1JTEVTVE9ORV9EQVlTIiwiZm9yRWFjaCIsImRvY3MiLCJ0b3RhbCIsImJyZWFrZG93biIsImxhc3RVcGRhdGVkIiwiVGltZXN0YW1wIiwibm93IiwiZ2V0VG90YWxNaWxlc3RvbmVDb3VudCIsIl94MSIsIl9nZXRNdWx0aUhhYml0TWlsZXN0b25lQmFkZ2VzIiwiaGFiaXRJZHMiLCJyZXN1bHQiLCJnZXRNdWx0aUhhYml0TWlsZXN0b25lQmFkZ2VzIiwiX3gxMCIsIl94MTEiLCJzaG91bGRUcmlnZ2VyQ2VsZWJyYXRpb24iLCJnZXROZXh0TWlsZXN0b25lVGFyZ2V0IiwiY3VycmVudFN0cmVhayIsIm1pbGVzdG9uZURheSIsImdldE1pbGVzdG9uZVByb2dyZXNzIiwibmV4dFRhcmdldCIsInByZXZpb3VzVGFyZ2V0IiwiZmluZCIsImluZGV4IiwicHJvZ3Jlc3MiLCJwZXJjZW50YWdlIiwiTWF0aCIsInJvdW5kIiwiZGF5c1JlbWFpbmluZyIsIm1pbGVzdG9uZVNlcnZpY2UiXSwic291cmNlcyI6WyJtaWxlc3RvbmVTZXJ2aWNlLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XG4gICAgZG9jLFxuICAgIGdldERvYyxcbiAgICBnZXREb2NzLFxuICAgIHF1ZXJ5LFxuICAgIHJ1blRyYW5zYWN0aW9uLFxuICAgIFRpbWVzdGFtcCxcbiAgICB3aGVyZSxcbn0gZnJvbSBcImZpcmViYXNlL2ZpcmVzdG9yZVwiO1xuaW1wb3J0IHsgZGIgfSBmcm9tIFwiLi4vLi4vZmlyZWJhc2VDb25maWdcIjtcbmltcG9ydCB7XG4gICAgSGFiaXRTdHJlYWssXG4gICAgTUlMRVNUT05FX0RBWVMsXG4gICAgU3RyZWFrTWlsZXN0b25lLFxufSBmcm9tIFwiLi4vLi4vdHlwZXMvaGFiaXQtc3RyZWFrc1wiO1xuaW1wb3J0IHsgY2VsZWJyYXRpb25NYW5hZ2VyIH0gZnJvbSBcIi4uLy4uL3V0aWxzL2NlbGVicmF0aW9uc1wiO1xuaW1wb3J0IHtcbiAgICBnZXRVc2VyRnJpZW5kbHlFcnJvck1lc3NhZ2UsXG4gICAgcmV0cnlXaXRoQmFja29mZixcbn0gZnJvbSBcIi4uLy4uL3V0aWxzL2Vycm9ySGFuZGxpbmdcIjtcbmltcG9ydCB7IGdldEhhYml0U3RyZWFrc0NvbGxlY3Rpb24gfSBmcm9tIFwiLi9jb2xsZWN0aW9uc1wiO1xuaW1wb3J0IHtcbiAgICB0cmFuc2Zvcm1GaXJlc3RvcmVUb1N0cmVhayxcbiAgICB0cmFuc2Zvcm1TdHJlYWtUb0ZpcmVzdG9yZSxcbiAgICB2YWxpZGF0ZVVzZXJPd25lcnNoaXAsXG59IGZyb20gXCIuL2hhYml0U3RyZWFrU2NoZW1hc1wiO1xuXG4vKipcbiAqIE1pbGVzdG9uZSBTZXJ2aWNlXG4gKlxuICogSGFuZGxlcyBtaWxlc3RvbmUgZGV0ZWN0aW9uLCBjZWxlYnJhdGlvbiB0cmlnZ2VyaW5nLCBiYWRnZSB0cmFja2luZyxcbiAqIGFuZCBtaWxlc3RvbmUgY291bnQgYWdncmVnYXRpb24gYWNyb3NzIGhhYml0cy5cbiAqIFJlcXVpcmVtZW50czogMy4xLCAzLjIsIDMuMywgMy40LCAzLjUsIDQuNFxuICovXG5leHBvcnQgY2xhc3MgTWlsZXN0b25lU2VydmljZSB7XG4gICAgLyoqXG4gICAgICogVHJpZ2dlciBjZWxlYnJhdGlvbiBmb3IgYSBtaWxlc3RvbmUgYWNoaWV2ZW1lbnRcbiAgICAgKiBSZXF1aXJlbWVudHM6IDMuMSwgMy4yLCA4LjFcbiAgICAgKi9cbiAgICBhc3luYyB0cmlnZ2VyTWlsZXN0b25lQ2VsZWJyYXRpb24oXG4gICAgICAgIHVzZXJJZDogc3RyaW5nLFxuICAgICAgICBoYWJpdElkOiBzdHJpbmcsXG4gICAgICAgIGhhYml0RGVzY3JpcHRpb246IHN0cmluZyxcbiAgICAgICAgbWlsZXN0b25lOiBTdHJlYWtNaWxlc3RvbmUsXG4gICAgICAgIG9mZmVyU2hhcmluZzogYm9vbGVhbiA9IHRydWUsXG4gICAgKTogUHJvbWlzZTx7IHNob3VsZE9mZmVyU2hhcmluZzogYm9vbGVhbiB9PiB7XG4gICAgICAgIGlmICghdXNlcklkIHx8ICFoYWJpdElkIHx8ICFoYWJpdERlc2NyaXB0aW9uIHx8ICFtaWxlc3RvbmUpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgICAgICAgICBcIlVzZXIgSUQsIEhhYml0IElELCBoYWJpdCBkZXNjcmlwdGlvbiwgYW5kIG1pbGVzdG9uZSBhcmUgcmVxdWlyZWRcIixcbiAgICAgICAgICAgICk7XG4gICAgICAgIH1cblxuICAgICAgICB0cnkge1xuICAgICAgICAgICAgLy8gTWFyayBtaWxlc3RvbmUgYXMgY2VsZWJyYXRlZFxuICAgICAgICAgICAgYXdhaXQgdGhpcy5tYXJrTWlsZXN0b25lQ2VsZWJyYXRlZCh1c2VySWQsIGhhYml0SWQsIG1pbGVzdG9uZS5kYXlzKTtcblxuICAgICAgICAgICAgLy8gVHJpZ2dlciBjZWxlYnJhdGlvbiBhbmltYXRpb24gYW5kIGhhcHRpY3NcbiAgICAgICAgICAgIGlmIChtaWxlc3RvbmUuZGF5cyA9PT0gNykge1xuICAgICAgICAgICAgICAgIC8vIEZpcnN0IG1pbGVzdG9uZSAtIGJhc2ljIGNlbGVicmF0aW9uXG4gICAgICAgICAgICAgICAgY2VsZWJyYXRpb25NYW5hZ2VyLmNlbGVicmF0ZUdvYWxDb21wbGV0aW9uKCk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIC8vIE1ham9yIG1pbGVzdG9uZSAtIGVuaGFuY2VkIGNlbGVicmF0aW9uXG4gICAgICAgICAgICAgICAgY2VsZWJyYXRpb25NYW5hZ2VyLmNlbGVicmF0ZVN0cmVha01pbGVzdG9uZSgpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBMb2cgY2VsZWJyYXRpb24gZm9yIGFuYWx5dGljcyAoY291bGQgYmUgdXNlZCBmb3Igbm90aWZpY2F0aW9ucylcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFxuICAgICAgICAgICAgICAgIGBNaWxlc3RvbmUgY2VsZWJyYXRpb24gdHJpZ2dlcmVkOiAke21pbGVzdG9uZS5kYXlzfSBkYXlzIGZvciBoYWJpdCAke2hhYml0SWR9YCxcbiAgICAgICAgICAgICk7XG5cbiAgICAgICAgICAgIC8vIFJldHVybiB3aGV0aGVyIHRvIG9mZmVyIHNoYXJpbmcgKFJlcXVpcmVtZW50czogOC4xKVxuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICBzaG91bGRPZmZlclNoYXJpbmc6XG4gICAgICAgICAgICAgICAgICAgIG9mZmVyU2hhcmluZyAmJiB0aGlzLnNob3VsZE9mZmVyU2hhcmluZyhtaWxlc3RvbmUuZGF5cyksXG4gICAgICAgICAgICB9O1xuICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgY29uc3QgbWVzc2FnZSA9IGdldFVzZXJGcmllbmRseUVycm9yTWVzc2FnZShlcnJvcik7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYEZhaWxlZCB0byB0cmlnZ2VyIG1pbGVzdG9uZSBjZWxlYnJhdGlvbjogJHttZXNzYWdlfWApO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogTWFyayBhIG1pbGVzdG9uZSBhcyBjZWxlYnJhdGVkIGluIHRoZSBkYXRhYmFzZVxuICAgICAqIFJlcXVpcmVtZW50czogMy4yXG4gICAgICovXG4gICAgYXN5bmMgbWFya01pbGVzdG9uZUNlbGVicmF0ZWQoXG4gICAgICAgIHVzZXJJZDogc3RyaW5nLFxuICAgICAgICBoYWJpdElkOiBzdHJpbmcsXG4gICAgICAgIG1pbGVzdG9uZURheXM6IG51bWJlcixcbiAgICApOiBQcm9taXNlPHZvaWQ+IHtcbiAgICAgICAgaWYgKCF1c2VySWQgfHwgIWhhYml0SWQgfHwgIW1pbGVzdG9uZURheXMpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIlVzZXIgSUQsIEhhYml0IElELCBhbmQgbWlsZXN0b25lIGRheXMgYXJlIHJlcXVpcmVkXCIpO1xuICAgICAgICB9XG5cbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGF3YWl0IHJldHJ5V2l0aEJhY2tvZmYoYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgICAgIHJldHVybiBhd2FpdCBydW5UcmFuc2FjdGlvbihkYiwgYXN5bmMgKHRyYW5zYWN0aW9uKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHN0cmVha3NDb2xsZWN0aW9uID0gZ2V0SGFiaXRTdHJlYWtzQ29sbGVjdGlvbigpO1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBzdHJlYWtJZCA9IGAke3VzZXJJZH1fJHtoYWJpdElkfWA7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHN0cmVha0RvY1JlZiA9IGRvYyhzdHJlYWtzQ29sbGVjdGlvbiwgc3RyZWFrSWQpO1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBzdHJlYWtEb2MgPSBhd2FpdCB0cmFuc2FjdGlvbi5nZXQoc3RyZWFrRG9jUmVmKTtcblxuICAgICAgICAgICAgICAgICAgICBpZiAoIXN0cmVha0RvYy5leGlzdHMoKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiU3RyZWFrIGRhdGEgbm90IGZvdW5kXCIpO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgY29uc3Qgc3RyZWFrID0gdHJhbnNmb3JtRmlyZXN0b3JlVG9TdHJlYWsoc3RyZWFrRG9jLmRhdGEoKSk7XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gVmFsaWRhdGUgdXNlciBvd25lcnNoaXBcbiAgICAgICAgICAgICAgICAgICAgaWYgKCF2YWxpZGF0ZVVzZXJPd25lcnNoaXAodXNlcklkLCBzdHJlYWsudXNlcklkKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiVW5hdXRob3JpemVkIGFjY2VzcyB0byBzdHJlYWsgZGF0YVwiKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIC8vIFVwZGF0ZSB0aGUgbWlsZXN0b25lIHRvIG1hcmsgaXQgYXMgY2VsZWJyYXRlZFxuICAgICAgICAgICAgICAgICAgICBjb25zdCB1cGRhdGVkTWlsZXN0b25lcyA9IHN0cmVhay5taWxlc3RvbmVzLm1hcCgobSkgPT5cbiAgICAgICAgICAgICAgICAgICAgICAgIG0uZGF5cyA9PT0gbWlsZXN0b25lRGF5cyA/IHsgLi4ubSwgY2VsZWJyYXRlZDogdHJ1ZSB9IDogbSxcbiAgICAgICAgICAgICAgICAgICAgKTtcblxuICAgICAgICAgICAgICAgICAgICBjb25zdCB1cGRhdGVkU3RyZWFrOiBIYWJpdFN0cmVhayA9IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIC4uLnN0cmVhayxcbiAgICAgICAgICAgICAgICAgICAgICAgIG1pbGVzdG9uZXM6IHVwZGF0ZWRNaWxlc3RvbmVzLFxuICAgICAgICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHN0cmVha0RhdGEgPSB0cmFuc2Zvcm1TdHJlYWtUb0ZpcmVzdG9yZSh1cGRhdGVkU3RyZWFrKTtcbiAgICAgICAgICAgICAgICAgICAgdHJhbnNhY3Rpb24uc2V0KHN0cmVha0RvY1JlZiwgc3RyZWFrRGF0YSk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgIGNvbnN0IG1lc3NhZ2UgPSBnZXRVc2VyRnJpZW5kbHlFcnJvck1lc3NhZ2UoZXJyb3IpO1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBGYWlsZWQgdG8gbWFyayBtaWxlc3RvbmUgYXMgY2VsZWJyYXRlZDogJHttZXNzYWdlfWApO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogR2V0IGFsbCBtaWxlc3RvbmUgYmFkZ2VzIGZvciBhIHNwZWNpZmljIGhhYml0XG4gICAgICogUmVxdWlyZW1lbnRzOiAzLjRcbiAgICAgKi9cbiAgICBhc3luYyBnZXRIYWJpdE1pbGVzdG9uZUJhZGdlcyhcbiAgICAgICAgdXNlcklkOiBzdHJpbmcsXG4gICAgICAgIGhhYml0SWQ6IHN0cmluZyxcbiAgICApOiBQcm9taXNlPE1pbGVzdG9uZUJhZGdlW10+IHtcbiAgICAgICAgaWYgKCF1c2VySWQgfHwgIWhhYml0SWQpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIlVzZXIgSUQgYW5kIEhhYml0IElEIGFyZSByZXF1aXJlZFwiKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBjb25zdCBzdHJlYWtzQ29sbGVjdGlvbiA9IGdldEhhYml0U3RyZWFrc0NvbGxlY3Rpb24oKTtcbiAgICAgICAgICAgIGNvbnN0IHN0cmVha0lkID0gYCR7dXNlcklkfV8ke2hhYml0SWR9YDtcbiAgICAgICAgICAgIGNvbnN0IHN0cmVha0RvY1JlZiA9IGRvYyhzdHJlYWtzQ29sbGVjdGlvbiwgc3RyZWFrSWQpO1xuICAgICAgICAgICAgY29uc3Qgc3RyZWFrRG9jID0gYXdhaXQgZ2V0RG9jKHN0cmVha0RvY1JlZik7XG5cbiAgICAgICAgICAgIGlmICghc3RyZWFrRG9jLmV4aXN0cygpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIFtdO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBjb25zdCBzdHJlYWsgPSB0cmFuc2Zvcm1GaXJlc3RvcmVUb1N0cmVhayhzdHJlYWtEb2MuZGF0YSgpKTtcblxuICAgICAgICAgICAgLy8gVmFsaWRhdGUgdXNlciBvd25lcnNoaXBcbiAgICAgICAgICAgIGlmICghdmFsaWRhdGVVc2VyT3duZXJzaGlwKHVzZXJJZCwgc3RyZWFrLnVzZXJJZCkpIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJVbmF1dGhvcml6ZWQgYWNjZXNzIHRvIHN0cmVhayBkYXRhXCIpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBUcmFuc2Zvcm0gbWlsZXN0b25lcyB0byBiYWRnZXNcbiAgICAgICAgICAgIGNvbnN0IGJhZGdlczogTWlsZXN0b25lQmFkZ2VbXSA9IHN0cmVhay5taWxlc3RvbmVzLm1hcCgobWlsZXN0b25lKSA9PiAoe1xuICAgICAgICAgICAgICAgIGRheXM6IG1pbGVzdG9uZS5kYXlzLFxuICAgICAgICAgICAgICAgIGFjaGlldmVkQXQ6IG1pbGVzdG9uZS5hY2hpZXZlZEF0LFxuICAgICAgICAgICAgICAgIGNlbGVicmF0ZWQ6IG1pbGVzdG9uZS5jZWxlYnJhdGVkLFxuICAgICAgICAgICAgICAgIGJhZGdlVHlwZTogdGhpcy5nZXRCYWRnZVR5cGUobWlsZXN0b25lLmRheXMpLFxuICAgICAgICAgICAgICAgIHRpdGxlOiB0aGlzLmdldE1pbGVzdG9uZVRpdGxlKG1pbGVzdG9uZS5kYXlzKSxcbiAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogdGhpcy5nZXRNaWxlc3RvbmVEZXNjcmlwdGlvbihtaWxlc3RvbmUuZGF5cyksXG4gICAgICAgICAgICB9KSk7XG5cbiAgICAgICAgICAgIC8vIFNvcnQgYmFkZ2VzIGJ5IGRheXMgYWNoaWV2ZWRcbiAgICAgICAgICAgIHJldHVybiBiYWRnZXMuc29ydCgoYSwgYikgPT4gYS5kYXlzIC0gYi5kYXlzKTtcbiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgIGNvbnN0IG1lc3NhZ2UgPSBnZXRVc2VyRnJpZW5kbHlFcnJvck1lc3NhZ2UoZXJyb3IpO1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBGYWlsZWQgdG8gZ2V0IGhhYml0IG1pbGVzdG9uZSBiYWRnZXM6ICR7bWVzc2FnZX1gKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEdldCB0b3RhbCBtaWxlc3RvbmUgY291bnQgYWNyb3NzIGFsbCB1c2VyIGhhYml0c1xuICAgICAqIFJlcXVpcmVtZW50czogMy41XG4gICAgICovXG4gICAgYXN5bmMgZ2V0VG90YWxNaWxlc3RvbmVDb3VudCh1c2VySWQ6IHN0cmluZyk6IFByb21pc2U8TWlsZXN0b25lQ291bnQ+IHtcbiAgICAgICAgaWYgKCF1c2VySWQpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIlVzZXIgSUQgaXMgcmVxdWlyZWRcIik7XG4gICAgICAgIH1cblxuICAgICAgICB0cnkge1xuICAgICAgICAgICAgcmV0dXJuIGF3YWl0IHJldHJ5V2l0aEJhY2tvZmYoYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnN0IHN0cmVha3NDb2xsZWN0aW9uID0gZ2V0SGFiaXRTdHJlYWtzQ29sbGVjdGlvbigpO1xuICAgICAgICAgICAgICAgIGNvbnN0IHVzZXJTdHJlYWtzUXVlcnkgPSBxdWVyeShcbiAgICAgICAgICAgICAgICAgICAgc3RyZWFrc0NvbGxlY3Rpb24sXG4gICAgICAgICAgICAgICAgICAgIHdoZXJlKFwidXNlcklkXCIsIFwiPT1cIiwgdXNlcklkKSxcbiAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgICAgIGNvbnN0IHN0cmVha3NTbmFwc2hvdCA9IGF3YWl0IGdldERvY3ModXNlclN0cmVha3NRdWVyeSk7XG5cbiAgICAgICAgICAgICAgICBsZXQgdG90YWxNaWxlc3RvbmVzID0gMDtcbiAgICAgICAgICAgICAgICBjb25zdCBtaWxlc3RvbmVCcmVha2Rvd246IFJlY29yZDxudW1iZXIsIG51bWJlcj4gPSB7fTtcblxuICAgICAgICAgICAgICAgIC8vIEluaXRpYWxpemUgbWlsZXN0b25lIGJyZWFrZG93blxuICAgICAgICAgICAgICAgIE1JTEVTVE9ORV9EQVlTLmZvckVhY2goKGRheXMpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgbWlsZXN0b25lQnJlYWtkb3duW2RheXNdID0gMDtcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIC8vIENvdW50IG1pbGVzdG9uZXMgYWNyb3NzIGFsbCBoYWJpdHNcbiAgICAgICAgICAgICAgICBzdHJlYWtzU25hcHNob3QuZG9jcy5mb3JFYWNoKChkb2MpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3Qgc3RyZWFrID0gdHJhbnNmb3JtRmlyZXN0b3JlVG9TdHJlYWsoZG9jLmRhdGEoKSk7XG5cbiAgICAgICAgICAgICAgICAgICAgc3RyZWFrLm1pbGVzdG9uZXMuZm9yRWFjaCgobWlsZXN0b25lKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0b3RhbE1pbGVzdG9uZXMrKztcbiAgICAgICAgICAgICAgICAgICAgICAgIG1pbGVzdG9uZUJyZWFrZG93blttaWxlc3RvbmUuZGF5c10gPVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIChtaWxlc3RvbmVCcmVha2Rvd25bbWlsZXN0b25lLmRheXNdIHx8IDApICsgMTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgICAgICB0b3RhbDogdG90YWxNaWxlc3RvbmVzLFxuICAgICAgICAgICAgICAgICAgICBicmVha2Rvd246IG1pbGVzdG9uZUJyZWFrZG93bixcbiAgICAgICAgICAgICAgICAgICAgbGFzdFVwZGF0ZWQ6IFRpbWVzdGFtcC5ub3coKSxcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICBjb25zdCBtZXNzYWdlID0gZ2V0VXNlckZyaWVuZGx5RXJyb3JNZXNzYWdlKGVycm9yKTtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgRmFpbGVkIHRvIGdldCB0b3RhbCBtaWxlc3RvbmUgY291bnQ6ICR7bWVzc2FnZX1gKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEdldCBtaWxlc3RvbmUgYmFkZ2VzIGZvciBtdWx0aXBsZSBoYWJpdHMgKGZvciBkYXNoYm9hcmQgZGlzcGxheSlcbiAgICAgKiBSZXF1aXJlbWVudHM6IDMuNFxuICAgICAqL1xuICAgIGFzeW5jIGdldE11bHRpSGFiaXRNaWxlc3RvbmVCYWRnZXMoXG4gICAgICAgIHVzZXJJZDogc3RyaW5nLFxuICAgICAgICBoYWJpdElkczogc3RyaW5nW10sXG4gICAgKTogUHJvbWlzZTxSZWNvcmQ8c3RyaW5nLCBNaWxlc3RvbmVCYWRnZVtdPj4ge1xuICAgICAgICBpZiAoIXVzZXJJZCB8fCAhaGFiaXRJZHMgfHwgaGFiaXRJZHMubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJVc2VyIElEIGFuZCBoYWJpdCBJRHMgYXJlIHJlcXVpcmVkXCIpO1xuICAgICAgICB9XG5cbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdDogUmVjb3JkPHN0cmluZywgTWlsZXN0b25lQmFkZ2VbXT4gPSB7fTtcblxuICAgICAgICAgICAgLy8gR2V0IGJhZGdlcyBmb3IgZWFjaCBoYWJpdFxuICAgICAgICAgICAgZm9yIChjb25zdCBoYWJpdElkIG9mIGhhYml0SWRzKSB7XG4gICAgICAgICAgICAgICAgcmVzdWx0W2hhYml0SWRdID0gYXdhaXQgdGhpcy5nZXRIYWJpdE1pbGVzdG9uZUJhZGdlcyh1c2VySWQsIGhhYml0SWQpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgY29uc3QgbWVzc2FnZSA9IGdldFVzZXJGcmllbmRseUVycm9yTWVzc2FnZShlcnJvcik7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYEZhaWxlZCB0byBnZXQgbXVsdGktaGFiaXQgbWlsZXN0b25lIGJhZGdlczogJHttZXNzYWdlfWApO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQ2hlY2sgaWYgYSBtaWxlc3RvbmUgc2hvdWxkIHRyaWdnZXIgYSBjZWxlYnJhdGlvblxuICAgICAqIFJlcXVpcmVtZW50czogMy4xLCAzLjJcbiAgICAgKi9cbiAgICBzaG91bGRUcmlnZ2VyQ2VsZWJyYXRpb24obWlsZXN0b25lOiBTdHJlYWtNaWxlc3RvbmUpOiBib29sZWFuIHtcbiAgICAgICAgLy8gT25seSB0cmlnZ2VyIGNlbGVicmF0aW9uIGZvciB1bmNlbGVicmF0ZWQgbWlsZXN0b25lc1xuICAgICAgICByZXR1cm4gIW1pbGVzdG9uZS5jZWxlYnJhdGVkO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEdldCB0aGUgbmV4dCBtaWxlc3RvbmUgdGFyZ2V0IGZvciBhIGdpdmVuIHN0cmVha1xuICAgICAqIFJlcXVpcmVtZW50czogNy4yIChmb3IgbW90aXZhdGlvbilcbiAgICAgKi9cbiAgICBnZXROZXh0TWlsZXN0b25lVGFyZ2V0KGN1cnJlbnRTdHJlYWs6IG51bWJlcik6IG51bWJlciB8IG51bGwge1xuICAgICAgICBmb3IgKGNvbnN0IG1pbGVzdG9uZURheSBvZiBNSUxFU1RPTkVfREFZUykge1xuICAgICAgICAgICAgaWYgKGN1cnJlbnRTdHJlYWsgPCBtaWxlc3RvbmVEYXkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gbWlsZXN0b25lRGF5O1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBudWxsOyAvLyBBbHJlYWR5IGFjaGlldmVkIGFsbCBtaWxlc3RvbmVzXG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogR2V0IHByb2dyZXNzIHRvd2FyZHMgbmV4dCBtaWxlc3RvbmVcbiAgICAgKiBSZXF1aXJlbWVudHM6IDcuMlxuICAgICAqL1xuICAgIGdldE1pbGVzdG9uZVByb2dyZXNzKGN1cnJlbnRTdHJlYWs6IG51bWJlcik6IE1pbGVzdG9uZVByb2dyZXNzIHwgbnVsbCB7XG4gICAgICAgIGNvbnN0IG5leHRUYXJnZXQgPSB0aGlzLmdldE5leHRNaWxlc3RvbmVUYXJnZXQoY3VycmVudFN0cmVhayk7XG5cbiAgICAgICAgaWYgKCFuZXh0VGFyZ2V0KSB7XG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IHByZXZpb3VzVGFyZ2V0ID1cbiAgICAgICAgICAgIE1JTEVTVE9ORV9EQVlTLmZpbmQoXG4gICAgICAgICAgICAgICAgKGRheXMsIGluZGV4KSA9PiBNSUxFU1RPTkVfREFZU1tpbmRleCArIDFdID09PSBuZXh0VGFyZ2V0LFxuICAgICAgICAgICAgKSB8fCAwO1xuXG4gICAgICAgIGNvbnN0IHByb2dyZXNzID0gY3VycmVudFN0cmVhayAtIHByZXZpb3VzVGFyZ2V0O1xuICAgICAgICBjb25zdCB0b3RhbCA9IG5leHRUYXJnZXQgLSBwcmV2aW91c1RhcmdldDtcbiAgICAgICAgY29uc3QgcGVyY2VudGFnZSA9IE1hdGgucm91bmQoKHByb2dyZXNzIC8gdG90YWwpICogMTAwKTtcblxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgY3VycmVudFN0cmVhayxcbiAgICAgICAgICAgIG5leHRUYXJnZXQsXG4gICAgICAgICAgICBwcm9ncmVzcyxcbiAgICAgICAgICAgIHRvdGFsLFxuICAgICAgICAgICAgcGVyY2VudGFnZSxcbiAgICAgICAgICAgIGRheXNSZW1haW5pbmc6IG5leHRUYXJnZXQgLSBjdXJyZW50U3RyZWFrLFxuICAgICAgICB9O1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENoZWNrIGlmIG1pbGVzdG9uZSBzaG91bGQgb2ZmZXIgc29jaWFsIHNoYXJpbmdcbiAgICAgKiBSZXF1aXJlbWVudHM6IDguMVxuICAgICAqL1xuICAgIHNob3VsZE9mZmVyU2hhcmluZyhtaWxlc3RvbmVEYXlzOiBudW1iZXIpOiBib29sZWFuIHtcbiAgICAgICAgLy8gT2ZmZXIgc2hhcmluZyBmb3Igc2lnbmlmaWNhbnQgbWlsZXN0b25lc1xuICAgICAgICByZXR1cm4gbWlsZXN0b25lRGF5cyA+PSA3O1xuICAgIH1cblxuICAgIC8vIFByaXZhdGUgaGVscGVyIG1ldGhvZHNcblxuICAgIHByaXZhdGUgZ2V0QmFkZ2VUeXBlKGRheXM6IG51bWJlcik6IEJhZGdlVHlwZSB7XG4gICAgICAgIHN3aXRjaCAoZGF5cykge1xuICAgICAgICAgICAgY2FzZSA3OlxuICAgICAgICAgICAgICAgIHJldHVybiBcImJyb256ZVwiO1xuICAgICAgICAgICAgY2FzZSAzMDpcbiAgICAgICAgICAgICAgICByZXR1cm4gXCJzaWx2ZXJcIjtcbiAgICAgICAgICAgIGNhc2UgNjA6XG4gICAgICAgICAgICAgICAgcmV0dXJuIFwiZ29sZFwiO1xuICAgICAgICAgICAgY2FzZSAxMDA6XG4gICAgICAgICAgICAgICAgcmV0dXJuIFwicGxhdGludW1cIjtcbiAgICAgICAgICAgIGNhc2UgMzY1OlxuICAgICAgICAgICAgICAgIHJldHVybiBcImRpYW1vbmRcIjtcbiAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgcmV0dXJuIFwiYnJvbnplXCI7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwcml2YXRlIGdldE1pbGVzdG9uZVRpdGxlKGRheXM6IG51bWJlcik6IHN0cmluZyB7XG4gICAgICAgIHN3aXRjaCAoZGF5cykge1xuICAgICAgICAgICAgY2FzZSA3OlxuICAgICAgICAgICAgICAgIHJldHVybiBcIldlZWsgV2FycmlvclwiO1xuICAgICAgICAgICAgY2FzZSAzMDpcbiAgICAgICAgICAgICAgICByZXR1cm4gXCJNb250aCBNYXN0ZXJcIjtcbiAgICAgICAgICAgIGNhc2UgNjA6XG4gICAgICAgICAgICAgICAgcmV0dXJuIFwiQ29uc2lzdGVuY3kgQ2hhbXBpb25cIjtcbiAgICAgICAgICAgIGNhc2UgMTAwOlxuICAgICAgICAgICAgICAgIHJldHVybiBcIkNlbnR1cnkgQWNoaWV2ZXJcIjtcbiAgICAgICAgICAgIGNhc2UgMzY1OlxuICAgICAgICAgICAgICAgIHJldHVybiBcIlllYXIgTGVnZW5kXCI7XG4gICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgIHJldHVybiBgJHtkYXlzfSBEYXkgU3RyZWFrYDtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHByaXZhdGUgZ2V0TWlsZXN0b25lRGVzY3JpcHRpb24oZGF5czogbnVtYmVyKTogc3RyaW5nIHtcbiAgICAgICAgc3dpdGNoIChkYXlzKSB7XG4gICAgICAgICAgICBjYXNlIDc6XG4gICAgICAgICAgICAgICAgcmV0dXJuIFwiQ29tcGxldGVkIDcgY29uc2VjdXRpdmUgZGF5c1wiO1xuICAgICAgICAgICAgY2FzZSAzMDpcbiAgICAgICAgICAgICAgICByZXR1cm4gXCJDb21wbGV0ZWQgMzAgY29uc2VjdXRpdmUgZGF5c1wiO1xuICAgICAgICAgICAgY2FzZSA2MDpcbiAgICAgICAgICAgICAgICByZXR1cm4gXCJDb21wbGV0ZWQgNjAgY29uc2VjdXRpdmUgZGF5c1wiO1xuICAgICAgICAgICAgY2FzZSAxMDA6XG4gICAgICAgICAgICAgICAgcmV0dXJuIFwiQ29tcGxldGVkIDEwMCBjb25zZWN1dGl2ZSBkYXlzXCI7XG4gICAgICAgICAgICBjYXNlIDM2NTpcbiAgICAgICAgICAgICAgICByZXR1cm4gXCJDb21wbGV0ZWQgYSBmdWxsIHllYXIgb2YgY29uc2lzdGVuY3lcIjtcbiAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgcmV0dXJuIGBDb21wbGV0ZWQgJHtkYXlzfSBjb25zZWN1dGl2ZSBkYXlzYDtcbiAgICAgICAgfVxuICAgIH1cbn1cblxuLy8gVHlwZXMgZm9yIG1pbGVzdG9uZSBiYWRnZXMgYW5kIGNvdW50c1xuZXhwb3J0IGludGVyZmFjZSBNaWxlc3RvbmVCYWRnZSB7XG4gICAgZGF5czogbnVtYmVyO1xuICAgIGFjaGlldmVkQXQ6IFRpbWVzdGFtcDtcbiAgICBjZWxlYnJhdGVkOiBib29sZWFuO1xuICAgIGJhZGdlVHlwZTogQmFkZ2VUeXBlO1xuICAgIHRpdGxlOiBzdHJpbmc7XG4gICAgZGVzY3JpcHRpb246IHN0cmluZztcbn1cblxuZXhwb3J0IGludGVyZmFjZSBNaWxlc3RvbmVDb3VudCB7XG4gICAgdG90YWw6IG51bWJlcjtcbiAgICBicmVha2Rvd246IFJlY29yZDxudW1iZXIsIG51bWJlcj47XG4gICAgbGFzdFVwZGF0ZWQ6IFRpbWVzdGFtcDtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBNaWxlc3RvbmVQcm9ncmVzcyB7XG4gICAgY3VycmVudFN0cmVhazogbnVtYmVyO1xuICAgIG5leHRUYXJnZXQ6IG51bWJlcjtcbiAgICBwcm9ncmVzczogbnVtYmVyO1xuICAgIHRvdGFsOiBudW1iZXI7XG4gICAgcGVyY2VudGFnZTogbnVtYmVyO1xuICAgIGRheXNSZW1haW5pbmc6IG51bWJlcjtcbn1cblxuZXhwb3J0IHR5cGUgQmFkZ2VUeXBlID0gXCJicm9uemVcIiB8IFwic2lsdmVyXCIgfCBcImdvbGRcIiB8IFwicGxhdGludW1cIiB8IFwiZGlhbW9uZFwiO1xuXG4vLyBFeHBvcnQgc2luZ2xldG9uIGluc3RhbmNlXG5leHBvcnQgY29uc3QgbWlsZXN0b25lU2VydmljZSA9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