{"version":3,"names":["_firestore","require","_firebaseConfig","_habitStreaks","_celebrations","_errorHandling","_collections","_habitStreakSchemas","MilestoneService","exports","_classCallCheck2","default","_createClass2","key","value","_triggerMilestoneCelebration","_asyncToGenerator2","userId","habitId","habitDescription","milestone","offerSharing","arguments","length","undefined","Error","markMilestoneCelebrated","days","celebrationManager","celebrateGoalCompletion","celebrateStreakMilestone","console","log","shouldOfferSharing","error","message","getUserFriendlyErrorMessage","triggerMilestoneCelebration","_x","_x2","_x3","_x4","apply","_markMilestoneCelebrated","milestoneDays","retryWithBackoff","runTransaction","db","_ref2","transaction","streaksCollection","getHabitStreaksCollection","streakId","streakDocRef","doc","streakDoc","get","exists","streak","transformFirestoreToStreak","data","validateUserOwnership","updatedMilestones","milestones","map","m","Object","assign","celebrated","updatedStreak","streakData","transformStreakToFirestore","set","_x8","_x5","_x6","_x7","_getHabitMilestoneBadges","_this","getDoc","badges","achievedAt","badgeType","getBadgeType","title","getMilestoneTitle","description","getMilestoneDescription","sort","a","b","getHabitMilestoneBadges","_x9","_x0","_getTotalMilestoneCount","userStreaksQuery","query","where","streaksSnapshot","getDocs","totalMilestones","milestoneBreakdown","MILESTONE_DAYS","forEach","docs","total","breakdown","lastUpdated","Timestamp","now","getTotalMilestoneCount","_x1","_getMultiHabitMilestoneBadges","habitIds","result","getMultiHabitMilestoneBadges","_x10","_x11","shouldTriggerCelebration","getNextMilestoneTarget","currentStreak","milestoneDay","getMilestoneProgress","nextTarget","previousTarget","find","index","progress","percentage","Math","round","daysRemaining","milestoneService"],"sources":["milestoneService.ts"],"sourcesContent":["import {\n    doc,\n    getDoc,\n    getDocs,\n    query,\n    runTransaction,\n    Timestamp,\n    where,\n} from \"firebase/firestore\";\nimport { db } from \"../../firebaseConfig\";\nimport {\n    HabitStreak,\n    MILESTONE_DAYS,\n    StreakMilestone,\n} from \"../../types/habit-streaks\";\nimport { celebrationManager } from \"../../utils/celebrations\";\nimport {\n    getUserFriendlyErrorMessage,\n    retryWithBackoff,\n} from \"../../utils/errorHandling\";\nimport { getHabitStreaksCollection } from \"./collections\";\nimport {\n    transformFirestoreToStreak,\n    transformStreakToFirestore,\n    validateUserOwnership,\n} from \"./habitStreakSchemas\";\n\n/**\n * Milestone Service\n *\n * Handles milestone detection, celebration triggering, badge tracking,\n * and milestone count aggregation across habits.\n * Requirements: 3.1, 3.2, 3.3, 3.4, 3.5, 4.4\n */\nexport class MilestoneService {\n    /**\n     * Trigger celebration for a milestone achievement\n     * Requirements: 3.1, 3.2, 8.1\n     */\n    async triggerMilestoneCelebration(\n        userId: string,\n        habitId: string,\n        habitDescription: string,\n        milestone: StreakMilestone,\n        offerSharing: boolean = true,\n    ): Promise<{ shouldOfferSharing: boolean }> {\n        if (!userId || !habitId || !habitDescription || !milestone) {\n            throw new Error(\n                \"User ID, Habit ID, habit description, and milestone are required\",\n            );\n        }\n\n        try {\n            // Mark milestone as celebrated\n            await this.markMilestoneCelebrated(userId, habitId, milestone.days);\n\n            // Trigger celebration animation and haptics\n            if (milestone.days === 7) {\n                // First milestone - basic celebration\n                celebrationManager.celebrateGoalCompletion();\n            } else {\n                // Major milestone - enhanced celebration\n                celebrationManager.celebrateStreakMilestone();\n            }\n\n            // Log celebration for analytics (could be used for notifications)\n            console.log(\n                `Milestone celebration triggered: ${milestone.days} days for habit ${habitId}`,\n            );\n\n            // Return whether to offer sharing (Requirements: 8.1)\n            return {\n                shouldOfferSharing:\n                    offerSharing && this.shouldOfferSharing(milestone.days),\n            };\n        } catch (error) {\n            const message = getUserFriendlyErrorMessage(error);\n            throw new Error(`Failed to trigger milestone celebration: ${message}`);\n        }\n    }\n\n    /**\n     * Mark a milestone as celebrated in the database\n     * Requirements: 3.2\n     */\n    async markMilestoneCelebrated(\n        userId: string,\n        habitId: string,\n        milestoneDays: number,\n    ): Promise<void> {\n        if (!userId || !habitId || !milestoneDays) {\n            throw new Error(\"User ID, Habit ID, and milestone days are required\");\n        }\n\n        try {\n            await retryWithBackoff(async () => {\n                return await runTransaction(db, async (transaction) => {\n                    const streaksCollection = getHabitStreaksCollection();\n                    const streakId = `${userId}_${habitId}`;\n                    const streakDocRef = doc(streaksCollection, streakId);\n                    const streakDoc = await transaction.get(streakDocRef);\n\n                    if (!streakDoc.exists()) {\n                        throw new Error(\"Streak data not found\");\n                    }\n\n                    const streak = transformFirestoreToStreak(streakDoc.data());\n\n                    // Validate user ownership\n                    if (!validateUserOwnership(userId, streak.userId)) {\n                        throw new Error(\"Unauthorized access to streak data\");\n                    }\n\n                    // Update the milestone to mark it as celebrated\n                    const updatedMilestones = streak.milestones.map((m) =>\n                        m.days === milestoneDays ? { ...m, celebrated: true } : m,\n                    );\n\n                    const updatedStreak: HabitStreak = {\n                        ...streak,\n                        milestones: updatedMilestones,\n                    };\n\n                    const streakData = transformStreakToFirestore(updatedStreak);\n                    transaction.set(streakDocRef, streakData);\n                });\n            });\n        } catch (error) {\n            const message = getUserFriendlyErrorMessage(error);\n            throw new Error(`Failed to mark milestone as celebrated: ${message}`);\n        }\n    }\n\n    /**\n     * Get all milestone badges for a specific habit\n     * Requirements: 3.4\n     */\n    async getHabitMilestoneBadges(\n        userId: string,\n        habitId: string,\n    ): Promise<MilestoneBadge[]> {\n        if (!userId || !habitId) {\n            throw new Error(\"User ID and Habit ID are required\");\n        }\n\n        try {\n            const streaksCollection = getHabitStreaksCollection();\n            const streakId = `${userId}_${habitId}`;\n            const streakDocRef = doc(streaksCollection, streakId);\n            const streakDoc = await getDoc(streakDocRef);\n\n            if (!streakDoc.exists()) {\n                return [];\n            }\n\n            const streak = transformFirestoreToStreak(streakDoc.data());\n\n            // Validate user ownership\n            if (!validateUserOwnership(userId, streak.userId)) {\n                throw new Error(\"Unauthorized access to streak data\");\n            }\n\n            // Transform milestones to badges\n            const badges: MilestoneBadge[] = streak.milestones.map((milestone) => ({\n                days: milestone.days,\n                achievedAt: milestone.achievedAt,\n                celebrated: milestone.celebrated,\n                badgeType: this.getBadgeType(milestone.days),\n                title: this.getMilestoneTitle(milestone.days),\n                description: this.getMilestoneDescription(milestone.days),\n            }));\n\n            // Sort badges by days achieved\n            return badges.sort((a, b) => a.days - b.days);\n        } catch (error) {\n            const message = getUserFriendlyErrorMessage(error);\n            throw new Error(`Failed to get habit milestone badges: ${message}`);\n        }\n    }\n\n    /**\n     * Get total milestone count across all user habits\n     * Requirements: 3.5\n     */\n    async getTotalMilestoneCount(userId: string): Promise<MilestoneCount> {\n        if (!userId) {\n            throw new Error(\"User ID is required\");\n        }\n\n        try {\n            return await retryWithBackoff(async () => {\n                const streaksCollection = getHabitStreaksCollection();\n                const userStreaksQuery = query(\n                    streaksCollection,\n                    where(\"userId\", \"==\", userId),\n                );\n                const streaksSnapshot = await getDocs(userStreaksQuery);\n\n                let totalMilestones = 0;\n                const milestoneBreakdown: Record<number, number> = {};\n\n                // Initialize milestone breakdown\n                MILESTONE_DAYS.forEach((days) => {\n                    milestoneBreakdown[days] = 0;\n                });\n\n                // Count milestones across all habits\n                streaksSnapshot.docs.forEach((doc) => {\n                    const streak = transformFirestoreToStreak(doc.data());\n\n                    streak.milestones.forEach((milestone) => {\n                        totalMilestones++;\n                        milestoneBreakdown[milestone.days] =\n                            (milestoneBreakdown[milestone.days] || 0) + 1;\n                    });\n                });\n\n                return {\n                    total: totalMilestones,\n                    breakdown: milestoneBreakdown,\n                    lastUpdated: Timestamp.now(),\n                };\n            });\n        } catch (error) {\n            const message = getUserFriendlyErrorMessage(error);\n            throw new Error(`Failed to get total milestone count: ${message}`);\n        }\n    }\n\n    /**\n     * Get milestone badges for multiple habits (for dashboard display)\n     * Requirements: 3.4\n     */\n    async getMultiHabitMilestoneBadges(\n        userId: string,\n        habitIds: string[],\n    ): Promise<Record<string, MilestoneBadge[]>> {\n        if (!userId || !habitIds || habitIds.length === 0) {\n            throw new Error(\"User ID and habit IDs are required\");\n        }\n\n        try {\n            const result: Record<string, MilestoneBadge[]> = {};\n\n            // Get badges for each habit\n            for (const habitId of habitIds) {\n                result[habitId] = await this.getHabitMilestoneBadges(userId, habitId);\n            }\n\n            return result;\n        } catch (error) {\n            const message = getUserFriendlyErrorMessage(error);\n            throw new Error(`Failed to get multi-habit milestone badges: ${message}`);\n        }\n    }\n\n    /**\n     * Check if a milestone should trigger a celebration\n     * Requirements: 3.1, 3.2\n     */\n    shouldTriggerCelebration(milestone: StreakMilestone): boolean {\n        // Only trigger celebration for uncelebrated milestones\n        return !milestone.celebrated;\n    }\n\n    /**\n     * Get the next milestone target for a given streak\n     * Requirements: 7.2 (for motivation)\n     */\n    getNextMilestoneTarget(currentStreak: number): number | null {\n        for (const milestoneDay of MILESTONE_DAYS) {\n            if (currentStreak < milestoneDay) {\n                return milestoneDay;\n            }\n        }\n        return null; // Already achieved all milestones\n    }\n\n    /**\n     * Get progress towards next milestone\n     * Requirements: 7.2\n     */\n    getMilestoneProgress(currentStreak: number): MilestoneProgress | null {\n        const nextTarget = this.getNextMilestoneTarget(currentStreak);\n\n        if (!nextTarget) {\n            return null;\n        }\n\n        const previousTarget =\n            MILESTONE_DAYS.find(\n                (days, index) => MILESTONE_DAYS[index + 1] === nextTarget,\n            ) || 0;\n\n        const progress = currentStreak - previousTarget;\n        const total = nextTarget - previousTarget;\n        const percentage = Math.round((progress / total) * 100);\n\n        return {\n            currentStreak,\n            nextTarget,\n            progress,\n            total,\n            percentage,\n            daysRemaining: nextTarget - currentStreak,\n        };\n    }\n\n    /**\n     * Check if milestone should offer social sharing\n     * Requirements: 8.1\n     */\n    shouldOfferSharing(milestoneDays: number): boolean {\n        // Offer sharing for significant milestones\n        return milestoneDays >= 7;\n    }\n\n    // Private helper methods\n\n    private getBadgeType(days: number): BadgeType {\n        switch (days) {\n            case 7:\n                return \"bronze\";\n            case 30:\n                return \"silver\";\n            case 60:\n                return \"gold\";\n            case 100:\n                return \"platinum\";\n            case 365:\n                return \"diamond\";\n            default:\n                return \"bronze\";\n        }\n    }\n\n    private getMilestoneTitle(days: number): string {\n        switch (days) {\n            case 7:\n                return \"Week Warrior\";\n            case 30:\n                return \"Month Master\";\n            case 60:\n                return \"Consistency Champion\";\n            case 100:\n                return \"Century Achiever\";\n            case 365:\n                return \"Year Legend\";\n            default:\n                return `${days} Day Streak`;\n        }\n    }\n\n    private getMilestoneDescription(days: number): string {\n        switch (days) {\n            case 7:\n                return \"Completed 7 consecutive days\";\n            case 30:\n                return \"Completed 30 consecutive days\";\n            case 60:\n                return \"Completed 60 consecutive days\";\n            case 100:\n                return \"Completed 100 consecutive days\";\n            case 365:\n                return \"Completed a full year of consistency\";\n            default:\n                return `Completed ${days} consecutive days`;\n        }\n    }\n}\n\n// Types for milestone badges and counts\nexport interface MilestoneBadge {\n    days: number;\n    achievedAt: Timestamp;\n    celebrated: boolean;\n    badgeType: BadgeType;\n    title: string;\n    description: string;\n}\n\nexport interface MilestoneCount {\n    total: number;\n    breakdown: Record<number, number>;\n    lastUpdated: Timestamp;\n}\n\nexport interface MilestoneProgress {\n    currentStreak: number;\n    nextTarget: number;\n    progress: number;\n    total: number;\n    percentage: number;\n    daysRemaining: number;\n}\n\nexport type BadgeType = \"bronze\" | \"silver\" | \"gold\" | \"platinum\" | \"diamond\";\n\n// Export singleton instance\nexport const milestoneService = new MilestoneService();\n"],"mappings":"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","ignoreList":[]}