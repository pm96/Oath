{"version":3,"names":["_asyncStorage","_interopRequireDefault","require","_firestore","_errorHandling","_streakService","_syncService","OfflineStreakService","exports","_classCallCheck2","default","streakService","StreakService","_createClass2","key","value","_recordCompletion","_asyncToGenerator2","completion","online","isOnline","result","recordCompletion","cacheCompletion","error","console","warn","recordCompletionOffline","_x","apply","arguments","_recordCompletionOffline","tempId","Date","now","Math","random","toString","substr","offlineCompletion","Object","assign","id","syncService","queueOperation","type","action","data","userId","habitId","_x2","_calculateStreak","streak","calculateStreak","cacheStreak","getStreakFromCache","_x3","_x4","_getStreakFromCache","cacheKey","CACHE_PREFIX","cachedData","AsyncStorage","getItem","parsed","JSON","parse","milestones","map","m","achievedAt","Timestamp","fromMillis","currentStreak","bestStreak","lastCompletionDate","streakStartDate","freezesAvailable","freezesUsed","_x5","_x6","_useStreakFreeze","missedDate","useStreakFreeze","updatedStreak","getHabitStreak","useStreakFreezeOffline","_x7","_x8","_x9","_useStreakFreezeOffline","cachedStreak","_x0","_x1","_x10","_getHabitCalendar","days","timezone","calendar","getHabitCalendar","cacheCalendar","getCalendarFromCache","_x11","_x12","_x13","_x14","_cacheCompletion","serialized","completedAt","toMillis","setItem","stringify","_x15","_cacheStreak","_x16","_cacheCalendar","timestamp","_x17","_x18","_x19","_getCalendarFromCache","cacheAge","_x20","_x21","_clearUserCache","allKeys","getAllKeys","userKeys","filter","startsWith","includes","length","multiRemove","clearUserCache","_x22","_getCacheStats","totalSize","lastUpdated","_unused","totalItems","getCacheStats","_x23","offlineStreakService"],"sources":["offlineStreakService.ts"],"sourcesContent":["/**\n * Offline-Aware Streak Service\n *\n * Wraps the existing StreakService with offline support and caching\n * Requirements: 10.1, 10.2, 10.3, 10.4, 10.5\n */\n\nimport AsyncStorage from \"@react-native-async-storage/async-storage\";\nimport { Timestamp } from \"firebase/firestore\";\nimport { HabitCompletion, HabitStreak } from \"../../types/habit-streaks\";\nimport { isOnline } from \"../../utils/errorHandling\";\nimport { StreakService } from \"./streakService\";\nimport { syncService } from \"./syncService\";\n\n/**\n * Offline-aware wrapper for StreakService\n */\nexport class OfflineStreakService {\n    private streakService: StreakService;\n    private static readonly CACHE_PREFIX = \"@offline_streak_\";\n\n    constructor() {\n        this.streakService = new StreakService();\n    }\n\n    /**\n     * Record completion with offline support\n     * Requirements: 10.4\n     */\n    async recordCompletion(\n        completion: Omit<HabitCompletion, \"id\">,\n    ): Promise<HabitCompletion> {\n        const online = await isOnline();\n\n        if (online) {\n            try {\n                // Try to record online first\n                const result = await this.streakService.recordCompletion(completion);\n\n                // Cache the successful result\n                await this.cacheCompletion(result);\n\n                return result;\n            } catch (error) {\n                console.warn(\n                    \"Online completion failed, falling back to offline mode:\",\n                    error,\n                );\n                return await this.recordCompletionOffline(completion);\n            }\n        } else {\n            return await this.recordCompletionOffline(completion);\n        }\n    }\n\n    /**\n     * Record completion in offline mode\n     * Requirements: 10.4\n     */\n    private async recordCompletionOffline(\n        completion: Omit<HabitCompletion, \"id\">,\n    ): Promise<HabitCompletion> {\n        // Generate temporary ID for offline completion\n        const tempId = `offline_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;\n\n        const offlineCompletion: HabitCompletion = {\n            ...completion,\n            id: tempId,\n        };\n\n        // Cache the completion locally\n        await this.cacheCompletion(offlineCompletion);\n\n        // Queue for sync when online\n        await syncService.queueOperation({\n            type: \"completion\",\n            action: \"create\",\n            data: completion,\n            userId: completion.userId,\n            habitId: completion.habitId,\n        });\n\n        return offlineCompletion;\n    }\n\n    /**\n     * Calculate streak with offline support\n     * Requirements: 10.3, 10.4\n     */\n    async calculateStreak(habitId: string, userId: string): Promise<HabitStreak> {\n        const online = await isOnline();\n\n        if (online) {\n            try {\n                // Try to get fresh data from server\n                const streak = await this.streakService.calculateStreak(\n                    habitId,\n                    userId,\n                );\n\n                // Cache the result\n                await this.cacheStreak(streak);\n\n                return streak;\n            } catch (error) {\n                console.warn(\n                    \"Online streak calculation failed, using cached data:\",\n                    error,\n                );\n                return await this.getStreakFromCache(habitId, userId);\n            }\n        } else {\n            return await this.getStreakFromCache(habitId, userId);\n        }\n    }\n\n    /**\n     * Get streak from cache with fallback\n     * Requirements: 10.3\n     */\n    private async getStreakFromCache(\n        habitId: string,\n        userId: string,\n    ): Promise<HabitStreak> {\n        const cacheKey = `${OfflineStreakService.CACHE_PREFIX}streak_${userId}_${habitId}`;\n\n        try {\n            const cachedData = await AsyncStorage.getItem(cacheKey);\n            if (cachedData) {\n                const parsed = JSON.parse(cachedData);\n\n                // Convert timestamp fields back to Timestamp objects\n                if (parsed.milestones) {\n                    parsed.milestones = parsed.milestones.map((m: any) => ({\n                        ...m,\n                        achievedAt: Timestamp.fromMillis(m.achievedAt),\n                    }));\n                }\n\n                return parsed;\n            }\n        } catch (error) {\n            console.error(\"Failed to get streak from cache:\", error);\n        }\n\n        // Return default streak if no cache available\n        return {\n            habitId,\n            userId,\n            currentStreak: 0,\n            bestStreak: 0,\n            lastCompletionDate: \"\",\n            streakStartDate: \"\",\n            freezesAvailable: 0,\n            freezesUsed: 0,\n            milestones: [],\n        };\n    }\n    /**\n     * Use streak freeze with offline support\n     * Requirements: 10.4\n     */\n    async useStreakFreeze(\n        habitId: string,\n        userId: string,\n        missedDate: string,\n    ): Promise<boolean> {\n        const online = await isOnline();\n\n        if (online) {\n            try {\n                const result = await this.streakService.useStreakFreeze(\n                    habitId,\n                    userId,\n                    missedDate,\n                );\n\n                // Update cached streak if successful\n                if (result) {\n                    const updatedStreak = await this.streakService.getHabitStreak(\n                        habitId,\n                        userId,\n                    );\n                    if (updatedStreak) {\n                        await this.cacheStreak(updatedStreak);\n                    }\n                }\n\n                return result;\n            } catch (error) {\n                console.warn(\"Online freeze usage failed, queuing for later:\", error);\n                return await this.useStreakFreezeOffline(habitId, userId, missedDate);\n            }\n        } else {\n            return await this.useStreakFreezeOffline(habitId, userId, missedDate);\n        }\n    }\n\n    /**\n     * Use streak freeze in offline mode\n     * Requirements: 10.4\n     */\n    private async useStreakFreezeOffline(\n        habitId: string,\n        userId: string,\n        missedDate: string,\n    ): Promise<boolean> {\n        // Get cached streak to check freeze availability\n        const cachedStreak = await this.getStreakFromCache(habitId, userId);\n\n        if (cachedStreak.freezesAvailable <= 0) {\n            return false;\n        }\n\n        // Update cached streak optimistically\n        const updatedStreak: HabitStreak = {\n            ...cachedStreak,\n            freezesAvailable: cachedStreak.freezesAvailable - 1,\n            freezesUsed: cachedStreak.freezesUsed + 1,\n        };\n\n        await this.cacheStreak(updatedStreak);\n\n        // Queue the operation for sync\n        await syncService.queueOperation({\n            type: \"streak\",\n            action: \"update\",\n            data: updatedStreak,\n            userId,\n            habitId,\n        });\n\n        return true;\n    }\n\n    /**\n     * Get habit calendar with offline support\n     * Requirements: 10.3, 10.4\n     */\n    async getHabitCalendar(\n        habitId: string,\n        userId: string,\n        days: number,\n        timezone: string,\n    ) {\n        const online = await isOnline();\n\n        if (online) {\n            try {\n                const calendar = await this.streakService.getHabitCalendar(\n                    habitId,\n                    userId,\n                    days,\n                    timezone,\n                );\n\n                // Cache calendar data\n                await this.cacheCalendar(habitId, userId, calendar);\n\n                return calendar;\n            } catch (error) {\n                console.warn(\"Online calendar fetch failed, using cached data:\", error);\n                return await this.getCalendarFromCache(habitId, userId);\n            }\n        } else {\n            return await this.getCalendarFromCache(habitId, userId);\n        }\n    }\n\n    /**\n     * Cache completion data\n     */\n    private async cacheCompletion(completion: HabitCompletion): Promise<void> {\n        const cacheKey = `${OfflineStreakService.CACHE_PREFIX}completion_${completion.id}`;\n\n        try {\n            // Serialize timestamp for storage\n            const serialized = {\n                ...completion,\n                completedAt: completion.completedAt.toMillis(),\n            };\n\n            await AsyncStorage.setItem(cacheKey, JSON.stringify(serialized));\n        } catch (error) {\n            console.error(\"Failed to cache completion:\", error);\n        }\n    }\n\n    /**\n     * Cache streak data\n     */\n    private async cacheStreak(streak: HabitStreak): Promise<void> {\n        const cacheKey = `${OfflineStreakService.CACHE_PREFIX}streak_${streak.userId}_${streak.habitId}`;\n\n        try {\n            // Serialize timestamps for storage\n            const serialized = {\n                ...streak,\n                milestones: streak.milestones.map((m) => ({\n                    ...m,\n                    achievedAt: m.achievedAt.toMillis(),\n                })),\n            };\n\n            await AsyncStorage.setItem(cacheKey, JSON.stringify(serialized));\n        } catch (error) {\n            console.error(\"Failed to cache streak:\", error);\n        }\n    }\n\n    /**\n     * Cache calendar data\n     */\n    private async cacheCalendar(\n        habitId: string,\n        userId: string,\n        calendar: any,\n    ): Promise<void> {\n        const cacheKey = `${OfflineStreakService.CACHE_PREFIX}calendar_${userId}_${habitId}`;\n\n        try {\n            const serialized = {\n                calendar,\n                timestamp: Date.now(),\n            };\n\n            await AsyncStorage.setItem(cacheKey, JSON.stringify(serialized));\n        } catch (error) {\n            console.error(\"Failed to cache calendar:\", error);\n        }\n    }\n\n    /**\n     * Get calendar from cache\n     */\n    private async getCalendarFromCache(habitId: string, userId: string) {\n        const cacheKey = `${OfflineStreakService.CACHE_PREFIX}calendar_${userId}_${habitId}`;\n\n        try {\n            const cachedData = await AsyncStorage.getItem(cacheKey);\n            if (cachedData) {\n                const parsed = JSON.parse(cachedData);\n\n                // Check if cache is not too old (24 hours)\n                const cacheAge = Date.now() - parsed.timestamp;\n                if (cacheAge < 24 * 60 * 60 * 1000) {\n                    return parsed.calendar;\n                }\n            }\n        } catch (error) {\n            console.error(\"Failed to get calendar from cache:\", error);\n        }\n\n        // Return empty calendar if no valid cache\n        return [];\n    }\n\n    /**\n     * Clear all cached data for a user\n     */\n    async clearUserCache(userId: string): Promise<void> {\n        try {\n            // Get all keys and filter for this user\n            const allKeys = await AsyncStorage.getAllKeys();\n            const userKeys = allKeys.filter(\n                (key) =>\n                    key.startsWith(OfflineStreakService.CACHE_PREFIX) &&\n                    key.includes(userId),\n            );\n\n            if (userKeys.length > 0) {\n                await AsyncStorage.multiRemove(userKeys);\n            }\n        } catch (error) {\n            console.error(\"Failed to clear user cache:\", error);\n        }\n    }\n\n    /**\n     * Get cache statistics\n     */\n    async getCacheStats(userId: string): Promise<{\n        totalItems: number;\n        totalSize: number;\n        lastUpdated: number | null;\n    }> {\n        try {\n            const allKeys = await AsyncStorage.getAllKeys();\n            const userKeys = allKeys.filter(\n                (key) =>\n                    key.startsWith(OfflineStreakService.CACHE_PREFIX) &&\n                    key.includes(userId),\n            );\n\n            let totalSize = 0;\n            let lastUpdated: number | null = null;\n\n            for (const key of userKeys) {\n                const data = await AsyncStorage.getItem(key);\n                if (data) {\n                    totalSize += data.length;\n\n                    try {\n                        const parsed = JSON.parse(data);\n                        if (\n                            parsed.timestamp &&\n                            (!lastUpdated || parsed.timestamp > lastUpdated)\n                        ) {\n                            lastUpdated = parsed.timestamp;\n                        }\n                    } catch {\n                        // Ignore parsing errors for timestamp extraction\n                    }\n                }\n            }\n\n            return {\n                totalItems: userKeys.length,\n                totalSize,\n                lastUpdated,\n            };\n        } catch (error) {\n            console.error(\"Failed to get cache stats:\", error);\n            return {\n                totalItems: 0,\n                totalSize: 0,\n                lastUpdated: null,\n            };\n        }\n    }\n}\n\n// Export singleton instance\nexport const offlineStreakService = new OfflineStreakService();\n"],"mappings":"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","ignoreList":[]}