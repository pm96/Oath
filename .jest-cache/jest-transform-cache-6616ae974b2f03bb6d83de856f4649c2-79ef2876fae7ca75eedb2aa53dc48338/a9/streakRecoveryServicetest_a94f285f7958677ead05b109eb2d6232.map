{"version":3,"names":["_streakRecoveryService","require","describe","service","beforeEach","StreakRecoveryService","it","message","generateBrokenStreakMessage","expect","type","toBe","title","toBeTruthy","toContain","actionText","reminderOffered","generateRestartEncouragement","targetStreak","generateAchievementPreservationMessage","guidance","generateMultipleBreakGuidance","toHaveLength","actionSteps","length","toBeGreaterThan","types","map","g","generateRestartReminderOffer","streak","habitId","userId","currentStreak","bestStreak","lastCompletionDate","streakStartDate","freezesAvailable","freezesUsed","milestones","isStreakBroken","time","getOptimalReminderTime","count","estimateBrokenStreakCount"],"sources":["streakRecoveryService.test.ts"],"sourcesContent":["import { StreakRecoveryService } from \"../services/firebase/streakRecoveryService\";\nimport { HabitStreak } from \"../types/habit-streaks\";\n\ndescribe(\"StreakRecoveryService\", () => {\n    let service: StreakRecoveryService;\n\n    beforeEach(() => {\n        service = new StreakRecoveryService();\n    });\n\n    describe(\"generateBrokenStreakMessage\", () => {\n        it(\"should generate motivational message for broken streak\", () => {\n            const message = service.generateBrokenStreakMessage(\n                \"habit123\",\n                15,\n                \"Daily Exercise\",\n            );\n\n            expect(message.type).toBe(\"broken_streak\");\n            expect(message.title).toBeTruthy();\n            expect(message.message).toContain(\"Daily Exercise\");\n            expect(message.message).toContain(\"15\");\n            expect(message.actionText).toBe(\"Start Fresh Today\");\n            expect(message.reminderOffered).toBe(true);\n        });\n    });\n\n    describe(\"generateRestartEncouragement\", () => {\n        it(\"should generate encouragement with target streak\", () => {\n            const message = service.generateRestartEncouragement(\n                \"habit123\",\n                20,\n                \"Meditation\",\n            );\n\n            expect(message.type).toBe(\"restart_encouragement\");\n            expect(message.title).toBeTruthy();\n            expect(message.message).toContain(\"Meditation\");\n            expect(message.message).toContain(\"20\");\n            expect(message.targetStreak).toBe(21); // bestStreak + 1\n            expect(message.actionText).toContain(\"21 Days\");\n        });\n    });\n\n    describe(\"generateAchievementPreservationMessage\", () => {\n        it(\"should generate achievement preservation message\", () => {\n            const message = service.generateAchievementPreservationMessage(\n                \"habit123\",\n                30,\n                45,\n                \"Reading\",\n            );\n\n            expect(message.type).toBe(\"achievement_preservation\");\n            expect(message.title).toBe(\"Your Progress Still Counts! ðŸ…\");\n            expect(message.message).toContain(\"Reading\");\n            expect(message.message).toContain(\"45 times\");\n            expect(message.message).toContain(\"30-day streak\");\n            expect(message.actionText).toBe(\"View My Achievements\");\n        });\n    });\n\n    describe(\"generateMultipleBreakGuidance\", () => {\n        it(\"should provide no guidance for single break\", () => {\n            const guidance = service.generateMultipleBreakGuidance(1);\n            expect(guidance).toHaveLength(0);\n        });\n\n        it(\"should provide habit stacking for 2+ breaks\", () => {\n            const guidance = service.generateMultipleBreakGuidance(2);\n            expect(guidance).toHaveLength(1);\n            expect(guidance[0].type).toBe(\"habit_stacking\");\n            expect(guidance[0].title).toBe(\"Try Habit Stacking\");\n            expect(guidance[0].actionSteps).toHaveLength(4);\n        });\n\n        it(\"should provide multiple strategies for many breaks\", () => {\n            const guidance = service.generateMultipleBreakGuidance(5);\n            expect(guidance.length).toBeGreaterThan(1);\n\n            const types = guidance.map((g) => g.type);\n            expect(types).toContain(\"habit_stacking\");\n            expect(types).toContain(\"easier_goals\");\n            expect(types).toContain(\"schedule_adjustment\");\n            expect(types).toContain(\"accountability_partner\");\n        });\n    });\n\n    describe(\"generateRestartReminderOffer\", () => {\n        it(\"should generate restart reminder offer\", () => {\n            const message = service.generateRestartReminderOffer(\n                \"habit123\",\n                \"Journaling\",\n                \"UTC\",\n            );\n\n            expect(message.type).toBe(\"restart_reminder\");\n            expect(message.title).toBe(\"Set a Restart Reminder? â°\");\n            expect(message.message).toContain(\"Journaling\");\n            expect(message.actionText).toBe(\"Set Reminder\");\n            expect(message.reminderOffered).toBe(true);\n        });\n    });\n\n    describe(\"isStreakBroken\", () => {\n        it(\"should return true for zero current streak\", () => {\n            const streak: HabitStreak = {\n                habitId: \"habit123\",\n                userId: \"user456\",\n                currentStreak: 0,\n                bestStreak: 10,\n                lastCompletionDate: \"\",\n                streakStartDate: \"2024-01-01\",\n                freezesAvailable: 0,\n                freezesUsed: 0,\n                milestones: [],\n            };\n\n            expect(service.isStreakBroken(streak)).toBe(true);\n        });\n\n        it(\"should return true for old last completion date\", () => {\n            const streak: HabitStreak = {\n                habitId: \"habit123\",\n                userId: \"user456\",\n                currentStreak: 5,\n                bestStreak: 10,\n                lastCompletionDate: \"2024-01-01\", // Old date\n                streakStartDate: \"2024-01-01\",\n                freezesAvailable: 0,\n                freezesUsed: 0,\n                milestones: [],\n            };\n\n            expect(service.isStreakBroken(streak)).toBe(true);\n        });\n    });\n\n    describe(\"getOptimalReminderTime\", () => {\n        it(\"should suggest morning time for exercise habits\", () => {\n            const time = (service as any).getOptimalReminderTime(\"Daily Exercise\");\n            expect(time).toBe(\"08:00\");\n        });\n\n        it(\"should suggest evening time for reflection habits\", () => {\n            const time = (service as any).getOptimalReminderTime(\n                \"Evening Reflection\",\n            );\n            expect(time).toBe(\"20:00\");\n        });\n\n        it(\"should suggest default time for unknown habits\", () => {\n            const time = (service as any).getOptimalReminderTime(\"Unknown Habit\");\n            expect(time).toBe(\"10:00\");\n        });\n    });\n\n    describe(\"estimateBrokenStreakCount\", () => {\n        it(\"should estimate based on performance ratio\", () => {\n            const streak: HabitStreak = {\n                habitId: \"habit123\",\n                userId: \"user456\",\n                currentStreak: 1,\n                bestStreak: 20, // Performance ratio: 1/20 = 0.05 < 0.1\n                lastCompletionDate: \"2024-01-01\",\n                streakStartDate: \"2024-01-01\",\n                freezesAvailable: 0,\n                freezesUsed: 0,\n                milestones: [],\n            };\n\n            const count = (service as any).estimateBrokenStreakCount(streak);\n            expect(count).toBe(5); // Very poor performance\n        });\n\n        it(\"should return 0 for no best streak\", () => {\n            const streak: HabitStreak = {\n                habitId: \"habit123\",\n                userId: \"user456\",\n                currentStreak: 0,\n                bestStreak: 0,\n                lastCompletionDate: \"\",\n                streakStartDate: \"2024-01-01\",\n                freezesAvailable: 0,\n                freezesUsed: 0,\n                milestones: [],\n            };\n\n            const count = (service as any).estimateBrokenStreakCount(streak);\n            expect(count).toBe(0);\n        });\n    });\n});\n"],"mappings":"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","ignoreList":[]}