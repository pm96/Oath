b6e3d99ead459a00c347198693d0b1cc
var _streakRecoveryService = require("../services/firebase/streakRecoveryService");
describe("StreakRecoveryService", function () {
  var service;
  beforeEach(function () {
    service = new _streakRecoveryService.StreakRecoveryService();
  });
  describe("generateBrokenStreakMessage", function () {
    it("should generate motivational message for broken streak", function () {
      var message = service.generateBrokenStreakMessage("habit123", 15, "Daily Exercise");
      expect(message.type).toBe("broken_streak");
      expect(message.title).toBeTruthy();
      expect(message.message).toContain("Daily Exercise");
      expect(message.message).toContain("15");
      expect(message.actionText).toBe("Start Fresh Today");
      expect(message.reminderOffered).toBe(true);
    });
  });
  describe("generateRestartEncouragement", function () {
    it("should generate encouragement with target streak", function () {
      var message = service.generateRestartEncouragement("habit123", 20, "Meditation");
      expect(message.type).toBe("restart_encouragement");
      expect(message.title).toBeTruthy();
      expect(message.message).toContain("Meditation");
      expect(message.message).toContain("20");
      expect(message.targetStreak).toBe(21);
      expect(message.actionText).toContain("21 Days");
    });
  });
  describe("generateAchievementPreservationMessage", function () {
    it("should generate achievement preservation message", function () {
      var message = service.generateAchievementPreservationMessage("habit123", 30, 45, "Reading");
      expect(message.type).toBe("achievement_preservation");
      expect(message.title).toBe("Your Progress Still Counts! üèÖ");
      expect(message.message).toContain("Reading");
      expect(message.message).toContain("45 times");
      expect(message.message).toContain("30-day streak");
      expect(message.actionText).toBe("View My Achievements");
    });
  });
  describe("generateMultipleBreakGuidance", function () {
    it("should provide no guidance for single break", function () {
      var guidance = service.generateMultipleBreakGuidance(1);
      expect(guidance).toHaveLength(0);
    });
    it("should provide habit stacking for 2+ breaks", function () {
      var guidance = service.generateMultipleBreakGuidance(2);
      expect(guidance).toHaveLength(1);
      expect(guidance[0].type).toBe("habit_stacking");
      expect(guidance[0].title).toBe("Try Habit Stacking");
      expect(guidance[0].actionSteps).toHaveLength(4);
    });
    it("should provide multiple strategies for many breaks", function () {
      var guidance = service.generateMultipleBreakGuidance(5);
      expect(guidance.length).toBeGreaterThan(1);
      var types = guidance.map(function (g) {
        return g.type;
      });
      expect(types).toContain("habit_stacking");
      expect(types).toContain("easier_goals");
      expect(types).toContain("schedule_adjustment");
      expect(types).toContain("accountability_partner");
    });
  });
  describe("generateRestartReminderOffer", function () {
    it("should generate restart reminder offer", function () {
      var message = service.generateRestartReminderOffer("habit123", "Journaling", "UTC");
      expect(message.type).toBe("restart_reminder");
      expect(message.title).toBe("Set a Restart Reminder? ‚è∞");
      expect(message.message).toContain("Journaling");
      expect(message.actionText).toBe("Set Reminder");
      expect(message.reminderOffered).toBe(true);
    });
  });
  describe("isStreakBroken", function () {
    it("should return true for zero current streak", function () {
      var streak = {
        habitId: "habit123",
        userId: "user456",
        currentStreak: 0,
        bestStreak: 10,
        lastCompletionDate: "",
        streakStartDate: "2024-01-01",
        freezesAvailable: 0,
        freezesUsed: 0,
        milestones: []
      };
      expect(service.isStreakBroken(streak)).toBe(true);
    });
    it("should return true for old last completion date", function () {
      var streak = {
        habitId: "habit123",
        userId: "user456",
        currentStreak: 5,
        bestStreak: 10,
        lastCompletionDate: "2024-01-01",
        streakStartDate: "2024-01-01",
        freezesAvailable: 0,
        freezesUsed: 0,
        milestones: []
      };
      expect(service.isStreakBroken(streak)).toBe(true);
    });
  });
  describe("getOptimalReminderTime", function () {
    it("should suggest morning time for exercise habits", function () {
      var time = service.getOptimalReminderTime("Daily Exercise");
      expect(time).toBe("08:00");
    });
    it("should suggest evening time for reflection habits", function () {
      var time = service.getOptimalReminderTime("Evening Reflection");
      expect(time).toBe("20:00");
    });
    it("should suggest default time for unknown habits", function () {
      var time = service.getOptimalReminderTime("Unknown Habit");
      expect(time).toBe("10:00");
    });
  });
  describe("estimateBrokenStreakCount", function () {
    it("should estimate based on performance ratio", function () {
      var streak = {
        habitId: "habit123",
        userId: "user456",
        currentStreak: 1,
        bestStreak: 20,
        lastCompletionDate: "2024-01-01",
        streakStartDate: "2024-01-01",
        freezesAvailable: 0,
        freezesUsed: 0,
        milestones: []
      };
      var count = service.estimateBrokenStreakCount(streak);
      expect(count).toBe(5);
    });
    it("should return 0 for no best streak", function () {
      var streak = {
        habitId: "habit123",
        userId: "user456",
        currentStreak: 0,
        bestStreak: 0,
        lastCompletionDate: "",
        streakStartDate: "2024-01-01",
        freezesAvailable: 0,
        freezesUsed: 0,
        milestones: []
      };
      var count = service.estimateBrokenStreakCount(streak);
      expect(count).toBe(0);
    });
  });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfc3RyZWFrUmVjb3ZlcnlTZXJ2aWNlIiwicmVxdWlyZSIsImRlc2NyaWJlIiwic2VydmljZSIsImJlZm9yZUVhY2giLCJTdHJlYWtSZWNvdmVyeVNlcnZpY2UiLCJpdCIsIm1lc3NhZ2UiLCJnZW5lcmF0ZUJyb2tlblN0cmVha01lc3NhZ2UiLCJleHBlY3QiLCJ0eXBlIiwidG9CZSIsInRpdGxlIiwidG9CZVRydXRoeSIsInRvQ29udGFpbiIsImFjdGlvblRleHQiLCJyZW1pbmRlck9mZmVyZWQiLCJnZW5lcmF0ZVJlc3RhcnRFbmNvdXJhZ2VtZW50IiwidGFyZ2V0U3RyZWFrIiwiZ2VuZXJhdGVBY2hpZXZlbWVudFByZXNlcnZhdGlvbk1lc3NhZ2UiLCJndWlkYW5jZSIsImdlbmVyYXRlTXVsdGlwbGVCcmVha0d1aWRhbmNlIiwidG9IYXZlTGVuZ3RoIiwiYWN0aW9uU3RlcHMiLCJsZW5ndGgiLCJ0b0JlR3JlYXRlclRoYW4iLCJ0eXBlcyIsIm1hcCIsImciLCJnZW5lcmF0ZVJlc3RhcnRSZW1pbmRlck9mZmVyIiwic3RyZWFrIiwiaGFiaXRJZCIsInVzZXJJZCIsImN1cnJlbnRTdHJlYWsiLCJiZXN0U3RyZWFrIiwibGFzdENvbXBsZXRpb25EYXRlIiwic3RyZWFrU3RhcnREYXRlIiwiZnJlZXplc0F2YWlsYWJsZSIsImZyZWV6ZXNVc2VkIiwibWlsZXN0b25lcyIsImlzU3RyZWFrQnJva2VuIiwidGltZSIsImdldE9wdGltYWxSZW1pbmRlclRpbWUiLCJjb3VudCIsImVzdGltYXRlQnJva2VuU3RyZWFrQ291bnQiXSwic291cmNlcyI6WyJzdHJlYWtSZWNvdmVyeVNlcnZpY2UudGVzdC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBTdHJlYWtSZWNvdmVyeVNlcnZpY2UgfSBmcm9tIFwiLi4vc2VydmljZXMvZmlyZWJhc2Uvc3RyZWFrUmVjb3ZlcnlTZXJ2aWNlXCI7XG5pbXBvcnQgeyBIYWJpdFN0cmVhayB9IGZyb20gXCIuLi90eXBlcy9oYWJpdC1zdHJlYWtzXCI7XG5cbmRlc2NyaWJlKFwiU3RyZWFrUmVjb3ZlcnlTZXJ2aWNlXCIsICgpID0+IHtcbiAgICBsZXQgc2VydmljZTogU3RyZWFrUmVjb3ZlcnlTZXJ2aWNlO1xuXG4gICAgYmVmb3JlRWFjaCgoKSA9PiB7XG4gICAgICAgIHNlcnZpY2UgPSBuZXcgU3RyZWFrUmVjb3ZlcnlTZXJ2aWNlKCk7XG4gICAgfSk7XG5cbiAgICBkZXNjcmliZShcImdlbmVyYXRlQnJva2VuU3RyZWFrTWVzc2FnZVwiLCAoKSA9PiB7XG4gICAgICAgIGl0KFwic2hvdWxkIGdlbmVyYXRlIG1vdGl2YXRpb25hbCBtZXNzYWdlIGZvciBicm9rZW4gc3RyZWFrXCIsICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IG1lc3NhZ2UgPSBzZXJ2aWNlLmdlbmVyYXRlQnJva2VuU3RyZWFrTWVzc2FnZShcbiAgICAgICAgICAgICAgICBcImhhYml0MTIzXCIsXG4gICAgICAgICAgICAgICAgMTUsXG4gICAgICAgICAgICAgICAgXCJEYWlseSBFeGVyY2lzZVwiLFxuICAgICAgICAgICAgKTtcblxuICAgICAgICAgICAgZXhwZWN0KG1lc3NhZ2UudHlwZSkudG9CZShcImJyb2tlbl9zdHJlYWtcIik7XG4gICAgICAgICAgICBleHBlY3QobWVzc2FnZS50aXRsZSkudG9CZVRydXRoeSgpO1xuICAgICAgICAgICAgZXhwZWN0KG1lc3NhZ2UubWVzc2FnZSkudG9Db250YWluKFwiRGFpbHkgRXhlcmNpc2VcIik7XG4gICAgICAgICAgICBleHBlY3QobWVzc2FnZS5tZXNzYWdlKS50b0NvbnRhaW4oXCIxNVwiKTtcbiAgICAgICAgICAgIGV4cGVjdChtZXNzYWdlLmFjdGlvblRleHQpLnRvQmUoXCJTdGFydCBGcmVzaCBUb2RheVwiKTtcbiAgICAgICAgICAgIGV4cGVjdChtZXNzYWdlLnJlbWluZGVyT2ZmZXJlZCkudG9CZSh0cnVlKTtcbiAgICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBkZXNjcmliZShcImdlbmVyYXRlUmVzdGFydEVuY291cmFnZW1lbnRcIiwgKCkgPT4ge1xuICAgICAgICBpdChcInNob3VsZCBnZW5lcmF0ZSBlbmNvdXJhZ2VtZW50IHdpdGggdGFyZ2V0IHN0cmVha1wiLCAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBtZXNzYWdlID0gc2VydmljZS5nZW5lcmF0ZVJlc3RhcnRFbmNvdXJhZ2VtZW50KFxuICAgICAgICAgICAgICAgIFwiaGFiaXQxMjNcIixcbiAgICAgICAgICAgICAgICAyMCxcbiAgICAgICAgICAgICAgICBcIk1lZGl0YXRpb25cIixcbiAgICAgICAgICAgICk7XG5cbiAgICAgICAgICAgIGV4cGVjdChtZXNzYWdlLnR5cGUpLnRvQmUoXCJyZXN0YXJ0X2VuY291cmFnZW1lbnRcIik7XG4gICAgICAgICAgICBleHBlY3QobWVzc2FnZS50aXRsZSkudG9CZVRydXRoeSgpO1xuICAgICAgICAgICAgZXhwZWN0KG1lc3NhZ2UubWVzc2FnZSkudG9Db250YWluKFwiTWVkaXRhdGlvblwiKTtcbiAgICAgICAgICAgIGV4cGVjdChtZXNzYWdlLm1lc3NhZ2UpLnRvQ29udGFpbihcIjIwXCIpO1xuICAgICAgICAgICAgZXhwZWN0KG1lc3NhZ2UudGFyZ2V0U3RyZWFrKS50b0JlKDIxKTsgLy8gYmVzdFN0cmVhayArIDFcbiAgICAgICAgICAgIGV4cGVjdChtZXNzYWdlLmFjdGlvblRleHQpLnRvQ29udGFpbihcIjIxIERheXNcIik7XG4gICAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgZGVzY3JpYmUoXCJnZW5lcmF0ZUFjaGlldmVtZW50UHJlc2VydmF0aW9uTWVzc2FnZVwiLCAoKSA9PiB7XG4gICAgICAgIGl0KFwic2hvdWxkIGdlbmVyYXRlIGFjaGlldmVtZW50IHByZXNlcnZhdGlvbiBtZXNzYWdlXCIsICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IG1lc3NhZ2UgPSBzZXJ2aWNlLmdlbmVyYXRlQWNoaWV2ZW1lbnRQcmVzZXJ2YXRpb25NZXNzYWdlKFxuICAgICAgICAgICAgICAgIFwiaGFiaXQxMjNcIixcbiAgICAgICAgICAgICAgICAzMCxcbiAgICAgICAgICAgICAgICA0NSxcbiAgICAgICAgICAgICAgICBcIlJlYWRpbmdcIixcbiAgICAgICAgICAgICk7XG5cbiAgICAgICAgICAgIGV4cGVjdChtZXNzYWdlLnR5cGUpLnRvQmUoXCJhY2hpZXZlbWVudF9wcmVzZXJ2YXRpb25cIik7XG4gICAgICAgICAgICBleHBlY3QobWVzc2FnZS50aXRsZSkudG9CZShcIllvdXIgUHJvZ3Jlc3MgU3RpbGwgQ291bnRzISDwn4+FXCIpO1xuICAgICAgICAgICAgZXhwZWN0KG1lc3NhZ2UubWVzc2FnZSkudG9Db250YWluKFwiUmVhZGluZ1wiKTtcbiAgICAgICAgICAgIGV4cGVjdChtZXNzYWdlLm1lc3NhZ2UpLnRvQ29udGFpbihcIjQ1IHRpbWVzXCIpO1xuICAgICAgICAgICAgZXhwZWN0KG1lc3NhZ2UubWVzc2FnZSkudG9Db250YWluKFwiMzAtZGF5IHN0cmVha1wiKTtcbiAgICAgICAgICAgIGV4cGVjdChtZXNzYWdlLmFjdGlvblRleHQpLnRvQmUoXCJWaWV3IE15IEFjaGlldmVtZW50c1wiKTtcbiAgICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBkZXNjcmliZShcImdlbmVyYXRlTXVsdGlwbGVCcmVha0d1aWRhbmNlXCIsICgpID0+IHtcbiAgICAgICAgaXQoXCJzaG91bGQgcHJvdmlkZSBubyBndWlkYW5jZSBmb3Igc2luZ2xlIGJyZWFrXCIsICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGd1aWRhbmNlID0gc2VydmljZS5nZW5lcmF0ZU11bHRpcGxlQnJlYWtHdWlkYW5jZSgxKTtcbiAgICAgICAgICAgIGV4cGVjdChndWlkYW5jZSkudG9IYXZlTGVuZ3RoKDApO1xuICAgICAgICB9KTtcblxuICAgICAgICBpdChcInNob3VsZCBwcm92aWRlIGhhYml0IHN0YWNraW5nIGZvciAyKyBicmVha3NcIiwgKCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgZ3VpZGFuY2UgPSBzZXJ2aWNlLmdlbmVyYXRlTXVsdGlwbGVCcmVha0d1aWRhbmNlKDIpO1xuICAgICAgICAgICAgZXhwZWN0KGd1aWRhbmNlKS50b0hhdmVMZW5ndGgoMSk7XG4gICAgICAgICAgICBleHBlY3QoZ3VpZGFuY2VbMF0udHlwZSkudG9CZShcImhhYml0X3N0YWNraW5nXCIpO1xuICAgICAgICAgICAgZXhwZWN0KGd1aWRhbmNlWzBdLnRpdGxlKS50b0JlKFwiVHJ5IEhhYml0IFN0YWNraW5nXCIpO1xuICAgICAgICAgICAgZXhwZWN0KGd1aWRhbmNlWzBdLmFjdGlvblN0ZXBzKS50b0hhdmVMZW5ndGgoNCk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGl0KFwic2hvdWxkIHByb3ZpZGUgbXVsdGlwbGUgc3RyYXRlZ2llcyBmb3IgbWFueSBicmVha3NcIiwgKCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgZ3VpZGFuY2UgPSBzZXJ2aWNlLmdlbmVyYXRlTXVsdGlwbGVCcmVha0d1aWRhbmNlKDUpO1xuICAgICAgICAgICAgZXhwZWN0KGd1aWRhbmNlLmxlbmd0aCkudG9CZUdyZWF0ZXJUaGFuKDEpO1xuXG4gICAgICAgICAgICBjb25zdCB0eXBlcyA9IGd1aWRhbmNlLm1hcCgoZykgPT4gZy50eXBlKTtcbiAgICAgICAgICAgIGV4cGVjdCh0eXBlcykudG9Db250YWluKFwiaGFiaXRfc3RhY2tpbmdcIik7XG4gICAgICAgICAgICBleHBlY3QodHlwZXMpLnRvQ29udGFpbihcImVhc2llcl9nb2Fsc1wiKTtcbiAgICAgICAgICAgIGV4cGVjdCh0eXBlcykudG9Db250YWluKFwic2NoZWR1bGVfYWRqdXN0bWVudFwiKTtcbiAgICAgICAgICAgIGV4cGVjdCh0eXBlcykudG9Db250YWluKFwiYWNjb3VudGFiaWxpdHlfcGFydG5lclwiKTtcbiAgICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBkZXNjcmliZShcImdlbmVyYXRlUmVzdGFydFJlbWluZGVyT2ZmZXJcIiwgKCkgPT4ge1xuICAgICAgICBpdChcInNob3VsZCBnZW5lcmF0ZSByZXN0YXJ0IHJlbWluZGVyIG9mZmVyXCIsICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IG1lc3NhZ2UgPSBzZXJ2aWNlLmdlbmVyYXRlUmVzdGFydFJlbWluZGVyT2ZmZXIoXG4gICAgICAgICAgICAgICAgXCJoYWJpdDEyM1wiLFxuICAgICAgICAgICAgICAgIFwiSm91cm5hbGluZ1wiLFxuICAgICAgICAgICAgICAgIFwiVVRDXCIsXG4gICAgICAgICAgICApO1xuXG4gICAgICAgICAgICBleHBlY3QobWVzc2FnZS50eXBlKS50b0JlKFwicmVzdGFydF9yZW1pbmRlclwiKTtcbiAgICAgICAgICAgIGV4cGVjdChtZXNzYWdlLnRpdGxlKS50b0JlKFwiU2V0IGEgUmVzdGFydCBSZW1pbmRlcj8g4o+wXCIpO1xuICAgICAgICAgICAgZXhwZWN0KG1lc3NhZ2UubWVzc2FnZSkudG9Db250YWluKFwiSm91cm5hbGluZ1wiKTtcbiAgICAgICAgICAgIGV4cGVjdChtZXNzYWdlLmFjdGlvblRleHQpLnRvQmUoXCJTZXQgUmVtaW5kZXJcIik7XG4gICAgICAgICAgICBleHBlY3QobWVzc2FnZS5yZW1pbmRlck9mZmVyZWQpLnRvQmUodHJ1ZSk7XG4gICAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgZGVzY3JpYmUoXCJpc1N0cmVha0Jyb2tlblwiLCAoKSA9PiB7XG4gICAgICAgIGl0KFwic2hvdWxkIHJldHVybiB0cnVlIGZvciB6ZXJvIGN1cnJlbnQgc3RyZWFrXCIsICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHN0cmVhazogSGFiaXRTdHJlYWsgPSB7XG4gICAgICAgICAgICAgICAgaGFiaXRJZDogXCJoYWJpdDEyM1wiLFxuICAgICAgICAgICAgICAgIHVzZXJJZDogXCJ1c2VyNDU2XCIsXG4gICAgICAgICAgICAgICAgY3VycmVudFN0cmVhazogMCxcbiAgICAgICAgICAgICAgICBiZXN0U3RyZWFrOiAxMCxcbiAgICAgICAgICAgICAgICBsYXN0Q29tcGxldGlvbkRhdGU6IFwiXCIsXG4gICAgICAgICAgICAgICAgc3RyZWFrU3RhcnREYXRlOiBcIjIwMjQtMDEtMDFcIixcbiAgICAgICAgICAgICAgICBmcmVlemVzQXZhaWxhYmxlOiAwLFxuICAgICAgICAgICAgICAgIGZyZWV6ZXNVc2VkOiAwLFxuICAgICAgICAgICAgICAgIG1pbGVzdG9uZXM6IFtdLFxuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgZXhwZWN0KHNlcnZpY2UuaXNTdHJlYWtCcm9rZW4oc3RyZWFrKSkudG9CZSh0cnVlKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgaXQoXCJzaG91bGQgcmV0dXJuIHRydWUgZm9yIG9sZCBsYXN0IGNvbXBsZXRpb24gZGF0ZVwiLCAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBzdHJlYWs6IEhhYml0U3RyZWFrID0ge1xuICAgICAgICAgICAgICAgIGhhYml0SWQ6IFwiaGFiaXQxMjNcIixcbiAgICAgICAgICAgICAgICB1c2VySWQ6IFwidXNlcjQ1NlwiLFxuICAgICAgICAgICAgICAgIGN1cnJlbnRTdHJlYWs6IDUsXG4gICAgICAgICAgICAgICAgYmVzdFN0cmVhazogMTAsXG4gICAgICAgICAgICAgICAgbGFzdENvbXBsZXRpb25EYXRlOiBcIjIwMjQtMDEtMDFcIiwgLy8gT2xkIGRhdGVcbiAgICAgICAgICAgICAgICBzdHJlYWtTdGFydERhdGU6IFwiMjAyNC0wMS0wMVwiLFxuICAgICAgICAgICAgICAgIGZyZWV6ZXNBdmFpbGFibGU6IDAsXG4gICAgICAgICAgICAgICAgZnJlZXplc1VzZWQ6IDAsXG4gICAgICAgICAgICAgICAgbWlsZXN0b25lczogW10sXG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICBleHBlY3Qoc2VydmljZS5pc1N0cmVha0Jyb2tlbihzdHJlYWspKS50b0JlKHRydWUpO1xuICAgICAgICB9KTtcbiAgICB9KTtcblxuICAgIGRlc2NyaWJlKFwiZ2V0T3B0aW1hbFJlbWluZGVyVGltZVwiLCAoKSA9PiB7XG4gICAgICAgIGl0KFwic2hvdWxkIHN1Z2dlc3QgbW9ybmluZyB0aW1lIGZvciBleGVyY2lzZSBoYWJpdHNcIiwgKCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgdGltZSA9IChzZXJ2aWNlIGFzIGFueSkuZ2V0T3B0aW1hbFJlbWluZGVyVGltZShcIkRhaWx5IEV4ZXJjaXNlXCIpO1xuICAgICAgICAgICAgZXhwZWN0KHRpbWUpLnRvQmUoXCIwODowMFwiKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgaXQoXCJzaG91bGQgc3VnZ2VzdCBldmVuaW5nIHRpbWUgZm9yIHJlZmxlY3Rpb24gaGFiaXRzXCIsICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHRpbWUgPSAoc2VydmljZSBhcyBhbnkpLmdldE9wdGltYWxSZW1pbmRlclRpbWUoXG4gICAgICAgICAgICAgICAgXCJFdmVuaW5nIFJlZmxlY3Rpb25cIixcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgICBleHBlY3QodGltZSkudG9CZShcIjIwOjAwXCIpO1xuICAgICAgICB9KTtcblxuICAgICAgICBpdChcInNob3VsZCBzdWdnZXN0IGRlZmF1bHQgdGltZSBmb3IgdW5rbm93biBoYWJpdHNcIiwgKCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgdGltZSA9IChzZXJ2aWNlIGFzIGFueSkuZ2V0T3B0aW1hbFJlbWluZGVyVGltZShcIlVua25vd24gSGFiaXRcIik7XG4gICAgICAgICAgICBleHBlY3QodGltZSkudG9CZShcIjEwOjAwXCIpO1xuICAgICAgICB9KTtcbiAgICB9KTtcblxuICAgIGRlc2NyaWJlKFwiZXN0aW1hdGVCcm9rZW5TdHJlYWtDb3VudFwiLCAoKSA9PiB7XG4gICAgICAgIGl0KFwic2hvdWxkIGVzdGltYXRlIGJhc2VkIG9uIHBlcmZvcm1hbmNlIHJhdGlvXCIsICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHN0cmVhazogSGFiaXRTdHJlYWsgPSB7XG4gICAgICAgICAgICAgICAgaGFiaXRJZDogXCJoYWJpdDEyM1wiLFxuICAgICAgICAgICAgICAgIHVzZXJJZDogXCJ1c2VyNDU2XCIsXG4gICAgICAgICAgICAgICAgY3VycmVudFN0cmVhazogMSxcbiAgICAgICAgICAgICAgICBiZXN0U3RyZWFrOiAyMCwgLy8gUGVyZm9ybWFuY2UgcmF0aW86IDEvMjAgPSAwLjA1IDwgMC4xXG4gICAgICAgICAgICAgICAgbGFzdENvbXBsZXRpb25EYXRlOiBcIjIwMjQtMDEtMDFcIixcbiAgICAgICAgICAgICAgICBzdHJlYWtTdGFydERhdGU6IFwiMjAyNC0wMS0wMVwiLFxuICAgICAgICAgICAgICAgIGZyZWV6ZXNBdmFpbGFibGU6IDAsXG4gICAgICAgICAgICAgICAgZnJlZXplc1VzZWQ6IDAsXG4gICAgICAgICAgICAgICAgbWlsZXN0b25lczogW10sXG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICBjb25zdCBjb3VudCA9IChzZXJ2aWNlIGFzIGFueSkuZXN0aW1hdGVCcm9rZW5TdHJlYWtDb3VudChzdHJlYWspO1xuICAgICAgICAgICAgZXhwZWN0KGNvdW50KS50b0JlKDUpOyAvLyBWZXJ5IHBvb3IgcGVyZm9ybWFuY2VcbiAgICAgICAgfSk7XG5cbiAgICAgICAgaXQoXCJzaG91bGQgcmV0dXJuIDAgZm9yIG5vIGJlc3Qgc3RyZWFrXCIsICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHN0cmVhazogSGFiaXRTdHJlYWsgPSB7XG4gICAgICAgICAgICAgICAgaGFiaXRJZDogXCJoYWJpdDEyM1wiLFxuICAgICAgICAgICAgICAgIHVzZXJJZDogXCJ1c2VyNDU2XCIsXG4gICAgICAgICAgICAgICAgY3VycmVudFN0cmVhazogMCxcbiAgICAgICAgICAgICAgICBiZXN0U3RyZWFrOiAwLFxuICAgICAgICAgICAgICAgIGxhc3RDb21wbGV0aW9uRGF0ZTogXCJcIixcbiAgICAgICAgICAgICAgICBzdHJlYWtTdGFydERhdGU6IFwiMjAyNC0wMS0wMVwiLFxuICAgICAgICAgICAgICAgIGZyZWV6ZXNBdmFpbGFibGU6IDAsXG4gICAgICAgICAgICAgICAgZnJlZXplc1VzZWQ6IDAsXG4gICAgICAgICAgICAgICAgbWlsZXN0b25lczogW10sXG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICBjb25zdCBjb3VudCA9IChzZXJ2aWNlIGFzIGFueSkuZXN0aW1hdGVCcm9rZW5TdHJlYWtDb3VudChzdHJlYWspO1xuICAgICAgICAgICAgZXhwZWN0KGNvdW50KS50b0JlKDApO1xuICAgICAgICB9KTtcbiAgICB9KTtcbn0pO1xuIl0sIm1hcHBpbmdzIjoiQUFBQSxJQUFBQSxzQkFBQSxHQUFBQyxPQUFBO0FBR0FDLFFBQVEsQ0FBQyx1QkFBdUIsRUFBRSxZQUFNO0VBQ3BDLElBQUlDLE9BQThCO0VBRWxDQyxVQUFVLENBQUMsWUFBTTtJQUNiRCxPQUFPLEdBQUcsSUFBSUUsNENBQXFCLENBQUMsQ0FBQztFQUN6QyxDQUFDLENBQUM7RUFFRkgsUUFBUSxDQUFDLDZCQUE2QixFQUFFLFlBQU07SUFDMUNJLEVBQUUsQ0FBQyx3REFBd0QsRUFBRSxZQUFNO01BQy9ELElBQU1DLE9BQU8sR0FBR0osT0FBTyxDQUFDSywyQkFBMkIsQ0FDL0MsVUFBVSxFQUNWLEVBQUUsRUFDRixnQkFDSixDQUFDO01BRURDLE1BQU0sQ0FBQ0YsT0FBTyxDQUFDRyxJQUFJLENBQUMsQ0FBQ0MsSUFBSSxDQUFDLGVBQWUsQ0FBQztNQUMxQ0YsTUFBTSxDQUFDRixPQUFPLENBQUNLLEtBQUssQ0FBQyxDQUFDQyxVQUFVLENBQUMsQ0FBQztNQUNsQ0osTUFBTSxDQUFDRixPQUFPLENBQUNBLE9BQU8sQ0FBQyxDQUFDTyxTQUFTLENBQUMsZ0JBQWdCLENBQUM7TUFDbkRMLE1BQU0sQ0FBQ0YsT0FBTyxDQUFDQSxPQUFPLENBQUMsQ0FBQ08sU0FBUyxDQUFDLElBQUksQ0FBQztNQUN2Q0wsTUFBTSxDQUFDRixPQUFPLENBQUNRLFVBQVUsQ0FBQyxDQUFDSixJQUFJLENBQUMsbUJBQW1CLENBQUM7TUFDcERGLE1BQU0sQ0FBQ0YsT0FB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