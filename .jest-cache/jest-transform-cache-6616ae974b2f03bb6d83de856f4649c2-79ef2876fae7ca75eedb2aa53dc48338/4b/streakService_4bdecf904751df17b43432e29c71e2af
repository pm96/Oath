93c9c5b2ece4de76e2c30fe2f1b96e3b
var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault").default;
Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.streakService = exports.StreakService = void 0;
var _toConsumableArray2 = _interopRequireDefault(require("@babel/runtime/helpers/toConsumableArray"));
var _asyncToGenerator2 = _interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));
var _classCallCheck2 = _interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));
var _createClass2 = _interopRequireDefault(require("@babel/runtime/helpers/createClass"));
var _firestore = require("firebase/firestore");
var _firebaseConfig = require("../../firebaseConfig");
var _habitStreaks = require("../../types/habit-streaks");
var _dateUtils = require("../../utils/dateUtils");
var _errorHandling = require("../../utils/errorHandling");
var _collections = require("./collections");
var _dataIntegrityService = require("./dataIntegrityService");
var _habitStreakSchemas = require("./habitStreakSchemas");
var _streakValidationService = require("./streakValidationService");
var _syncService = require("./syncService");
var StreakService = exports.StreakService = function () {
  function StreakService() {
    (0, _classCallCheck2.default)(this, StreakService);
  }
  return (0, _createClass2.default)(StreakService, [{
    key: "calculateStreak",
    value: (function () {
      var _calculateStreak = (0, _asyncToGenerator2.default)(function* (habitId, userId) {
        var _this = this;
        if (!habitId || !userId) {
          throw new Error("Habit ID and User ID are required");
        }
        try {
          return yield (0, _errorHandling.retryWithBackoff)((0, _asyncToGenerator2.default)(function* () {
            return yield (0, _firestore.runTransaction)(_firebaseConfig.db, function () {
              var _ref2 = (0, _asyncToGenerator2.default)(function* (transaction) {
                var streakId = (0, _habitStreakSchemas.generateStreakId)(userId, habitId);
                var streaksCollection = (0, _collections.getHabitStreaksCollection)();
                var streakDocRef = (0, _firestore.doc)(streaksCollection, streakId);
                var streakDoc = yield transaction.get(streakDocRef);
                var completionsCollection = (0, _collections.getHabitCompletionsCollection)();
                var completionsQuery = (0, _firestore.query)(completionsCollection, (0, _firestore.where)("habitId", "==", habitId), (0, _firestore.where)("userId", "==", userId));
                var completionsSnapshot = yield (0, _firestore.getDocs)(completionsQuery);
                var completions = completionsSnapshot.docs.map(function (doc) {
                  return (0, _habitStreakSchemas.transformFirestoreToCompletion)(doc.id, doc.data());
                }).sort(function (a, b) {
                  return a.completedAt.toMillis() - b.completedAt.toMillis();
                });
                var calculatedStreak = _this.calculateStreakFromCompletions(completions, habitId, userId);
                var existingStreak = null;
                if (streakDoc.exists()) {
                  existingStreak = (0, _habitStreakSchemas.transformFirestoreToStreak)(streakDoc.data());
                }
                var updatedStreak = _this.mergeStreakData(calculatedStreak, existingStreak);
                var validationResult = yield _streakValidationService.streakValidationService.validateStreakCalculation(updatedStreak, completions, userId);
                if (!validationResult.isValid) {
                  console.warn("Streak calculation validation failed:", validationResult.errors);
                  yield _streakValidationService.streakValidationService.createAuditLog(userId, "streak_calculation_validation_failed", "streak", streakId, existingStreak, updatedStreak, validationResult);
                  var finalStreak = validationResult.correctedData || updatedStreak;
                  var _streakData = (0, _habitStreakSchemas.transformStreakToFirestore)(finalStreak);
                  transaction.set(streakDocRef, _streakData);
                  return finalStreak;
                }
                var integrityCheck = yield _dataIntegrityService.dataIntegrityService.verifyStreakIntegrity(habitId, userId, updatedStreak);
                if (!integrityCheck.isValid) {
                  console.warn("Streak integrity issues detected:", integrityCheck.errors);
                  yield _streakValidationService.streakValidationService.createAuditLog(userId, "streak_integrity_check_failed", "streak", streakId, existingStreak, updatedStreak, {
                    isValid: false,
                    errors: integrityCheck.errors,
                    warnings: integrityCheck.warnings
                  });
                  var _finalStreak = integrityCheck.correctedData || updatedStreak;
                  var _streakData2 = (0, _habitStreakSchemas.transformStreakToFirestore)(_finalStreak);
                  transaction.set(streakDocRef, _streakData2);
                  return _finalStreak;
                }
                var streakData = (0, _habitStreakSchemas.transformStreakToFirestore)(updatedStreak);
                transaction.set(streakDocRef, streakData);
                yield _streakValidationService.streakValidationService.createAuditLog(userId, "streak_calculated", "streak", streakId, existingStreak, updatedStreak, validationResult);
                return updatedStreak;
              });
              return function (_x3) {
                return _ref2.apply(this, arguments);
              };
            }());
          }));
        } catch (error) {
          var message = (0, _errorHandling.getUserFriendlyErrorMessage)(error);
          throw new Error(`Failed to calculate streak: ${message}`);
        }
      });
      function calculateStreak(_x, _x2) {
        return _calculateStreak.apply(this, arguments);
      }
      return calculateStreak;
    }())
  }, {
    key: "recordCompletion",
    value: (function () {
      var _recordCompletion = (0, _asyncToGenerator2.default)(function* (completion) {
        if (!completion.habitId || !completion.userId) {
          throw new Error("Habit ID and User ID are required");
        }
        var completionsCollection = (0, _collections.getHabitCompletionsCollection)();
        var existingCompletionsQuery = (0, _firestore.query)(completionsCollection, (0, _firestore.where)("habitId", "==", completion.habitId), (0, _firestore.where)("userId", "==", completion.userId));
        var existingSnapshot = yield (0, _firestore.getDocs)(existingCompletionsQuery);
        var existingCompletions = existingSnapshot.docs.map(function (doc) {
          return (0, _habitStreakSchemas.transformFirestoreToCompletion)(doc.id, doc.data());
        });
        var validationResult = yield _streakValidationService.streakValidationService.validateCompletionData(completion, completion.userId, existingCompletions);
        if (!validationResult.isValid) {
          yield _streakValidationService.streakValidationService.createAuditLog(completion.userId, "completion_validation_failed", "completion", "pending", null, completion, validationResult);
          throw new Error(`Completion validation failed: ${validationResult.errors.join(", ")}`);
        }
        if (validationResult.suspiciousActivity) {
          console.warn("Suspicious completion activity detected:", validationResult.warnings);
        }
        var userTimezone = completion.timezone || (0, _dateUtils.getUserTimezone)();
        var completionDateString = (0, _dateUtils.timestampToDateString)(completion.completedAt, userTimezone);
        var currentDateString = (0, _dateUtils.getCurrentDateString)(userTimezone);
        if (completionDateString > currentDateString) {
          throw new Error("Cannot record completions for future dates");
        }
        try {
          return yield (0, _errorHandling.retryWithBackoff)((0, _asyncToGenerator2.default)(function* () {
            return yield (0, _firestore.runTransaction)(_firebaseConfig.db, function () {
              var _ref4 = (0, _asyncToGenerator2.default)(function* (transaction) {
                var sameDay = existingCompletions.filter(function (comp) {
                  var compDateString = (0, _dateUtils.timestampToDateString)(comp.completedAt, userTimezone);
                  return compDateString === completionDateString;
                });
                if (sameDay.length > 0) {
                  throw new Error("Habit already completed for this date");
                }
                var completionData = {
                  habitId: completion.habitId,
                  userId: completion.userId,
                  completedAt: completion.completedAt,
                  timezone: userTimezone,
                  notes: completion.notes || "",
                  difficulty: completion.difficulty,
                  createdAt: (0, _firestore.serverTimestamp)()
                };
                var completionRef = (0, _firestore.doc)(completionsCollection);
                transaction.set(completionRef, completionData);
                var newCompletion = Object.assign({
                  id: completionRef.id
                }, completion, {
                  timezone: userTimezone
                });
                yield _streakValidationService.streakValidationService.createAuditLog(completion.userId, "completion_recorded", "completion", completionRef.id, null, completionData, validationResult);
                yield _syncService.syncService.queueOperation({
                  type: "completion",
                  action: "create",
                  data: completionData,
                  userId: completion.userId,
                  habitId: completion.habitId
                });
                return newCompletion;
              });
              return function (_x5) {
                return _ref4.apply(this, arguments);
              };
            }());
          }));
        } catch (error) {
          var message = (0, _errorHandling.getUserFriendlyErrorMessage)(error);
          throw new Error(`Failed to record completion: ${message}`);
        }
      });
      function recordCompletion(_x4) {
        return _recordCompletion.apply(this, arguments);
      }
      return recordCompletion;
    }())
  }, {
    key: "recordCompletionWithMilestoneCheck",
    value: (function () {
      var _recordCompletionWithMilestoneCheck = (0, _asyncToGenerator2.default)(function* (completion) {
        var recordedCompletion = yield this.recordCompletion(completion);
        var updatedStreak = yield this.calculateStreak(completion.habitId, completion.userId);
        var newMilestones = yield this.checkMilestones(updatedStreak);
        return {
          completion: recordedCompletion,
          newMilestones: newMilestones,
          updatedStreak: updatedStreak
        };
      });
      function recordCompletionWithMilestoneCheck(_x6) {
        return _recordCompletionWithMilestoneCheck.apply(this, arguments);
      }
      return recordCompletionWithMilestoneCheck;
    }())
  }, {
    key: "useStreakFreeze",
    value: (function () {
      var _useStreakFreeze = (0, _asyncToGenerator2.default)(function* (habitId, userId, missedDate) {
        if (!habitId || !userId || !missedDate) {
          throw new Error("Habit ID, User ID, and missed date are required");
        }
        try {
          return yield (0, _errorHandling.retryWithBackoff)((0, _asyncToGenerator2.default)(function* () {
            return yield (0, _firestore.runTransaction)(_firebaseConfig.db, function () {
              var _ref6 = (0, _asyncToGenerator2.default)(function* (transaction) {
                var streakId = (0, _habitStreakSchemas.generateStreakId)(userId, habitId);
                var streaksCollection = (0, _collections.getHabitStreaksCollection)();
                var streakDocRef = (0, _firestore.doc)(streaksCollection, streakId);
                var streakDoc = yield transaction.get(streakDocRef);
                if (!streakDoc.exists()) {
                  throw new Error("Streak data not found");
                }
                var streak = (0, _habitStreakSchemas.transformFirestoreToStreak)(streakDoc.data());
                if (!(0, _habitStreakSchemas.validateUserOwnership)(userId, streak.userId)) {
                  throw new Error("Unauthorized access to streak data");
                }
                if (streak.freezesAvailable <= 0) {
                  return false;
                }
                var updatedStreak = Object.assign({}, streak, {
                  freezesAvailable: streak.freezesAvailable - 1,
                  freezesUsed: streak.freezesUsed + 1
                });
                var protectedCompletion = {
                  habitId: habitId,
                  userId: userId,
                  completedAt: _firestore.Timestamp.fromDate((0, _dateUtils.parseDateString)(missedDate)),
                  timezone: (0, _dateUtils.getUserTimezone)(),
                  notes: "Protected by streak freeze",
                  difficulty: "easy",
                  createdAt: (0, _firestore.serverTimestamp)()
                };
                var completionsCollection = (0, _collections.getHabitCompletionsCollection)();
                var completionRef = (0, _firestore.doc)(completionsCollection);
                transaction.set(completionRef, protectedCompletion);
                var streakData = (0, _habitStreakSchemas.transformStreakToFirestore)(updatedStreak);
                transaction.set(streakDocRef, streakData);
                return true;
              });
              return function (_x0) {
                return _ref6.apply(this, arguments);
              };
            }());
          }));
        } catch (error) {
          var message = (0, _errorHandling.getUserFriendlyErrorMessage)(error);
          throw new Error(`Failed to use streak freeze: ${message}`);
        }
      });
      function useStreakFreeze(_x7, _x8, _x9) {
        return _useStreakFreeze.apply(this, arguments);
      }
      return useStreakFreeze;
    }())
  }, {
    key: "getHabitCalendar",
    value: (function () {
      var _getHabitCalendar = (0, _asyncToGenerator2.default)(function* (habitId, userId, days, timezone) {
        var _this2 = this;
        if (!habitId || !userId) {
          throw new Error("Habit ID and User ID are required");
        }
        try {
          return yield (0, _errorHandling.retryWithBackoff)((0, _asyncToGenerator2.default)(function* () {
            var endDate = (0, _dateUtils.getCurrentDateString)(timezone);
            var startDate = (0, _dateUtils.formatDateToString)(new Date(Date.now() - (days - 1) * 24 * 60 * 60 * 1000), timezone);
            var completionsCollection = (0, _collections.getHabitCompletionsCollection)();
            var completionsQuery = (0, _firestore.query)(completionsCollection, (0, _firestore.where)("habitId", "==", habitId), (0, _firestore.where)("userId", "==", userId));
            var completionsSnapshot = yield (0, _firestore.getDocs)(completionsQuery);
            var completions = completionsSnapshot.docs.map(function (doc) {
              return (0, _habitStreakSchemas.transformFirestoreToCompletion)(doc.id, doc.data());
            }).filter(function (completion) {
              var compDateString = (0, _dateUtils.timestampToDateString)(completion.completedAt, timezone);
              return compDateString >= startDate && compDateString <= endDate;
            });
            var streak = yield _this2.getHabitStreak(habitId, userId);
            var dateRange = (0, _dateUtils.generateDateRange)(startDate, endDate);
            var calendarDays = dateRange.map(function (date) {
              var completion = completions.find(function (comp) {
                return (0, _dateUtils.timestampToDateString)(comp.completedAt, timezone) === date;
              });
              var isInStreak = _this2.isDateInCurrentStreak(date, streak);
              return {
                date: date,
                completed: !!completion,
                isToday: (0, _dateUtils.isToday)(date, timezone),
                isInStreak: isInStreak,
                completionTime: completion ? completion.completedAt.toDate().toLocaleTimeString() : undefined,
                notes: completion == null ? void 0 : completion.notes
              };
            });
            return calendarDays;
          }));
        } catch (error) {
          var message = (0, _errorHandling.getUserFriendlyErrorMessage)(error);
          throw new Error(`Failed to get habit calendar: ${message}`);
        }
      });
      function getHabitCalendar(_x1, _x10, _x11, _x12) {
        return _getHabitCalendar.apply(this, arguments);
      }
      return getHabitCalendar;
    }())
  }, {
    key: "checkMilestones",
    value: (function () {
      var _checkMilestones = (0, _asyncToGenerator2.default)(function* (streak) {
        var newMilestones = [];
        var existingMilestoneDays = streak.milestones.map(function (m) {
          return m.days;
        });
        for (var milestoneDay of _habitStreaks.MILESTONE_DAYS) {
          if (streak.currentStreak >= milestoneDay && !existingMilestoneDays.includes(milestoneDay)) {
            var milestone = {
              days: milestoneDay,
              achievedAt: _firestore.Timestamp.now(),
              celebrated: false
            };
            newMilestones.push(milestone);
            if (milestoneDay === 30) {
              streak.freezesAvailable += 1;
            }
          }
        }
        if (newMilestones.length > 0) {
          var updatedStreak = Object.assign({}, streak, {
            milestones: [].concat((0, _toConsumableArray2.default)(streak.milestones), newMilestones),
            freezesAvailable: streak.freezesAvailable
          });
          var streakId = (0, _habitStreakSchemas.generateStreakId)(streak.userId, streak.habitId);
          var streaksCollection = (0, _collections.getHabitStreaksCollection)();
          var streakDocRef = (0, _firestore.doc)(streaksCollection, streakId);
          var streakData = (0, _habitStreakSchemas.transformStreakToFirestore)(updatedStreak);
          yield (0, _firestore.runTransaction)(_firebaseConfig.db, function () {
            var _ref8 = (0, _asyncToGenerator2.default)(function* (transaction) {
              transaction.set(streakDocRef, streakData);
            });
            return function (_x14) {
              return _ref8.apply(this, arguments);
            };
          }());
          for (var _milestone of newMilestones) {
            try {
              var habitName = yield this.getHabitName(streak.habitId);
              console.log(`Milestone achieved: ${_milestone.days} days for ${habitName}`);
            } catch (error) {
              console.error("Error logging milestone achievement:", error);
            }
          }
        }
        return newMilestones;
      });
      function checkMilestones(_x13) {
        return _checkMilestones.apply(this, arguments);
      }
      return checkMilestones;
    }())
  }, {
    key: "getHabitStreak",
    value: (function () {
      var _getHabitStreak = (0, _asyncToGenerator2.default)(function* (habitId, userId) {
        if (!habitId || !userId) {
          throw new Error("Habit ID and User ID are required");
        }
        try {
          var streakId = (0, _habitStreakSchemas.generateStreakId)(userId, habitId);
          var streaksCollection = (0, _collections.getHabitStreaksCollection)();
          var streakDocRef = (0, _firestore.doc)(streaksCollection, streakId);
          var streakDoc = yield (0, _firestore.getDoc)(streakDocRef);
          if (!streakDoc.exists()) {
            return null;
          }
          var streakData = streakDoc.data();
          if (!(0, _habitStreakSchemas.validateStreakDocument)(streakData)) {
            throw new Error("Invalid streak data format");
          }
          return (0, _habitStreakSchemas.transformFirestoreToStreak)(streakData);
        } catch (error) {
          var message = (0, _errorHandling.getUserFriendlyErrorMessage)(error);
          throw new Error(`Failed to get habit streak: ${message}`);
        }
      });
      function getHabitStreak(_x15, _x16) {
        return _getHabitStreak.apply(this, arguments);
      }
      return getHabitStreak;
    }())
  }, {
    key: "getHabitStreakForFriend",
    value: (function () {
      var _getHabitStreakForFriend = (0, _asyncToGenerator2.default)(function* (habitId, userId, friendId) {
        if (!habitId || !userId || !friendId) {
          throw new Error("Habit ID, User ID, and Friend ID are required");
        }
        try {
          var streak = yield this.getHabitStreak(habitId, userId);
          if (!streak) {
            return null;
          }
          var validationResult = yield _streakValidationService.streakValidationService.validateDataForFriendDisplay(streak, userId, friendId);
          if (!validationResult.isValid) {
            console.warn("Streak data failed friend display validation:", validationResult.errors);
            yield _streakValidationService.streakValidationService.createAuditLog(userId, "friend_display_validation_failed", "streak", (0, _habitStreakSchemas.generateStreakId)(userId, habitId), null, streak, validationResult);
            return null;
          }
          yield _streakValidationService.streakValidationService.createAuditLog(userId, "friend_accessed_streak", "streak", (0, _habitStreakSchemas.generateStreakId)(userId, habitId), null, {
            friendId: friendId,
            habitId: habitId
          }, validationResult);
          return streak;
        } catch (error) {
          var message = (0, _errorHandling.getUserFriendlyErrorMessage)(error);
          throw new Error(`Failed to get habit streak for friend: ${message}`);
        }
      });
      function getHabitStreakForFriend(_x17, _x18, _x19) {
        return _getHabitStreakForFriend.apply(this, arguments);
      }
      return getHabitStreakForFriend;
    }())
  }, {
    key: "initializeHabitStreak",
    value: (function () {
      var _initializeHabitStreak = (0, _asyncToGenerator2.default)(function* (habitId, userId) {
        if (!habitId || !userId) {
          throw new Error("Habit ID and User ID are required");
        }
        var currentDate = (0, _dateUtils.getCurrentDateString)((0, _dateUtils.getUserTimezone)());
        var initialStreak = {
          habitId: habitId,
          userId: userId,
          currentStreak: 0,
          bestStreak: 0,
          lastCompletionDate: "",
          streakStartDate: currentDate,
          freezesAvailable: 0,
          freezesUsed: 0,
          milestones: []
        };
        try {
          var streakId = (0, _habitStreakSchemas.generateStreakId)(userId, habitId);
          var streaksCollection = (0, _collections.getHabitStreaksCollection)();
          var streakDocRef = (0, _firestore.doc)(streaksCollection, streakId);
          var streakData = (0, _habitStreakSchemas.transformStreakToFirestore)(initialStreak);
          yield (0, _firestore.runTransaction)(_firebaseConfig.db, function () {
            var _ref9 = (0, _asyncToGenerator2.default)(function* (transaction) {
              transaction.set(streakDocRef, streakData);
            });
            return function (_x22) {
              return _ref9.apply(this, arguments);
            };
          }());
          return initialStreak;
        } catch (error) {
          var message = (0, _errorHandling.getUserFriendlyErrorMessage)(error);
          throw new Error(`Failed to initialize habit streak: ${message}`);
        }
      });
      function initializeHabitStreak(_x20, _x21) {
        return _initializeHabitStreak.apply(this, arguments);
      }
      return initializeHabitStreak;
    }())
  }, {
    key: "resetStreak",
    value: (function () {
      var _resetStreak = (0, _asyncToGenerator2.default)(function* (habitId, userId, resetDate) {
        var _this3 = this;
        if (!habitId || !userId || !resetDate) {
          throw new Error("Habit ID, User ID, and reset date are required");
        }
        try {
          return yield (0, _errorHandling.retryWithBackoff)((0, _asyncToGenerator2.default)(function* () {
            return yield (0, _firestore.runTransaction)(_firebaseConfig.db, function () {
              var _ref1 = (0, _asyncToGenerator2.default)(function* (transaction) {
                var streakId = (0, _habitStreakSchemas.generateStreakId)(userId, habitId);
                var streaksCollection = (0, _collections.getHabitStreaksCollection)();
                var streakDocRef = (0, _firestore.doc)(streaksCollection, streakId);
                var streakDoc = yield transaction.get(streakDocRef);
                if (!streakDoc.exists()) {
                  throw new Error("Streak data not found");
                }
                var streak = (0, _habitStreakSchemas.transformFirestoreToStreak)(streakDoc.data());
                if (!(0, _habitStreakSchemas.validateUserOwnership)(userId, streak.userId)) {
                  throw new Error("Unauthorized access to streak data");
                }
                var resetStreak = Object.assign({}, streak, {
                  currentStreak: 0,
                  lastCompletionDate: "",
                  streakStartDate: resetDate
                });
                var streakData = (0, _habitStreakSchemas.transformStreakToFirestore)(resetStreak);
                transaction.set(streakDocRef, streakData);
                try {
                  var habitName = yield _this3.getHabitName(habitId);
                  console.log(`Streak broken for ${habitName}, recovery notification will be scheduled`);
                } catch (error) {
                  console.error("Error scheduling recovery notification:", error);
                }
                return resetStreak;
              });
              return function (_x26) {
                return _ref1.apply(this, arguments);
              };
            }());
          }));
        } catch (error) {
          var message = (0, _errorHandling.getUserFriendlyErrorMessage)(error);
          throw new Error(`Failed to reset streak: ${message}`);
        }
      });
      function resetStreak(_x23, _x24, _x25) {
        return _resetStreak.apply(this, arguments);
      }
      return resetStreak;
    }())
  }, {
    key: "calculateStreakFromCompletions",
    value: function calculateStreakFromCompletions(completions, habitId, userId) {
      var _completions$;
      if (completions.length === 0) {
        return {
          habitId: habitId,
          userId: userId,
          currentStreak: 0,
          bestStreak: 0,
          lastCompletionDate: "",
          streakStartDate: (0, _dateUtils.getCurrentDateString)((0, _dateUtils.getUserTimezone)()),
          freezesAvailable: 0,
          freezesUsed: 0,
          milestones: []
        };
      }
      var timezone = ((_completions$ = completions[0]) == null ? void 0 : _completions$.timezone) || (0, _dateUtils.getUserTimezone)();
      var completionDates = completions.map(function (comp) {
        return (0, _dateUtils.timestampToDateString)(comp.completedAt, timezone);
      });
      var uniqueDates = Array.from(new Set(completionDates)).sort();
      var currentStreak = 0;
      var streakStartDate = "";
      var today = (0, _dateUtils.getCurrentDateString)(timezone);
      var yesterday = (0, _dateUtils.formatDateToString)(new Date(Date.now() - 24 * 60 * 60 * 1000), timezone);
      var lastCompletionDate = uniqueDates[uniqueDates.length - 1];
      if (lastCompletionDate === today || lastCompletionDate === yesterday) {
        currentStreak = 1;
        streakStartDate = lastCompletionDate;
        for (var i = uniqueDates.length - 2; i >= 0; i--) {
          var currentDate = uniqueDates[i + 1];
          var previousDate = uniqueDates[i];
          if ((0, _dateUtils.areConsecutiveDays)(previousDate, currentDate)) {
            currentStreak++;
            streakStartDate = previousDate;
          } else {
            break;
          }
        }
      }
      var bestStreak = 0;
      var tempStreak = 1;
      for (var _i = 1; _i < uniqueDates.length; _i++) {
        if ((0, _dateUtils.areConsecutiveDays)(uniqueDates[_i - 1], uniqueDates[_i])) {
          tempStreak++;
        } else {
          bestStreak = Math.max(bestStreak, tempStreak);
          tempStreak = 1;
        }
      }
      bestStreak = Math.max(bestStreak, tempStreak, currentStreak);
      return {
        habitId: habitId,
        userId: userId,
        currentStreak: currentStreak,
        bestStreak: bestStreak,
        lastCompletionDate: lastCompletionDate,
        streakStartDate: streakStartDate,
        freezesAvailable: 0,
        freezesUsed: 0,
        milestones: []
      };
    }
  }, {
    key: "mergeStreakData",
    value: function mergeStreakData(calculated, existing) {
      if (!existing) {
        return calculated;
      }
      return Object.assign({}, calculated, {
        freezesAvailable: existing.freezesAvailable,
        freezesUsed: existing.freezesUsed,
        milestones: existing.milestones,
        bestStreak: Math.max(calculated.bestStreak, existing.bestStreak)
      });
    }
  }, {
    key: "getHabitName",
    value: function () {
      var _getHabitName = (0, _asyncToGenerator2.default)(function* (habitId) {
        try {
          var goalRef = (0, _firestore.doc)(_firebaseConfig.db, `artifacts/oath-app/public/data/goals/${habitId}`);
          var goalDoc = yield (0, _firestore.getDoc)(goalRef);
          if (goalDoc.exists()) {
            var goalData = goalDoc.data();
            return goalData.description || "Your habit";
          }
          return "Your habit";
        } catch (error) {
          console.error("Error getting habit name:", error);
          return "Your habit";
        }
      });
      function getHabitName(_x27) {
        return _getHabitName.apply(this, arguments);
      }
      return getHabitName;
    }()
  }, {
    key: "isDateInCurrentStreak",
    value: function isDateInCurrentStreak(date, streak) {
      if (!streak || streak.currentStreak === 0 || !streak.streakStartDate) {
        return false;
      }
      var streakStart = (0, _dateUtils.parseDateString)(streak.streakStartDate);
      var checkDate = (0, _dateUtils.parseDateString)(date);
      var streakEnd = new Date(streakStart);
      streakEnd.setDate(streakEnd.getDate() + streak.currentStreak - 1);
      return checkDate >= streakStart && checkDate <= streakEnd;
    }
  }]);
}();
var streakService = exports.streakService = new StreakService();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfZmlyZXN0b3JlIiwicmVxdWlyZSIsIl9maXJlYmFzZUNvbmZpZyIsIl9oYWJpdFN0cmVha3MiLCJfZGF0ZVV0aWxzIiwiX2Vycm9ySGFuZGxpbmciLCJfY29sbGVjdGlvbnMiLCJfZGF0YUludGVncml0eVNlcnZpY2UiLCJfaGFiaXRTdHJlYWtTY2hlbWFzIiwiX3N0cmVha1ZhbGlkYXRpb25TZXJ2aWNlIiwiX3N5bmNTZXJ2aWNlIiwiU3RyZWFrU2VydmljZSIsImV4cG9ydHMiLCJfY2xhc3NDYWxsQ2hlY2syIiwiZGVmYXVsdCIsIl9jcmVhdGVDbGFzczIiLCJrZXkiLCJ2YWx1ZSIsIl9jYWxjdWxhdGVTdHJlYWsiLCJfYXN5bmNUb0dlbmVyYXRvcjIiLCJoYWJpdElkIiwidXNlcklkIiwiX3RoaXMiLCJFcnJvciIsInJldHJ5V2l0aEJhY2tvZmYiLCJydW5UcmFuc2FjdGlvbiIsImRiIiwiX3JlZjIiLCJ0cmFuc2FjdGlvbiIsInN0cmVha0lkIiwiZ2VuZXJhdGVTdHJlYWtJZCIsInN0cmVha3NDb2xsZWN0aW9uIiwiZ2V0SGFiaXRTdHJlYWtzQ29sbGVjdGlvbiIsInN0cmVha0RvY1JlZiIsImRvYyIsInN0cmVha0RvYyIsImdldCIsImNvbXBsZXRpb25zQ29sbGVjdGlvbiIsImdldEhhYml0Q29tcGxldGlvbnNDb2xsZWN0aW9uIiwiY29tcGxldGlvbnNRdWVyeSIsInF1ZXJ5Iiwid2hlcmUiLCJjb21wbGV0aW9uc1NuYXBzaG90IiwiZ2V0RG9jcyIsImNvbXBsZXRpb25zIiwiZG9jcyIsIm1hcCIsInRyYW5zZm9ybUZpcmVzdG9yZVRvQ29tcGxldGlvbiIsImlkIiwiZGF0YSIsInNvcnQiLCJhIiwiYiIsImNvbXBsZXRlZEF0IiwidG9NaWxsaXMiLCJjYWxjdWxhdGVkU3RyZWFrIiwiY2FsY3VsYXRlU3RyZWFrRnJvbUNvbXBsZXRpb25zIiwiZXhpc3RpbmdTdHJlYWsiLCJleGlzdHMiLCJ0cmFuc2Zvcm1GaXJlc3RvcmVUb1N0cmVhayIsInVwZGF0ZWRTdHJlYWsiLCJtZXJnZVN0cmVha0RhdGEiLCJ2YWxpZGF0aW9uUmVzdWx0Iiwic3RyZWFrVmFsaWRhdGlvblNlcnZpY2UiLCJ2YWxpZGF0ZVN0cmVha0NhbGN1bGF0aW9uIiwiaXNWYWxpZCIsImNvbnNvbGUiLCJ3YXJuIiwiZXJyb3JzIiwiY3JlYXRlQXVkaXRMb2ciLCJmaW5hbFN0cmVhayIsImNvcnJlY3RlZERhdGEiLCJzdHJlYWtEYXRhIiwidHJhbnNmb3JtU3RyZWFrVG9GaXJlc3RvcmUiLCJzZXQiLCJpbnRlZ3JpdHlDaGVjayIsImRhdGFJbnRlZ3JpdHlTZXJ2aWNlIiwidmVyaWZ5U3RyZWFrSW50ZWdyaXR5Iiwid2FybmluZ3MiLCJfeDMiLCJhcHBseSIsImFyZ3VtZW50cyIsImVycm9yIiwibWVzc2FnZSIsImdldFVzZXJGcmllbmRseUVycm9yTWVzc2FnZSIsImNhbGN1bGF0ZVN0cmVhayIsIl94IiwiX3gyIiwiX3JlY29yZENvbXBsZXRpb24iLCJjb21wbGV0aW9uIiwiZXhpc3RpbmdDb21wbGV0aW9uc1F1ZXJ5IiwiZXhpc3RpbmdTbmFwc2hvdCIsImV4aXN0aW5nQ29tcGxldGlvbnMiLCJ2YWxpZGF0ZUNvbXBsZXRpb25EYXRhIiwiam9pbiIsInN1c3BpY2lvdXNBY3Rpdml0eSIsInVzZXJUaW1lem9uZSIsInRpbWV6b25lIiwiZ2V0VXNlclRpbWV6b25lIiwiY29tcGxldGlvbkRhdGVTdHJpbmciLCJ0aW1lc3RhbXBUb0RhdGVTdHJpbmciLCJjdXJyZW50RGF0ZVN0cmluZyIsImdldEN1cnJlbnREYXRlU3RyaW5nIiwiX3JlZjQiLCJzYW1lRGF5IiwiZmlsdGVyIiwiY29tcCIsImNvbXBEYXRlU3RyaW5nIiwibGVuZ3RoIiwiY29tcGxldGlvbkRhdGEiLCJub3RlcyIsImRpZmZpY3VsdHkiLCJjcmVhdGVkQXQiLCJzZXJ2ZXJUaW1lc3RhbXAiLCJjb21wbGV0aW9uUmVmIiwibmV3Q29tcGxldGlvbiIsIk9iamVjdCIsImFzc2lnbiIsInN5bmNTZXJ2aWNlIiwicXVldWVPcGVyYXRpb24iLCJ0eXBlIiwiYWN0aW9uIiwiX3g1IiwicmVjb3JkQ29tcGxldGlvbiIsIl94NCIsIl9yZWNvcmRDb21wbGV0aW9uV2l0aE1pbGVzdG9uZUNoZWNrIiwicmVjb3JkZWRDb21wbGV0aW9uIiwibmV3TWlsZXN0b25lcyIsImNoZWNrTWlsZXN0b25lcyIsInJlY29yZENvbXBsZXRpb25XaXRoTWlsZXN0b25lQ2hlY2siLCJfeDYiLCJfdXNlU3RyZWFrRnJlZXplIiwibWlzc2VkRGF0ZSIsIl9yZWY2Iiwic3RyZWFrIiwidmFsaWRhdGVVc2VyT3duZXJzaGlwIiwiZnJlZXplc0F2YWlsYWJsZSIsImZyZWV6ZXNVc2VkIiwicHJvdGVjdGVkQ29tcGxldGlvbiIsIlRpbWVzdGFtcCIsImZyb21EYXRlIiwicGFyc2VEYXRlU3RyaW5nIiwiX3gwIiwidXNlU3RyZWFrRnJlZXplIiwiX3g3IiwiX3g4IiwiX3g5IiwiX2dldEhhYml0Q2FsZW5kYXIiLCJkYXlzIiwiX3RoaXMyIiwiZW5kRGF0ZSIsInN0YXJ0RGF0ZSIsImZvcm1hdERhdGVUb1N0cmluZyIsIkRhdGUiLCJub3ciLCJnZXRIYWJpdFN0cmVhayIsImRhdGVSYW5nZSIsImdlbmVyYXRlRGF0ZVJhbmdlIiwiY2FsZW5kYXJEYXlzIiwiZGF0ZSIsImZpbmQiLCJpc0luU3RyZWFrIiwiaXNEYXRlSW5DdXJyZW50U3RyZWFrIiwiY29tcGxldGVkIiwiaXNUb2RheSIsImNvbXBsZXRpb25UaW1lIiwidG9EYXRlIiwidG9Mb2NhbGVUaW1lU3RyaW5nIiwidW5kZWZpbmVkIiwiZ2V0SGFiaXRDYWxlbmRhciIsIl94MSIsIl94MTAiLCJfeDExIiwiX3gxMiIsIl9jaGVja01pbGVzdG9uZXMiLCJleGlzdGluZ01pbGVzdG9uZURheXMiLCJtaWxlc3RvbmVzIiwibSIsIm1pbGVzdG9uZURheSIsIk1JTEVTVE9ORV9EQVlTIiwiY3VycmVudFN0cmVhayIsImluY2x1ZGVzIiwibWlsZXN0b25lIiwiYWNoaWV2ZWRBdCIsImNlbGVicmF0ZWQiLCJwdXNoIiwiY29uY2F0IiwiX3RvQ29uc3VtYWJsZUFycmF5MiIsIl9yZWY4IiwiX3gxNCIsImhhYml0TmFtZSIsImdldEhhYml0TmFtZSIsImxvZyIsIl94MTMiLCJfZ2V0SGFiaXRTdHJlYWsiLCJnZXREb2MiLCJ2YWxpZGF0ZVN0cmVha0RvY3VtZW50IiwiX3gxNSIsIl94MTYiLCJfZ2V0SGFiaXRTdHJlYWtGb3JGcmllbmQiLCJmcmllbmRJZCIsInZhbGlkYXRlRGF0YUZvckZyaWVuZERpc3BsYXkiLCJnZXRIYWJpdFN0cmVha0ZvckZyaWVuZCIsIl94MTciLCJfeDE4IiwiX3gxOSIsIl9pbml0aWFsaXplSGFiaXRTdHJlYWsiLCJjdXJyZW50RGF0ZSIsImluaXRpYWxTdHJlYWsiLCJiZXN0U3RyZWFrIiwibGFzdENvbXBsZXRpb25EYXRlIiwic3RyZWFrU3RhcnREYXRlIiwiX3JlZjkiLCJfeDIyIiwiaW5pdGlhbGl6ZUhhYml0U3RyZWFrIiwiX3gyMCIsIl94MjEiLCJfcmVzZXRTdHJlYWsiLCJyZXNldERhdGUiLCJfdGhpczMiLCJfcmVmMSIsInJlc2V0U3RyZWFrIiwiX3gyNiIsIl94MjMiLCJfeDI0IiwiX3gyNSIsIl9jb21wbGV0aW9ucyQiLCJjb21wbGV0aW9uRGF0ZXMiLCJ1bmlxdWVEYXRlcyIsIkFycmF5IiwiZnJvbSIsIlNldCIsInRvZGF5IiwieWVzdGVyZGF5IiwiaSIsInByZXZpb3VzRGF0ZSIsImFyZUNvbnNlY3V0aXZlRGF5cyIsInRlbXBTdHJlYWsiLCJNYXRoIiwibWF4IiwiY2FsY3VsYXRlZCIsImV4aXN0aW5nIiwiX2dldEhhYml0TmFtZSIsImdvYWxSZWYiLCJnb2FsRG9jIiwiZ29hbERhdGEiLCJkZXNjcmlwdGlvbiIsIl94MjciLCJzdHJlYWtTdGFydCIsImNoZWNrRGF0ZSIsInN0cmVha0VuZCIsInNldERhdGUiLCJnZXREYXRlIiwic3RyZWFrU2VydmljZSJdLCJzb3VyY2VzIjpbInN0cmVha1NlcnZpY2UudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcbiAgICBkb2MsXG4gICAgZ2V0RG9jLFxuICAgIGdldERvY3MsXG4gICAgcXVlcnksXG4gICAgcnVuVHJhbnNhY3Rpb24sXG4gICAgc2VydmVyVGltZXN0YW1wLFxuICAgIFRpbWVzdGFtcCxcbiAgICB3aGVyZSxcbn0gZnJvbSBcImZpcmViYXNlL2ZpcmVzdG9yZVwiO1xuaW1wb3J0IHsgZGIgfSBmcm9tIFwiLi4vLi4vZmlyZWJhc2VDb25maWdcIjtcbmltcG9ydCB7XG4gICAgQ2FsZW5kYXJEYXksXG4gICAgSGFiaXRDb21wbGV0aW9uLFxuICAgIEhhYml0U3RyZWFrLFxuICAgIE1JTEVTVE9ORV9EQVlTLFxuICAgIFN0cmVha01pbGVzdG9uZSxcbn0gZnJvbSBcIi4uLy4uL3R5cGVzL2hhYml0LXN0cmVha3NcIjtcbmltcG9ydCB7XG4gICAgYXJlQ29uc2VjdXRpdmVEYXlzLFxuICAgIGZvcm1hdERhdGVUb1N0cmluZyxcbiAgICBnZW5lcmF0ZURhdGVSYW5nZSxcbiAgICBnZXRDdXJyZW50RGF0ZVN0cmluZyxcbiAgICBnZXRVc2VyVGltZXpvbmUsXG4gICAgaXNUb2RheSxcbiAgICBwYXJzZURhdGVTdHJpbmcsXG4gICAgdGltZXN0YW1wVG9EYXRlU3RyaW5nLFxufSBmcm9tIFwiLi4vLi4vdXRpbHMvZGF0ZVV0aWxzXCI7XG5pbXBvcnQge1xuICAgIGdldFVzZXJGcmllbmRseUVycm9yTWVzc2FnZSxcbiAgICByZXRyeVdpdGhCYWNrb2ZmLFxufSBmcm9tIFwiLi4vLi4vdXRpbHMvZXJyb3JIYW5kbGluZ1wiO1xuaW1wb3J0IHtcbiAgICBnZXRIYWJpdENvbXBsZXRpb25zQ29sbGVjdGlvbixcbiAgICBnZXRIYWJpdFN0cmVha3NDb2xsZWN0aW9uLFxufSBmcm9tIFwiLi9jb2xsZWN0aW9uc1wiO1xuaW1wb3J0IHsgZGF0YUludGVncml0eVNlcnZpY2UgfSBmcm9tIFwiLi9kYXRhSW50ZWdyaXR5U2VydmljZVwiO1xuaW1wb3J0IHsgU3RyZWFrU2VydmljZSBhcyBJU3RyZWFrU2VydmljZSB9IGZyb20gXCIuL2hhYml0U3RyZWFrSW50ZXJmYWNlc1wiO1xuaW1wb3J0IHtcbiAgICBnZW5lcmF0ZVN0cmVha0lkLFxuICAgIHRyYW5zZm9ybUZpcmVzdG9yZVRvQ29tcGxldGlvbixcbiAgICB0cmFuc2Zvcm1GaXJlc3RvcmVUb1N0cmVhayxcbiAgICB0cmFuc2Zvcm1TdHJlYWtUb0ZpcmVzdG9yZSxcbiAgICB2YWxpZGF0ZVN0cmVha0RvY3VtZW50LFxuICAgIHZhbGlkYXRlVXNlck93bmVyc2hpcCxcbn0gZnJvbSBcIi4vaGFiaXRTdHJlYWtTY2hlbWFzXCI7XG5pbXBvcnQgeyBzdHJlYWtWYWxpZGF0aW9uU2VydmljZSB9IGZyb20gXCIuL3N0cmVha1ZhbGlkYXRpb25TZXJ2aWNlXCI7XG5pbXBvcnQgeyBzeW5jU2VydmljZSB9IGZyb20gXCIuL3N5bmNTZXJ2aWNlXCI7XG5cbi8qKlxuICogU3RyZWFrU2VydmljZSBJbXBsZW1lbnRhdGlvblxuICpcbiAqIEhhbmRsZXMgYWxsIHN0cmVhayBjYWxjdWxhdGlvbiwgdHJhY2tpbmcsIGFuZCBtYW5hZ2VtZW50IGZ1bmN0aW9uYWxpdHlcbiAqIHdpdGggdGltZXpvbmUgYXdhcmVuZXNzIGFuZCBkYXRhIGludGVncml0eSBwcm90ZWN0aW9uLlxuICovXG5leHBvcnQgY2xhc3MgU3RyZWFrU2VydmljZSBpbXBsZW1lbnRzIElTdHJlYWtTZXJ2aWNlIHtcbiAgICAvKipcbiAgICAgKiBDYWxjdWxhdGUgYW5kIHVwZGF0ZSBzdHJlYWsgaW5mb3JtYXRpb24gZm9yIGEgaGFiaXRcbiAgICAgKiBSZXF1aXJlbWVudHM6IDEuMSwgMS4yLCAxLjMsIDEwLjIsIDEyLjRcbiAgICAgKi9cbiAgICBhc3luYyBjYWxjdWxhdGVTdHJlYWsoaGFiaXRJZDogc3RyaW5nLCB1c2VySWQ6IHN0cmluZyk6IFByb21pc2U8SGFiaXRTdHJlYWs+IHtcbiAgICAgICAgaWYgKCFoYWJpdElkIHx8ICF1c2VySWQpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkhhYml0IElEIGFuZCBVc2VyIElEIGFyZSByZXF1aXJlZFwiKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICByZXR1cm4gYXdhaXQgcmV0cnlXaXRoQmFja29mZihhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGF3YWl0IHJ1blRyYW5zYWN0aW9uKGRiLCBhc3luYyAodHJhbnNhY3Rpb24pID0+IHtcbiAgICAgICAgICAgICAgICAgICAgLy8gR2V0IGN1cnJlbnQgc3RyZWFrIGRhdGFcbiAgICAgICAgICAgICAgICAgICAgY29uc3Qgc3RyZWFrSWQgPSBnZW5lcmF0ZVN0cmVha0lkKHVzZXJJZCwgaGFiaXRJZCk7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHN0cmVha3NDb2xsZWN0aW9uID0gZ2V0SGFiaXRTdHJlYWtzQ29sbGVjdGlvbigpO1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBzdHJlYWtEb2NSZWYgPSBkb2Moc3RyZWFrc0NvbGxlY3Rpb24sIHN0cmVha0lkKTtcbiAgICAgICAgICAgICAgICAgICAgY29uc3Qgc3RyZWFrRG9jID0gYXdhaXQgdHJhbnNhY3Rpb24uZ2V0KHN0cmVha0RvY1JlZik7XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gR2V0IGFsbCBjb21wbGV0aW9ucyBmb3IgdGhpcyBoYWJpdFxuICAgICAgICAgICAgICAgICAgICBjb25zdCBjb21wbGV0aW9uc0NvbGxlY3Rpb24gPSBnZXRIYWJpdENvbXBsZXRpb25zQ29sbGVjdGlvbigpO1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBjb21wbGV0aW9uc1F1ZXJ5ID0gcXVlcnkoXG4gICAgICAgICAgICAgICAgICAgICAgICBjb21wbGV0aW9uc0NvbGxlY3Rpb24sXG4gICAgICAgICAgICAgICAgICAgICAgICB3aGVyZShcImhhYml0SWRcIiwgXCI9PVwiLCBoYWJpdElkKSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHdoZXJlKFwidXNlcklkXCIsIFwiPT1cIiwgdXNlcklkKSxcbiAgICAgICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgY29tcGxldGlvbnNTbmFwc2hvdCA9IGF3YWl0IGdldERvY3MoY29tcGxldGlvbnNRdWVyeSk7XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gVHJhbnNmb3JtIGNvbXBsZXRpb25zIGFuZCBzb3J0IGJ5IGRhdGVcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgY29tcGxldGlvbnMgPSBjb21wbGV0aW9uc1NuYXBzaG90LmRvY3NcbiAgICAgICAgICAgICAgICAgICAgICAgIC5tYXAoKGRvYykgPT4gdHJhbnNmb3JtRmlyZXN0b3JlVG9Db21wbGV0aW9uKGRvYy5pZCwgZG9jLmRhdGEoKSkpXG4gICAgICAgICAgICAgICAgICAgICAgICAuc29ydChcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAoYSwgYikgPT4gYS5jb21wbGV0ZWRBdC50b01pbGxpcygpIC0gYi5jb21wbGV0ZWRBdC50b01pbGxpcygpLFxuICAgICAgICAgICAgICAgICAgICAgICAgKTtcblxuICAgICAgICAgICAgICAgICAgICAvLyBDYWxjdWxhdGUgc3RyZWFrIGZyb20gY29tcGxldGlvbnNcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgY2FsY3VsYXRlZFN0cmVhayA9IHRoaXMuY2FsY3VsYXRlU3RyZWFrRnJvbUNvbXBsZXRpb25zKFxuICAgICAgICAgICAgICAgICAgICAgICAgY29tcGxldGlvbnMsXG4gICAgICAgICAgICAgICAgICAgICAgICBoYWJpdElkLFxuICAgICAgICAgICAgICAgICAgICAgICAgdXNlcklkLFxuICAgICAgICAgICAgICAgICAgICApO1xuXG4gICAgICAgICAgICAgICAgICAgIC8vIE1lcmdlIHdpdGggZXhpc3RpbmcgZGF0YSBpZiBhdmFpbGFibGVcbiAgICAgICAgICAgICAgICAgICAgbGV0IGV4aXN0aW5nU3RyZWFrOiBIYWJpdFN0cmVhayB8IG51bGwgPSBudWxsO1xuICAgICAgICAgICAgICAgICAgICBpZiAoc3RyZWFrRG9jLmV4aXN0cygpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBleGlzdGluZ1N0cmVhayA9IHRyYW5zZm9ybUZpcmVzdG9yZVRvU3RyZWFrKHN0cmVha0RvYy5kYXRhKCkpO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgY29uc3QgdXBkYXRlZFN0cmVhayA9IHRoaXMubWVyZ2VTdHJlYWtEYXRhKFxuICAgICAgICAgICAgICAgICAgICAgICAgY2FsY3VsYXRlZFN0cmVhayxcbiAgICAgICAgICAgICAgICAgICAgICAgIGV4aXN0aW5nU3RyZWFrLFxuICAgICAgICAgICAgICAgICAgICApO1xuXG4gICAgICAgICAgICAgICAgICAgIC8vIFNlcnZlci1zaWRlIHZhbGlkYXRpb24gb2Ygc3RyZWFrIGNhbGN1bGF0aW9uIChSZXF1aXJlbWVudHMgMTIuMilcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgdmFsaWRhdGlvblJlc3VsdCA9XG4gICAgICAgICAgICAgICAgICAgICAgICBhd2FpdCBzdHJlYWtWYWxpZGF0aW9uU2VydmljZS52YWxpZGF0ZVN0cmVha0NhbGN1bGF0aW9uKFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVwZGF0ZWRTdHJlYWssXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29tcGxldGlvbnMsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdXNlcklkLFxuICAgICAgICAgICAgICAgICAgICAgICAgKTtcblxuICAgICAgICAgICAgICAgICAgICBpZiAoIXZhbGlkYXRpb25SZXN1bHQuaXNWYWxpZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS53YXJuKFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiU3RyZWFrIGNhbGN1bGF0aW9uIHZhbGlkYXRpb24gZmFpbGVkOlwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbGlkYXRpb25SZXN1bHQuZXJyb3JzLFxuICAgICAgICAgICAgICAgICAgICAgICAgKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gQ3JlYXRlIGF1ZGl0IGxvZyBmb3IgdmFsaWRhdGlvbiBmYWlsdXJlXG4gICAgICAgICAgICAgICAgICAgICAgICBhd2FpdCBzdHJlYWtWYWxpZGF0aW9uU2VydmljZS5jcmVhdGVBdWRpdExvZyhcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1c2VySWQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJzdHJlYWtfY2FsY3VsYXRpb25fdmFsaWRhdGlvbl9mYWlsZWRcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcInN0cmVha1wiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0cmVha0lkLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4aXN0aW5nU3RyZWFrLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVwZGF0ZWRTdHJlYWssXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsaWRhdGlvblJlc3VsdCxcbiAgICAgICAgICAgICAgICAgICAgICAgICk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFVzZSBjb3JyZWN0ZWQgZGF0YSBpZiBhdmFpbGFibGVcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGZpbmFsU3RyZWFrID0gdmFsaWRhdGlvblJlc3VsdC5jb3JyZWN0ZWREYXRhIHx8IHVwZGF0ZWRTdHJlYWs7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFNhdmUgY29ycmVjdGVkIHN0cmVha1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qgc3RyZWFrRGF0YSA9IHRyYW5zZm9ybVN0cmVha1RvRmlyZXN0b3JlKGZpbmFsU3RyZWFrKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRyYW5zYWN0aW9uLnNldChzdHJlYWtEb2NSZWYsIHN0cmVha0RhdGEpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmluYWxTdHJlYWs7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAvLyBWZXJpZnkgZGF0YSBpbnRlZ3JpdHkgYmVmb3JlIHNhdmluZyAoUmVxdWlyZW1lbnRzIDEyLjQpXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGludGVncml0eUNoZWNrID1cbiAgICAgICAgICAgICAgICAgICAgICAgIGF3YWl0IGRhdGFJbnRlZ3JpdHlTZXJ2aWNlLnZlcmlmeVN0cmVha0ludGVncml0eShcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBoYWJpdElkLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVzZXJJZCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1cGRhdGVkU3RyZWFrLFxuICAgICAgICAgICAgICAgICAgICAgICAgKTtcblxuICAgICAgICAgICAgICAgICAgICBpZiAoIWludGVncml0eUNoZWNrLmlzVmFsaWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUud2FybihcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcIlN0cmVhayBpbnRlZ3JpdHkgaXNzdWVzIGRldGVjdGVkOlwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGludGVncml0eUNoZWNrLmVycm9ycyxcbiAgICAgICAgICAgICAgICAgICAgICAgICk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIENyZWF0ZSBhdWRpdCBsb2cgZm9yIGludGVncml0eSBpc3N1ZXNcbiAgICAgICAgICAgICAgICAgICAgICAgIGF3YWl0IHN0cmVha1ZhbGlkYXRpb25TZXJ2aWNlLmNyZWF0ZUF1ZGl0TG9nKFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVzZXJJZCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcInN0cmVha19pbnRlZ3JpdHlfY2hlY2tfZmFpbGVkXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJzdHJlYWtcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdHJlYWtJZCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBleGlzdGluZ1N0cmVhayxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1cGRhdGVkU3RyZWFrLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaXNWYWxpZDogZmFsc2UsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVycm9yczogaW50ZWdyaXR5Q2hlY2suZXJyb3JzLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3YXJuaW5nczogaW50ZWdyaXR5Q2hlY2sud2FybmluZ3MsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgICk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFVzZSBjb3JyZWN0ZWQgZGF0YSBpZiBhdmFpbGFibGVcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGZpbmFsU3RyZWFrID0gaW50ZWdyaXR5Q2hlY2suY29ycmVjdGVkRGF0YSB8fCB1cGRhdGVkU3RyZWFrO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBTYXZlIGNvcnJlY3RlZCBzdHJlYWtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHN0cmVha0RhdGEgPSB0cmFuc2Zvcm1TdHJlYWtUb0ZpcmVzdG9yZShmaW5hbFN0cmVhayk7XG4gICAgICAgICAgICAgICAgICAgICAgICB0cmFuc2FjdGlvbi5zZXQoc3RyZWFrRG9jUmVmLCBzdHJlYWtEYXRhKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZpbmFsU3RyZWFrO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gU2F2ZSB1cGRhdGVkIHN0cmVha1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBzdHJlYWtEYXRhID0gdHJhbnNmb3JtU3RyZWFrVG9GaXJlc3RvcmUodXBkYXRlZFN0cmVhayk7XG4gICAgICAgICAgICAgICAgICAgIHRyYW5zYWN0aW9uLnNldChzdHJlYWtEb2NSZWYsIHN0cmVha0RhdGEpO1xuXG4gICAgICAgICAgICAgICAgICAgIC8vIENyZWF0ZSBhdWRpdCBsb2cgZm9yIHN1Y2Nlc3NmdWwgY2FsY3VsYXRpb25cbiAgICAgICAgICAgICAgICAgICAgYXdhaXQgc3RyZWFrVmFsaWRhdGlvblNlcnZpY2UuY3JlYXRlQXVkaXRMb2coXG4gICAgICAgICAgICAgICAgICAgICAgICB1c2VySWQsXG4gICAgICAgICAgICAgICAgICAgICAgICBcInN0cmVha19jYWxjdWxhdGVkXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICBcInN0cmVha1wiLFxuICAgICAgICAgICAgICAgICAgICAgICAgc3RyZWFrSWQsXG4gICAgICAgICAgICAgICAgICAgICAgICBleGlzdGluZ1N0cmVhayxcbiAgICAgICAgICAgICAgICAgICAgICAgIHVwZGF0ZWRTdHJlYWssXG4gICAgICAgICAgICAgICAgICAgICAgICB2YWxpZGF0aW9uUmVzdWx0LFxuICAgICAgICAgICAgICAgICAgICApO1xuXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB1cGRhdGVkU3RyZWFrO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICBjb25zdCBtZXNzYWdlID0gZ2V0VXNlckZyaWVuZGx5RXJyb3JNZXNzYWdlKGVycm9yKTtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgRmFpbGVkIHRvIGNhbGN1bGF0ZSBzdHJlYWs6ICR7bWVzc2FnZX1gKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFJlY29yZCBhIG5ldyBoYWJpdCBjb21wbGV0aW9uIGFuZCB1cGRhdGUgc3RyZWFrXG4gICAgICogUmVxdWlyZW1lbnRzOiA1LjEsIDEyLjEsIDEwLjRcbiAgICAgKi9cbiAgICBhc3luYyByZWNvcmRDb21wbGV0aW9uKFxuICAgICAgICBjb21wbGV0aW9uOiBPbWl0PEhhYml0Q29tcGxldGlvbiwgXCJpZFwiPixcbiAgICApOiBQcm9taXNlPEhhYml0Q29tcGxldGlvbj4ge1xuICAgICAgICBpZiAoIWNvbXBsZXRpb24uaGFiaXRJZCB8fCAhY29tcGxldGlvbi51c2VySWQpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkhhYml0IElEIGFuZCBVc2VyIElEIGFyZSByZXF1aXJlZFwiKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIEdldCBleGlzdGluZyBjb21wbGV0aW9ucyBmb3IgdmFsaWRhdGlvblxuICAgICAgICBjb25zdCBjb21wbGV0aW9uc0NvbGxlY3Rpb24gPSBnZXRIYWJpdENvbXBsZXRpb25zQ29sbGVjdGlvbigpO1xuICAgICAgICBjb25zdCBleGlzdGluZ0NvbXBsZXRpb25zUXVlcnkgPSBxdWVyeShcbiAgICAgICAgICAgIGNvbXBsZXRpb25zQ29sbGVjdGlvbixcbiAgICAgICAgICAgIHdoZXJlKFwiaGFiaXRJZFwiLCBcIj09XCIsIGNvbXBsZXRpb24uaGFiaXRJZCksXG4gICAgICAgICAgICB3aGVyZShcInVzZXJJZFwiLCBcIj09XCIsIGNvbXBsZXRpb24udXNlcklkKSxcbiAgICAgICAgKTtcbiAgICAgICAgY29uc3QgZXhpc3RpbmdTbmFwc2hvdCA9IGF3YWl0IGdldERvY3MoZXhpc3RpbmdDb21wbGV0aW9uc1F1ZXJ5KTtcbiAgICAgICAgY29uc3QgZXhpc3RpbmdDb21wbGV0aW9ucyA9IGV4aXN0aW5nU25hcHNob3QuZG9jcy5tYXAoKGRvYykgPT5cbiAgICAgICAgICAgIHRyYW5zZm9ybUZpcmVzdG9yZVRvQ29tcGxldGlvbihkb2MuaWQsIGRvYy5kYXRhKCkpLFxuICAgICAgICApO1xuXG4gICAgICAgIC8vIFNlcnZlci1zaWRlIHZhbGlkYXRpb24gb2YgY29tcGxldGlvbiBkYXRhIChSZXF1aXJlbWVudHMgMTIuMSwgMTIuMylcbiAgICAgICAgY29uc3QgdmFsaWRhdGlvblJlc3VsdCA9XG4gICAgICAgICAgICBhd2FpdCBzdHJlYWtWYWxpZGF0aW9uU2VydmljZS52YWxpZGF0ZUNvbXBsZXRpb25EYXRhKFxuICAgICAgICAgICAgICAgIGNvbXBsZXRpb24sXG4gICAgICAgICAgICAgICAgY29tcGxldGlvbi51c2VySWQsXG4gICAgICAgICAgICAgICAgZXhpc3RpbmdDb21wbGV0aW9ucyxcbiAgICAgICAgICAgICk7XG5cbiAgICAgICAgaWYgKCF2YWxpZGF0aW9uUmVzdWx0LmlzVmFsaWQpIHtcbiAgICAgICAgICAgIC8vIENyZWF0ZSBhdWRpdCBsb2cgZm9yIHZhbGlkYXRpb24gZmFpbHVyZVxuICAgICAgICAgICAgYXdhaXQgc3RyZWFrVmFsaWRhdGlvblNlcnZpY2UuY3JlYXRlQXVkaXRMb2coXG4gICAgICAgICAgICAgICAgY29tcGxldGlvbi51c2VySWQsXG4gICAgICAgICAgICAgICAgXCJjb21wbGV0aW9uX3ZhbGlkYXRpb25fZmFpbGVkXCIsXG4gICAgICAgICAgICAgICAgXCJjb21wbGV0aW9uXCIsXG4gICAgICAgICAgICAgICAgXCJwZW5kaW5nXCIsXG4gICAgICAgICAgICAgICAgbnVsbCxcbiAgICAgICAgICAgICAgICBjb21wbGV0aW9uLFxuICAgICAgICAgICAgICAgIHZhbGlkYXRpb25SZXN1bHQsXG4gICAgICAgICAgICApO1xuXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgICAgICAgICAgYENvbXBsZXRpb24gdmFsaWRhdGlvbiBmYWlsZWQ6ICR7dmFsaWRhdGlvblJlc3VsdC5lcnJvcnMuam9pbihcIiwgXCIpfWAsXG4gICAgICAgICAgICApO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gTG9nIHN1c3BpY2lvdXMgYWN0aXZpdHkgaWYgZGV0ZWN0ZWRcbiAgICAgICAgaWYgKHZhbGlkYXRpb25SZXN1bHQuc3VzcGljaW91c0FjdGl2aXR5KSB7XG4gICAgICAgICAgICBjb25zb2xlLndhcm4oXG4gICAgICAgICAgICAgICAgXCJTdXNwaWNpb3VzIGNvbXBsZXRpb24gYWN0aXZpdHkgZGV0ZWN0ZWQ6XCIsXG4gICAgICAgICAgICAgICAgdmFsaWRhdGlvblJlc3VsdC53YXJuaW5ncyxcbiAgICAgICAgICAgICk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBWYWxpZGF0ZSB0aW1lem9uZS1hd2FyZSBjb21wbGV0aW9uXG4gICAgICAgIGNvbnN0IHVzZXJUaW1lem9uZSA9IGNvbXBsZXRpb24udGltZXpvbmUgfHwgZ2V0VXNlclRpbWV6b25lKCk7XG4gICAgICAgIGNvbnN0IGNvbXBsZXRpb25EYXRlU3RyaW5nID0gdGltZXN0YW1wVG9EYXRlU3RyaW5nKFxuICAgICAgICAgICAgY29tcGxldGlvbi5jb21wbGV0ZWRBdCxcbiAgICAgICAgICAgIHVzZXJUaW1lem9uZSxcbiAgICAgICAgKTtcbiAgICAgICAgY29uc3QgY3VycmVudERhdGVTdHJpbmcgPSBnZXRDdXJyZW50RGF0ZVN0cmluZyh1c2VyVGltZXpvbmUpO1xuXG4gICAgICAgIC8vIEVuc3VyZSBjb21wbGV0aW9uIGlzIGZvciBjdXJyZW50IGRheSBvciBlYXJsaWVyIChwcmV2ZW50IGZ1dHVyZSBjb21wbGV0aW9ucylcbiAgICAgICAgaWYgKGNvbXBsZXRpb25EYXRlU3RyaW5nID4gY3VycmVudERhdGVTdHJpbmcpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkNhbm5vdCByZWNvcmQgY29tcGxldGlvbnMgZm9yIGZ1dHVyZSBkYXRlc1wiKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICByZXR1cm4gYXdhaXQgcmV0cnlXaXRoQmFja29mZihhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGF3YWl0IHJ1blRyYW5zYWN0aW9uKGRiLCBhc3luYyAodHJhbnNhY3Rpb24pID0+IHtcbiAgICAgICAgICAgICAgICAgICAgLy8gRG91YmxlLWNoZWNrIGZvciBleGlzdGluZyBjb21wbGV0aW9uIG9uIHRoZSBzYW1lIGRhdGVcbiAgICAgICAgICAgICAgICAgICAgY29uc3Qgc2FtZURheSA9IGV4aXN0aW5nQ29tcGxldGlvbnMuZmlsdGVyKChjb21wKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBjb21wRGF0ZVN0cmluZyA9IHRpbWVzdGFtcFRvRGF0ZVN0cmluZyhcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb21wLmNvbXBsZXRlZEF0LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVzZXJUaW1lem9uZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gY29tcERhdGVTdHJpbmcgPT09IGNvbXBsZXRpb25EYXRlU3RyaW5nO1xuICAgICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgICAgICBpZiAoc2FtZURheS5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJIYWJpdCBhbHJlYWR5IGNvbXBsZXRlZCBmb3IgdGhpcyBkYXRlXCIpO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gQ3JlYXRlIGNvbXBsZXRpb24gcmVjb3JkIHdpdGggbWV0YWRhdGFcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgY29tcGxldGlvbkRhdGEgPSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBoYWJpdElkOiBjb21wbGV0aW9uLmhhYml0SWQsXG4gICAgICAgICAgICAgICAgICAgICAgICB1c2VySWQ6IGNvbXBsZXRpb24udXNlcklkLFxuICAgICAgICAgICAgICAgICAgICAgICAgY29tcGxldGVkQXQ6IGNvbXBsZXRpb24uY29tcGxldGVkQXQsXG4gICAgICAgICAgICAgICAgICAgICAgICB0aW1lem9uZTogdXNlclRpbWV6b25lLFxuICAgICAgICAgICAgICAgICAgICAgICAgbm90ZXM6IGNvbXBsZXRpb24ubm90ZXMgfHwgXCJcIixcbiAgICAgICAgICAgICAgICAgICAgICAgIGRpZmZpY3VsdHk6IGNvbXBsZXRpb24uZGlmZmljdWx0eSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGNyZWF0ZWRBdDogc2VydmVyVGltZXN0YW1wKCksXG4gICAgICAgICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICAgICAgICAgY29uc3QgY29tcGxldGlvblJlZiA9IGRvYyhjb21wbGV0aW9uc0NvbGxlY3Rpb24pO1xuICAgICAgICAgICAgICAgICAgICB0cmFuc2FjdGlvbi5zZXQoY29tcGxldGlvblJlZiwgY29tcGxldGlvbkRhdGEpO1xuXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IG5ld0NvbXBsZXRpb246IEhhYml0Q29tcGxldGlvbiA9IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlkOiBjb21wbGV0aW9uUmVmLmlkLFxuICAgICAgICAgICAgICAgICAgICAgICAgLi4uY29tcGxldGlvbixcbiAgICAgICAgICAgICAgICAgICAgICAgIHRpbWV6b25lOiB1c2VyVGltZXpvbmUsXG4gICAgICAgICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gQ3JlYXRlIGF1ZGl0IGxvZyBmb3Igc3VjY2Vzc2Z1bCBjb21wbGV0aW9uXG4gICAgICAgICAgICAgICAgICAgIGF3YWl0IHN0cmVha1ZhbGlkYXRpb25TZXJ2aWNlLmNyZWF0ZUF1ZGl0TG9nKFxuICAgICAgICAgICAgICAgICAgICAgICAgY29tcGxldGlvbi51c2VySWQsXG4gICAgICAgICAgICAgICAgICAgICAgICBcImNvbXBsZXRpb25fcmVjb3JkZWRcIixcbiAgICAgICAgICAgICAgICAgICAgICAgIFwiY29tcGxldGlvblwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgY29tcGxldGlvblJlZi5pZCxcbiAgICAgICAgICAgICAgICAgICAgICAgIG51bGwsXG4gICAgICAgICAgICAgICAgICAgICAgICBjb21wbGV0aW9uRGF0YSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhbGlkYXRpb25SZXN1bHQsXG4gICAgICAgICAgICAgICAgICAgICk7XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gUXVldWUgZm9yIHN5bmMgdG8gb3RoZXIgZGV2aWNlc1xuICAgICAgICAgICAgICAgICAgICBhd2FpdCBzeW5jU2VydmljZS5xdWV1ZU9wZXJhdGlvbih7XG4gICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBcImNvbXBsZXRpb25cIixcbiAgICAgICAgICAgICAgICAgICAgICAgIGFjdGlvbjogXCJjcmVhdGVcIixcbiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGE6IGNvbXBsZXRpb25EYXRhLFxuICAgICAgICAgICAgICAgICAgICAgICAgdXNlcklkOiBjb21wbGV0aW9uLnVzZXJJZCxcbiAgICAgICAgICAgICAgICAgICAgICAgIGhhYml0SWQ6IGNvbXBsZXRpb24uaGFiaXRJZCxcbiAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ld0NvbXBsZXRpb247XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgIGNvbnN0IG1lc3NhZ2UgPSBnZXRVc2VyRnJpZW5kbHlFcnJvck1lc3NhZ2UoZXJyb3IpO1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBGYWlsZWQgdG8gcmVjb3JkIGNvbXBsZXRpb246ICR7bWVzc2FnZX1gKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFJlY29yZCBjb21wbGV0aW9uIGFuZCBjaGVjayBmb3IgbWlsZXN0b25lIGFjaGlldmVtZW50c1xuICAgICAqIFRoaXMgaXMgdGhlIG1haW4gbWV0aG9kIHRoYXQgc2hvdWxkIGJlIGNhbGxlZCB3aGVuIGEgdXNlciBjb21wbGV0ZXMgYSBoYWJpdFxuICAgICAqIFJlcXVpcmVtZW50czogMy4xLCAzLjIsIDUuMVxuICAgICAqL1xuICAgIGFzeW5jIHJlY29yZENvbXBsZXRpb25XaXRoTWlsZXN0b25lQ2hlY2soXG4gICAgICAgIGNvbXBsZXRpb246IE9taXQ8SGFiaXRDb21wbGV0aW9uLCBcImlkXCI+LFxuICAgICk6IFByb21pc2U8e1xuICAgICAgICBjb21wbGV0aW9uOiBIYWJpdENvbXBsZXRpb247XG4gICAgICAgIG5ld01pbGVzdG9uZXM6IFN0cmVha01pbGVzdG9uZVtdO1xuICAgICAgICB1cGRhdGVkU3RyZWFrOiBIYWJpdFN0cmVhaztcbiAgICB9PiB7XG4gICAgICAgIC8vIFJlY29yZCB0aGUgY29tcGxldGlvblxuICAgICAgICBjb25zdCByZWNvcmRlZENvbXBsZXRpb24gPSBhd2FpdCB0aGlzLnJlY29yZENvbXBsZXRpb24oY29tcGxldGlvbik7XG5cbiAgICAgICAgLy8gUmVjYWxjdWxhdGUgc3RyZWFrIHdpdGggdGhlIG5ldyBjb21wbGV0aW9uXG4gICAgICAgIGNvbnN0IHVwZGF0ZWRTdHJlYWsgPSBhd2FpdCB0aGlzLmNhbGN1bGF0ZVN0cmVhayhcbiAgICAgICAgICAgIGNvbXBsZXRpb24uaGFiaXRJZCxcbiAgICAgICAgICAgIGNvbXBsZXRpb24udXNlcklkLFxuICAgICAgICApO1xuXG4gICAgICAgIC8vIENoZWNrIGZvciBuZXcgbWlsZXN0b25lc1xuICAgICAgICBjb25zdCBuZXdNaWxlc3RvbmVzID0gYXdhaXQgdGhpcy5jaGVja01pbGVzdG9uZXModXBkYXRlZFN0cmVhayk7XG5cbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIGNvbXBsZXRpb246IHJlY29yZGVkQ29tcGxldGlvbixcbiAgICAgICAgICAgIG5ld01pbGVzdG9uZXMsXG4gICAgICAgICAgICB1cGRhdGVkU3RyZWFrLFxuICAgICAgICB9O1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFVzZSBhIHN0cmVhayBmcmVlemUgdG8gcHJvdGVjdCBmcm9tIGEgbWlzc2VkIGRheVxuICAgICAqIFJlcXVpcmVtZW50czogNC4xLCA0LjIsIDQuNVxuICAgICAqL1xuICAgIGFzeW5jIHVzZVN0cmVha0ZyZWV6ZShcbiAgICAgICAgaGFiaXRJZDogc3RyaW5nLFxuICAgICAgICB1c2VySWQ6IHN0cmluZyxcbiAgICAgICAgbWlzc2VkRGF0ZTogc3RyaW5nLFxuICAgICk6IFByb21pc2U8Ym9vbGVhbj4ge1xuICAgICAgICBpZiAoIWhhYml0SWQgfHwgIXVzZXJJZCB8fCAhbWlzc2VkRGF0ZSkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiSGFiaXQgSUQsIFVzZXIgSUQsIGFuZCBtaXNzZWQgZGF0ZSBhcmUgcmVxdWlyZWRcIik7XG4gICAgICAgIH1cblxuICAgICAgICB0cnkge1xuICAgICAgICAgICAgcmV0dXJuIGF3YWl0IHJldHJ5V2l0aEJhY2tvZmYoYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgICAgIHJldHVybiBhd2FpdCBydW5UcmFuc2FjdGlvbihkYiwgYXN5bmMgKHRyYW5zYWN0aW9uKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHN0cmVha0lkID0gZ2VuZXJhdGVTdHJlYWtJZCh1c2VySWQsIGhhYml0SWQpO1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBzdHJlYWtzQ29sbGVjdGlvbiA9IGdldEhhYml0U3RyZWFrc0NvbGxlY3Rpb24oKTtcbiAgICAgICAgICAgICAgICAgICAgY29uc3Qgc3RyZWFrRG9jUmVmID0gZG9jKHN0cmVha3NDb2xsZWN0aW9uLCBzdHJlYWtJZCk7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHN0cmVha0RvYyA9IGF3YWl0IHRyYW5zYWN0aW9uLmdldChzdHJlYWtEb2NSZWYpO1xuXG4gICAgICAgICAgICAgICAgICAgIGlmICghc3RyZWFrRG9jLmV4aXN0cygpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJTdHJlYWsgZGF0YSBub3QgZm91bmRcIik7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICBjb25zdCBzdHJlYWsgPSB0cmFuc2Zvcm1GaXJlc3RvcmVUb1N0cmVhayhzdHJlYWtEb2MuZGF0YSgpKTtcblxuICAgICAgICAgICAgICAgICAgICAvLyBWYWxpZGF0ZSB1c2VyIG93bmVyc2hpcFxuICAgICAgICAgICAgICAgICAgICBpZiAoIXZhbGlkYXRlVXNlck93bmVyc2hpcCh1c2VySWQsIHN0cmVhay51c2VySWQpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJVbmF1dGhvcml6ZWQgYWNjZXNzIHRvIHN0cmVhayBkYXRhXCIpO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gQ2hlY2sgaWYgZnJlZXplIGlzIGF2YWlsYWJsZVxuICAgICAgICAgICAgICAgICAgICBpZiAoc3RyZWFrLmZyZWV6ZXNBdmFpbGFibGUgPD0gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gVXNlIHRoZSBmcmVlemVcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgdXBkYXRlZFN0cmVhazogSGFiaXRTdHJlYWsgPSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAuLi5zdHJlYWssXG4gICAgICAgICAgICAgICAgICAgICAgICBmcmVlemVzQXZhaWxhYmxlOiBzdHJlYWsuZnJlZXplc0F2YWlsYWJsZSAtIDEsXG4gICAgICAgICAgICAgICAgICAgICAgICBmcmVlemVzVXNlZDogc3RyZWFrLmZyZWV6ZXNVc2VkICsgMSxcbiAgICAgICAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgICAgICAgICAvLyBDcmVhdGUgYSBcInByb3RlY3RlZFwiIGNvbXBsZXRpb24gcmVjb3JkIGZvciB0aGUgbWlzc2VkIGRhdGVcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgcHJvdGVjdGVkQ29tcGxldGlvbiA9IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGhhYml0SWQsXG4gICAgICAgICAgICAgICAgICAgICAgICB1c2VySWQsXG4gICAgICAgICAgICAgICAgICAgICAgICBjb21wbGV0ZWRBdDogVGltZXN0YW1wLmZyb21EYXRlKHBhcnNlRGF0ZVN0cmluZyhtaXNzZWREYXRlKSksXG4gICAgICAgICAgICAgICAgICAgICAgICB0aW1lem9uZTogZ2V0VXNlclRpbWV6b25lKCksXG4gICAgICAgICAgICAgICAgICAgICAgICBub3RlczogXCJQcm90ZWN0ZWQgYnkgc3RyZWFrIGZyZWV6ZVwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgZGlmZmljdWx0eTogXCJlYXN5XCIgYXMgY29uc3QsXG4gICAgICAgICAgICAgICAgICAgICAgICBjcmVhdGVkQXQ6IHNlcnZlclRpbWVzdGFtcCgpLFxuICAgICAgICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGNvbXBsZXRpb25zQ29sbGVjdGlvbiA9IGdldEhhYml0Q29tcGxldGlvbnNDb2xsZWN0aW9uKCk7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGNvbXBsZXRpb25SZWYgPSBkb2MoY29tcGxldGlvbnNDb2xsZWN0aW9uKTtcbiAgICAgICAgICAgICAgICAgICAgdHJhbnNhY3Rpb24uc2V0KGNvbXBsZXRpb25SZWYsIHByb3RlY3RlZENvbXBsZXRpb24pO1xuXG4gICAgICAgICAgICAgICAgICAgIC8vIFVwZGF0ZSBzdHJlYWsgZGF0YVxuICAgICAgICAgICAgICAgICAgICBjb25zdCBzdHJlYWtEYXRhID0gdHJhbnNmb3JtU3RyZWFrVG9GaXJlc3RvcmUodXBkYXRlZFN0cmVhayk7XG4gICAgICAgICAgICAgICAgICAgIHRyYW5zYWN0aW9uLnNldChzdHJlYWtEb2NSZWYsIHN0cmVha0RhdGEpO1xuXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICBjb25zdCBtZXNzYWdlID0gZ2V0VXNlckZyaWVuZGx5RXJyb3JNZXNzYWdlKGVycm9yKTtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgRmFpbGVkIHRvIHVzZSBzdHJlYWsgZnJlZXplOiAke21lc3NhZ2V9YCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBHZXQgY2FsZW5kYXIgZGF0YSBmb3IgYSBoYWJpdCBzaG93aW5nIGNvbXBsZXRpb24gc3RhdHVzXG4gICAgICogUmVxdWlyZW1lbnRzOiAyLjEsIDIuMiwgMi4zLCAyLjQsIDIuNVxuICAgICAqL1xuICAgIGFzeW5jIGdldEhhYml0Q2FsZW5kYXIoXG4gICAgICAgIGhhYml0SWQ6IHN0cmluZyxcbiAgICAgICAgdXNlcklkOiBzdHJpbmcsXG4gICAgICAgIGRheXM6IG51bWJlcixcbiAgICAgICAgdGltZXpvbmU6IHN0cmluZyxcbiAgICApOiBQcm9taXNlPENhbGVuZGFyRGF5W10+IHtcbiAgICAgICAgaWYgKCFoYWJpdElkIHx8ICF1c2VySWQpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkhhYml0IElEIGFuZCBVc2VyIElEIGFyZSByZXF1aXJlZFwiKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICByZXR1cm4gYXdhaXQgcmV0cnlXaXRoQmFja29mZihhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICAgICAgLy8gR2V0IGRhdGUgcmFuZ2UgZm9yIGNhbGVuZGFyXG4gICAgICAgICAgICAgICAgY29uc3QgZW5kRGF0ZSA9IGdldEN1cnJlbnREYXRlU3RyaW5nKHRpbWV6b25lKTtcbiAgICAgICAgICAgICAgICBjb25zdCBzdGFydERhdGUgPSBmb3JtYXREYXRlVG9TdHJpbmcoXG4gICAgICAgICAgICAgICAgICAgIG5ldyBEYXRlKERhdGUubm93KCkgLSAoZGF5cyAtIDEpICogMjQgKiA2MCAqIDYwICogMTAwMCksXG4gICAgICAgICAgICAgICAgICAgIHRpbWV6b25lLFxuICAgICAgICAgICAgICAgICk7XG5cbiAgICAgICAgICAgICAgICAvLyBHZXQgY29tcGxldGlvbnMgZm9yIHRoZSBkYXRlIHJhbmdlXG4gICAgICAgICAgICAgICAgY29uc3QgY29tcGxldGlvbnNDb2xsZWN0aW9uID0gZ2V0SGFiaXRDb21wbGV0aW9uc0NvbGxlY3Rpb24oKTtcbiAgICAgICAgICAgICAgICBjb25zdCBjb21wbGV0aW9uc1F1ZXJ5ID0gcXVlcnkoXG4gICAgICAgICAgICAgICAgICAgIGNvbXBsZXRpb25zQ29sbGVjdGlvbixcbiAgICAgICAgICAgICAgICAgICAgd2hlcmUoXCJoYWJpdElkXCIsIFwiPT1cIiwgaGFiaXRJZCksXG4gICAgICAgICAgICAgICAgICAgIHdoZXJlKFwidXNlcklkXCIsIFwiPT1cIiwgdXNlcklkKSxcbiAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgICAgIGNvbnN0IGNvbXBsZXRpb25zU25hcHNob3QgPSBhd2FpdCBnZXREb2NzKGNvbXBsZXRpb25zUXVlcnkpO1xuXG4gICAgICAgICAgICAgICAgY29uc3QgY29tcGxldGlvbnMgPSBjb21wbGV0aW9uc1NuYXBzaG90LmRvY3NcbiAgICAgICAgICAgICAgICAgICAgLm1hcCgoZG9jKSA9PiB0cmFuc2Zvcm1GaXJlc3RvcmVUb0NvbXBsZXRpb24oZG9jLmlkLCBkb2MuZGF0YSgpKSlcbiAgICAgICAgICAgICAgICAgICAgLmZpbHRlcigoY29tcGxldGlvbikgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgY29tcERhdGVTdHJpbmcgPSB0aW1lc3RhbXBUb0RhdGVTdHJpbmcoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29tcGxldGlvbi5jb21wbGV0ZWRBdCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aW1lem9uZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gY29tcERhdGVTdHJpbmcgPj0gc3RhcnREYXRlICYmIGNvbXBEYXRlU3RyaW5nIDw9IGVuZERhdGU7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgLy8gR2V0IHN0cmVhayBkYXRhIGZvciBoaWdobGlnaHRpbmdcbiAgICAgICAgICAgICAgICBjb25zdCBzdHJlYWsgPSBhd2FpdCB0aGlzLmdldEhhYml0U3RyZWFrKGhhYml0SWQsIHVzZXJJZCk7XG5cbiAgICAgICAgICAgICAgICAvLyBHZW5lcmF0ZSBjYWxlbmRhciBkYXlzXG4gICAgICAgICAgICAgICAgY29uc3QgZGF0ZVJhbmdlID0gZ2VuZXJhdGVEYXRlUmFuZ2Uoc3RhcnREYXRlLCBlbmREYXRlKTtcbiAgICAgICAgICAgICAgICBjb25zdCBjYWxlbmRhckRheXM6IENhbGVuZGFyRGF5W10gPSBkYXRlUmFuZ2UubWFwKChkYXRlKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGNvbXBsZXRpb24gPSBjb21wbGV0aW9ucy5maW5kKFxuICAgICAgICAgICAgICAgICAgICAgICAgKGNvbXApID0+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGltZXN0YW1wVG9EYXRlU3RyaW5nKGNvbXAuY29tcGxldGVkQXQsIHRpbWV6b25lKSA9PT0gZGF0ZSxcbiAgICAgICAgICAgICAgICAgICAgKTtcblxuICAgICAgICAgICAgICAgICAgICBjb25zdCBpc0luU3RyZWFrID0gdGhpcy5pc0RhdGVJbkN1cnJlbnRTdHJlYWsoZGF0ZSwgc3RyZWFrKTtcblxuICAgICAgICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgZGF0ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbXBsZXRlZDogISFjb21wbGV0aW9uLFxuICAgICAgICAgICAgICAgICAgICAgICAgaXNUb2RheTogaXNUb2RheShkYXRlLCB0aW1lem9uZSksXG4gICAgICAgICAgICAgICAgICAgICAgICBpc0luU3RyZWFrLFxuICAgICAgICAgICAgICAgICAgICAgICAgY29tcGxldGlvblRpbWU6IGNvbXBsZXRpb25cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA/IGNvbXBsZXRpb24uY29tcGxldGVkQXQudG9EYXRlKCkudG9Mb2NhbGVUaW1lU3RyaW5nKClcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA6IHVuZGVmaW5lZCxcbiAgICAgICAgICAgICAgICAgICAgICAgIG5vdGVzOiBjb21wbGV0aW9uPy5ub3RlcyxcbiAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIHJldHVybiBjYWxlbmRhckRheXM7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgIGNvbnN0IG1lc3NhZ2UgPSBnZXRVc2VyRnJpZW5kbHlFcnJvck1lc3NhZ2UoZXJyb3IpO1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBGYWlsZWQgdG8gZ2V0IGhhYml0IGNhbGVuZGFyOiAke21lc3NhZ2V9YCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBDaGVjayBmb3IgbmV3IG1pbGVzdG9uZXMgYW5kIHJldHVybiBhbnkgdGhhdCBzaG91bGQgYmUgY2VsZWJyYXRlZFxuICAgICAqIFJlcXVpcmVtZW50czogMy4xLCAzLjIsIDQuNCwgMTEuMlxuICAgICAqL1xuICAgIGFzeW5jIGNoZWNrTWlsZXN0b25lcyhzdHJlYWs6IEhhYml0U3RyZWFrKTogUHJvbWlzZTxTdHJlYWtNaWxlc3RvbmVbXT4ge1xuICAgICAgICBjb25zdCBuZXdNaWxlc3RvbmVzOiBTdHJlYWtNaWxlc3RvbmVbXSA9IFtdO1xuICAgICAgICBjb25zdCBleGlzdGluZ01pbGVzdG9uZURheXMgPSBzdHJlYWsubWlsZXN0b25lcy5tYXAoKG0pID0+IG0uZGF5cyk7XG5cbiAgICAgICAgZm9yIChjb25zdCBtaWxlc3RvbmVEYXkgb2YgTUlMRVNUT05FX0RBWVMpIHtcbiAgICAgICAgICAgIGlmIChcbiAgICAgICAgICAgICAgICBzdHJlYWsuY3VycmVudFN0cmVhayA+PSBtaWxlc3RvbmVEYXkgJiZcbiAgICAgICAgICAgICAgICAhZXhpc3RpbmdNaWxlc3RvbmVEYXlzLmluY2x1ZGVzKG1pbGVzdG9uZURheSlcbiAgICAgICAgICAgICkge1xuICAgICAgICAgICAgICAgIGNvbnN0IG1pbGVzdG9uZTogU3RyZWFrTWlsZXN0b25lID0ge1xuICAgICAgICAgICAgICAgICAgICBkYXlzOiBtaWxlc3RvbmVEYXksXG4gICAgICAgICAgICAgICAgICAgIGFjaGlldmVkQXQ6IFRpbWVzdGFtcC5ub3coKSxcbiAgICAgICAgICAgICAgICAgICAgY2VsZWJyYXRlZDogZmFsc2UsXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICBuZXdNaWxlc3RvbmVzLnB1c2gobWlsZXN0b25lKTtcblxuICAgICAgICAgICAgICAgIC8vIEF3YXJkIHN0cmVhayBmcmVlemUgZm9yIDMwLWRheSBtaWxlc3RvbmVzIChSZXF1aXJlbWVudCA0LjQpXG4gICAgICAgICAgICAgICAgaWYgKG1pbGVzdG9uZURheSA9PT0gMzApIHtcbiAgICAgICAgICAgICAgICAgICAgc3RyZWFrLmZyZWV6ZXNBdmFpbGFibGUgKz0gMTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICAvLyBVcGRhdGUgc3RyZWFrIHdpdGggbmV3IG1pbGVzdG9uZXNcbiAgICAgICAgaWYgKG5ld01pbGVzdG9uZXMubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgY29uc3QgdXBkYXRlZFN0cmVhazogSGFiaXRTdHJlYWsgPSB7XG4gICAgICAgICAgICAgICAgLi4uc3RyZWFrLFxuICAgICAgICAgICAgICAgIG1pbGVzdG9uZXM6IFsuLi5zdHJlYWsubWlsZXN0b25lcywgLi4ubmV3TWlsZXN0b25lc10sXG4gICAgICAgICAgICAgICAgLy8gVXBkYXRlIGZyZWV6ZXMgaWYgMzAtZGF5IG1pbGVzdG9uZSB3YXMgYWNoaWV2ZWRcbiAgICAgICAgICAgICAgICBmcmVlemVzQXZhaWxhYmxlOiBzdHJlYWsuZnJlZXplc0F2YWlsYWJsZSxcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIGNvbnN0IHN0cmVha0lkID0gZ2VuZXJhdGVTdHJlYWtJZChzdHJlYWsudXNlcklkLCBzdHJlYWsuaGFiaXRJZCk7XG4gICAgICAgICAgICBjb25zdCBzdHJlYWtzQ29sbGVjdGlvbiA9IGdldEhhYml0U3RyZWFrc0NvbGxlY3Rpb24oKTtcbiAgICAgICAgICAgIGNvbnN0IHN0cmVha0RvY1JlZiA9IGRvYyhzdHJlYWtzQ29sbGVjdGlvbiwgc3RyZWFrSWQpO1xuICAgICAgICAgICAgY29uc3Qgc3RyZWFrRGF0YSA9IHRyYW5zZm9ybVN0cmVha1RvRmlyZXN0b3JlKHVwZGF0ZWRTdHJlYWspO1xuXG4gICAgICAgICAgICBhd2FpdCBydW5UcmFuc2FjdGlvbihkYiwgYXN5bmMgKHRyYW5zYWN0aW9uKSA9PiB7XG4gICAgICAgICAgICAgICAgdHJhbnNhY3Rpb24uc2V0KHN0cmVha0RvY1JlZiwgc3RyZWFrRGF0YSk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgLy8gU2VuZCBtaWxlc3RvbmUgbm90aWZpY2F0aW9ucyBmb3IgbmV3IG1pbGVzdG9uZXNcbiAgICAgICAgICAgIC8vIFJlcXVpcmVtZW50czogMTEuMlxuICAgICAgICAgICAgZm9yIChjb25zdCBtaWxlc3RvbmUgb2YgbmV3TWlsZXN0b25lcykge1xuICAgICAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGhhYml0TmFtZSA9IGF3YWl0IHRoaXMuZ2V0SGFiaXROYW1lKHN0cmVhay5oYWJpdElkKTtcbiAgICAgICAgICAgICAgICAgICAgLy8gTm90ZTogTm90aWZpY2F0aW9uIHNlcnZpY2UgaW50ZWdyYXRpb24gd291bGQgYmUgYWRkZWQgaGVyZVxuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcbiAgICAgICAgICAgICAgICAgICAgICAgIGBNaWxlc3RvbmUgYWNoaWV2ZWQ6ICR7bWlsZXN0b25lLmRheXN9IGRheXMgZm9yICR7aGFiaXROYW1lfWAsXG4gICAgICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihcIkVycm9yIGxvZ2dpbmcgbWlsZXN0b25lIGFjaGlldmVtZW50OlwiLCBlcnJvcik7XG4gICAgICAgICAgICAgICAgICAgIC8vIERvbid0IHRocm93IC0gbWlsZXN0b25lIHdhcyBhY2hpZXZlZCBzdWNjZXNzZnVsbHlcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gbmV3TWlsZXN0b25lcztcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBHZXQgc3RyZWFrIGluZm9ybWF0aW9uIGZvciBhIHNwZWNpZmljIGhhYml0XG4gICAgICovXG4gICAgYXN5bmMgZ2V0SGFiaXRTdHJlYWsoXG4gICAgICAgIGhhYml0SWQ6IHN0cmluZyxcbiAgICAgICAgdXNlcklkOiBzdHJpbmcsXG4gICAgKTogUHJvbWlzZTxIYWJpdFN0cmVhayB8IG51bGw+IHtcbiAgICAgICAgaWYgKCFoYWJpdElkIHx8ICF1c2VySWQpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkhhYml0IElEIGFuZCBVc2VyIElEIGFyZSByZXF1aXJlZFwiKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBjb25zdCBzdHJlYWtJZCA9IGdlbmVyYXRlU3RyZWFrSWQodXNlcklkLCBoYWJpdElkKTtcbiAgICAgICAgICAgIGNvbnN0IHN0cmVha3NDb2xsZWN0aW9uID0gZ2V0SGFiaXRTdHJlYWtzQ29sbGVjdGlvbigpO1xuICAgICAgICAgICAgY29uc3Qgc3RyZWFrRG9jUmVmID0gZG9jKHN0cmVha3NDb2xsZWN0aW9uLCBzdHJlYWtJZCk7XG4gICAgICAgICAgICBjb25zdCBzdHJlYWtEb2MgPSBhd2FpdCBnZXREb2Moc3RyZWFrRG9jUmVmKTtcblxuICAgICAgICAgICAgaWYgKCFzdHJlYWtEb2MuZXhpc3RzKCkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgY29uc3Qgc3RyZWFrRGF0YSA9IHN0cmVha0RvYy5kYXRhKCk7XG4gICAgICAgICAgICBpZiAoIXZhbGlkYXRlU3RyZWFrRG9jdW1lbnQoc3RyZWFrRGF0YSkpIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJJbnZhbGlkIHN0cmVhayBkYXRhIGZvcm1hdFwiKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcmV0dXJuIHRyYW5zZm9ybUZpcmVzdG9yZVRvU3RyZWFrKHN0cmVha0RhdGEpO1xuICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgY29uc3QgbWVzc2FnZSA9IGdldFVzZXJGcmllbmRseUVycm9yTWVzc2FnZShlcnJvcik7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYEZhaWxlZCB0byBnZXQgaGFiaXQgc3RyZWFrOiAke21lc3NhZ2V9YCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBHZXQgc3RyZWFrIGluZm9ybWF0aW9uIGZvciBmcmllbmQgZGlzcGxheSB3aXRoIGludGVncml0eSB2ZXJpZmljYXRpb25cbiAgICAgKiBSZXF1aXJlbWVudHM6IDEyLjRcbiAgICAgKi9cbiAgICBhc3luYyBnZXRIYWJpdFN0cmVha0ZvckZyaWVuZChcbiAgICAgICAgaGFiaXRJZDogc3RyaW5nLFxuICAgICAgICB1c2VySWQ6IHN0cmluZyxcbiAgICAgICAgZnJpZW5kSWQ6IHN0cmluZyxcbiAgICApOiBQcm9taXNlPEhhYml0U3RyZWFrIHwgbnVsbD4ge1xuICAgICAgICBpZiAoIWhhYml0SWQgfHwgIXVzZXJJZCB8fCAhZnJpZW5kSWQpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkhhYml0IElELCBVc2VyIElELCBhbmQgRnJpZW5kIElEIGFyZSByZXF1aXJlZFwiKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBjb25zdCBzdHJlYWsgPSBhd2FpdCB0aGlzLmdldEhhYml0U3RyZWFrKGhhYml0SWQsIHVzZXJJZCk7XG5cbiAgICAgICAgICAgIGlmICghc3RyZWFrKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIFZhbGlkYXRlIGRhdGEgaW50ZWdyaXR5IGJlZm9yZSBkaXNwbGF5aW5nIHRvIGZyaWVuZCAoUmVxdWlyZW1lbnRzIDEyLjQpXG4gICAgICAgICAgICBjb25zdCB2YWxpZGF0aW9uUmVzdWx0ID1cbiAgICAgICAgICAgICAgICBhd2FpdCBzdHJlYWtWYWxpZGF0aW9uU2VydmljZS52YWxpZGF0ZURhdGFGb3JGcmllbmREaXNwbGF5KFxuICAgICAgICAgICAgICAgICAgICBzdHJlYWssXG4gICAgICAgICAgICAgICAgICAgIHVzZXJJZCxcbiAgICAgICAgICAgICAgICAgICAgZnJpZW5kSWQsXG4gICAgICAgICAgICAgICAgKTtcblxuICAgICAgICAgICAgaWYgKCF2YWxpZGF0aW9uUmVzdWx0LmlzVmFsaWQpIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLndhcm4oXG4gICAgICAgICAgICAgICAgICAgIFwiU3RyZWFrIGRhdGEgZmFpbGVkIGZyaWVuZCBkaXNwbGF5IHZhbGlkYXRpb246XCIsXG4gICAgICAgICAgICAgICAgICAgIHZhbGlkYXRpb25SZXN1bHQuZXJyb3JzLFxuICAgICAgICAgICAgICAgICk7XG5cbiAgICAgICAgICAgICAgICAvLyBDcmVhdGUgYXVkaXQgbG9nIGZvciBmYWlsZWQgZnJpZW5kIGFjY2Vzc1xuICAgICAgICAgICAgICAgIGF3YWl0IHN0cmVha1ZhbGlkYXRpb25TZXJ2aWNlLmNyZWF0ZUF1ZGl0TG9nKFxuICAgICAgICAgICAgICAgICAgICB1c2VySWQsXG4gICAgICAgICAgICAgICAgICAgIFwiZnJpZW5kX2Rpc3BsYXlfdmFsaWRhdGlvbl9mYWlsZWRcIixcbiAgICAgICAgICAgICAgICAgICAgXCJzdHJlYWtcIixcbiAgICAgICAgICAgICAgICAgICAgZ2VuZXJhdGVTdHJlYWtJZCh1c2VySWQsIGhhYml0SWQpLFxuICAgICAgICAgICAgICAgICAgICBudWxsLFxuICAgICAgICAgICAgICAgICAgICBzdHJlYWssXG4gICAgICAgICAgICAgICAgICAgIHZhbGlkYXRpb25SZXN1bHQsXG4gICAgICAgICAgICAgICAgKTtcblxuICAgICAgICAgICAgICAgIC8vIERvbid0IHNob3cgaW52YWxpZCBkYXRhIHRvIGZyaWVuZHNcbiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gQ3JlYXRlIGF1ZGl0IGxvZyBmb3Igc3VjY2Vzc2Z1bCBmcmllbmQgYWNjZXNzXG4gICAgICAgICAgICBhd2FpdCBzdHJlYWtWYWxpZGF0aW9uU2VydmljZS5jcmVhdGVBdWRpdExvZyhcbiAgICAgICAgICAgICAgICB1c2VySWQsXG4gICAgICAgICAgICAgICAgXCJmcmllbmRfYWNjZXNzZWRfc3RyZWFrXCIsXG4gICAgICAgICAgICAgICAgXCJzdHJlYWtcIixcbiAgICAgICAgICAgICAgICBnZW5lcmF0ZVN0cmVha0lkKHVzZXJJZCwgaGFiaXRJZCksXG4gICAgICAgICAgICAgICAgbnVsbCxcbiAgICAgICAgICAgICAgICB7IGZyaWVuZElkLCBoYWJpdElkIH0sXG4gICAgICAgICAgICAgICAgdmFsaWRhdGlvblJlc3VsdCxcbiAgICAgICAgICAgICk7XG5cbiAgICAgICAgICAgIHJldHVybiBzdHJlYWs7XG4gICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICBjb25zdCBtZXNzYWdlID0gZ2V0VXNlckZyaWVuZGx5RXJyb3JNZXNzYWdlKGVycm9yKTtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgRmFpbGVkIHRvIGdldCBoYWJpdCBzdHJlYWsgZm9yIGZyaWVuZDogJHttZXNzYWdlfWApO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogSW5pdGlhbGl6ZSBzdHJlYWsgZGF0YSBmb3IgYSBuZXcgaGFiaXRcbiAgICAgKi9cbiAgICBhc3luYyBpbml0aWFsaXplSGFiaXRTdHJlYWsoXG4gICAgICAgIGhhYml0SWQ6IHN0cmluZyxcbiAgICAgICAgdXNlcklkOiBzdHJpbmcsXG4gICAgKTogUHJvbWlzZTxIYWJpdFN0cmVhaz4ge1xuICAgICAgICBpZiAoIWhhYml0SWQgfHwgIXVzZXJJZCkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiSGFiaXQgSUQgYW5kIFVzZXIgSUQgYXJlIHJlcXVpcmVkXCIpO1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgY3VycmVudERhdGUgPSBnZXRDdXJyZW50RGF0ZVN0cmluZyhnZXRVc2VyVGltZXpvbmUoKSk7XG4gICAgICAgIGNvbnN0IGluaXRpYWxTdHJlYWs6IEhhYml0U3RyZWFrID0ge1xuICAgICAgICAgICAgaGFiaXRJZCxcbiAgICAgICAgICAgIHVzZXJJZCxcbiAgICAgICAgICAgIGN1cnJlbnRTdHJlYWs6IDAsXG4gICAgICAgICAgICBiZXN0U3RyZWFrOiAwLFxuICAgICAgICAgICAgbGFzdENvbXBsZXRpb25EYXRlOiBcIlwiLFxuICAgICAgICAgICAgc3RyZWFrU3RhcnREYXRlOiBjdXJyZW50RGF0ZSxcbiAgICAgICAgICAgIGZyZWV6ZXNBdmFpbGFibGU6IDAsXG4gICAgICAgICAgICBmcmVlemVzVXNlZDogMCxcbiAgICAgICAgICAgIG1pbGVzdG9uZXM6IFtdLFxuICAgICAgICB9O1xuXG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBjb25zdCBzdHJlYWtJZCA9IGdlbmVyYXRlU3RyZWFrSWQodXNlcklkLCBoYWJpdElkKTtcbiAgICAgICAgICAgIGNvbnN0IHN0cmVha3NDb2xsZWN0aW9uID0gZ2V0SGFiaXRTdHJlYWtzQ29sbGVjdGlvbigpO1xuICAgICAgICAgICAgY29uc3Qgc3RyZWFrRG9jUmVmID0gZG9jKHN0cmVha3NDb2xsZWN0aW9uLCBzdHJlYWtJZCk7XG4gICAgICAgICAgICBjb25zdCBzdHJlYWtEYXRhID0gdHJhbnNmb3JtU3RyZWFrVG9GaXJlc3RvcmUoaW5pdGlhbFN0cmVhayk7XG5cbiAgICAgICAgICAgIGF3YWl0IHJ1blRyYW5zYWN0aW9uKGRiLCBhc3luYyAodHJhbnNhY3Rpb24pID0+IHtcbiAgICAgICAgICAgICAgICB0cmFuc2FjdGlvbi5zZXQoc3RyZWFrRG9jUmVmLCBzdHJlYWtEYXRhKTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICByZXR1cm4gaW5pdGlhbFN0cmVhaztcbiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgIGNvbnN0IG1lc3NhZ2UgPSBnZXRVc2VyRnJpZW5kbHlFcnJvck1lc3NhZ2UoZXJyb3IpO1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBGYWlsZWQgdG8gaW5pdGlhbGl6ZSBoYWJpdCBzdHJlYWs6ICR7bWVzc2FnZX1gKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFJlc2V0IGEgc3RyZWFrICh1c2VkIHdoZW4gc3RyZWFrIGlzIGJyb2tlbiBhbmQgbm8gZnJlZXplIGF2YWlsYWJsZSlcbiAgICAgKiBSZXF1aXJlbWVudHM6IDEuMiwgMTEuM1xuICAgICAqL1xuICAgIGFzeW5jIHJlc2V0U3RyZWFrKFxuICAgICAgICBoYWJpdElkOiBzdHJpbmcsXG4gICAgICAgIHVzZXJJZDogc3RyaW5nLFxuICAgICAgICByZXNldERhdGU6IHN0cmluZyxcbiAgICApOiBQcm9taXNlPEhhYml0U3RyZWFrPiB7XG4gICAgICAgIGlmICghaGFiaXRJZCB8fCAhdXNlcklkIHx8ICFyZXNldERhdGUpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkhhYml0IElELCBVc2VyIElELCBhbmQgcmVzZXQgZGF0ZSBhcmUgcmVxdWlyZWRcIik7XG4gICAgICAgIH1cblxuICAgICAgICB0cnkge1xuICAgICAgICAgICAgcmV0dXJuIGF3YWl0IHJldHJ5V2l0aEJhY2tvZmYoYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgICAgIHJldHVybiBhd2FpdCBydW5UcmFuc2FjdGlvbihkYiwgYXN5bmMgKHRyYW5zYWN0aW9uKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHN0cmVha0lkID0gZ2VuZXJhdGVTdHJlYWtJZCh1c2VySWQsIGhhYml0SWQpO1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBzdHJlYWtzQ29sbGVjdGlvbiA9IGdldEhhYml0U3RyZWFrc0NvbGxlY3Rpb24oKTtcbiAgICAgICAgICAgICAgICAgICAgY29uc3Qgc3RyZWFrRG9jUmVmID0gZG9jKHN0cmVha3NDb2xsZWN0aW9uLCBzdHJlYWtJZCk7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHN0cmVha0RvYyA9IGF3YWl0IHRyYW5zYWN0aW9uLmdldChzdHJlYWtEb2NSZWYpO1xuXG4gICAgICAgICAgICAgICAgICAgIGlmICghc3RyZWFrRG9jLmV4aXN0cygpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJTdHJlYWsgZGF0YSBub3QgZm91bmRcIik7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICBjb25zdCBzdHJlYWsgPSB0cmFuc2Zvcm1GaXJlc3RvcmVUb1N0cmVhayhzdHJlYWtEb2MuZGF0YSgpKTtcblxuICAgICAgICAgICAgICAgICAgICAvLyBWYWxpZGF0ZSB1c2VyIG93bmVyc2hpcFxuICAgICAgICAgICAgICAgICAgICBpZiAoIXZhbGlkYXRlVXNlck93bmVyc2hpcCh1c2VySWQsIHN0cmVhay51c2VySWQpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJVbmF1dGhvcml6ZWQgYWNjZXNzIHRvIHN0cmVhayBkYXRhXCIpO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgY29uc3QgcmVzZXRTdHJlYWs6IEhhYml0U3RyZWFrID0ge1xuICAgICAgICAgICAgICAgICAgICAgICAgLi4uc3RyZWFrLFxuICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudFN0cmVhazogMCxcbiAgICAgICAgICAgICAgICAgICAgICAgIGxhc3RDb21wbGV0aW9uRGF0ZTogXCJcIixcbiAgICAgICAgICAgICAgICAgICAgICAgIHN0cmVha1N0YXJ0RGF0ZTogcmVzZXREYXRlLFxuICAgICAgICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHN0cmVha0RhdGEgPSB0cmFuc2Zvcm1TdHJlYWtUb0ZpcmVzdG9yZShyZXNldFN0cmVhayk7XG4gICAgICAgICAgICAgICAgICAgIHRyYW5zYWN0aW9uLnNldChzdHJlYWtEb2NSZWYsIHN0cmVha0RhdGEpO1xuXG4gICAgICAgICAgICAgICAgICAgIC8vIFNlbmQgcmVjb3Zlcnkgbm90aWZpY2F0aW9uIGFmdGVyIHN0cmVhayBpcyBicm9rZW5cbiAgICAgICAgICAgICAgICAgICAgLy8gUmVxdWlyZW1lbnRzOiAxMS4zXG4gICAgICAgICAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBoYWJpdE5hbWUgPSBhd2FpdCB0aGlzLmdldEhhYml0TmFtZShoYWJpdElkKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFNjaGVkdWxlIHJlY292ZXJ5IG5vdGlmaWNhdGlvbiBmb3IgdG9tb3Jyb3cgKGhhbmRsZWQgYnkgQ2xvdWQgRnVuY3Rpb25zKVxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gVGhlIG5vdGlmaWNhdGlvbiB3aWxsIGJlIHNlbnQgYnkgdGhlIHNjaGVkdWxlZCBmdW5jdGlvblxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYFN0cmVhayBicm9rZW4gZm9yICR7aGFiaXROYW1lfSwgcmVjb3Zlcnkgbm90aWZpY2F0aW9uIHdpbGwgYmUgc2NoZWR1bGVkYCxcbiAgICAgICAgICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKFwiRXJyb3Igc2NoZWR1bGluZyByZWNvdmVyeSBub3RpZmljYXRpb246XCIsIGVycm9yKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIERvbid0IHRocm93IC0gc3RyZWFrIHJlc2V0IHdhcyBzdWNjZXNzZnVsXG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVzZXRTdHJlYWs7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgIGNvbnN0IG1lc3NhZ2UgPSBnZXRVc2VyRnJpZW5kbHlFcnJvck1lc3NhZ2UoZXJyb3IpO1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBGYWlsZWQgdG8gcmVzZXQgc3RyZWFrOiAke21lc3NhZ2V9YCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBQcml2YXRlIGhlbHBlciBtZXRob2RzXG5cbiAgICAvKipcbiAgICAgKiBDYWxjdWxhdGUgc3RyZWFrIGZyb20gY29tcGxldGlvbiByZWNvcmRzXG4gICAgICovXG4gICAgcHJpdmF0ZSBjYWxjdWxhdGVTdHJlYWtGcm9tQ29tcGxldGlvbnMoXG4gICAgICAgIGNvbXBsZXRpb25zOiBIYWJpdENvbXBsZXRpb25bXSxcbiAgICAgICAgaGFiaXRJZDogc3RyaW5nLFxuICAgICAgICB1c2VySWQ6IHN0cmluZyxcbiAgICApOiBIYWJpdFN0cmVhayB7XG4gICAgICAgIGlmIChjb21wbGV0aW9ucy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgaGFiaXRJZCxcbiAgICAgICAgICAgICAgICB1c2VySWQsXG4gICAgICAgICAgICAgICAgY3VycmVudFN0cmVhazogMCxcbiAgICAgICAgICAgICAgICBiZXN0U3RyZWFrOiAwLFxuICAgICAgICAgICAgICAgIGxhc3RDb21wbGV0aW9uRGF0ZTogXCJcIixcbiAgICAgICAgICAgICAgICBzdHJlYWtTdGFydERhdGU6IGdldEN1cnJlbnREYXRlU3RyaW5nKGdldFVzZXJUaW1lem9uZSgpKSxcbiAgICAgICAgICAgICAgICBmcmVlemVzQXZhaWxhYmxlOiAwLFxuICAgICAgICAgICAgICAgIGZyZWV6ZXNVc2VkOiAwLFxuICAgICAgICAgICAgICAgIG1pbGVzdG9uZXM6IFtdLFxuICAgICAgICAgICAgfTtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IHRpbWV6b25lID0gY29tcGxldGlvbnNbMF0/LnRpbWV6b25lIHx8IGdldFVzZXJUaW1lem9uZSgpO1xuICAgICAgICBjb25zdCBjb21wbGV0aW9uRGF0ZXMgPSBjb21wbGV0aW9ucy5tYXAoKGNvbXApID0+XG4gICAgICAgICAgICB0aW1lc3RhbXBUb0RhdGVTdHJpbmcoY29tcC5jb21wbGV0ZWRBdCwgdGltZXpvbmUpLFxuICAgICAgICApO1xuXG4gICAgICAgIC8vIFJlbW92ZSBkdXBsaWNhdGVzIGFuZCBzb3J0XG4gICAgICAgIGNvbnN0IHVuaXF1ZURhdGVzID0gQXJyYXkuZnJvbShuZXcgU2V0KGNvbXBsZXRpb25EYXRlcykpLnNvcnQoKTtcblxuICAgICAgICAvLyBDYWxjdWxhdGUgY3VycmVudCBzdHJlYWsgKGZyb20gbW9zdCByZWNlbnQgY29tcGxldGlvbiBiYWNrd2FyZHMpXG4gICAgICAgIGxldCBjdXJyZW50U3RyZWFrID0gMDtcbiAgICAgICAgbGV0IHN0cmVha1N0YXJ0RGF0ZSA9IFwiXCI7XG4gICAgICAgIGNvbnN0IHRvZGF5ID0gZ2V0Q3VycmVudERhdGVTdHJpbmcodGltZXpvbmUpO1xuICAgICAgICBjb25zdCB5ZXN0ZXJkYXkgPSBmb3JtYXREYXRlVG9TdHJpbmcoXG4gICAgICAgICAgICBuZXcgRGF0ZShEYXRlLm5vdygpIC0gMjQgKiA2MCAqIDYwICogMTAwMCksXG4gICAgICAgICAgICB0aW1lem9uZSxcbiAgICAgICAgKTtcblxuICAgICAgICAvLyBDaGVjayBpZiB0aGVyZSdzIGEgY29tcGxldGlvbiB0b2RheSBvciB5ZXN0ZXJkYXkgdG8gc3RhcnQgY291bnRpbmdcbiAgICAgICAgY29uc3QgbGFzdENvbXBsZXRpb25EYXRlID0gdW5pcXVlRGF0ZXNbdW5pcXVlRGF0ZXMubGVuZ3RoIC0gMV07XG4gICAgICAgIGlmIChsYXN0Q29tcGxldGlvbkRhdGUgPT09IHRvZGF5IHx8IGxhc3RDb21wbGV0aW9uRGF0ZSA9PT0geWVzdGVyZGF5KSB7XG4gICAgICAgICAgICBjdXJyZW50U3RyZWFrID0gMTtcbiAgICAgICAgICAgIHN0cmVha1N0YXJ0RGF0ZSA9IGxhc3RDb21wbGV0aW9uRGF0ZTtcblxuICAgICAgICAgICAgLy8gQ291bnQgYmFja3dhcmRzIGZvciBjb25zZWN1dGl2ZSBkYXlzXG4gICAgICAgICAgICBmb3IgKGxldCBpID0gdW5pcXVlRGF0ZXMubGVuZ3RoIC0gMjsgaSA+PSAwOyBpLS0pIHtcbiAgICAgICAgICAgICAgICBjb25zdCBjdXJyZW50RGF0ZSA9IHVuaXF1ZURhdGVzW2kgKyAxXTtcbiAgICAgICAgICAgICAgICBjb25zdCBwcmV2aW91c0RhdGUgPSB1bmlxdWVEYXRlc1tpXTtcblxuICAgICAgICAgICAgICAgIGlmIChhcmVDb25zZWN1dGl2ZURheXMocHJldmlvdXNEYXRlLCBjdXJyZW50RGF0ZSkpIHtcbiAgICAgICAgICAgICAgICAgICAgY3VycmVudFN0cmVhaysrO1xuICAgICAgICAgICAgICAgICAgICBzdHJlYWtTdGFydERhdGUgPSBwcmV2aW91c0RhdGU7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgLy8gQ2FsY3VsYXRlIGJlc3Qgc3RyZWFrIChsb25nZXN0IGNvbnNlY3V0aXZlIHNlcXVlbmNlKVxuICAgICAgICBsZXQgYmVzdFN0cmVhayA9IDA7XG4gICAgICAgIGxldCB0ZW1wU3RyZWFrID0gMTtcblxuICAgICAgICBmb3IgKGxldCBpID0gMTsgaSA8IHVuaXF1ZURhdGVzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICBpZiAoYXJlQ29uc2VjdXRpdmVEYXlzKHVuaXF1ZURhdGVzW2kgLSAxXSwgdW5pcXVlRGF0ZXNbaV0pKSB7XG4gICAgICAgICAgICAgICAgdGVtcFN0cmVhaysrO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBiZXN0U3RyZWFrID0gTWF0aC5tYXgoYmVzdFN0cmVhaywgdGVtcFN0cmVhayk7XG4gICAgICAgICAgICAgICAgdGVtcFN0cmVhayA9IDE7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgYmVzdFN0cmVhayA9IE1hdGgubWF4KGJlc3RTdHJlYWssIHRlbXBTdHJlYWssIGN1cnJlbnRTdHJlYWspO1xuXG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBoYWJpdElkLFxuICAgICAgICAgICAgdXNlcklkLFxuICAgICAgICAgICAgY3VycmVudFN0cmVhayxcbiAgICAgICAgICAgIGJlc3RTdHJlYWssXG4gICAgICAgICAgICBsYXN0Q29tcGxldGlvbkRhdGUsXG4gICAgICAgICAgICBzdHJlYWtTdGFydERhdGUsXG4gICAgICAgICAgICBmcmVlemVzQXZhaWxhYmxlOiAwLFxuICAgICAgICAgICAgZnJlZXplc1VzZWQ6IDAsXG4gICAgICAgICAgICBtaWxlc3RvbmVzOiBbXSxcbiAgICAgICAgfTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBNZXJnZSBjYWxjdWxhdGVkIHN0cmVhayB3aXRoIGV4aXN0aW5nIHN0cmVhayBkYXRhXG4gICAgICovXG4gICAgcHJpdmF0ZSBtZXJnZVN0cmVha0RhdGEoXG4gICAgICAgIGNhbGN1bGF0ZWQ6IEhhYml0U3RyZWFrLFxuICAgICAgICBleGlzdGluZzogSGFiaXRTdHJlYWsgfCBudWxsLFxuICAgICk6IEhhYml0U3RyZWFrIHtcbiAgICAgICAgaWYgKCFleGlzdGluZykge1xuICAgICAgICAgICAgcmV0dXJuIGNhbGN1bGF0ZWQ7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgLi4uY2FsY3VsYXRlZCxcbiAgICAgICAgICAgIGZyZWV6ZXNBdmFpbGFibGU6IGV4aXN0aW5nLmZyZWV6ZXNBdmFpbGFibGUsXG4gICAgICAgICAgICBmcmVlemVzVXNlZDogZXhpc3RpbmcuZnJlZXplc1VzZWQsXG4gICAgICAgICAgICBtaWxlc3RvbmVzOiBleGlzdGluZy5taWxlc3RvbmVzLFxuICAgICAgICAgICAgLy8gRW5zdXJlIGJlc3Qgc3RyZWFrIG5ldmVyIGRlY3JlYXNlc1xuICAgICAgICAgICAgYmVzdFN0cmVhazogTWF0aC5tYXgoY2FsY3VsYXRlZC5iZXN0U3RyZWFrLCBleGlzdGluZy5iZXN0U3RyZWFrKSxcbiAgICAgICAgfTtcbiAgICB9XG5cbiAgICBwcml2YXRlIGFzeW5jIGdldEhhYml0TmFtZShoYWJpdElkOiBzdHJpbmcpOiBQcm9taXNlPHN0cmluZz4ge1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgLy8gQXNzdW1pbmcgaGFiaXRzIGFyZSBzdG9yZWQgaW4gdGhlIGdvYWxzIGNvbGxlY3Rpb25cbiAgICAgICAgICAgIGNvbnN0IGdvYWxSZWYgPSBkb2MoXG4gICAgICAgICAgICAgICAgZGIsXG4gICAgICAgICAgICAgICAgYGFydGlmYWN0cy9vYXRoLWFwcC9wdWJsaWMvZGF0YS9nb2Fscy8ke2hhYml0SWR9YCxcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgICBjb25zdCBnb2FsRG9jID0gYXdhaXQgZ2V0RG9jKGdvYWxSZWYpO1xuXG4gICAgICAgICAgICBpZiAoZ29hbERvYy5leGlzdHMoKSkge1xuICAgICAgICAgICAgICAgIGNvbnN0IGdvYWxEYXRhID0gZ29hbERvYy5kYXRhKCk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGdvYWxEYXRhLmRlc2NyaXB0aW9uIHx8IFwiWW91ciBoYWJpdFwiO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4gXCJZb3VyIGhhYml0XCI7XG4gICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgZ2V0dGluZyBoYWJpdCBuYW1lOlwiLCBlcnJvcik7XG4gICAgICAgICAgICByZXR1cm4gXCJZb3VyIGhhYml0XCI7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBDaGVjayBpZiBhIGRhdGUgaXMgd2l0aGluIHRoZSBjdXJyZW50IHN0cmVhayBwZXJpb2RcbiAgICAgKi9cbiAgICBwcml2YXRlIGlzRGF0ZUluQ3VycmVudFN0cmVhayhcbiAgICAgICAgZGF0ZTogc3RyaW5nLFxuICAgICAgICBzdHJlYWs6IEhhYml0U3RyZWFrIHwgbnVsbCxcbiAgICApOiBib29sZWFuIHtcbiAgICAgICAgaWYgKCFzdHJlYWsgfHwgc3RyZWFrLmN1cnJlbnRTdHJlYWsgPT09IDAgfHwgIXN0cmVhay5zdHJlYWtTdGFydERhdGUpIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IHN0cmVha1N0YXJ0ID0gcGFyc2VEYXRlU3RyaW5nKHN0cmVhay5zdHJlYWtTdGFydERhdGUpO1xuICAgICAgICBjb25zdCBjaGVja0RhdGUgPSBwYXJzZURhdGVTdHJpbmcoZGF0ZSk7XG4gICAgICAgIGNvbnN0IHN0cmVha0VuZCA9IG5ldyBEYXRlKHN0cmVha1N0YXJ0KTtcbiAgICAgICAgc3RyZWFrRW5kLnNldERhdGUoc3RyZWFrRW5kLmdldERhdGUoKSArIHN0cmVhay5jdXJyZW50U3RyZWFrIC0gMSk7XG5cbiAgICAgICAgcmV0dXJuIGNoZWNrRGF0ZSA+PSBzdHJlYWtTdGFydCAmJiBjaGVja0RhdGUgPD0gc3RyZWFrRW5kO1xuICAgIH1cbn1cblxuLy8gRXhwb3J0IHNpbmdsZXRvbiBpbnN0YW5jZVxuZXhwb3J0IGNvbnN0IHN0cmVha1NlcnZpY2UgPSBuZXcgU3RyZWFrU2VydmljZSgpO1xuIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7QUFBQSxJQUFBQSxVQUFBLEdBQUFDLE9BQUE7QUFVQSxJQUFBQyxlQUFBLEdBQUFELE9BQUE7QUFDQSxJQUFBRSxhQUFBLEdBQUFGLE9BQUE7QUFPQSxJQUFBRyxVQUFBLEdBQUFILE9BQUE7QUFVQSxJQUFBSSxjQUFBLEdBQUFKLE9BQUE7QUFJQSxJQUFBSyxZQUFBLEdBQUFMLE9BQUE7QUFJQSxJQUFBTSxxQkFBQSxHQUFBTixPQUFBO0FBRUEsSUFBQU8sbUJBQUEsR0FBQVAsT0FBQTtBQVFBLElBQUFRLHdCQUFBLEdBQUFSLE9BQUE7QUFDQSxJQUFBUyxZQUFBLEdBQUFULE9BQUE7QUFBNEMsSUFRL0JVLGFBQWEsR0FBQUMsT0FBQSxDQUFBRCxhQUFBO0VBQUEsU0FBQUEsY0FBQTtJQUFBLElBQUFFLGdCQUFBLENBQUFDLE9BQUEsUUFBQUgsYUFBQTtFQUFBO0VBQUEsV0FBQUksYUFBQSxDQUFBRCxPQUFBLEVBQUFILGFBQUE7SUFBQUssR0FBQTtJQUFBQyxLQUFBO01BQUEsSUFBQUMsZ0JBQUEsT0FBQUMsa0JBQUEsQ0FBQUwsT0FBQSxFQUt0QixXQUFzQk0sT0FBZSxFQUFFQyxNQUFjLEVBQXdCO1FBQUEsSUFBQUMsS0FBQTtRQUN6RSxJQUFJLENBQUNGLE9BQU8sSUFBSSxDQUFDQyxNQUFNLEVBQUU7VUFDckIsTUFBTSxJQUFJRSxLQUFLLENBQUMsbUNBQW1DLENBQUM7UUFDeEQ7UUFFQSxJQUFJO1VBQ0EsYUFBYSxJQUFBQywrQkFBZ0IsTUFBQUwsa0JBQUEsQ0FBQUwsT0FBQSxFQUFDLGFBQVk7WUFDdEMsYUFBYSxJQUFBVyx5QkFBYyxFQUFDQyxrQkFBRTtjQUFBLElBQUFDLEtBQUEsT0FBQVIsa0JBQUEsQ0FBQUwsT0FBQSxFQUFFLFdBQU9jLFdBQVcsRUFBSztnQkFFbkQsSUFBTUMsUUFBUSxHQUFHLElBQUFDLG9DQUFnQixFQUFDVCxNQUFNLEVBQUVELE9BQU8sQ0FBQztnQkFDbEQsSUFBTVcsaUJBQWlCLEdBQUcsSUFBQUMsc0NBQXlCLEVBQUMsQ0FBQztnQkFDckQsSUFBTUMsWUFBWSxHQUFHLElBQUFDLGNBQUcsRUFBQ0gsaUJBQWlCLEVBQUVGLFFBQVEsQ0FBQztnQkFDckQsSUFBTU0sU0FBUyxTQUFTUCxXQUFXLENBQUNRLEdBQUcsQ0FBQ0gsWUFBWSxDQUFDO2dCQUdyRCxJQUFNSSxxQkFBcUIsR0FBRyxJQUFBQywwQ0FBNkIsRUFBQyxDQUFDO2dCQUM3RCxJQUFNQyxnQkFBZ0IsR0FBRyxJQUFBQyxnQkFBSyxFQUMxQkgscUJBQXFCLEVBQ3JCLElBQUFJLGdCQUFLLEVBQUMsU0FBUyxFQUFFLElBQUksRUFBRXJCLE9BQU8sQ0FBQyxFQUMvQixJQUFBcUIsZ0JBQUssRUFBQyxRQUFRLEVBQUUsSUFBSSxFQUFFcEIsTUFBTSxDQUNoQyxDQUFDO2dCQUNELElBQU1xQixtQkFBbUIsU0FBUyxJQUFBQyxrQkFBTyxFQUFDSixnQkFBZ0IsQ0FBQztnQkFHM0QsSUFBTUssV0FBVyxHQUFHRixtQkFBbUIsQ0FBQ0csSUFBSSxDQUN2Q0MsR0FBRyxDQUFDLFVBQUNaLEdBQUc7a0JBQUEsT0FBSyxJQUFBYSxrREFBOEIsRUFBQ2IsR0FBRyxDQUFDYyxFQUFFLEVBQUVkLEdBQUcsQ0FBQ2UsSUFBSSxDQUFDLENBQUMsQ0FBQztnQkFBQSxFQUFDLENBQ2hFQyxJQUFJLENBQ0QsVUFBQ0MsQ0FBQyxFQUFFQyxDQUFDO2tCQUFBLE9BQUtELENBQUMsQ0FBQ0UsV0FBVyxDQUFDQyxRQUFRLENBQUMsQ0FBQyxHQUFHRixDQUFDLENBQUNDLFdBQVcsQ0FBQ0MsUUFBUSxDQUFDLENBQUM7Z0JBQUEsQ0FDakUsQ0FBQztnQkFHTCxJQUFNQyxnQkFBZ0IsR0FBR2pDLEtBQUksQ0FBQ2tDLDhCQUE4QixDQUN4RFosV0FBVyxFQUNYeEIsT0FBTyxFQUNQQyxNQUNKLENBQUM7Z0JBR0QsSUFBSW9DLGNBQWtDLEdBQUcsSUFBSTtnQkFDN0MsSUFBSXRCLFNBQVMsQ0FBQ3VCLE1BQU0sQ0FBQyxDQUFDLEVBQUU7a0JBQ3BCRCxjQUFjLEdBQUcsSUFBQUUsOENBQTBCLEVBQUN4QixTQUFTLENBQUNjLElBQUksQ0FBQyxDQUFDLENBQUM7Z0JBQ2pFO2dCQUVBLElBQU1XLGFBQWEsR0FBR3RDLEtBQUksQ0FBQ3VDLGVBQWUsQ0FDdENOLGdCQUFnQixFQUNoQkUsY0FDSixDQUFDO2dCQUdELElBQU1LLGdCQUFnQixTQUNaQyxnREFBdUIsQ0FBQ0MseUJBQXlCLENBQ25ESixhQUFhLEVBQ2JoQixXQUFXLEVBQ1h2QixNQUNKLENBQUM7Z0JBRUwsSUFBSSxDQUFDeUMsZ0JBQWdCLENBQUNHLE9BQU8sRUFBRTtrQkFDM0JDLE9BQU8sQ0FBQ0MsSUFBSSxDQUNSLHVDQUF1QyxFQUN2Q0wsZ0JBQWdCLENBQUNNLE1BQ3JCLENBQUM7a0JBR0QsTUFBTUwsZ0RBQXVCLENBQUNNLGNBQWMsQ0FDeENoRCxNQUFNLEVBQ04sc0NBQXNDLEVBQ3RDLFFBQVEsRUFDUlEsUUFBUSxFQUNSNEIsY0FBYyxFQUNkRyxhQUFhLEVBQ2JFLGdCQUNKLENBQUM7a0JBR0QsSUFBTVEsV0FBVyxHQUFHUixnQkFBZ0IsQ0FBQ1MsYUFBYSxJQUFJWCxhQUFhO2tCQUduRSxJQUFNWSxXQUFVLEdBQUcsSUFBQUMsOENBQTBCLEVBQUNILFdBQVcsQ0FBQztrQkFDMUQxQyxXQUFXLENBQUM4QyxHQUFHLENBQUN6QyxZQUFZLEVBQUV1QyxXQUFVLENBQUM7a0JBRXpDLE9BQU9GLFdBQVc7Z0JBQ3RCO2dCQUdBLElBQU1LLGNBQWMsU0FDVkMsMENBQW9CLENBQUNDLHFCQUFxQixDQUM1Q3pELE9BQU8sRUFDUEMsTUFBTSxFQUNOdUMsYUFDSixDQUFDO2dCQUVMLElBQUksQ0FBQ2UsY0FBYyxDQUFDVixPQUFPLEVBQUU7a0JBQ3pCQyxPQUFPLENBQUNDLElBQUksQ0FDUixtQ0FBbUMsRUFDbkNRLGNBQWMsQ0FBQ1AsTUFDbkIsQ0FBQztrQkFHRCxNQUFNTCxnREFBdUIsQ0FBQ00sY0FBYyxDQUN4Q2hELE1BQU0sRUFDTiwrQkFBK0IsRUFDL0IsUUFBUSxFQUNSUSxRQUFRLEVBQ1I0QixjQUFjLEVBQ2RHLGFBQWEsRUFDYjtvQkFDSUssT0FBTyxFQUFFLEtBQUs7b0JBQ2RHLE1BQU0sRUFBRU8sY0FBYyxDQUFDUCxNQUFNO29CQUM3QlUsUUFBUSxFQUFFSCxjQUFjLENBQUNHO2tCQUM3QixDQUNKLENBQUM7a0JBR0QsSUFBTVIsWUFBVyxHQUFHSyxjQUFjLENBQUNKLGFBQWEsSUFBSVgsYUFBYTtrQkFHakUsSUFBTVksWUFBVSxHQUFHLElBQUFDLDhDQUEwQixFQUFDSCxZQUFXLENBQUM7a0JBQzFEMUMsV0FBVyxDQUFDOEMsR0FBRyxDQUFDekMsWUFBWSxFQUFFdUMsWUFBVSxDQUFDO2tCQUV6QyxPQUFPRixZQUFXO2dCQUN0QjtnQkFHQSxJQUFNRSxVQUFVLEdBQUcsSUFBQUMsOENBQTBCLEVBQUNiLGFBQWEsQ0FBQztnQkFDNURoQyxXQUFXLENBQUM4QyxHQUFHLENBQUN6QyxZQUFZLEVBQUV1QyxVQUFVLENBQUM7Z0JBR3pDLE1BQU1ULGdEQUF1QixDQUFDTSxjQUFjLENBQ3hDaEQsTUFBTSxFQUNOLG1CQUFtQixFQUNuQixRQUFRLEVBQ1JRLFFBQVEsRUFDUjRCLGNBQWMsRUFDZEcsYUFBYSxFQUNiRSxnQkFDSixDQUFDO2dCQUVELE9BQU9GLGFBQWE7Y0FDeEIsQ0FBQztjQUFBLGlCQUFBbUIsR0FBQTtnQkFBQSxPQUFBcEQsS0FBQSxDQUFBcUQsS0FBQSxPQUFBQyxTQUFBO2NBQUE7WUFBQSxJQUFDO1VBQ04sQ0FBQyxFQUFDO1FBQ04sQ0FBQyxDQUFDLE9BQU9DLEtBQUssRUFBRTtVQUNaLElBQU1DLE9BQU8sR0FBRyxJQUFBQywwQ0FBMkIsRUFBQ0YsS0FBSyxDQUFDO1VBQ2xELE1BQU0sSUFBSTNELEtBQUssQ0FBQywrQkFBK0I0RCxPQUFPLEVBQUUsQ0FBQztRQUM3RDtNQUNKLENBQUM7TUFBQSxTQWhKS0UsZUFBZUEsQ0FBQUMsRUFBQSxFQUFBQyxHQUFBO1FBQUEsT0FBQXJFLGdCQUFBLENBQUE4RCxLQUFBLE9BQUFDLFNBQUE7TUFBQTtNQUFBLE9BQWZJLGVBQWU7SUFBQTtFQUFBO0lBQUFyRSxHQUFBO0lBQUFDLEtBQUE7TUFBQSxJQUFBdUUsaUJBQUEsT0FBQXJFLGtCQUFBLENBQUFMLE9BQUEsRUFzSnJCLFdBQ0kyRSxVQUF1QyxFQUNmO1FBQ3hCLElBQUksQ0FBQ0EsVUFBVSxDQUFDckUsT0FBTyxJQUFJLENBQUNxRSxVQUFVLENBQUNwRSxNQUFNLEVBQUU7VUFDM0MsTUFBTSxJQUFJRSxLQUFLLENBQUMsbUNBQW1DLENBQUM7UUFDeEQ7UUFHQSxJQUFNYyxxQkFBcUIsR0FBRyxJQUFBQywwQ0FBNkIsRUFBQyxDQUFDO1FBQzdELElBQU1vRCx3QkFBd0IsR0FBRyxJQUFBbEQsZ0JBQUssRUFDbENILHFCQUFxQixFQUNyQixJQUFBSSxnQkFBSyxFQUFDLFNBQVMsRUFBRSxJQUFJLEVBQUVnRCxVQUFVLENBQUNyRSxPQUFPLENBQUMsRUFDMUMsSUFBQXFCLGdCQUFLLEVBQUMsUUFBUSxFQUFFLElBQUksRUFBRWdELFVBQVUsQ0FBQ3BFLE1BQU0sQ0FDM0MsQ0FBQztRQUNELElBQU1zRSxnQkFBZ0IsU0FBUyxJQUFBaEQsa0JBQU8sRUFBQytDLHdCQUF3QixDQUFDO1FBQ2hFLElBQU1FLG1CQUFtQixHQUFHRCxnQkFBZ0IsQ0FBQzlDLElBQUksQ0FBQ0MsR0FBRyxDQUFDLFVBQUNaLEdBQUc7VUFBQSxPQUN0RCxJQUFBYSxrREFBOEIsRUFBQ2IsR0FBRyxDQUFDYyxFQUFFLEVBQUVkLEdBQUcsQ0FBQ2UsSUFBSSxDQUFDLENBQUMsQ0FBQztRQUFBLENBQ3RELENBQUM7UUFHRCxJQUFNYSxnQkFBZ0IsU0FDWkMsZ0RBQXVCLENBQUM4QixzQkFBc0IsQ0FDaERKLFVBQVUsRUFDVkEsVUFBVSxDQUFDcEUsTUFBTSxFQUNqQnVFLG1CQUNKLENBQUM7UUFFTCxJQUFJLENBQUM5QixnQkFBZ0IsQ0FBQ0csT0FBTyxFQUFFO1VBRTNCLE1BQU1GLGdEQUF1QixDQUFDTSxjQUFjLENBQ3hDb0IsVUFBVSxDQUFDcEUsTUFBTSxFQUNqQiw4QkFBOEIsRUFDOUIsWUFBWSxFQUNaLFNBQVMsRUFDVCxJQUFJLEVBQ0pvRSxVQUFVLEVBQ1YzQixnQkFDSixDQUFDO1VBRUQsTUFBTSxJQUFJdkMsS0FBSyxDQUNYLGlDQUFpQ3VDLGdCQUFnQixDQUFDTSxNQUFNLENBQUMwQixJQUFJLENBQUMsSUFBSSxDQUFDLEVBQ3ZFLENBQUM7UUFDTDtRQUdBLElBQUloQyxnQkFBZ0IsQ0FBQ2lDLGtCQUFrQixFQUFFO1VBQ3JDN0IsT0FBTyxDQUFDQyxJQUFJLENBQ1IsMENBQTBDLEVBQzFDTCxnQkFBZ0IsQ0FBQ2dCLFFBQ3JCLENBQUM7UUFDTDtRQUdBLElBQU1rQixZQUFZLEdBQUdQLFVBQVUsQ0FBQ1EsUUFBUSxJQUFJLElBQUFDLDBCQUFlLEVBQUMsQ0FBQztRQUM3RCxJQUFNQyxvQkFBb0IsR0FBRyxJQUFBQyxnQ0FBcUIsRUFDOUNYLFVBQVUsQ0FBQ3BDLFdBQVcsRUFDdEIyQyxZQUNKLENBQUM7UUFDRCxJQUFNSyxpQkFBaUIsR0FBRyxJQUFBQywrQkFBb0IsRUFBQ04sWUFBWSxDQUFDO1FBRzVELElBQUlHLG9CQUFvQixHQUFHRSxpQkFBaUIsRUFBRTtVQUMxQyxNQUFNLElBQUk5RSxLQUFLLENBQUMsNENBQTRDLENBQUM7UUFDakU7UUFFQSxJQUFJO1VBQ0EsYUFBYSxJQUFBQywrQkFBZ0IsTUFBQUwsa0JBQUEsQ0FBQUwsT0FBQSxFQUFDLGFBQVk7WUFDdEMsYUFBYSxJQUFBVyx5QkFBYyxFQUFDQyxrQkFBRTtjQUFBLElBQUE2RSxLQUFBLE9BQUFwRixrQkFBQSxDQUFBTCxPQUFBLEVBQUUsV0FBT2MsV0FBVyxFQUFLO2dCQUVuRCxJQUFNNEUsT0FBTyxHQUFHWixtQkFBbUIsQ0FBQ2EsTUFBTSxDQUFDLFVBQUNDLElBQUksRUFBSztrQkFDakQsSUFBTUMsY0FBYyxHQUFHLElBQUFQLGdDQUFxQixFQUN4Q00sSUFBSSxDQUFDckQsV0FBVyxFQUNoQjJDLFlBQ0osQ0FBQztrQkFDRCxPQUFPVyxjQUFjLEtBQUtSLG9CQUFvQjtnQkFDbEQsQ0FBQyxDQUFDO2dCQUVGLElBQUlLLE9BQU8sQ0FBQ0ksTUFBTSxHQUFHLENBQUMsRUFBRTtrQkFDcEIsTUFBTSxJQUFJckYsS0FBSyxDQUFDLHVDQUF1QyxDQUFDO2dCQUM1RDtnQkFHQSxJQUFNc0YsY0FBYyxHQUFHO2tCQUNuQnpGLE9BQU8sRUFBRXFFLFVBQVUsQ0FBQ3JFLE9BQU87a0JBQzNCQyxNQUFNLEVBQUVvRSxVQUFVLENBQUNwRSxNQUFNO2tCQUN6QmdDLFdBQVcsRUFBRW9DLFVBQVUsQ0FBQ3BDLFdBQVc7a0JBQ25DNEMsUUFBUSxFQUFFRCxZQUFZO2tCQUN0QmMsS0FBSyxFQUFFckIsVUFBVSxDQUFDcUIsS0FBSyxJQUFJLEVBQUU7a0JBQzdCQyxVQUFVLEVBQUV0QixVQUFVLENBQUNzQixVQUFVO2tCQUNqQ0MsU0FBUyxFQUFFLElBQUFDLDBCQUFlLEVBQUM7Z0JBQy9CLENBQUM7Z0JBRUQsSUFBTUMsYUFBYSxHQUFHLElBQUFoRixjQUFHLEVBQUNHLHFCQUFxQixDQUFDO2dCQUNoRFQsV0FBVyxDQUFDOEMsR0FBRyxDQUFDd0MsYUFBYSxFQUFFTCxjQUFjLENBQUM7Z0JBRTlDLElBQU1NLGFBQThCLEdBQUFDLE1BQUEsQ0FBQUMsTUFBQTtrQkFDaENyRSxFQUFFLEVBQUVrRSxhQUFhLENBQUNsRTtnQkFBRSxHQUNqQnlDLFVBQVU7a0JBQ2JRLFFBQVEsRUFBRUQ7Z0JBQVksRUFDekI7Z0JBR0QsTUFBTWpDLGdEQUF1QixDQUFDTSxjQUFjLENBQ3hDb0IsVUFBVSxDQUFDcEUsTUFBTSxFQUNqQixxQkFBcUIsRUFDckIsWUFBWSxFQUNaNkYsYUFBYSxDQUFDbEUsRUFBRSxFQUNoQixJQUFJLEVBQ0o2RCxjQUFjLEVBQ2QvQyxnQkFDSixDQUFDO2dCQUdELE1BQU13RCx3QkFBVyxDQUFDQyxjQUFjLENBQUM7a0JBQzdCQyxJQUFJLEVBQUUsWUFBWTtrQkFDbEJDLE1BQU0sRUFBRSxRQUFRO2tCQUNoQnhFLElBQUksRUFBRTRELGNBQWM7a0JBQ3BCeEYsTUFBTSxFQUFFb0UsVUFBVSxDQUFDcEUsTUFBTTtrQkFDekJELE9BQU8sRUFBRXFFLFVBQVUsQ0FBQ3JFO2dCQUN4QixDQUFDLENBQUM7Z0JBRUYsT0FBTytGLGFBQWE7Y0FDeEIsQ0FBQztjQUFBLGlCQUFBTyxHQUFBO2dCQUFBLE9BQUFuQixLQUFBLENBQUF2QixLQUFBLE9BQUFDLFNBQUE7Y0FBQTtZQUFBLElBQUM7VUFDTixDQUFDLEVBQUM7UUFDTixDQUFDLENBQUMsT0FBT0MsS0FBSyxFQUFFO1VBQ1osSUFBTUMsT0FBTyxHQUFHLElBQUFDLDBDQUEyQixFQUFDRixLQUFLLENBQUM7VUFDbEQsTUFBTSxJQUFJM0QsS0FBSyxDQUFDLGdDQUFnQzRELE9BQU8sRUFBRSxDQUFDO1FBQzlEO01BQ0osQ0FBQztNQUFBLFNBaElLd0MsZ0JBQWdCQSxDQUFBQyxHQUFBO1FBQUEsT0FBQXBDLGlCQUFBLENBQUFSLEtBQUEsT0FBQUMsU0FBQTtNQUFBO01BQUEsT0FBaEIwQyxnQkFBZ0I7SUFBQTtFQUFBO0lBQUEzRyxHQUFBO0lBQUFDLEtBQUE7TUFBQSxJQUFBNEcsbUNBQUEsT0FBQTFHLGtCQUFBLENBQUFMLE9BQUEsRUF1SXRCLFdBQ0kyRSxVQUF1QyxFQUt4QztRQUVDLElBQU1xQyxrQkFBa0IsU0FBUyxJQUFJLENBQUNILGdCQUFnQixDQUFDbEMsVUFBVSxDQUFDO1FBR2xFLElBQU03QixhQUFhLFNBQVMsSUFBSSxDQUFDeUIsZUFBZSxDQUM1Q0ksVUFBVSxDQUFDckUsT0FBTyxFQUNsQnFFLFVBQVUsQ0FBQ3BFLE1BQ2YsQ0FBQztRQUdELElBQU0wRyxhQUFhLFNBQVMsSUFBSSxDQUFDQyxlQUFlLENBQUNwRSxhQUFhLENBQUM7UUFFL0QsT0FBTztVQUNINkIsVUFBVSxFQUFFcUMsa0JBQWtCO1VBQzlCQyxhQUFhLEVBQWJBLGFBQWE7VUFDYm5FLGFBQWEsRUFBYkE7UUFDSixDQUFDO01BQ0wsQ0FBQztNQUFBLFNBeEJLcUUsa0NBQWtDQSxDQUFBQyxHQUFBO1FBQUEsT0FBQUwsbUNBQUEsQ0FBQTdDLEtBQUEsT0FBQUMsU0FBQTtNQUFBO01BQUEsT0FBbENnRCxrQ0FBa0M7SUFBQTtFQUFBO0lBQUFqSCxHQUFBO0lBQUFDLEtBQUE7TUFBQSxJQUFBa0gsZ0JBQUEsT0FBQWhILGtCQUFBLENBQUFMLE9BQUEsRUE4QnhDLFdBQ0lNLE9BQWUsRUFDZkMsTUFBYyxFQUNkK0csVUFBa0IsRUFDRjtRQUNoQixJQUFJLENBQUNoSCxPQUFPLElBQUksQ0FBQ0MsTUFBTSxJQUFJLENBQUMrRyxVQUFVLEVBQUU7VUFDcEMsTUFBTSxJQUFJN0csS0FBSyxDQUFDLGlEQUFpRCxDQUFDO1FBQ3RFO1FBRUEsSUFBSTtVQUNBLGFBQWEsSUFBQUMsK0JBQWdCLE1BQUFMLGtCQUFBLENBQUFMLE9BQUEsRUFBQyxhQUFZO1lBQ3RDLGFBQWEsSUFBQVcseUJBQWMsRUFBQ0Msa0JBQUU7Y0FBQSxJQUFBMkcsS0FBQSxPQUFBbEgsa0JBQUEsQ0FBQUwsT0FBQSxFQUFFLFdBQU9jLFdBQVcsRUFBSztnQkFDbkQsSUFBTUMsUUFBUSxHQUFHLElBQUFDLG9DQUFnQixFQUFDVCxNQUFNLEVBQUVELE9BQU8sQ0FBQztnQkFDbEQsSUFBTVcsaUJBQWlCLEdBQUcsSUFBQUMsc0NBQXlCLEVBQUMsQ0FBQztnQkFDckQsSUFBTUMsWUFBWSxHQUFHLElBQUFDLGNBQUcsRUFBQ0gsaUJBQWlCLEVBQUVGLFFBQVEsQ0FBQztnQkFDckQsSUFBTU0sU0FBUyxTQUFTUCxXQUFXLENBQUNRLEdBQUcsQ0FBQ0gsWUFBWSxDQUFDO2dCQUVyRCxJQUFJLENBQUNFLFNBQVMsQ0FBQ3VCLE1BQU0sQ0FBQyxDQUFDLEVBQUU7a0JBQ3JCLE1BQU0sSUFBSW5DLEtBQUssQ0FBQyx1QkFBdUIsQ0FBQztnQkFDNUM7Z0JBRUEsSUFBTStHLE1BQU0sR0FBRyxJQUFBM0UsOENBQTBCLEVBQUN4QixTQUFTLENBQUNjLElBQUksQ0FBQyxDQUFDLENBQUM7Z0JBRzNELElBQUksQ0FBQyxJQUFBc0YseUNBQXFCLEVBQUNsSCxNQUFNLEVBQUVpSCxNQUFNLENBQUNqSCxNQUFNLENBQUMsRUFBRTtrQkFDL0MsTUFBTSxJQUFJRSxLQUFLLENBQUMsb0NBQW9DLENBQUM7Z0JBQ3pEO2dCQUdBLElBQUkrRyxNQUFNLENBQUNFLGdCQUFnQixJQUFJLENBQUMsRUFBRTtrQkFDOUIsT0FBTyxLQUFLO2dCQUNoQjtnQkFHQSxJQUFNNUUsYUFBMEIsR0FBQXdELE1BQUEsQ0FBQUMsTUFBQSxLQUN6QmlCLE1BQU07a0JBQ1RFLGdCQUFnQixFQUFFRixNQUFNLENBQUNFLGdCQUFnQixHQUFHLENBQUM7a0JBQzdDQyxXQUFXLEVBQUVILE1BQU0sQ0FBQ0csV0FBVyxHQUFHO2dCQUFDLEVBQ3RDO2dCQUdELElBQU1DLG1CQUFtQixHQUFHO2tCQUN4QnRILE9BQU8sRUFBUEEsT0FBTztrQkFDUEMsTUFBTSxFQUFOQSxNQUFNO2tCQUNOZ0MsV0FBVyxFQUFFc0Ysb0JBQVMsQ0FBQ0MsUUFBUSxDQUFDLElBQUFDLDBCQUFlLEVBQUNULFVBQVUsQ0FBQyxDQUFDO2tCQUM1RG5DLFFBQVEsRUFBRSxJQUFBQywwQkFBZSxFQUFDLENBQUM7a0JBQzNCWSxLQUFLLEVBQUUsNEJBQTRCO2tCQUNuQ0MsVUFBVSxFQUFFLE1BQWU7a0JBQzNCQyxTQUFTLEVBQUUsSUFBQUMsMEJBQWUsRUFBQztnQkFDL0IsQ0FBQztnQkFFRCxJQUFNNUUscUJBQXFCLEdBQUcsSUFBQUMsMENBQTZCLEVBQUMsQ0FBQztnQkFDN0QsSUFBTTRFLGFBQWEsR0FBRyxJQUFBaEYsY0FBRyxFQUFDRyxxQkFBcUIsQ0FBQztnQkFDaERULFdBQVcsQ0FBQzhDLEdBQUcsQ0FBQ3dDLGFBQWEsRUFBRXdCLG1CQUFtQixDQUFDO2dCQUduRCxJQUFNbEUsVUFBVSxHQUFHLElBQUFDLDhDQUEwQixFQUFDYixhQUFhLENBQUM7Z0JBQzVEaEMsV0FBVyxDQUFDOEMsR0FBRyxDQUFDekMsWUFBWSxFQUFFdUMsVUFBVSxDQUFDO2dCQUV6QyxPQUFPLElBQUk7Y0FDZixDQUFDO2NBQUEsaUJBQUFzRSxHQUFBO2dCQUFBLE9BQUFULEtBQUEsQ0FBQXJELEtBQUEsT0FBQUMsU0FBQTtjQUFBO1lBQUEsSUFBQztVQUNOLENBQUMsRUFBQztRQUNOLENBQUMsQ0FBQyxPQUFPQyxLQUFLLEVBQUU7VUFDWixJQUFNQyxPQUFPLEdBQUcsSUFBQUMsMENBQTJCLEVBQUNGLEtBQUssQ0FBQztVQUNsRCxNQUFNLElBQUkzRCxLQUFLLENBQUMsZ0NBQWdDNEQsT0FBTyxFQUFFLENBQUM7UUFDOUQ7TUFDSixDQUFDO01BQUEsU0FsRUs0RCxlQUFlQSxDQUFBQyxHQUFBLEVBQUFDLEdBQUEsRUFBQUMsR0FBQTtRQUFBLE9BQUFmLGdCQUFBLENBQUFuRCxLQUFBLE9BQUFDLFNBQUE7TUFBQTtNQUFBLE9BQWY4RCxlQUFlO0lBQUE7RUFBQTtJQUFBL0gsR0FBQTtJQUFBQyxLQUFBO01BQUEsSUFBQWtJLGlCQUFBLE9BQUFoSSxrQkFBQSxDQUFBTCxPQUFBLEVBd0VyQixXQUNJTSxPQUFlLEVBQ2ZDLE1BQWMsRUFDZCtILElBQVksRUFDWm5ELFFBQWdCLEVBQ007UUFBQSxJQUFBb0QsTUFBQTtRQUN0QixJQUFJLENBQUNqSSxPQUFPLElBQUksQ0FBQ0MsTUFBTSxFQUFFO1VBQ3JCLE1BQU0sSUFBSUUsS0FBSyxDQUFDLG1DQUFtQyxDQUFDO1FBQ3hEO1FBRUEsSUFBSTtVQUNBLGFBQWEsSUFBQUMsK0JBQWdCLE1BQUFMLGtCQUFBLENBQUFMLE9BQUEsRUFBQyxhQUFZO1lBRXRDLElBQU13SSxPQUFPLEdBQUcsSUFBQWhELCtCQUFvQixFQUFDTCxRQUFRLENBQUM7WUFDOUMsSUFBTXNELFNBQVMsR0FBRyxJQUFBQyw2QkFBa0IsRUFDaEMsSUFBSUMsSUFBSSxDQUFDQSxJQUFJLENBQUNDLEdBQUcsQ0FBQyxDQUFDLEdBQUcsQ0FBQ04sSUFBSSxHQUFHLENBQUMsSUFBSSxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxJQUFJLENBQUMsRUFDdkRuRCxRQUNKLENBQUM7WUFHRCxJQUFNNUQscUJBQXFCLEdBQUcsSUFBQUMsMENBQTZCLEVBQUMsQ0FBQztZQUM3RCxJQUFNQyxnQkFBZ0IsR0FBRyxJQUFBQyxnQkFBSyxFQUMxQkgscUJBQXFCLEVBQ3JCLElBQUFJLGdCQUFLLEVBQUMsU0FBUyxFQUFFLElBQUksRUFBRXJCLE9BQU8sQ0FBQyxFQUMvQixJQUFBcUIsZ0JBQUssRUFBQyxRQUFRLEVBQUUsSUFBSSxFQUFFcEIsTUFBTSxDQUNoQyxDQUFDO1lBQ0QsSUFBTXFCLG1CQUFtQixTQUFTLElBQUFDLGtCQUFPLEVBQUNKLGdCQUFnQixDQUFDO1lBRTNELElBQU1LLFdBQVcsR0FBR0YsbUJBQW1CLENBQUNHLElBQUksQ0FDdkNDLEdBQUcsQ0FBQyxVQUFDWixHQUFHO2NBQUEsT0FBSyxJQUFBYSxrREFBOEIsRUFBQ2IsR0FBRyxDQUFDYyxFQUFFLEVBQUVkLEdBQUcsQ0FBQ2UsSUFBSSxDQUFDLENBQUMsQ0FBQztZQUFBLEVBQUMsQ0FDaEV3RCxNQUFNLENBQUMsVUFBQ2hCLFVBQVUsRUFBSztjQUNwQixJQUFNa0IsY0FBYyxHQUFHLElBQUFQLGdDQUFxQixFQUN4Q1gsVUFBVSxDQUFDcEMsV0FBVyxFQUN0QjRDLFFBQ0osQ0FBQztjQUNELE9BQU9VLGNBQWMsSUFBSTRDLFNBQVMsSUFBSTVDLGNBQWMsSUFBSTJDLE9BQU87WUFDbkUsQ0FBQyxDQUFDO1lBR04sSUFBTWhCLE1BQU0sU0FBU2UsTUFBSSxDQUFDTSxjQUFjLENBQUN2SSxPQUFPLEVBQUVDLE1BQU0sQ0FBQztZQUd6RCxJQUFNdUksU0FBUyxHQUFHLElBQUFDLDRCQUFpQixFQUFDTixTQUFTLEVBQUVELE9BQU8sQ0FBQztZQUN2RCxJQUFNUSxZQUEyQixHQUFHRixTQUFTLENBQUM5RyxHQUFHLENBQUMsVUFBQ2lILElBQUksRUFBSztjQUN4RCxJQUFNdEUsVUFBVSxHQUFHN0MsV0FBVyxDQUFDb0gsSUFBSSxDQUMvQixVQUFDdEQsSUFBSTtnQkFBQSxPQUNELElBQUFOLGdDQUFxQixFQUFDTSxJQUFJLENBQUNyRCxXQUFXLEVBQUU0QyxRQUFRLENBQUMsS0FBSzhELElBQUk7Y0FBQSxDQUNsRSxDQUFDO2NBRUQsSUFBTUUsVUFBVSxHQUFHWixNQUFJLENBQUNhLHFCQUFxQixDQUFDSCxJQUFJLEVBQUV6QixNQUFNLENBQUM7Y0FFM0QsT0FBTztnQkFDSHlCLElBQUksRUFBSkEsSUFBSTtnQkFDSkksU0FBUyxFQUFFLENBQUMsQ0FBQzFFLFVBQVU7Z0JBQ3ZCMkUsT0FBTyxFQUFFLElBQUFBLGtCQUFPLEVBQUNMLElBQUksRUFBRTlELFFBQVEsQ0FBQztnQkFDaENnRSxVQUFVLEVBQVZBLFVBQVU7Z0JBQ1ZJLGNBQWMsRUFBRTVFLFVBQVUsR0FDcEJBLFVBQVUsQ0FBQ3BDLFdBQVcsQ0FBQ2lILE1BQU0sQ0FBQyxDQUFDLENBQUNDLGtCQUFrQixDQUFDLENBQUMsR0FDcERDLFNBQVM7Z0JBQ2YxRCxLQUFLLEVBQUVyQixVQUFVLG9CQUFWQSxVQUFVLENBQUVxQjtjQUN2QixDQUFDO1lBQ0wsQ0FBQyxDQUFDO1lBRUYsT0FBT2dELFlBQVk7VUFDdkIsQ0FBQyxFQUFDO1FBQ04sQ0FBQyxDQUFDLE9BQU81RSxLQUFLLEVBQUU7VUFDWixJQUFNQyxPQUFPLEdBQUcsSUFBQUMsMENBQTJCLEVBQUNGLEtBQUssQ0FBQztVQUNsRCxNQUFNLElBQUkzRCxLQUFLLENBQUMsaUNBQWlDNEQsT0FBTyxFQUFFLENBQUM7UUFDL0Q7TUFDSixDQUFDO01BQUEsU0FyRUtzRixnQkFBZ0JBLENBQUFDLEdBQUEsRUFBQUMsSUFBQSxFQUFBQyxJQUFBLEVBQUFDLElBQUE7UUFBQSxPQUFBMUIsaUJBQUEsQ0FBQW5FLEtBQUEsT0FBQUMsU0FBQTtNQUFBO01BQUEsT0FBaEJ3RixnQkFBZ0I7SUFBQTtFQUFBO0lBQUF6SixHQUFBO0lBQUFDLEtBQUE7TUFBQSxJQUFBNkosZ0JBQUEsT0FBQTNKLGtCQUFBLENBQUFMLE9BQUEsRUEyRXRCLFdBQXNCd0gsTUFBbUIsRUFBOEI7UUFDbkUsSUFBTVAsYUFBZ0MsR0FBRyxFQUFFO1FBQzNDLElBQU1nRCxxQkFBcUIsR0FBR3pDLE1BQU0sQ0FBQzBDLFVBQVUsQ0FBQ2xJLEdBQUcsQ0FBQyxVQUFDbUksQ0FBQztVQUFBLE9BQUtBLENBQUMsQ0FBQzdCLElBQUk7UUFBQSxFQUFDO1FBRWxFLEtBQUssSUFBTThCLFlBQVksSUFBSUMsNEJBQWMsRUFBRTtVQUN2QyxJQUNJN0MsTUFBTSxDQUFDOEMsYUFBYSxJQUFJRixZQUFZLElBQ3BDLENBQUNILHFCQUFxQixDQUFDTSxRQUFRLENBQUNILFlBQVksQ0FBQyxFQUMvQztZQUNFLElBQU1JLFNBQTBCLEdBQUc7Y0FDL0JsQyxJQUFJLEVBQUU4QixZQUFZO2NBQ2xCSyxVQUFVLEVBQUU1QyxvQkFBUyxDQUFDZSxHQUFHLENBQUMsQ0FBQztjQUMzQjhCLFVBQVUsRUFBRTtZQUNoQixDQUFDO1lBQ0R6RCxhQUFhLENBQUMwRCxJQUFJLENBQUNILFNBQVMsQ0FBQztZQUc3QixJQUFJSixZQUFZLEtBQUssRUFBRSxFQUFFO2NBQ3JCNUMsTUFBTSxDQUFDRSxnQkFBZ0IsSUFBSSxDQUFDO1lBQ2hDO1VBQ0o7UUFDSjtRQUdBLElBQUlULGFBQWEsQ0FBQ25CLE1BQU0sR0FBRyxDQUFDLEVBQUU7VUFDMUIsSUFBTWhELGFBQTBCLEdBQUF3RCxNQUFBLENBQUFDLE1BQUEsS0FDekJpQixNQUFNO1lBQ1QwQyxVQUFVLEtBQUFVLE1BQUEsS0FBQUMsbUJBQUEsQ0FBQTdLLE9BQUEsRUFBTXdILE1BQU0sQ0FBQzBDLFVBQVUsR0FBS2pELGFBQWEsQ0FBQztZQUVwRFMsZ0JBQWdCLEVBQUVGLE1BQU0sQ0FBQ0U7VUFBZ0IsRUFDNUM7VUFFRCxJQUFNM0csUUFBUSxHQUFHLElBQUFDLG9DQUFnQixFQUFDd0csTUFBTSxDQUFDakgsTUFBTSxFQUFFaUgsTUFBTSxDQUFDbEgsT0FBTyxDQUFDO1VBQ2hFLElBQU1XLGlCQUFpQixHQUFHLElBQUFDLHNDQUF5QixFQUFDLENBQUM7VUFDckQsSUFBTUMsWUFBWSxHQUFHLElBQUFDLGNBQUcsRUFBQ0gsaUJBQWlCLEVBQUVGLFFBQVEsQ0FBQztVQUNyRCxJQUFNMkMsVUFBVSxHQUFHLElBQUFDLDhDQUEwQixFQUFDYixhQUFhLENBQUM7VUFFNUQsTUFBTSxJQUFBbkMseUJBQWMsRUFBQ0Msa0JBQUU7WUFBQSxJQUFBa0ssS0FBQSxPQUFBekssa0JBQUEsQ0FBQUwsT0FBQSxFQUFFLFdBQU9jLFdBQVcsRUFBSztjQUM1Q0EsV0FBVyxDQUFDOEMsR0FBRyxDQUFDekMsWUFBWSxFQUFFdUMsVUFBVSxDQUFDO1lBQzdDLENBQUM7WUFBQSxpQkFBQXFILElBQUE7Y0FBQSxPQUFBRCxLQUFBLENBQUE1RyxLQUFBLE9BQUFDLFNBQUE7WUFBQTtVQUFBLElBQUM7VUFJRixLQUFLLElBQU1xRyxVQUFTLElBQUl2RCxhQUFhLEVBQUU7WUFDbkMsSUFBSTtjQUNBLElBQU0rRCxTQUFTLFNBQVMsSUFBSSxDQUFDQyxZQUFZLENBQUN6RCxNQUFNLENBQUNsSCxPQUFPLENBQUM7Y0FFekQ4QyxPQUFPLENBQUM4SCxHQUFHLENBQ1AsdUJBQXVCVixVQUFTLENBQUNsQyxJQUFJLGFBQWEwQyxTQUFTLEVBQy9ELENBQUM7WUFDTCxDQUFDLENBQUMsT0FBTzVHLEtBQUssRUFBRTtjQUNaaEIsT0FBTyxDQUFDZ0IsS0FBSyxDQUFDLHNDQUFzQyxFQUFFQSxLQUFLLENBQUM7WUFFaEU7VUFDSjtRQUNKO1FBRUEsT0FBTzZDLGFBQWE7TUFDeEIsQ0FBQztNQUFBLFNBMURLQyxlQUFlQSxDQUFBaUUsSUFBQTtRQUFBLE9BQUFuQixnQkFBQSxDQUFBOUYsS0FBQSxPQUFBQyxTQUFBO01BQUE7TUFBQSxPQUFmK0MsZUFBZTtJQUFBO0VBQUE7SUFBQWhILEdBQUE7SUFBQUMsS0FBQTtNQUFBLElBQUFpTCxlQUFBLE9BQUEvSyxrQkFBQSxDQUFBTCxPQUFBLEVBK0RyQixXQUNJTSxPQUFlLEVBQ2ZDLE1BQWMsRUFDYTtRQUMzQixJQUFJLENBQUNELE9BQU8sSUFBSSxDQUFDQyxNQUFNLEVBQUU7VUFDckIsTUFBTSxJQUFJRSxLQUFLLENBQUMsbUNBQW1DLENBQUM7UUFDeEQ7UUFFQSxJQUFJO1VBQ0EsSUFBTU0sUUFBUSxHQUFHLElBQUFDLG9DQUFnQixFQUFDVCxNQUFNLEVBQUVELE9BQU8sQ0FBQztVQUNsRCxJQUFNVyxpQkFBaUIsR0FBRyxJQUFBQyxzQ0FBeUIsRUFBQyxDQUFDO1VBQ3JELElBQU1DLFlBQVksR0FBRyxJQUFBQyxjQUFHLEVBQUNILGlCQUFpQixFQUFFRixRQUFRLENBQUM7VUFDckQsSUFBTU0sU0FBUyxTQUFTLElBQUFnSyxpQkFBTSxFQUFDbEssWUFBWSxDQUFDO1VBRTVDLElBQUksQ0FBQ0UsU0FBUyxDQUFDdUIsTUFBTSxDQUFDLENBQUMsRUFBRTtZQUNyQixPQUFPLElBQUk7VUFDZjtVQUVBLElBQU1jLFVBQVUsR0FBR3JDLFNBQVMsQ0FBQ2MsSUFBSSxDQUFDLENBQUM7VUFDbkMsSUFBSSxDQUFDLElBQUFtSiwwQ0FBc0IsRUFBQzVILFVBQVUsQ0FBQyxFQUFFO1lBQ3JDLE1BQU0sSUFBSWpELEtBQUssQ0FBQyw0QkFBNEIsQ0FBQztVQUNqRDtVQUVBLE9BQU8sSUFBQW9DLDhDQUEwQixFQUFDYSxVQUFVLENBQUM7UUFDakQsQ0FBQyxDQUFDLE9BQU9VLEtBQUssRUFBRTtVQUNaLElBQU1DLE9BQU8sR0FBRyxJQUFBQywwQ0FBMkIsRUFBQ0YsS0FBSyxDQUFDO1VBQ2xELE1BQU0sSUFBSTNELEtBQUssQ0FBQywrQkFBK0I0RCxPQUFPLEVBQUUsQ0FBQztRQUM3RDtNQUNKLENBQUM7TUFBQSxTQTVCS3dFLGNBQWNBLENBQUEwQyxJQUFBLEVBQUFDLElBQUE7UUFBQSxPQUFBSixlQUFBLENBQUFsSCxLQUFBLE9BQUFDLFNBQUE7TUFBQTtNQUFBLE9BQWQwRSxjQUFjO0lBQUE7RUFBQTtJQUFBM0ksR0FBQTtJQUFBQyxLQUFBO01BQUEsSUFBQXNMLHdCQUFBLE9BQUFwTCxrQkFBQSxDQUFBTCxPQUFBLEVBa0NwQixXQUNJTSxPQUFlLEVBQ2ZDLE1BQWMsRUFDZG1MLFFBQWdCLEVBQ1c7UUFDM0IsSUFBSSxDQUFDcEwsT0FBTyxJQUFJLENBQUNDLE1BQU0sSUFBSSxDQUFDbUwsUUFBUSxFQUFFO1VBQ2xDLE1BQU0sSUFBSWpMLEtBQUssQ0FBQywrQ0FBK0MsQ0FBQztRQUNwRTtRQUVBLElBQUk7VUFDQSxJQUFNK0csTUFBTSxTQUFTLElBQUksQ0FBQ3FCLGNBQWMsQ0FBQ3ZJLE9BQU8sRUFBRUMsTUFBTSxDQUFDO1VBRXpELElBQUksQ0FBQ2lILE1BQU0sRUFBRTtZQUNULE9BQU8sSUFBSTtVQUNmO1VBR0EsSUFBTXhFLGdCQUFnQixTQUNaQyxnREFBdUIsQ0FBQzBJLDRCQUE0QixDQUN0RG5FLE1BQU0sRUFDTmpILE1BQU0sRUFDTm1MLFFBQ0osQ0FBQztVQUVMLElBQUksQ0FBQzFJLGdCQUFnQixDQUFDRyxPQUFPLEVBQUU7WUFDM0JDLE9BQU8sQ0FBQ0MsSUFBSSxDQUNSLCtDQUErQyxFQUMvQ0wsZ0JBQWdCLENBQUNNLE1BQ3JCLENBQUM7WUFHRCxNQUFNTCxnREFBdUIsQ0FBQ00sY0FBYyxDQUN4Q2hELE1BQU0sRUFDTixrQ0FBa0MsRUFDbEMsUUFBUSxFQUNSLElBQUFTLG9DQUFnQixFQUFDVCxNQUFNLEVBQUVELE9BQU8sQ0FBQyxFQUNqQyxJQUFJLEVBQ0prSCxNQUFNLEVBQ054RSxnQkFDSixDQUFDO1lBR0QsT0FBTyxJQUFJO1VBQ2Y7VUFHQSxNQUFNQyxnREFBdUIsQ0FBQ00sY0FBYyxDQUN4Q2hELE1BQU0sRUFDTix3QkFBd0IsRUFDeEIsUUFBUSxFQUNSLElBQUFTLG9DQUFnQixFQUFDVCxNQUFNLEVBQUVELE9BQU8sQ0FBQyxFQUNqQyxJQUFJLEVBQ0o7WUFBRW9MLFFBQVEsRUFBUkEsUUFBUTtZQUFFcEwsT0FBTyxFQUFQQTtVQUFRLENBQUMsRUFDckIwQyxnQkFDSixDQUFDO1VBRUQsT0FBT3dFLE1BQU07UUFDakIsQ0FBQyxDQUFDLE9BQU9wRCxLQUFLLEVBQUU7VUFDWixJQUFNQyxPQUFPLEdBQUcsSUFBQUMsMENBQTJCLEVBQUNGLEtBQUssQ0FBQztVQUNsRCxNQUFNLElBQUkzRCxLQUFLLENBQUMsMENBQTBDNEQsT0FBTyxFQUFFLENBQUM7UUFDeEU7TUFDSixDQUFDO01BQUEsU0E3REt1SCx1QkFBdUJBLENBQUFDLElBQUEsRUFBQUMsSUFBQSxFQUFBQyxJQUFBO1FBQUEsT0FBQU4sd0JBQUEsQ0FBQXZILEtBQUEsT0FBQUMsU0FBQTtNQUFBO01BQUEsT0FBdkJ5SCx1QkFBdUI7SUFBQTtFQUFBO0lBQUExTCxHQUFBO0lBQUFDLEtBQUE7TUFBQSxJQUFBNkwsc0JBQUEsT0FBQTNMLGtCQUFBLENBQUFMLE9BQUEsRUFrRTdCLFdBQ0lNLE9BQWUsRUFDZkMsTUFBYyxFQUNNO1FBQ3BCLElBQUksQ0FBQ0QsT0FBTyxJQUFJLENBQUNDLE1BQU0sRUFBRTtVQUNyQixNQUFNLElBQUlFLEtBQUssQ0FBQyxtQ0FBbUMsQ0FBQztRQUN4RDtRQUVBLElBQU13TCxXQUFXLEdBQUcsSUFBQXpHLCtCQUFvQixFQUFDLElBQUFKLDBCQUFlLEVBQUMsQ0FBQyxDQUFDO1FBQzNELElBQU04RyxhQUEwQixHQUFHO1VBQy9CNUwsT0FBTyxFQUFQQSxPQUFPO1VBQ1BDLE1BQU0sRUFBTkEsTUFBTTtVQUNOK0osYUFBYSxFQUFFLENBQUM7VUFDaEI2QixVQUFVLEVBQUUsQ0FBQztVQUNiQyxrQkFBa0IsRUFBRSxFQUFFO1VBQ3RCQyxlQUFlLEVBQUVKLFdBQVc7VUFDNUJ2RSxnQkFBZ0IsRUFBRSxDQUFDO1VBQ25CQyxXQUFXLEVBQUUsQ0FBQztVQUNkdUMsVUFBVSxFQUFFO1FBQ2hCLENBQUM7UUFFRCxJQUFJO1VBQ0EsSUFBTW5KLFFBQVEsR0FBRyxJQUFBQyxvQ0FBZ0IsRUFBQ1QsTUFBTSxFQUFFRCxPQUFPLENBQUM7VUFDbEQsSUFBTVcsaUJBQWlCLEdBQUcsSUFBQUMsc0NBQXlCLEVBQUMsQ0FBQztVQUNyRCxJQUFNQyxZQUFZLEdBQUcsSUFBQUMsY0FBRyxFQUFDSCxpQkFBaUIsRUFBRUYsUUFBUSxDQUFDO1VBQ3JELElBQU0yQyxVQUFVLEdBQUcsSUFBQUMsOENBQTBCLEVBQUN1SSxhQUFhLENBQUM7VUFFNUQsTUFBTSxJQUFBdkwseUJBQWMsRUFBQ0Msa0JBQUU7WUFBQSxJQUFBMEwsS0FBQSxPQUFBak0sa0JBQUEsQ0FBQUwsT0FBQSxFQUFFLFdBQU9jLFdBQVcsRUFBSztjQUM1Q0EsV0FBVyxDQUFDOEMsR0FBRyxDQUFDekMsWUFBWSxFQUFFdUMsVUFBVSxDQUFDO1lBQzdDLENBQUM7WUFBQSxpQkFBQTZJLElBQUE7Y0FBQSxPQUFBRCxLQUFBLENBQUFwSSxLQUFBLE9BQUFDLFNBQUE7WUFBQTtVQUFBLElBQUM7VUFFRixPQUFPK0gsYUFBYTtRQUN4QixDQUFDLENBQUMsT0FBTzlILEtBQUssRUFBRTtVQUNaLElBQU1DLE9BQU8sR0FBRyxJQUFBQywwQ0FBMkIsRUFBQ0YsS0FBSyxDQUFDO1VBQ2xELE1BQU0sSUFBSTNELEtBQUssQ0FBQyxzQ0FBc0M0RCxPQUFPLEVBQUUsQ0FBQztRQUNwRTtNQUNKLENBQUM7TUFBQSxTQXBDS21JLHFCQUFxQkEsQ0FBQUMsSUFBQSxFQUFBQyxJQUFBO1FBQUEsT0FBQVYsc0JBQUEsQ0FBQTlILEtBQUEsT0FBQUMsU0FBQTtNQUFBO01BQUEsT0FBckJxSSxxQkFBcUI7SUFBQTtFQUFBO0lBQUF0TSxHQUFBO0lBQUFDLEtBQUE7TUFBQSxJQUFBd00sWUFBQSxPQUFBdE0sa0JBQUEsQ0FBQUwsT0FBQSxFQTBDM0IsV0FDSU0sT0FBZSxFQUNmQyxNQUFjLEVBQ2RxTSxTQUFpQixFQUNHO1FBQUEsSUFBQUMsTUFBQTtRQUNwQixJQUFJLENBQUN2TSxPQUFPLElBQUksQ0FBQ0MsTUFBTSxJQUFJLENBQUNxTSxTQUFTLEVBQUU7VUFDbkMsTUFBTSxJQUFJbk0sS0FBSyxDQUFDLGdEQUFnRCxDQUFDO1FBQ3JFO1FBRUEsSUFBSTtVQUNBLGFBQWEsSUFBQUMsK0JBQWdCLE1BQUFMLGtCQUFBLENBQUFMLE9BQUEsRUFBQyxhQUFZO1lBQ3RDLGFBQWEsSUFBQVcseUJBQWMsRUFBQ0Msa0JBQUU7Y0FBQSxJQUFBa00sS0FBQSxPQUFBek0sa0JBQUEsQ0FBQUwsT0FBQSxFQUFFLFdBQU9jLFdBQVcsRUFBSztnQkFDbkQsSUFBTUMsUUFBUSxHQUFHLElBQUFDLG9DQUFnQixFQUFDVCxNQUFNLEVBQUVELE9BQU8sQ0FBQztnQkFDbEQsSUFBTVcsaUJBQWlCLEdBQUcsSUFBQUMsc0NBQXlCLEVBQUMsQ0FBQztnQkFDckQsSUFBTUMsWUFBWSxHQUFHLElBQUFDLGNBQUcsRUFBQ0gsaUJBQWlCLEVBQUVGLFFBQVEsQ0FBQztnQkFDckQsSUFBTU0sU0FBUyxTQUFTUCxXQUFXLENBQUNRLEdBQUcsQ0FBQ0gsWUFBWSxDQUFDO2dCQUVyRCxJQUFJLENBQUNFLFNBQVMsQ0FBQ3VCLE1BQU0sQ0FBQyxDQUFDLEVBQUU7a0JBQ3JCLE1BQU0sSUFBSW5DLEtBQUssQ0FBQyx1QkFBdUIsQ0FBQztnQkFDNUM7Z0JBRUEsSUFBTStHLE1BQU0sR0FBRyxJQUFBM0UsOENBQTBCLEVBQUN4QixTQUFTLENBQUNjLElBQUksQ0FBQyxDQUFDLENBQUM7Z0JBRzNELElBQUksQ0FBQyxJQUFBc0YseUNBQXFCLEVBQUNsSCxNQUFNLEVBQUVpSCxNQUFNLENBQUNqSCxNQUFNLENBQUMsRUFBRTtrQkFDL0MsTUFBTSxJQUFJRSxLQUFLLENBQUMsb0NBQW9DLENBQUM7Z0JBQ3pEO2dCQUVBLElBQU1zTSxXQUF3QixHQUFBekcsTUFBQSxDQUFBQyxNQUFBLEtBQ3ZCaUIsTUFBTTtrQkFDVDhDLGFBQWEsRUFBRSxDQUFDO2tCQUNoQjhCLGtCQUFrQixFQUFFLEVBQUU7a0JBQ3RCQyxlQUFlLEVBQUVPO2dCQUFTLEVBQzdCO2dCQUVELElBQU1sSixVQUFVLEdBQUcsSUFBQUMsOENBQTBCLEVBQUNvSixXQUFXLENBQUM7Z0JBQzFEak0sV0FBVyxDQUFDOEMsR0FBRyxDQUFDekMsWUFBWSxFQUFFdUMsVUFBVSxDQUFDO2dCQUl6QyxJQUFJO2tCQUNBLElBQU1zSCxTQUFTLFNBQVM2QixNQUFJLENBQUM1QixZQUFZLENBQUMzSyxPQUFPLENBQUM7a0JBR2xEOEMsT0FBTyxDQUFDOEgsR0FBRyxDQUNQLHFCQUFxQkYsU0FBUywyQ0FDbEMsQ0FBQztnQkFDTCxDQUFDLENBQUMsT0FBTzVHLEtBQUssRUFBRTtrQkFDWmhCLE9BQU8sQ0FBQ2dCLEtBQUssQ0FBQyx5Q0FBeUMsRUFBRUEsS0FBSyxDQUFDO2dCQUVuRTtnQkFFQSxPQUFPMkksV0FBVztjQUN0QixDQUFDO2NBQUEsaUJBQUFDLElBQUE7Z0JBQUEsT0FBQUYsS0FBQSxDQUFBNUksS0FBQSxPQUFBQyxTQUFBO2NBQUE7WUFBQSxJQUFDO1VBQ04sQ0FBQyxFQUFDO1FBQ04sQ0FBQyxDQUFDLE9BQU9DLEtBQUssRUFBRTtVQUNaLElBQU1DLE9BQU8sR0FBRyxJQUFBQywwQ0FBMkIsRUFBQ0YsS0FBSyxDQUFDO1VBQ2xELE1BQU0sSUFBSTNELEtBQUssQ0FBQywyQkFBMkI0RCxPQUFPLEVBQUUsQ0FBQztRQUN6RDtNQUNKLENBQUM7TUFBQSxTQTNESzBJLFdBQVdBLENBQUFFLElBQUEsRUFBQUMsSUFBQSxFQUFBQyxJQUFBO1FBQUEsT0FBQVIsWUFBQSxDQUFBekksS0FBQSxPQUFBQyxTQUFBO01BQUE7TUFBQSxPQUFYNEksV0FBVztJQUFBO0VBQUE7SUFBQTdNLEdBQUE7SUFBQUMsS0FBQSxFQWtFakIsU0FBUXVDLDhCQUE4QkEsQ0FDbENaLFdBQThCLEVBQzlCeEIsT0FBZSxFQUNmQyxNQUFjLEVBQ0g7TUFBQSxJQUFBNk0sYUFBQTtNQUNYLElBQUl0TCxXQUFXLENBQUNnRSxNQUFNLEtBQUssQ0FBQyxFQUFFO1FBQzFCLE9BQU87VUFDSHhGLE9BQU8sRUFBUEEsT0FBTztVQUNQQyxNQUFNLEVBQU5BLE1BQU07VUFDTitKLGFBQWEsRUFBRSxDQUFDO1VBQ2hCNkIsVUFBVSxFQUFFLENBQUM7VUFDYkMsa0JBQWtCLEVBQUUsRUFBRTtVQUN0QkMsZUFBZSxFQUFFLElBQUE3RywrQkFBb0IsRUFBQyxJQUFBSiwwQkFBZSxFQUFDLENBQUMsQ0FBQztVQUN4RHNDLGdCQUFnQixFQUFFLENBQUM7VUFDbkJDLFdBQVcsRUFBRSxDQUFDO1VBQ2R1QyxVQUFVLEVBQUU7UUFDaEIsQ0FBQztNQUNMO01BRUEsSUFBTS9FLFFBQVEsR0FBRyxFQUFBaUksYUFBQSxHQUFBdEwsV0FBVyxDQUFDLENBQUMsQ0FBQyxxQkFBZHNMLGFBQUEsQ0FBZ0JqSSxRQUFRLEtBQUksSUFBQUMsMEJBQWUsRUFBQyxDQUFDO01BQzlELElBQU1pSSxlQUFlLEdBQUd2TCxXQUFXLENBQUNFLEdBQUcsQ0FBQyxVQUFDNEQsSUFBSTtRQUFBLE9BQ3pDLElBQUFOLGdDQUFxQixFQUFDTSxJQUFJLENBQUNyRCxXQUFXLEVBQUU0QyxRQUFRLENBQUM7TUFBQSxDQUNyRCxDQUFDO01BR0QsSUFBTW1JLFdBQVcsR0FBR0MsS0FBSyxDQUFDQyxJQUFJLENBQUMsSUFBSUMsR0FBRyxDQUFDSixlQUFlLENBQUMsQ0FBQyxDQUFDakwsSUFBSSxDQUFDLENBQUM7TUFHL0QsSUFBSWtJLGFBQWEsR0FBRyxDQUFDO01BQ3JCLElBQUkrQixlQUFlLEdBQUcsRUFBRTtNQUN4QixJQUFNcUIsS0FBSyxHQUFHLElBQUFsSSwrQkFBb0IsRUFBQ0wsUUFBUSxDQUFDO01BQzVDLElBQU13SSxTQUFTLEdBQUcsSUFBQWpGLDZCQUFrQixFQUNoQyxJQUFJQyxJQUFJLENBQUNBLElBQUksQ0FBQ0MsR0FBRyxDQUFDLENBQUMsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxJQUFJLENBQUMsRUFDMUN6RCxRQUNKLENBQUM7TUFHRCxJQUFNaUgsa0JBQWtCLEdBQUdrQixXQUFXLENBQUNBLFdBQVcsQ0FBQ3hILE1BQU0sR0FBRyxDQUFDLENBQUM7TUFDOUQsSUFBSXNHLGtCQUFrQixLQUFLc0IsS0FBSyxJQUFJdEIsa0JBQWtCLEtBQUt1QixTQUFTLEVBQUU7UUFDbEVyRCxhQUFhLEdBQUcsQ0FBQztRQUNqQitCLGVBQWUsR0FBR0Qsa0JBQWtCO1FBR3BDLEtBQUssSUFBSXdCLENBQUMsR0FBR04sV0FBVyxDQUFDeEgsTUFBTSxHQUFHLENBQUMsRUFBRThILENBQUMsSUFBSSxDQUFDLEVBQUVBLENBQUMsRUFBRSxFQUFFO1VBQzlDLElBQU0zQixXQUFXLEdBQUdxQixXQUFXLENBQUNNLENBQUMsR0FBRyxDQUFDLENBQUM7VUFDdEMsSUFBTUMsWUFBWSxHQUFHUCxXQUFXLENBQUNNLENBQUMsQ0FBQztVQUVuQyxJQUFJLElBQUFFLDZCQUFrQixFQUFDRCxZQUFZLEVBQUU1QixXQUFXLENBQUMsRUFBRTtZQUMvQzNCLGFBQWEsRUFBRTtZQUNmK0IsZUFBZSxHQUFHd0IsWUFBWTtVQUNsQyxDQUFDLE1BQU07WUFDSDtVQUNKO1FBQ0o7TUFDSjtNQUdBLElBQUkxQixVQUFVLEdBQUcsQ0FBQztNQUNsQixJQUFJNEIsVUFBVSxHQUFHLENBQUM7TUFFbEIsS0FBSyxJQUFJSCxFQUFDLEdBQUcsQ0FBQyxFQUFFQSxFQUFDLEdBQUdOLFdBQVcsQ0FBQ3hILE1BQU0sRUFBRThILEVBQUMsRUFBRSxFQUFFO1FBQ3pDLElBQUksSUFBQUUsNkJBQWtCLEVBQUNSLFdBQVcsQ0FBQ00sRUFBQyxHQUFHLENBQUMsQ0FBQyxFQUFFTixXQUFXLENBQUNNLEVBQUMsQ0FBQyxDQUFDLEVBQUU7VUFDeERHLFVBQVUsRUFBRTtRQUNoQixDQUFDLE1BQU07VUFDSDVCLFVBQVUsR0FBRzZCLElBQUksQ0FBQ0MsR0FBRyxDQUFDOUIsVUFBVSxFQUFFNEIsVUFBVSxDQUFDO1VBQzdDQSxVQUFVLEdBQUcsQ0FBQztRQUNsQjtNQUNKO01BQ0E1QixVQUFVLEdBQUc2QixJQUFJLENBQUNDLEdBQUcsQ0FBQzlCLFVBQVUsRUFBRTRCLFVBQVUsRUFBRXpELGFBQWEsQ0FBQztNQUU1RCxPQUFPO1FBQ0hoSyxPQUFPLEVBQVBBLE9BQU87UUFDUEMsTUFBTSxFQUFOQSxNQUFNO1FBQ04rSixhQUFhLEVBQWJBLGFBQWE7UUFDYjZCLFVBQVUsRUFBVkEsVUFBVTtRQUNWQyxrQkFBa0IsRUFBbEJBLGtCQUFrQjtRQUNsQkMsZUFBZSxFQUFmQSxlQUFlO1FBQ2YzRSxnQkFBZ0IsRUFBRSxDQUFDO1FBQ25CQyxXQUFXLEVBQUUsQ0FBQztRQUNkdUMsVUFBVSxFQUFFO01BQ2hCLENBQUM7SUFDTDtFQUFDO0lBQUFoSyxHQUFBO0lBQUFDLEtBQUEsRUFLRCxTQUFRNEMsZUFBZUEsQ0FDbkJtTCxVQUF1QixFQUN2QkMsUUFBNEIsRUFDakI7TUFDWCxJQUFJLENBQUNBLFFBQVEsRUFBRTtRQUNYLE9BQU9ELFVBQVU7TUFDckI7TUFFQSxPQUFBNUgsTUFBQSxDQUFBQyxNQUFBLEtBQ08ySCxVQUFVO1FBQ2J4RyxnQkFBZ0IsRUFBRXlHLFFBQVEsQ0FBQ3pHLGdCQUFnQjtRQUMzQ0MsV0FBVyxFQUFFd0csUUFBUSxDQUFDeEcsV0FBVztRQUNqQ3VDLFVBQVUsRUFBRWlFLFFBQVEsQ0FBQ2pFLFVBQVU7UUFFL0JpQyxVQUFVLEVBQUU2QixJQUFJLENBQUNDLEdBQUcsQ0FBQ0MsVUFBVSxDQUFDL0IsVUFBVSxFQUFFZ0MsUUFBUSxDQUFDaEMsVUFBVTtNQUFDO0lBRXhFO0VBQUM7SUFBQWpNLEdBQUE7SUFBQUMsS0FBQTtNQUFBLElBQUFpTyxhQUFBLE9BQUEvTixrQkFBQSxDQUFBTCxPQUFBLEVBRUQsV0FBMkJNLE9BQWUsRUFBbUI7UUFDekQsSUFBSTtVQUVBLElBQU0rTixPQUFPLEdBQUcsSUFBQWpOLGNBQUcsRUFDZlIsa0JBQUUsRUFDRix3Q0FBd0NOLE9BQU8sRUFDbkQsQ0FBQztVQUNELElBQU1nTyxPQUFPLFNBQVMsSUFBQWpELGlCQUFNLEVBQUNnRCxPQUFPLENBQUM7VUFFckMsSUFBSUMsT0FBTyxDQUFDMUwsTUFBTSxDQUFDLENBQUMsRUFBRTtZQUNsQixJQUFNMkwsUUFBUSxHQUFHRCxPQUFPLENBQUNuTSxJQUFJLENBQUMsQ0FBQztZQUMvQixPQUFPb00sUUFBUSxDQUFDQyxXQUFXLElBQUksWUFBWTtVQUMvQztVQUVBLE9BQU8sWUFBWTtRQUN2QixDQUFDLENBQUMsT0FBT3BLLEtBQUssRUFBRTtVQUNaaEIsT0FBTyxDQUFDZ0IsS0FBSyxDQUFDLDJCQUEyQixFQUFFQSxLQUFLLENBQUM7VUFDakQsT0FBTyxZQUFZO1FBQ3ZCO01BQ0osQ0FBQztNQUFBLFNBbkJhNkcsWUFBWUEsQ0FBQXdELElBQUE7UUFBQSxPQUFBTCxhQUFBLENBQUFsSyxLQUFBLE9BQUFDLFNBQUE7TUFBQTtNQUFBLE9BQVo4RyxZQUFZO0lBQUE7RUFBQTtJQUFBL0ssR0FBQTtJQUFBQyxLQUFBLEVBd0IxQixTQUFRaUoscUJBQXFCQSxDQUN6QkgsSUFBWSxFQUNaekIsTUFBMEIsRUFDbkI7TUFDUCxJQUFJLENBQUNBLE1BQU0sSUFBSUEsTUFBTSxDQUFDOEMsYUFBYSxLQUFLLENBQUMsSUFBSSxDQUFDOUMsTUFBTSxDQUFDNkUsZUFBZSxFQUFFO1FBQ2xFLE9BQU8sS0FBSztNQUNoQjtNQUVBLElBQU1xQyxXQUFXLEdBQUcsSUFBQTNHLDBCQUFlLEVBQUNQLE1BQU0sQ0FBQzZFLGVBQWUsQ0FBQztNQUMzRCxJQUFNc0MsU0FBUyxHQUFHLElBQUE1RywwQkFBZSxFQUFDa0IsSUFBSSxDQUFDO01BQ3ZDLElBQU0yRixTQUFTLEdBQUcsSUFBSWpHLElBQUksQ0FBQytGLFdBQVcsQ0FBQztNQUN2Q0UsU0FBUyxDQUFDQyxPQUFPLENBQUNELFNBQVMsQ0FBQ0UsT0FBTyxDQUFDLENBQUMsR0FBR3RILE1BQU0sQ0FBQzhDLGFBQWEsR0FBRyxDQUFDLENBQUM7TUFFakUsT0FBT3FFLFNBQVMsSUFBSUQsV0FBVyxJQUFJQyxTQUFTLElBQUlDLFNBQVM7SUFDN0Q7RUFBQztBQUFBO0FBSUUsSUFBTUcsYUFBYSxHQUFBalAsT0FBQSxDQUFBaVAsYUFBQSxHQUFHLElBQUlsUCxhQUFhLENBQUMsQ0FBQyIsImlnbm9yZUxpc3QiOltdfQ==