10ed2c35231df3caaf4a178f9f55239a
var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault").default;
Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.streakService = exports.StreakService = void 0;
var _toConsumableArray2 = _interopRequireDefault(require("@babel/runtime/helpers/toConsumableArray"));
var _asyncToGenerator2 = _interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));
var _classCallCheck2 = _interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));
var _createClass2 = _interopRequireDefault(require("@babel/runtime/helpers/createClass"));
var _firestore = require("firebase/firestore");
var _firebaseConfig = require("../../firebaseConfig");
var _habitStreaks = require("../../types/habit-streaks");
var _dateUtils = require("../../utils/dateUtils");
var _errorHandling = require("../../utils/errorHandling");
var _collections = require("./collections");
var _habitStreakSchemas = require("./habitStreakSchemas");
var StreakService = exports.StreakService = function () {
  function StreakService() {
    (0, _classCallCheck2.default)(this, StreakService);
  }
  return (0, _createClass2.default)(StreakService, [{
    key: "calculateStreak",
    value: (function () {
      var _calculateStreak = (0, _asyncToGenerator2.default)(function* (habitId, userId) {
        var _this = this;
        if (!habitId || !userId) {
          throw new Error("Habit ID and User ID are required");
        }
        try {
          return yield (0, _errorHandling.retryWithBackoff)((0, _asyncToGenerator2.default)(function* () {
            return yield (0, _firestore.runTransaction)(_firebaseConfig.db, function () {
              var _ref2 = (0, _asyncToGenerator2.default)(function* (transaction) {
                var streakId = (0, _habitStreakSchemas.generateStreakId)(userId, habitId);
                var streaksCollection = (0, _collections.getHabitStreaksCollection)();
                var streakDocRef = (0, _firestore.doc)(streaksCollection, streakId);
                var streakDoc = yield transaction.get(streakDocRef);
                var completionsCollection = (0, _collections.getHabitCompletionsCollection)();
                var completionsQuery = (0, _firestore.query)(completionsCollection, (0, _firestore.where)("habitId", "==", habitId), (0, _firestore.where)("userId", "==", userId));
                var completionsSnapshot = yield (0, _firestore.getDocs)(completionsQuery);
                var completions = completionsSnapshot.docs.map(function (doc) {
                  return (0, _habitStreakSchemas.transformFirestoreToCompletion)(doc.id, doc.data());
                }).sort(function (a, b) {
                  return a.completedAt.toMillis() - b.completedAt.toMillis();
                });
                var calculatedStreak = _this.calculateStreakFromCompletions(completions, habitId, userId);
                var existingStreak = null;
                if (streakDoc.exists()) {
                  existingStreak = (0, _habitStreakSchemas.transformFirestoreToStreak)(streakDoc.data());
                }
                var updatedStreak = _this.mergeStreakData(calculatedStreak, existingStreak);
                var streakData = (0, _habitStreakSchemas.transformStreakToFirestore)(updatedStreak);
                transaction.set(streakDocRef, streakData);
                return updatedStreak;
              });
              return function (_x3) {
                return _ref2.apply(this, arguments);
              };
            }());
          }));
        } catch (error) {
          var message = (0, _errorHandling.getUserFriendlyErrorMessage)(error);
          throw new Error(`Failed to calculate streak: ${message}`);
        }
      });
      function calculateStreak(_x, _x2) {
        return _calculateStreak.apply(this, arguments);
      }
      return calculateStreak;
    }())
  }, {
    key: "recordCompletion",
    value: (function () {
      var _recordCompletion = (0, _asyncToGenerator2.default)(function* (completion) {
        if (!completion.habitId || !completion.userId) {
          throw new Error("Habit ID and User ID are required");
        }
        var userTimezone = completion.timezone || (0, _dateUtils.getUserTimezone)();
        var completionDateString = (0, _dateUtils.timestampToDateString)(completion.completedAt, userTimezone);
        var currentDateString = (0, _dateUtils.getCurrentDateString)(userTimezone);
        if (completionDateString > currentDateString) {
          throw new Error("Cannot record completions for future dates");
        }
        try {
          return yield (0, _errorHandling.retryWithBackoff)((0, _asyncToGenerator2.default)(function* () {
            return yield (0, _firestore.runTransaction)(_firebaseConfig.db, function () {
              var _ref4 = (0, _asyncToGenerator2.default)(function* (transaction) {
                var completionsCollection = (0, _collections.getHabitCompletionsCollection)();
                var existingCompletionsQuery = (0, _firestore.query)(completionsCollection, (0, _firestore.where)("habitId", "==", completion.habitId), (0, _firestore.where)("userId", "==", completion.userId));
                var existingSnapshot = yield (0, _firestore.getDocs)(existingCompletionsQuery);
                var existingCompletions = existingSnapshot.docs.map(function (doc) {
                  return (0, _habitStreakSchemas.transformFirestoreToCompletion)(doc.id, doc.data());
                }).filter(function (comp) {
                  var compDateString = (0, _dateUtils.timestampToDateString)(comp.completedAt, userTimezone);
                  return compDateString === completionDateString;
                });
                if (existingCompletions.length > 0) {
                  throw new Error("Habit already completed for this date");
                }
                var completionData = {
                  habitId: completion.habitId,
                  userId: completion.userId,
                  completedAt: completion.completedAt,
                  timezone: userTimezone,
                  notes: completion.notes || "",
                  difficulty: completion.difficulty,
                  createdAt: (0, _firestore.serverTimestamp)()
                };
                var completionRef = (0, _firestore.doc)(completionsCollection);
                transaction.set(completionRef, completionData);
                var newCompletion = Object.assign({
                  id: completionRef.id
                }, completion, {
                  timezone: userTimezone
                });
                return newCompletion;
              });
              return function (_x5) {
                return _ref4.apply(this, arguments);
              };
            }());
          }));
        } catch (error) {
          var message = (0, _errorHandling.getUserFriendlyErrorMessage)(error);
          throw new Error(`Failed to record completion: ${message}`);
        }
      });
      function recordCompletion(_x4) {
        return _recordCompletion.apply(this, arguments);
      }
      return recordCompletion;
    }())
  }, {
    key: "recordCompletionWithMilestoneCheck",
    value: (function () {
      var _recordCompletionWithMilestoneCheck = (0, _asyncToGenerator2.default)(function* (completion) {
        var recordedCompletion = yield this.recordCompletion(completion);
        var updatedStreak = yield this.calculateStreak(completion.habitId, completion.userId);
        var newMilestones = yield this.checkMilestones(updatedStreak);
        return {
          completion: recordedCompletion,
          newMilestones: newMilestones,
          updatedStreak: updatedStreak
        };
      });
      function recordCompletionWithMilestoneCheck(_x6) {
        return _recordCompletionWithMilestoneCheck.apply(this, arguments);
      }
      return recordCompletionWithMilestoneCheck;
    }())
  }, {
    key: "useStreakFreeze",
    value: (function () {
      var _useStreakFreeze = (0, _asyncToGenerator2.default)(function* (habitId, userId, missedDate) {
        if (!habitId || !userId || !missedDate) {
          throw new Error("Habit ID, User ID, and missed date are required");
        }
        try {
          return yield (0, _errorHandling.retryWithBackoff)((0, _asyncToGenerator2.default)(function* () {
            return yield (0, _firestore.runTransaction)(_firebaseConfig.db, function () {
              var _ref6 = (0, _asyncToGenerator2.default)(function* (transaction) {
                var streakId = (0, _habitStreakSchemas.generateStreakId)(userId, habitId);
                var streaksCollection = (0, _collections.getHabitStreaksCollection)();
                var streakDocRef = (0, _firestore.doc)(streaksCollection, streakId);
                var streakDoc = yield transaction.get(streakDocRef);
                if (!streakDoc.exists()) {
                  throw new Error("Streak data not found");
                }
                var streak = (0, _habitStreakSchemas.transformFirestoreToStreak)(streakDoc.data());
                if (!(0, _habitStreakSchemas.validateUserOwnership)(userId, streak.userId)) {
                  throw new Error("Unauthorized access to streak data");
                }
                if (streak.freezesAvailable <= 0) {
                  return false;
                }
                var updatedStreak = Object.assign({}, streak, {
                  freezesAvailable: streak.freezesAvailable - 1,
                  freezesUsed: streak.freezesUsed + 1
                });
                var protectedCompletion = {
                  habitId: habitId,
                  userId: userId,
                  completedAt: _firestore.Timestamp.fromDate((0, _dateUtils.parseDateString)(missedDate)),
                  timezone: (0, _dateUtils.getUserTimezone)(),
                  notes: "Protected by streak freeze",
                  difficulty: "easy",
                  createdAt: (0, _firestore.serverTimestamp)()
                };
                var completionsCollection = (0, _collections.getHabitCompletionsCollection)();
                var completionRef = (0, _firestore.doc)(completionsCollection);
                transaction.set(completionRef, protectedCompletion);
                var streakData = (0, _habitStreakSchemas.transformStreakToFirestore)(updatedStreak);
                transaction.set(streakDocRef, streakData);
                return true;
              });
              return function (_x0) {
                return _ref6.apply(this, arguments);
              };
            }());
          }));
        } catch (error) {
          var message = (0, _errorHandling.getUserFriendlyErrorMessage)(error);
          throw new Error(`Failed to use streak freeze: ${message}`);
        }
      });
      function useStreakFreeze(_x7, _x8, _x9) {
        return _useStreakFreeze.apply(this, arguments);
      }
      return useStreakFreeze;
    }())
  }, {
    key: "getHabitCalendar",
    value: (function () {
      var _getHabitCalendar = (0, _asyncToGenerator2.default)(function* (habitId, userId, days, timezone) {
        var _this2 = this;
        if (!habitId || !userId) {
          throw new Error("Habit ID and User ID are required");
        }
        try {
          return yield (0, _errorHandling.retryWithBackoff)((0, _asyncToGenerator2.default)(function* () {
            var endDate = (0, _dateUtils.getCurrentDateString)(timezone);
            var startDate = (0, _dateUtils.formatDateToString)(new Date(Date.now() - (days - 1) * 24 * 60 * 60 * 1000), timezone);
            var completionsCollection = (0, _collections.getHabitCompletionsCollection)();
            var completionsQuery = (0, _firestore.query)(completionsCollection, (0, _firestore.where)("habitId", "==", habitId), (0, _firestore.where)("userId", "==", userId));
            var completionsSnapshot = yield (0, _firestore.getDocs)(completionsQuery);
            var completions = completionsSnapshot.docs.map(function (doc) {
              return (0, _habitStreakSchemas.transformFirestoreToCompletion)(doc.id, doc.data());
            }).filter(function (completion) {
              var compDateString = (0, _dateUtils.timestampToDateString)(completion.completedAt, timezone);
              return compDateString >= startDate && compDateString <= endDate;
            });
            var streak = yield _this2.getHabitStreak(habitId, userId);
            var dateRange = (0, _dateUtils.generateDateRange)(startDate, endDate);
            var calendarDays = dateRange.map(function (date) {
              var completion = completions.find(function (comp) {
                return (0, _dateUtils.timestampToDateString)(comp.completedAt, timezone) === date;
              });
              var isInStreak = _this2.isDateInCurrentStreak(date, streak);
              return {
                date: date,
                completed: !!completion,
                isToday: (0, _dateUtils.isToday)(date, timezone),
                isInStreak: isInStreak,
                completionTime: completion ? completion.completedAt.toDate().toLocaleTimeString() : undefined,
                notes: completion == null ? void 0 : completion.notes
              };
            });
            return calendarDays;
          }));
        } catch (error) {
          var message = (0, _errorHandling.getUserFriendlyErrorMessage)(error);
          throw new Error(`Failed to get habit calendar: ${message}`);
        }
      });
      function getHabitCalendar(_x1, _x10, _x11, _x12) {
        return _getHabitCalendar.apply(this, arguments);
      }
      return getHabitCalendar;
    }())
  }, {
    key: "checkMilestones",
    value: (function () {
      var _checkMilestones = (0, _asyncToGenerator2.default)(function* (streak) {
        var newMilestones = [];
        var existingMilestoneDays = streak.milestones.map(function (m) {
          return m.days;
        });
        for (var milestoneDay of _habitStreaks.MILESTONE_DAYS) {
          if (streak.currentStreak >= milestoneDay && !existingMilestoneDays.includes(milestoneDay)) {
            var milestone = {
              days: milestoneDay,
              achievedAt: _firestore.Timestamp.now(),
              celebrated: false
            };
            newMilestones.push(milestone);
            if (milestoneDay === 30) {
              streak.freezesAvailable += 1;
            }
          }
        }
        if (newMilestones.length > 0) {
          var updatedStreak = Object.assign({}, streak, {
            milestones: [].concat((0, _toConsumableArray2.default)(streak.milestones), newMilestones),
            freezesAvailable: streak.freezesAvailable
          });
          var streakId = (0, _habitStreakSchemas.generateStreakId)(streak.userId, streak.habitId);
          var streaksCollection = (0, _collections.getHabitStreaksCollection)();
          var streakDocRef = (0, _firestore.doc)(streaksCollection, streakId);
          var streakData = (0, _habitStreakSchemas.transformStreakToFirestore)(updatedStreak);
          yield (0, _firestore.runTransaction)(_firebaseConfig.db, function () {
            var _ref8 = (0, _asyncToGenerator2.default)(function* (transaction) {
              transaction.set(streakDocRef, streakData);
            });
            return function (_x14) {
              return _ref8.apply(this, arguments);
            };
          }());
        }
        return newMilestones;
      });
      function checkMilestones(_x13) {
        return _checkMilestones.apply(this, arguments);
      }
      return checkMilestones;
    }())
  }, {
    key: "getHabitStreak",
    value: (function () {
      var _getHabitStreak = (0, _asyncToGenerator2.default)(function* (habitId, userId) {
        if (!habitId || !userId) {
          throw new Error("Habit ID and User ID are required");
        }
        try {
          var streakId = (0, _habitStreakSchemas.generateStreakId)(userId, habitId);
          var streaksCollection = (0, _collections.getHabitStreaksCollection)();
          var streakDocRef = (0, _firestore.doc)(streaksCollection, streakId);
          var streakDoc = yield (0, _firestore.getDoc)(streakDocRef);
          if (!streakDoc.exists()) {
            return null;
          }
          var streakData = streakDoc.data();
          if (!(0, _habitStreakSchemas.validateStreakDocument)(streakData)) {
            throw new Error("Invalid streak data format");
          }
          return (0, _habitStreakSchemas.transformFirestoreToStreak)(streakData);
        } catch (error) {
          var message = (0, _errorHandling.getUserFriendlyErrorMessage)(error);
          throw new Error(`Failed to get habit streak: ${message}`);
        }
      });
      function getHabitStreak(_x15, _x16) {
        return _getHabitStreak.apply(this, arguments);
      }
      return getHabitStreak;
    }())
  }, {
    key: "initializeHabitStreak",
    value: (function () {
      var _initializeHabitStreak = (0, _asyncToGenerator2.default)(function* (habitId, userId) {
        if (!habitId || !userId) {
          throw new Error("Habit ID and User ID are required");
        }
        var currentDate = (0, _dateUtils.getCurrentDateString)((0, _dateUtils.getUserTimezone)());
        var initialStreak = {
          habitId: habitId,
          userId: userId,
          currentStreak: 0,
          bestStreak: 0,
          lastCompletionDate: "",
          streakStartDate: currentDate,
          freezesAvailable: 0,
          freezesUsed: 0,
          milestones: []
        };
        try {
          var streakId = (0, _habitStreakSchemas.generateStreakId)(userId, habitId);
          var streaksCollection = (0, _collections.getHabitStreaksCollection)();
          var streakDocRef = (0, _firestore.doc)(streaksCollection, streakId);
          var streakData = (0, _habitStreakSchemas.transformStreakToFirestore)(initialStreak);
          yield (0, _firestore.runTransaction)(_firebaseConfig.db, function () {
            var _ref9 = (0, _asyncToGenerator2.default)(function* (transaction) {
              transaction.set(streakDocRef, streakData);
            });
            return function (_x19) {
              return _ref9.apply(this, arguments);
            };
          }());
          return initialStreak;
        } catch (error) {
          var message = (0, _errorHandling.getUserFriendlyErrorMessage)(error);
          throw new Error(`Failed to initialize habit streak: ${message}`);
        }
      });
      function initializeHabitStreak(_x17, _x18) {
        return _initializeHabitStreak.apply(this, arguments);
      }
      return initializeHabitStreak;
    }())
  }, {
    key: "resetStreak",
    value: (function () {
      var _resetStreak = (0, _asyncToGenerator2.default)(function* (habitId, userId, resetDate) {
        if (!habitId || !userId || !resetDate) {
          throw new Error("Habit ID, User ID, and reset date are required");
        }
        try {
          return yield (0, _errorHandling.retryWithBackoff)((0, _asyncToGenerator2.default)(function* () {
            return yield (0, _firestore.runTransaction)(_firebaseConfig.db, function () {
              var _ref1 = (0, _asyncToGenerator2.default)(function* (transaction) {
                var streakId = (0, _habitStreakSchemas.generateStreakId)(userId, habitId);
                var streaksCollection = (0, _collections.getHabitStreaksCollection)();
                var streakDocRef = (0, _firestore.doc)(streaksCollection, streakId);
                var streakDoc = yield transaction.get(streakDocRef);
                if (!streakDoc.exists()) {
                  throw new Error("Streak data not found");
                }
                var streak = (0, _habitStreakSchemas.transformFirestoreToStreak)(streakDoc.data());
                if (!(0, _habitStreakSchemas.validateUserOwnership)(userId, streak.userId)) {
                  throw new Error("Unauthorized access to streak data");
                }
                var resetStreak = Object.assign({}, streak, {
                  currentStreak: 0,
                  lastCompletionDate: "",
                  streakStartDate: resetDate
                });
                var streakData = (0, _habitStreakSchemas.transformStreakToFirestore)(resetStreak);
                transaction.set(streakDocRef, streakData);
                return resetStreak;
              });
              return function (_x23) {
                return _ref1.apply(this, arguments);
              };
            }());
          }));
        } catch (error) {
          var message = (0, _errorHandling.getUserFriendlyErrorMessage)(error);
          throw new Error(`Failed to reset streak: ${message}`);
        }
      });
      function resetStreak(_x20, _x21, _x22) {
        return _resetStreak.apply(this, arguments);
      }
      return resetStreak;
    }())
  }, {
    key: "calculateStreakFromCompletions",
    value: function calculateStreakFromCompletions(completions, habitId, userId) {
      var _completions$;
      if (completions.length === 0) {
        return {
          habitId: habitId,
          userId: userId,
          currentStreak: 0,
          bestStreak: 0,
          lastCompletionDate: "",
          streakStartDate: (0, _dateUtils.getCurrentDateString)((0, _dateUtils.getUserTimezone)()),
          freezesAvailable: 0,
          freezesUsed: 0,
          milestones: []
        };
      }
      var timezone = ((_completions$ = completions[0]) == null ? void 0 : _completions$.timezone) || (0, _dateUtils.getUserTimezone)();
      var completionDates = completions.map(function (comp) {
        return (0, _dateUtils.timestampToDateString)(comp.completedAt, timezone);
      });
      var uniqueDates = (0, _toConsumableArray2.default)(new Set(completionDates)).sort();
      var currentStreak = 0;
      var streakStartDate = "";
      var today = (0, _dateUtils.getCurrentDateString)(timezone);
      var yesterday = (0, _dateUtils.formatDateToString)(new Date(Date.now() - 24 * 60 * 60 * 1000), timezone);
      var lastCompletionDate = uniqueDates[uniqueDates.length - 1];
      if (lastCompletionDate === today || lastCompletionDate === yesterday) {
        currentStreak = 1;
        streakStartDate = lastCompletionDate;
        for (var i = uniqueDates.length - 2; i >= 0; i--) {
          var currentDate = uniqueDates[i + 1];
          var previousDate = uniqueDates[i];
          if ((0, _dateUtils.areConsecutiveDays)(previousDate, currentDate)) {
            currentStreak++;
            streakStartDate = previousDate;
          } else {
            break;
          }
        }
      }
      var bestStreak = 0;
      var tempStreak = 1;
      for (var _i = 1; _i < uniqueDates.length; _i++) {
        if ((0, _dateUtils.areConsecutiveDays)(uniqueDates[_i - 1], uniqueDates[_i])) {
          tempStreak++;
        } else {
          bestStreak = Math.max(bestStreak, tempStreak);
          tempStreak = 1;
        }
      }
      bestStreak = Math.max(bestStreak, tempStreak, currentStreak);
      return {
        habitId: habitId,
        userId: userId,
        currentStreak: currentStreak,
        bestStreak: bestStreak,
        lastCompletionDate: lastCompletionDate,
        streakStartDate: streakStartDate,
        freezesAvailable: 0,
        freezesUsed: 0,
        milestones: []
      };
    }
  }, {
    key: "mergeStreakData",
    value: function mergeStreakData(calculated, existing) {
      if (!existing) {
        return calculated;
      }
      return Object.assign({}, calculated, {
        freezesAvailable: existing.freezesAvailable,
        freezesUsed: existing.freezesUsed,
        milestones: existing.milestones,
        bestStreak: Math.max(calculated.bestStreak, existing.bestStreak)
      });
    }
  }, {
    key: "isDateInCurrentStreak",
    value: function isDateInCurrentStreak(date, streak) {
      if (!streak || streak.currentStreak === 0 || !streak.streakStartDate) {
        return false;
      }
      var streakStart = (0, _dateUtils.parseDateString)(streak.streakStartDate);
      var checkDate = (0, _dateUtils.parseDateString)(date);
      var streakEnd = new Date(streakStart);
      streakEnd.setDate(streakEnd.getDate() + streak.currentStreak - 1);
      return checkDate >= streakStart && checkDate <= streakEnd;
    }
  }]);
}();
var streakService = exports.streakService = new StreakService();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfZmlyZXN0b3JlIiwicmVxdWlyZSIsIl9maXJlYmFzZUNvbmZpZyIsIl9oYWJpdFN0cmVha3MiLCJfZGF0ZVV0aWxzIiwiX2Vycm9ySGFuZGxpbmciLCJfY29sbGVjdGlvbnMiLCJfaGFiaXRTdHJlYWtTY2hlbWFzIiwiU3RyZWFrU2VydmljZSIsImV4cG9ydHMiLCJfY2xhc3NDYWxsQ2hlY2syIiwiZGVmYXVsdCIsIl9jcmVhdGVDbGFzczIiLCJrZXkiLCJ2YWx1ZSIsIl9jYWxjdWxhdGVTdHJlYWsiLCJfYXN5bmNUb0dlbmVyYXRvcjIiLCJoYWJpdElkIiwidXNlcklkIiwiX3RoaXMiLCJFcnJvciIsInJldHJ5V2l0aEJhY2tvZmYiLCJydW5UcmFuc2FjdGlvbiIsImRiIiwiX3JlZjIiLCJ0cmFuc2FjdGlvbiIsInN0cmVha0lkIiwiZ2VuZXJhdGVTdHJlYWtJZCIsInN0cmVha3NDb2xsZWN0aW9uIiwiZ2V0SGFiaXRTdHJlYWtzQ29sbGVjdGlvbiIsInN0cmVha0RvY1JlZiIsImRvYyIsInN0cmVha0RvYyIsImdldCIsImNvbXBsZXRpb25zQ29sbGVjdGlvbiIsImdldEhhYml0Q29tcGxldGlvbnNDb2xsZWN0aW9uIiwiY29tcGxldGlvbnNRdWVyeSIsInF1ZXJ5Iiwid2hlcmUiLCJjb21wbGV0aW9uc1NuYXBzaG90IiwiZ2V0RG9jcyIsImNvbXBsZXRpb25zIiwiZG9jcyIsIm1hcCIsInRyYW5zZm9ybUZpcmVzdG9yZVRvQ29tcGxldGlvbiIsImlkIiwiZGF0YSIsInNvcnQiLCJhIiwiYiIsImNvbXBsZXRlZEF0IiwidG9NaWxsaXMiLCJjYWxjdWxhdGVkU3RyZWFrIiwiY2FsY3VsYXRlU3RyZWFrRnJvbUNvbXBsZXRpb25zIiwiZXhpc3RpbmdTdHJlYWsiLCJleGlzdHMiLCJ0cmFuc2Zvcm1GaXJlc3RvcmVUb1N0cmVhayIsInVwZGF0ZWRTdHJlYWsiLCJtZXJnZVN0cmVha0RhdGEiLCJzdHJlYWtEYXRhIiwidHJhbnNmb3JtU3RyZWFrVG9GaXJlc3RvcmUiLCJzZXQiLCJfeDMiLCJhcHBseSIsImFyZ3VtZW50cyIsImVycm9yIiwibWVzc2FnZSIsImdldFVzZXJGcmllbmRseUVycm9yTWVzc2FnZSIsImNhbGN1bGF0ZVN0cmVhayIsIl94IiwiX3gyIiwiX3JlY29yZENvbXBsZXRpb24iLCJjb21wbGV0aW9uIiwidXNlclRpbWV6b25lIiwidGltZXpvbmUiLCJnZXRVc2VyVGltZXpvbmUiLCJjb21wbGV0aW9uRGF0ZVN0cmluZyIsInRpbWVzdGFtcFRvRGF0ZVN0cmluZyIsImN1cnJlbnREYXRlU3RyaW5nIiwiZ2V0Q3VycmVudERhdGVTdHJpbmciLCJfcmVmNCIsImV4aXN0aW5nQ29tcGxldGlvbnNRdWVyeSIsImV4aXN0aW5nU25hcHNob3QiLCJleGlzdGluZ0NvbXBsZXRpb25zIiwiZmlsdGVyIiwiY29tcCIsImNvbXBEYXRlU3RyaW5nIiwibGVuZ3RoIiwiY29tcGxldGlvbkRhdGEiLCJub3RlcyIsImRpZmZpY3VsdHkiLCJjcmVhdGVkQXQiLCJzZXJ2ZXJUaW1lc3RhbXAiLCJjb21wbGV0aW9uUmVmIiwibmV3Q29tcGxldGlvbiIsIk9iamVjdCIsImFzc2lnbiIsIl94NSIsInJlY29yZENvbXBsZXRpb24iLCJfeDQiLCJfcmVjb3JkQ29tcGxldGlvbldpdGhNaWxlc3RvbmVDaGVjayIsInJlY29yZGVkQ29tcGxldGlvbiIsIm5ld01pbGVzdG9uZXMiLCJjaGVja01pbGVzdG9uZXMiLCJyZWNvcmRDb21wbGV0aW9uV2l0aE1pbGVzdG9uZUNoZWNrIiwiX3g2IiwiX3VzZVN0cmVha0ZyZWV6ZSIsIm1pc3NlZERhdGUiLCJfcmVmNiIsInN0cmVhayIsInZhbGlkYXRlVXNlck93bmVyc2hpcCIsImZyZWV6ZXNBdmFpbGFibGUiLCJmcmVlemVzVXNlZCIsInByb3RlY3RlZENvbXBsZXRpb24iLCJUaW1lc3RhbXAiLCJmcm9tRGF0ZSIsInBhcnNlRGF0ZVN0cmluZyIsIl94MCIsInVzZVN0cmVha0ZyZWV6ZSIsIl94NyIsIl94OCIsIl94OSIsIl9nZXRIYWJpdENhbGVuZGFyIiwiZGF5cyIsIl90aGlzMiIsImVuZERhdGUiLCJzdGFydERhdGUiLCJmb3JtYXREYXRlVG9TdHJpbmciLCJEYXRlIiwibm93IiwiZ2V0SGFiaXRTdHJlYWsiLCJkYXRlUmFuZ2UiLCJnZW5lcmF0ZURhdGVSYW5nZSIsImNhbGVuZGFyRGF5cyIsImRhdGUiLCJmaW5kIiwiaXNJblN0cmVhayIsImlzRGF0ZUluQ3VycmVudFN0cmVhayIsImNvbXBsZXRlZCIsImlzVG9kYXkiLCJjb21wbGV0aW9uVGltZSIsInRvRGF0ZSIsInRvTG9jYWxlVGltZVN0cmluZyIsInVuZGVmaW5lZCIsImdldEhhYml0Q2FsZW5kYXIiLCJfeDEiLCJfeDEwIiwiX3gxMSIsIl94MTIiLCJfY2hlY2tNaWxlc3RvbmVzIiwiZXhpc3RpbmdNaWxlc3RvbmVEYXlzIiwibWlsZXN0b25lcyIsIm0iLCJtaWxlc3RvbmVEYXkiLCJNSUxFU1RPTkVfREFZUyIsImN1cnJlbnRTdHJlYWsiLCJpbmNsdWRlcyIsIm1pbGVzdG9uZSIsImFjaGlldmVkQXQiLCJjZWxlYnJhdGVkIiwicHVzaCIsImNvbmNhdCIsIl90b0NvbnN1bWFibGVBcnJheTIiLCJfcmVmOCIsIl94MTQiLCJfeDEzIiwiX2dldEhhYml0U3RyZWFrIiwiZ2V0RG9jIiwidmFsaWRhdGVTdHJlYWtEb2N1bWVudCIsIl94MTUiLCJfeDE2IiwiX2luaXRpYWxpemVIYWJpdFN0cmVhayIsImN1cnJlbnREYXRlIiwiaW5pdGlhbFN0cmVhayIsImJlc3RTdHJlYWsiLCJsYXN0Q29tcGxldGlvbkRhdGUiLCJzdHJlYWtTdGFydERhdGUiLCJfcmVmOSIsIl94MTkiLCJpbml0aWFsaXplSGFiaXRTdHJlYWsiLCJfeDE3IiwiX3gxOCIsIl9yZXNldFN0cmVhayIsInJlc2V0RGF0ZSIsIl9yZWYxIiwicmVzZXRTdHJlYWsiLCJfeDIzIiwiX3gyMCIsIl94MjEiLCJfeDIyIiwiX2NvbXBsZXRpb25zJCIsImNvbXBsZXRpb25EYXRlcyIsInVuaXF1ZURhdGVzIiwiU2V0IiwidG9kYXkiLCJ5ZXN0ZXJkYXkiLCJpIiwicHJldmlvdXNEYXRlIiwiYXJlQ29uc2VjdXRpdmVEYXlzIiwidGVtcFN0cmVhayIsIk1hdGgiLCJtYXgiLCJjYWxjdWxhdGVkIiwiZXhpc3RpbmciLCJzdHJlYWtTdGFydCIsImNoZWNrRGF0ZSIsInN0cmVha0VuZCIsInNldERhdGUiLCJnZXREYXRlIiwic3RyZWFrU2VydmljZSJdLCJzb3VyY2VzIjpbInN0cmVha1NlcnZpY2UudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcbiAgICBkb2MsXG4gICAgZ2V0RG9jLFxuICAgIGdldERvY3MsXG4gICAgcXVlcnksXG4gICAgcnVuVHJhbnNhY3Rpb24sXG4gICAgc2VydmVyVGltZXN0YW1wLFxuICAgIFRpbWVzdGFtcCxcbiAgICB3aGVyZSxcbn0gZnJvbSBcImZpcmViYXNlL2ZpcmVzdG9yZVwiO1xuaW1wb3J0IHsgZGIgfSBmcm9tIFwiLi4vLi4vZmlyZWJhc2VDb25maWdcIjtcbmltcG9ydCB7XG4gICAgQ2FsZW5kYXJEYXksXG4gICAgSGFiaXRDb21wbGV0aW9uLFxuICAgIEhhYml0U3RyZWFrLFxuICAgIE1JTEVTVE9ORV9EQVlTLFxuICAgIFN0cmVha01pbGVzdG9uZSxcbn0gZnJvbSBcIi4uLy4uL3R5cGVzL2hhYml0LXN0cmVha3NcIjtcbmltcG9ydCB7XG4gICAgYXJlQ29uc2VjdXRpdmVEYXlzLFxuICAgIGZvcm1hdERhdGVUb1N0cmluZyxcbiAgICBnZW5lcmF0ZURhdGVSYW5nZSxcbiAgICBnZXRDdXJyZW50RGF0ZVN0cmluZyxcbiAgICBnZXRVc2VyVGltZXpvbmUsXG4gICAgaXNUb2RheSxcbiAgICBwYXJzZURhdGVTdHJpbmcsXG4gICAgdGltZXN0YW1wVG9EYXRlU3RyaW5nLFxufSBmcm9tIFwiLi4vLi4vdXRpbHMvZGF0ZVV0aWxzXCI7XG5pbXBvcnQge1xuICAgIGdldFVzZXJGcmllbmRseUVycm9yTWVzc2FnZSxcbiAgICByZXRyeVdpdGhCYWNrb2ZmLFxufSBmcm9tIFwiLi4vLi4vdXRpbHMvZXJyb3JIYW5kbGluZ1wiO1xuaW1wb3J0IHtcbiAgICBnZXRIYWJpdENvbXBsZXRpb25zQ29sbGVjdGlvbixcbiAgICBnZXRIYWJpdFN0cmVha3NDb2xsZWN0aW9uLFxufSBmcm9tIFwiLi9jb2xsZWN0aW9uc1wiO1xuaW1wb3J0IHsgU3RyZWFrU2VydmljZSBhcyBJU3RyZWFrU2VydmljZSB9IGZyb20gXCIuL2hhYml0U3RyZWFrSW50ZXJmYWNlc1wiO1xuaW1wb3J0IHtcbiAgICBnZW5lcmF0ZVN0cmVha0lkLFxuICAgIHRyYW5zZm9ybUZpcmVzdG9yZVRvQ29tcGxldGlvbixcbiAgICB0cmFuc2Zvcm1GaXJlc3RvcmVUb1N0cmVhayxcbiAgICB0cmFuc2Zvcm1TdHJlYWtUb0ZpcmVzdG9yZSxcbiAgICB2YWxpZGF0ZVN0cmVha0RvY3VtZW50LFxuICAgIHZhbGlkYXRlVXNlck93bmVyc2hpcCxcbn0gZnJvbSBcIi4vaGFiaXRTdHJlYWtTY2hlbWFzXCI7XG5cbi8qKlxuICogU3RyZWFrU2VydmljZSBJbXBsZW1lbnRhdGlvblxuICpcbiAqIEhhbmRsZXMgYWxsIHN0cmVhayBjYWxjdWxhdGlvbiwgdHJhY2tpbmcsIGFuZCBtYW5hZ2VtZW50IGZ1bmN0aW9uYWxpdHlcbiAqIHdpdGggdGltZXpvbmUgYXdhcmVuZXNzIGFuZCBkYXRhIGludGVncml0eSBwcm90ZWN0aW9uLlxuICovXG5leHBvcnQgY2xhc3MgU3RyZWFrU2VydmljZSBpbXBsZW1lbnRzIElTdHJlYWtTZXJ2aWNlIHtcbiAgICAvKipcbiAgICAgKiBDYWxjdWxhdGUgYW5kIHVwZGF0ZSBzdHJlYWsgaW5mb3JtYXRpb24gZm9yIGEgaGFiaXRcbiAgICAgKiBSZXF1aXJlbWVudHM6IDEuMSwgMS4yLCAxLjNcbiAgICAgKi9cbiAgICBhc3luYyBjYWxjdWxhdGVTdHJlYWsoaGFiaXRJZDogc3RyaW5nLCB1c2VySWQ6IHN0cmluZyk6IFByb21pc2U8SGFiaXRTdHJlYWs+IHtcbiAgICAgICAgaWYgKCFoYWJpdElkIHx8ICF1c2VySWQpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkhhYml0IElEIGFuZCBVc2VyIElEIGFyZSByZXF1aXJlZFwiKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICByZXR1cm4gYXdhaXQgcmV0cnlXaXRoQmFja29mZihhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGF3YWl0IHJ1blRyYW5zYWN0aW9uKGRiLCBhc3luYyAodHJhbnNhY3Rpb24pID0+IHtcbiAgICAgICAgICAgICAgICAgICAgLy8gR2V0IGN1cnJlbnQgc3RyZWFrIGRhdGFcbiAgICAgICAgICAgICAgICAgICAgY29uc3Qgc3RyZWFrSWQgPSBnZW5lcmF0ZVN0cmVha0lkKHVzZXJJZCwgaGFiaXRJZCk7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHN0cmVha3NDb2xsZWN0aW9uID0gZ2V0SGFiaXRTdHJlYWtzQ29sbGVjdGlvbigpO1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBzdHJlYWtEb2NSZWYgPSBkb2Moc3RyZWFrc0NvbGxlY3Rpb24sIHN0cmVha0lkKTtcbiAgICAgICAgICAgICAgICAgICAgY29uc3Qgc3RyZWFrRG9jID0gYXdhaXQgdHJhbnNhY3Rpb24uZ2V0KHN0cmVha0RvY1JlZik7XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gR2V0IGFsbCBjb21wbGV0aW9ucyBmb3IgdGhpcyBoYWJpdFxuICAgICAgICAgICAgICAgICAgICBjb25zdCBjb21wbGV0aW9uc0NvbGxlY3Rpb24gPSBnZXRIYWJpdENvbXBsZXRpb25zQ29sbGVjdGlvbigpO1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBjb21wbGV0aW9uc1F1ZXJ5ID0gcXVlcnkoXG4gICAgICAgICAgICAgICAgICAgICAgICBjb21wbGV0aW9uc0NvbGxlY3Rpb24sXG4gICAgICAgICAgICAgICAgICAgICAgICB3aGVyZShcImhhYml0SWRcIiwgXCI9PVwiLCBoYWJpdElkKSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHdoZXJlKFwidXNlcklkXCIsIFwiPT1cIiwgdXNlcklkKSxcbiAgICAgICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgY29tcGxldGlvbnNTbmFwc2hvdCA9IGF3YWl0IGdldERvY3MoY29tcGxldGlvbnNRdWVyeSk7XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gVHJhbnNmb3JtIGNvbXBsZXRpb25zIGFuZCBzb3J0IGJ5IGRhdGVcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgY29tcGxldGlvbnMgPSBjb21wbGV0aW9uc1NuYXBzaG90LmRvY3NcbiAgICAgICAgICAgICAgICAgICAgICAgIC5tYXAoKGRvYykgPT4gdHJhbnNmb3JtRmlyZXN0b3JlVG9Db21wbGV0aW9uKGRvYy5pZCwgZG9jLmRhdGEoKSkpXG4gICAgICAgICAgICAgICAgICAgICAgICAuc29ydChcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAoYSwgYikgPT4gYS5jb21wbGV0ZWRBdC50b01pbGxpcygpIC0gYi5jb21wbGV0ZWRBdC50b01pbGxpcygpLFxuICAgICAgICAgICAgICAgICAgICAgICAgKTtcblxuICAgICAgICAgICAgICAgICAgICAvLyBDYWxjdWxhdGUgc3RyZWFrIGZyb20gY29tcGxldGlvbnNcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgY2FsY3VsYXRlZFN0cmVhayA9IHRoaXMuY2FsY3VsYXRlU3RyZWFrRnJvbUNvbXBsZXRpb25zKFxuICAgICAgICAgICAgICAgICAgICAgICAgY29tcGxldGlvbnMsXG4gICAgICAgICAgICAgICAgICAgICAgICBoYWJpdElkLFxuICAgICAgICAgICAgICAgICAgICAgICAgdXNlcklkLFxuICAgICAgICAgICAgICAgICAgICApO1xuXG4gICAgICAgICAgICAgICAgICAgIC8vIE1lcmdlIHdpdGggZXhpc3RpbmcgZGF0YSBpZiBhdmFpbGFibGVcbiAgICAgICAgICAgICAgICAgICAgbGV0IGV4aXN0aW5nU3RyZWFrOiBIYWJpdFN0cmVhayB8IG51bGwgPSBudWxsO1xuICAgICAgICAgICAgICAgICAgICBpZiAoc3RyZWFrRG9jLmV4aXN0cygpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBleGlzdGluZ1N0cmVhayA9IHRyYW5zZm9ybUZpcmVzdG9yZVRvU3RyZWFrKHN0cmVha0RvYy5kYXRhKCkpO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgY29uc3QgdXBkYXRlZFN0cmVhayA9IHRoaXMubWVyZ2VTdHJlYWtEYXRhKFxuICAgICAgICAgICAgICAgICAgICAgICAgY2FsY3VsYXRlZFN0cmVhayxcbiAgICAgICAgICAgICAgICAgICAgICAgIGV4aXN0aW5nU3RyZWFrLFxuICAgICAgICAgICAgICAgICAgICApO1xuXG4gICAgICAgICAgICAgICAgICAgIC8vIFNhdmUgdXBkYXRlZCBzdHJlYWtcbiAgICAgICAgICAgICAgICAgICAgY29uc3Qgc3RyZWFrRGF0YSA9IHRyYW5zZm9ybVN0cmVha1RvRmlyZXN0b3JlKHVwZGF0ZWRTdHJlYWspO1xuICAgICAgICAgICAgICAgICAgICB0cmFuc2FjdGlvbi5zZXQoc3RyZWFrRG9jUmVmLCBzdHJlYWtEYXRhKTtcblxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdXBkYXRlZFN0cmVhaztcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgY29uc3QgbWVzc2FnZSA9IGdldFVzZXJGcmllbmRseUVycm9yTWVzc2FnZShlcnJvcik7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYEZhaWxlZCB0byBjYWxjdWxhdGUgc3RyZWFrOiAke21lc3NhZ2V9YCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBSZWNvcmQgYSBuZXcgaGFiaXQgY29tcGxldGlvbiBhbmQgdXBkYXRlIHN0cmVha1xuICAgICAqIFJlcXVpcmVtZW50czogNS4xLCAxMi4xXG4gICAgICovXG4gICAgYXN5bmMgcmVjb3JkQ29tcGxldGlvbihcbiAgICAgICAgY29tcGxldGlvbjogT21pdDxIYWJpdENvbXBsZXRpb24sIFwiaWRcIj4sXG4gICAgKTogUHJvbWlzZTxIYWJpdENvbXBsZXRpb24+IHtcbiAgICAgICAgaWYgKCFjb21wbGV0aW9uLmhhYml0SWQgfHwgIWNvbXBsZXRpb24udXNlcklkKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJIYWJpdCBJRCBhbmQgVXNlciBJRCBhcmUgcmVxdWlyZWRcIik7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBWYWxpZGF0ZSB0aW1lem9uZS1hd2FyZSBjb21wbGV0aW9uXG4gICAgICAgIGNvbnN0IHVzZXJUaW1lem9uZSA9IGNvbXBsZXRpb24udGltZXpvbmUgfHwgZ2V0VXNlclRpbWV6b25lKCk7XG4gICAgICAgIGNvbnN0IGNvbXBsZXRpb25EYXRlU3RyaW5nID0gdGltZXN0YW1wVG9EYXRlU3RyaW5nKFxuICAgICAgICAgICAgY29tcGxldGlvbi5jb21wbGV0ZWRBdCxcbiAgICAgICAgICAgIHVzZXJUaW1lem9uZSxcbiAgICAgICAgKTtcbiAgICAgICAgY29uc3QgY3VycmVudERhdGVTdHJpbmcgPSBnZXRDdXJyZW50RGF0ZVN0cmluZyh1c2VyVGltZXpvbmUpO1xuXG4gICAgICAgIC8vIEVuc3VyZSBjb21wbGV0aW9uIGlzIGZvciBjdXJyZW50IGRheSBvciBlYXJsaWVyIChwcmV2ZW50IGZ1dHVyZSBjb21wbGV0aW9ucylcbiAgICAgICAgaWYgKGNvbXBsZXRpb25EYXRlU3RyaW5nID4gY3VycmVudERhdGVTdHJpbmcpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkNhbm5vdCByZWNvcmQgY29tcGxldGlvbnMgZm9yIGZ1dHVyZSBkYXRlc1wiKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICByZXR1cm4gYXdhaXQgcmV0cnlXaXRoQmFja29mZihhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGF3YWl0IHJ1blRyYW5zYWN0aW9uKGRiLCBhc3luYyAodHJhbnNhY3Rpb24pID0+IHtcbiAgICAgICAgICAgICAgICAgICAgLy8gQ2hlY2sgZm9yIGV4aXN0aW5nIGNvbXBsZXRpb24gb24gdGhlIHNhbWUgZGF0ZVxuICAgICAgICAgICAgICAgICAgICBjb25zdCBjb21wbGV0aW9uc0NvbGxlY3Rpb24gPSBnZXRIYWJpdENvbXBsZXRpb25zQ29sbGVjdGlvbigpO1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBleGlzdGluZ0NvbXBsZXRpb25zUXVlcnkgPSBxdWVyeShcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbXBsZXRpb25zQ29sbGVjdGlvbixcbiAgICAgICAgICAgICAgICAgICAgICAgIHdoZXJlKFwiaGFiaXRJZFwiLCBcIj09XCIsIGNvbXBsZXRpb24uaGFiaXRJZCksXG4gICAgICAgICAgICAgICAgICAgICAgICB3aGVyZShcInVzZXJJZFwiLCBcIj09XCIsIGNvbXBsZXRpb24udXNlcklkKSxcbiAgICAgICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgZXhpc3RpbmdTbmFwc2hvdCA9IGF3YWl0IGdldERvY3MoZXhpc3RpbmdDb21wbGV0aW9uc1F1ZXJ5KTtcblxuICAgICAgICAgICAgICAgICAgICBjb25zdCBleGlzdGluZ0NvbXBsZXRpb25zID0gZXhpc3RpbmdTbmFwc2hvdC5kb2NzXG4gICAgICAgICAgICAgICAgICAgICAgICAubWFwKChkb2MpID0+IHRyYW5zZm9ybUZpcmVzdG9yZVRvQ29tcGxldGlvbihkb2MuaWQsIGRvYy5kYXRhKCkpKVxuICAgICAgICAgICAgICAgICAgICAgICAgLmZpbHRlcigoY29tcCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGNvbXBEYXRlU3RyaW5nID0gdGltZXN0YW1wVG9EYXRlU3RyaW5nKFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb21wLmNvbXBsZXRlZEF0LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1c2VyVGltZXpvbmUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gY29tcERhdGVTdHJpbmcgPT09IGNvbXBsZXRpb25EYXRlU3RyaW5nO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKGV4aXN0aW5nQ29tcGxldGlvbnMubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiSGFiaXQgYWxyZWFkeSBjb21wbGV0ZWQgZm9yIHRoaXMgZGF0ZVwiKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIC8vIENyZWF0ZSBjb21wbGV0aW9uIHJlY29yZCB3aXRoIG1ldGFkYXRhXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGNvbXBsZXRpb25EYXRhID0ge1xuICAgICAgICAgICAgICAgICAgICAgICAgaGFiaXRJZDogY29tcGxldGlvbi5oYWJpdElkLFxuICAgICAgICAgICAgICAgICAgICAgICAgdXNlcklkOiBjb21wbGV0aW9uLnVzZXJJZCxcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbXBsZXRlZEF0OiBjb21wbGV0aW9uLmNvbXBsZXRlZEF0LFxuICAgICAgICAgICAgICAgICAgICAgICAgdGltZXpvbmU6IHVzZXJUaW1lem9uZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIG5vdGVzOiBjb21wbGV0aW9uLm5vdGVzIHx8IFwiXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICBkaWZmaWN1bHR5OiBjb21wbGV0aW9uLmRpZmZpY3VsdHksXG4gICAgICAgICAgICAgICAgICAgICAgICBjcmVhdGVkQXQ6IHNlcnZlclRpbWVzdGFtcCgpLFxuICAgICAgICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGNvbXBsZXRpb25SZWYgPSBkb2MoY29tcGxldGlvbnNDb2xsZWN0aW9uKTtcbiAgICAgICAgICAgICAgICAgICAgdHJhbnNhY3Rpb24uc2V0KGNvbXBsZXRpb25SZWYsIGNvbXBsZXRpb25EYXRhKTtcblxuICAgICAgICAgICAgICAgICAgICBjb25zdCBuZXdDb21wbGV0aW9uOiBIYWJpdENvbXBsZXRpb24gPSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZDogY29tcGxldGlvblJlZi5pZCxcbiAgICAgICAgICAgICAgICAgICAgICAgIC4uLmNvbXBsZXRpb24sXG4gICAgICAgICAgICAgICAgICAgICAgICB0aW1lem9uZTogdXNlclRpbWV6b25lLFxuICAgICAgICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXdDb21wbGV0aW9uO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICBjb25zdCBtZXNzYWdlID0gZ2V0VXNlckZyaWVuZGx5RXJyb3JNZXNzYWdlKGVycm9yKTtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgRmFpbGVkIHRvIHJlY29yZCBjb21wbGV0aW9uOiAke21lc3NhZ2V9YCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBSZWNvcmQgY29tcGxldGlvbiBhbmQgY2hlY2sgZm9yIG1pbGVzdG9uZSBhY2hpZXZlbWVudHNcbiAgICAgKiBUaGlzIGlzIHRoZSBtYWluIG1ldGhvZCB0aGF0IHNob3VsZCBiZSBjYWxsZWQgd2hlbiBhIHVzZXIgY29tcGxldGVzIGEgaGFiaXRcbiAgICAgKiBSZXF1aXJlbWVudHM6IDMuMSwgMy4yLCA1LjFcbiAgICAgKi9cbiAgICBhc3luYyByZWNvcmRDb21wbGV0aW9uV2l0aE1pbGVzdG9uZUNoZWNrKFxuICAgICAgICBjb21wbGV0aW9uOiBPbWl0PEhhYml0Q29tcGxldGlvbiwgXCJpZFwiPixcbiAgICApOiBQcm9taXNlPHtcbiAgICAgICAgY29tcGxldGlvbjogSGFiaXRDb21wbGV0aW9uO1xuICAgICAgICBuZXdNaWxlc3RvbmVzOiBTdHJlYWtNaWxlc3RvbmVbXTtcbiAgICAgICAgdXBkYXRlZFN0cmVhazogSGFiaXRTdHJlYWs7XG4gICAgfT4ge1xuICAgICAgICAvLyBSZWNvcmQgdGhlIGNvbXBsZXRpb25cbiAgICAgICAgY29uc3QgcmVjb3JkZWRDb21wbGV0aW9uID0gYXdhaXQgdGhpcy5yZWNvcmRDb21wbGV0aW9uKGNvbXBsZXRpb24pO1xuXG4gICAgICAgIC8vIFJlY2FsY3VsYXRlIHN0cmVhayB3aXRoIHRoZSBuZXcgY29tcGxldGlvblxuICAgICAgICBjb25zdCB1cGRhdGVkU3RyZWFrID0gYXdhaXQgdGhpcy5jYWxjdWxhdGVTdHJlYWsoXG4gICAgICAgICAgICBjb21wbGV0aW9uLmhhYml0SWQsXG4gICAgICAgICAgICBjb21wbGV0aW9uLnVzZXJJZCxcbiAgICAgICAgKTtcblxuICAgICAgICAvLyBDaGVjayBmb3IgbmV3IG1pbGVzdG9uZXNcbiAgICAgICAgY29uc3QgbmV3TWlsZXN0b25lcyA9IGF3YWl0IHRoaXMuY2hlY2tNaWxlc3RvbmVzKHVwZGF0ZWRTdHJlYWspO1xuXG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBjb21wbGV0aW9uOiByZWNvcmRlZENvbXBsZXRpb24sXG4gICAgICAgICAgICBuZXdNaWxlc3RvbmVzLFxuICAgICAgICAgICAgdXBkYXRlZFN0cmVhayxcbiAgICAgICAgfTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBVc2UgYSBzdHJlYWsgZnJlZXplIHRvIHByb3RlY3QgZnJvbSBhIG1pc3NlZCBkYXlcbiAgICAgKiBSZXF1aXJlbWVudHM6IDQuMSwgNC4yLCA0LjVcbiAgICAgKi9cbiAgICBhc3luYyB1c2VTdHJlYWtGcmVlemUoXG4gICAgICAgIGhhYml0SWQ6IHN0cmluZyxcbiAgICAgICAgdXNlcklkOiBzdHJpbmcsXG4gICAgICAgIG1pc3NlZERhdGU6IHN0cmluZyxcbiAgICApOiBQcm9taXNlPGJvb2xlYW4+IHtcbiAgICAgICAgaWYgKCFoYWJpdElkIHx8ICF1c2VySWQgfHwgIW1pc3NlZERhdGUpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkhhYml0IElELCBVc2VyIElELCBhbmQgbWlzc2VkIGRhdGUgYXJlIHJlcXVpcmVkXCIpO1xuICAgICAgICB9XG5cbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIHJldHVybiBhd2FpdCByZXRyeVdpdGhCYWNrb2ZmKGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgICAgICByZXR1cm4gYXdhaXQgcnVuVHJhbnNhY3Rpb24oZGIsIGFzeW5jICh0cmFuc2FjdGlvbikgPT4ge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBzdHJlYWtJZCA9IGdlbmVyYXRlU3RyZWFrSWQodXNlcklkLCBoYWJpdElkKTtcbiAgICAgICAgICAgICAgICAgICAgY29uc3Qgc3RyZWFrc0NvbGxlY3Rpb24gPSBnZXRIYWJpdFN0cmVha3NDb2xsZWN0aW9uKCk7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHN0cmVha0RvY1JlZiA9IGRvYyhzdHJlYWtzQ29sbGVjdGlvbiwgc3RyZWFrSWQpO1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBzdHJlYWtEb2MgPSBhd2FpdCB0cmFuc2FjdGlvbi5nZXQoc3RyZWFrRG9jUmVmKTtcblxuICAgICAgICAgICAgICAgICAgICBpZiAoIXN0cmVha0RvYy5leGlzdHMoKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiU3RyZWFrIGRhdGEgbm90IGZvdW5kXCIpO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgY29uc3Qgc3RyZWFrID0gdHJhbnNmb3JtRmlyZXN0b3JlVG9TdHJlYWsoc3RyZWFrRG9jLmRhdGEoKSk7XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gVmFsaWRhdGUgdXNlciBvd25lcnNoaXBcbiAgICAgICAgICAgICAgICAgICAgaWYgKCF2YWxpZGF0ZVVzZXJPd25lcnNoaXAodXNlcklkLCBzdHJlYWsudXNlcklkKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiVW5hdXRob3JpemVkIGFjY2VzcyB0byBzdHJlYWsgZGF0YVwiKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIC8vIENoZWNrIGlmIGZyZWV6ZSBpcyBhdmFpbGFibGVcbiAgICAgICAgICAgICAgICAgICAgaWYgKHN0cmVhay5mcmVlemVzQXZhaWxhYmxlIDw9IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIC8vIFVzZSB0aGUgZnJlZXplXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHVwZGF0ZWRTdHJlYWs6IEhhYml0U3RyZWFrID0ge1xuICAgICAgICAgICAgICAgICAgICAgICAgLi4uc3RyZWFrLFxuICAgICAgICAgICAgICAgICAgICAgICAgZnJlZXplc0F2YWlsYWJsZTogc3RyZWFrLmZyZWV6ZXNBdmFpbGFibGUgLSAxLFxuICAgICAgICAgICAgICAgICAgICAgICAgZnJlZXplc1VzZWQ6IHN0cmVhay5mcmVlemVzVXNlZCArIDEsXG4gICAgICAgICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gQ3JlYXRlIGEgXCJwcm90ZWN0ZWRcIiBjb21wbGV0aW9uIHJlY29yZCBmb3IgdGhlIG1pc3NlZCBkYXRlXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHByb3RlY3RlZENvbXBsZXRpb24gPSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBoYWJpdElkLFxuICAgICAgICAgICAgICAgICAgICAgICAgdXNlcklkLFxuICAgICAgICAgICAgICAgICAgICAgICAgY29tcGxldGVkQXQ6IFRpbWVzdGFtcC5mcm9tRGF0ZShwYXJzZURhdGVTdHJpbmcobWlzc2VkRGF0ZSkpLFxuICAgICAgICAgICAgICAgICAgICAgICAgdGltZXpvbmU6IGdldFVzZXJUaW1lem9uZSgpLFxuICAgICAgICAgICAgICAgICAgICAgICAgbm90ZXM6IFwiUHJvdGVjdGVkIGJ5IHN0cmVhayBmcmVlemVcIixcbiAgICAgICAgICAgICAgICAgICAgICAgIGRpZmZpY3VsdHk6IFwiZWFzeVwiIGFzIGNvbnN0LFxuICAgICAgICAgICAgICAgICAgICAgICAgY3JlYXRlZEF0OiBzZXJ2ZXJUaW1lc3RhbXAoKSxcbiAgICAgICAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgICAgICAgICBjb25zdCBjb21wbGV0aW9uc0NvbGxlY3Rpb24gPSBnZXRIYWJpdENvbXBsZXRpb25zQ29sbGVjdGlvbigpO1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBjb21wbGV0aW9uUmVmID0gZG9jKGNvbXBsZXRpb25zQ29sbGVjdGlvbik7XG4gICAgICAgICAgICAgICAgICAgIHRyYW5zYWN0aW9uLnNldChjb21wbGV0aW9uUmVmLCBwcm90ZWN0ZWRDb21wbGV0aW9uKTtcblxuICAgICAgICAgICAgICAgICAgICAvLyBVcGRhdGUgc3RyZWFrIGRhdGFcbiAgICAgICAgICAgICAgICAgICAgY29uc3Qgc3RyZWFrRGF0YSA9IHRyYW5zZm9ybVN0cmVha1RvRmlyZXN0b3JlKHVwZGF0ZWRTdHJlYWspO1xuICAgICAgICAgICAgICAgICAgICB0cmFuc2FjdGlvbi5zZXQoc3RyZWFrRG9jUmVmLCBzdHJlYWtEYXRhKTtcblxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgY29uc3QgbWVzc2FnZSA9IGdldFVzZXJGcmllbmRseUVycm9yTWVzc2FnZShlcnJvcik7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYEZhaWxlZCB0byB1c2Ugc3RyZWFrIGZyZWV6ZTogJHttZXNzYWdlfWApO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogR2V0IGNhbGVuZGFyIGRhdGEgZm9yIGEgaGFiaXQgc2hvd2luZyBjb21wbGV0aW9uIHN0YXR1c1xuICAgICAqIFJlcXVpcmVtZW50czogMi4xLCAyLjIsIDIuMywgMi40LCAyLjVcbiAgICAgKi9cbiAgICBhc3luYyBnZXRIYWJpdENhbGVuZGFyKFxuICAgICAgICBoYWJpdElkOiBzdHJpbmcsXG4gICAgICAgIHVzZXJJZDogc3RyaW5nLFxuICAgICAgICBkYXlzOiBudW1iZXIsXG4gICAgICAgIHRpbWV6b25lOiBzdHJpbmcsXG4gICAgKTogUHJvbWlzZTxDYWxlbmRhckRheVtdPiB7XG4gICAgICAgIGlmICghaGFiaXRJZCB8fCAhdXNlcklkKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJIYWJpdCBJRCBhbmQgVXNlciBJRCBhcmUgcmVxdWlyZWRcIik7XG4gICAgICAgIH1cblxuICAgICAgICB0cnkge1xuICAgICAgICAgICAgcmV0dXJuIGF3YWl0IHJldHJ5V2l0aEJhY2tvZmYoYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgICAgIC8vIEdldCBkYXRlIHJhbmdlIGZvciBjYWxlbmRhclxuICAgICAgICAgICAgICAgIGNvbnN0IGVuZERhdGUgPSBnZXRDdXJyZW50RGF0ZVN0cmluZyh0aW1lem9uZSk7XG4gICAgICAgICAgICAgICAgY29uc3Qgc3RhcnREYXRlID0gZm9ybWF0RGF0ZVRvU3RyaW5nKFxuICAgICAgICAgICAgICAgICAgICBuZXcgRGF0ZShEYXRlLm5vdygpIC0gKGRheXMgLSAxKSAqIDI0ICogNjAgKiA2MCAqIDEwMDApLFxuICAgICAgICAgICAgICAgICAgICB0aW1lem9uZSxcbiAgICAgICAgICAgICAgICApO1xuXG4gICAgICAgICAgICAgICAgLy8gR2V0IGNvbXBsZXRpb25zIGZvciB0aGUgZGF0ZSByYW5nZVxuICAgICAgICAgICAgICAgIGNvbnN0IGNvbXBsZXRpb25zQ29sbGVjdGlvbiA9IGdldEhhYml0Q29tcGxldGlvbnNDb2xsZWN0aW9uKCk7XG4gICAgICAgICAgICAgICAgY29uc3QgY29tcGxldGlvbnNRdWVyeSA9IHF1ZXJ5KFxuICAgICAgICAgICAgICAgICAgICBjb21wbGV0aW9uc0NvbGxlY3Rpb24sXG4gICAgICAgICAgICAgICAgICAgIHdoZXJlKFwiaGFiaXRJZFwiLCBcIj09XCIsIGhhYml0SWQpLFxuICAgICAgICAgICAgICAgICAgICB3aGVyZShcInVzZXJJZFwiLCBcIj09XCIsIHVzZXJJZCksXG4gICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgICAgICBjb25zdCBjb21wbGV0aW9uc1NuYXBzaG90ID0gYXdhaXQgZ2V0RG9jcyhjb21wbGV0aW9uc1F1ZXJ5KTtcblxuICAgICAgICAgICAgICAgIGNvbnN0IGNvbXBsZXRpb25zID0gY29tcGxldGlvbnNTbmFwc2hvdC5kb2NzXG4gICAgICAgICAgICAgICAgICAgIC5tYXAoKGRvYykgPT4gdHJhbnNmb3JtRmlyZXN0b3JlVG9Db21wbGV0aW9uKGRvYy5pZCwgZG9jLmRhdGEoKSkpXG4gICAgICAgICAgICAgICAgICAgIC5maWx0ZXIoKGNvbXBsZXRpb24pID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGNvbXBEYXRlU3RyaW5nID0gdGltZXN0YW1wVG9EYXRlU3RyaW5nKFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbXBsZXRpb24uY29tcGxldGVkQXQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGltZXpvbmUsXG4gICAgICAgICAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNvbXBEYXRlU3RyaW5nID49IHN0YXJ0RGF0ZSAmJiBjb21wRGF0ZVN0cmluZyA8PSBlbmREYXRlO1xuICAgICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIC8vIEdldCBzdHJlYWsgZGF0YSBmb3IgaGlnaGxpZ2h0aW5nXG4gICAgICAgICAgICAgICAgY29uc3Qgc3RyZWFrID0gYXdhaXQgdGhpcy5nZXRIYWJpdFN0cmVhayhoYWJpdElkLCB1c2VySWQpO1xuXG4gICAgICAgICAgICAgICAgLy8gR2VuZXJhdGUgY2FsZW5kYXIgZGF5c1xuICAgICAgICAgICAgICAgIGNvbnN0IGRhdGVSYW5nZSA9IGdlbmVyYXRlRGF0ZVJhbmdlKHN0YXJ0RGF0ZSwgZW5kRGF0ZSk7XG4gICAgICAgICAgICAgICAgY29uc3QgY2FsZW5kYXJEYXlzOiBDYWxlbmRhckRheVtdID0gZGF0ZVJhbmdlLm1hcCgoZGF0ZSkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBjb21wbGV0aW9uID0gY29tcGxldGlvbnMuZmluZChcbiAgICAgICAgICAgICAgICAgICAgICAgIChjb21wKSA9PlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRpbWVzdGFtcFRvRGF0ZVN0cmluZyhjb21wLmNvbXBsZXRlZEF0LCB0aW1lem9uZSkgPT09IGRhdGUsXG4gICAgICAgICAgICAgICAgICAgICk7XG5cbiAgICAgICAgICAgICAgICAgICAgY29uc3QgaXNJblN0cmVhayA9IHRoaXMuaXNEYXRlSW5DdXJyZW50U3RyZWFrKGRhdGUsIHN0cmVhayk7XG5cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGUsXG4gICAgICAgICAgICAgICAgICAgICAgICBjb21wbGV0ZWQ6ICEhY29tcGxldGlvbixcbiAgICAgICAgICAgICAgICAgICAgICAgIGlzVG9kYXk6IGlzVG9kYXkoZGF0ZSwgdGltZXpvbmUpLFxuICAgICAgICAgICAgICAgICAgICAgICAgaXNJblN0cmVhayxcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbXBsZXRpb25UaW1lOiBjb21wbGV0aW9uXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgPyBjb21wbGV0aW9uLmNvbXBsZXRlZEF0LnRvRGF0ZSgpLnRvTG9jYWxlVGltZVN0cmluZygpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgOiB1bmRlZmluZWQsXG4gICAgICAgICAgICAgICAgICAgICAgICBub3RlczogY29tcGxldGlvbj8ubm90ZXMsXG4gICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICByZXR1cm4gY2FsZW5kYXJEYXlzO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICBjb25zdCBtZXNzYWdlID0gZ2V0VXNlckZyaWVuZGx5RXJyb3JNZXNzYWdlKGVycm9yKTtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgRmFpbGVkIHRvIGdldCBoYWJpdCBjYWxlbmRhcjogJHttZXNzYWdlfWApO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQ2hlY2sgZm9yIG5ldyBtaWxlc3RvbmVzIGFuZCByZXR1cm4gYW55IHRoYXQgc2hvdWxkIGJlIGNlbGVicmF0ZWRcbiAgICAgKiBSZXF1aXJlbWVudHM6IDMuMSwgMy4yLCA0LjRcbiAgICAgKi9cbiAgICBhc3luYyBjaGVja01pbGVzdG9uZXMoc3RyZWFrOiBIYWJpdFN0cmVhayk6IFByb21pc2U8U3RyZWFrTWlsZXN0b25lW10+IHtcbiAgICAgICAgY29uc3QgbmV3TWlsZXN0b25lczogU3RyZWFrTWlsZXN0b25lW10gPSBbXTtcbiAgICAgICAgY29uc3QgZXhpc3RpbmdNaWxlc3RvbmVEYXlzID0gc3RyZWFrLm1pbGVzdG9uZXMubWFwKChtKSA9PiBtLmRheXMpO1xuXG4gICAgICAgIGZvciAoY29uc3QgbWlsZXN0b25lRGF5IG9mIE1JTEVTVE9ORV9EQVlTKSB7XG4gICAgICAgICAgICBpZiAoXG4gICAgICAgICAgICAgICAgc3RyZWFrLmN1cnJlbnRTdHJlYWsgPj0gbWlsZXN0b25lRGF5ICYmXG4gICAgICAgICAgICAgICAgIWV4aXN0aW5nTWlsZXN0b25lRGF5cy5pbmNsdWRlcyhtaWxlc3RvbmVEYXkpXG4gICAgICAgICAgICApIHtcbiAgICAgICAgICAgICAgICBjb25zdCBtaWxlc3RvbmU6IFN0cmVha01pbGVzdG9uZSA9IHtcbiAgICAgICAgICAgICAgICAgICAgZGF5czogbWlsZXN0b25lRGF5LFxuICAgICAgICAgICAgICAgICAgICBhY2hpZXZlZEF0OiBUaW1lc3RhbXAubm93KCksXG4gICAgICAgICAgICAgICAgICAgIGNlbGVicmF0ZWQ6IGZhbHNlLFxuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgbmV3TWlsZXN0b25lcy5wdXNoKG1pbGVzdG9uZSk7XG5cbiAgICAgICAgICAgICAgICAvLyBBd2FyZCBzdHJlYWsgZnJlZXplIGZvciAzMC1kYXkgbWlsZXN0b25lcyAoUmVxdWlyZW1lbnQgNC40KVxuICAgICAgICAgICAgICAgIGlmIChtaWxlc3RvbmVEYXkgPT09IDMwKSB7XG4gICAgICAgICAgICAgICAgICAgIHN0cmVhay5mcmVlemVzQXZhaWxhYmxlICs9IDE7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgLy8gVXBkYXRlIHN0cmVhayB3aXRoIG5ldyBtaWxlc3RvbmVzXG4gICAgICAgIGlmIChuZXdNaWxlc3RvbmVzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgIGNvbnN0IHVwZGF0ZWRTdHJlYWs6IEhhYml0U3RyZWFrID0ge1xuICAgICAgICAgICAgICAgIC4uLnN0cmVhayxcbiAgICAgICAgICAgICAgICBtaWxlc3RvbmVzOiBbLi4uc3RyZWFrLm1pbGVzdG9uZXMsIC4uLm5ld01pbGVzdG9uZXNdLFxuICAgICAgICAgICAgICAgIC8vIFVwZGF0ZSBmcmVlemVzIGlmIDMwLWRheSBtaWxlc3RvbmUgd2FzIGFjaGlldmVkXG4gICAgICAgICAgICAgICAgZnJlZXplc0F2YWlsYWJsZTogc3RyZWFrLmZyZWV6ZXNBdmFpbGFibGUsXG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICBjb25zdCBzdHJlYWtJZCA9IGdlbmVyYXRlU3RyZWFrSWQoc3RyZWFrLnVzZXJJZCwgc3RyZWFrLmhhYml0SWQpO1xuICAgICAgICAgICAgY29uc3Qgc3RyZWFrc0NvbGxlY3Rpb24gPSBnZXRIYWJpdFN0cmVha3NDb2xsZWN0aW9uKCk7XG4gICAgICAgICAgICBjb25zdCBzdHJlYWtEb2NSZWYgPSBkb2Moc3RyZWFrc0NvbGxlY3Rpb24sIHN0cmVha0lkKTtcbiAgICAgICAgICAgIGNvbnN0IHN0cmVha0RhdGEgPSB0cmFuc2Zvcm1TdHJlYWtUb0ZpcmVzdG9yZSh1cGRhdGVkU3RyZWFrKTtcblxuICAgICAgICAgICAgYXdhaXQgcnVuVHJhbnNhY3Rpb24oZGIsIGFzeW5jICh0cmFuc2FjdGlvbikgPT4ge1xuICAgICAgICAgICAgICAgIHRyYW5zYWN0aW9uLnNldChzdHJlYWtEb2NSZWYsIHN0cmVha0RhdGEpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gbmV3TWlsZXN0b25lcztcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBHZXQgc3RyZWFrIGluZm9ybWF0aW9uIGZvciBhIHNwZWNpZmljIGhhYml0XG4gICAgICovXG4gICAgYXN5bmMgZ2V0SGFiaXRTdHJlYWsoXG4gICAgICAgIGhhYml0SWQ6IHN0cmluZyxcbiAgICAgICAgdXNlcklkOiBzdHJpbmcsXG4gICAgKTogUHJvbWlzZTxIYWJpdFN0cmVhayB8IG51bGw+IHtcbiAgICAgICAgaWYgKCFoYWJpdElkIHx8ICF1c2VySWQpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkhhYml0IElEIGFuZCBVc2VyIElEIGFyZSByZXF1aXJlZFwiKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBjb25zdCBzdHJlYWtJZCA9IGdlbmVyYXRlU3RyZWFrSWQodXNlcklkLCBoYWJpdElkKTtcbiAgICAgICAgICAgIGNvbnN0IHN0cmVha3NDb2xsZWN0aW9uID0gZ2V0SGFiaXRTdHJlYWtzQ29sbGVjdGlvbigpO1xuICAgICAgICAgICAgY29uc3Qgc3RyZWFrRG9jUmVmID0gZG9jKHN0cmVha3NDb2xsZWN0aW9uLCBzdHJlYWtJZCk7XG4gICAgICAgICAgICBjb25zdCBzdHJlYWtEb2MgPSBhd2FpdCBnZXREb2Moc3RyZWFrRG9jUmVmKTtcblxuICAgICAgICAgICAgaWYgKCFzdHJlYWtEb2MuZXhpc3RzKCkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgY29uc3Qgc3RyZWFrRGF0YSA9IHN0cmVha0RvYy5kYXRhKCk7XG4gICAgICAgICAgICBpZiAoIXZhbGlkYXRlU3RyZWFrRG9jdW1lbnQoc3RyZWFrRGF0YSkpIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJJbnZhbGlkIHN0cmVhayBkYXRhIGZvcm1hdFwiKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcmV0dXJuIHRyYW5zZm9ybUZpcmVzdG9yZVRvU3RyZWFrKHN0cmVha0RhdGEpO1xuICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgY29uc3QgbWVzc2FnZSA9IGdldFVzZXJGcmllbmRseUVycm9yTWVzc2FnZShlcnJvcik7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYEZhaWxlZCB0byBnZXQgaGFiaXQgc3RyZWFrOiAke21lc3NhZ2V9YCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBJbml0aWFsaXplIHN0cmVhayBkYXRhIGZvciBhIG5ldyBoYWJpdFxuICAgICAqL1xuICAgIGFzeW5jIGluaXRpYWxpemVIYWJpdFN0cmVhayhcbiAgICAgICAgaGFiaXRJZDogc3RyaW5nLFxuICAgICAgICB1c2VySWQ6IHN0cmluZyxcbiAgICApOiBQcm9taXNlPEhhYml0U3RyZWFrPiB7XG4gICAgICAgIGlmICghaGFiaXRJZCB8fCAhdXNlcklkKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJIYWJpdCBJRCBhbmQgVXNlciBJRCBhcmUgcmVxdWlyZWRcIik7XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBjdXJyZW50RGF0ZSA9IGdldEN1cnJlbnREYXRlU3RyaW5nKGdldFVzZXJUaW1lem9uZSgpKTtcbiAgICAgICAgY29uc3QgaW5pdGlhbFN0cmVhazogSGFiaXRTdHJlYWsgPSB7XG4gICAgICAgICAgICBoYWJpdElkLFxuICAgICAgICAgICAgdXNlcklkLFxuICAgICAgICAgICAgY3VycmVudFN0cmVhazogMCxcbiAgICAgICAgICAgIGJlc3RTdHJlYWs6IDAsXG4gICAgICAgICAgICBsYXN0Q29tcGxldGlvbkRhdGU6IFwiXCIsXG4gICAgICAgICAgICBzdHJlYWtTdGFydERhdGU6IGN1cnJlbnREYXRlLFxuICAgICAgICAgICAgZnJlZXplc0F2YWlsYWJsZTogMCxcbiAgICAgICAgICAgIGZyZWV6ZXNVc2VkOiAwLFxuICAgICAgICAgICAgbWlsZXN0b25lczogW10sXG4gICAgICAgIH07XG5cbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGNvbnN0IHN0cmVha0lkID0gZ2VuZXJhdGVTdHJlYWtJZCh1c2VySWQsIGhhYml0SWQpO1xuICAgICAgICAgICAgY29uc3Qgc3RyZWFrc0NvbGxlY3Rpb24gPSBnZXRIYWJpdFN0cmVha3NDb2xsZWN0aW9uKCk7XG4gICAgICAgICAgICBjb25zdCBzdHJlYWtEb2NSZWYgPSBkb2Moc3RyZWFrc0NvbGxlY3Rpb24sIHN0cmVha0lkKTtcbiAgICAgICAgICAgIGNvbnN0IHN0cmVha0RhdGEgPSB0cmFuc2Zvcm1TdHJlYWtUb0ZpcmVzdG9yZShpbml0aWFsU3RyZWFrKTtcblxuICAgICAgICAgICAgYXdhaXQgcnVuVHJhbnNhY3Rpb24oZGIsIGFzeW5jICh0cmFuc2FjdGlvbikgPT4ge1xuICAgICAgICAgICAgICAgIHRyYW5zYWN0aW9uLnNldChzdHJlYWtEb2NSZWYsIHN0cmVha0RhdGEpO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHJldHVybiBpbml0aWFsU3RyZWFrO1xuICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgY29uc3QgbWVzc2FnZSA9IGdldFVzZXJGcmllbmRseUVycm9yTWVzc2FnZShlcnJvcik7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYEZhaWxlZCB0byBpbml0aWFsaXplIGhhYml0IHN0cmVhazogJHttZXNzYWdlfWApO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogUmVzZXQgYSBzdHJlYWsgKHVzZWQgd2hlbiBzdHJlYWsgaXMgYnJva2VuIGFuZCBubyBmcmVlemUgYXZhaWxhYmxlKVxuICAgICAqIFJlcXVpcmVtZW50czogMS4yXG4gICAgICovXG4gICAgYXN5bmMgcmVzZXRTdHJlYWsoXG4gICAgICAgIGhhYml0SWQ6IHN0cmluZyxcbiAgICAgICAgdXNlcklkOiBzdHJpbmcsXG4gICAgICAgIHJlc2V0RGF0ZTogc3RyaW5nLFxuICAgICk6IFByb21pc2U8SGFiaXRTdHJlYWs+IHtcbiAgICAgICAgaWYgKCFoYWJpdElkIHx8ICF1c2VySWQgfHwgIXJlc2V0RGF0ZSkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiSGFiaXQgSUQsIFVzZXIgSUQsIGFuZCByZXNldCBkYXRlIGFyZSByZXF1aXJlZFwiKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICByZXR1cm4gYXdhaXQgcmV0cnlXaXRoQmFja29mZihhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGF3YWl0IHJ1blRyYW5zYWN0aW9uKGRiLCBhc3luYyAodHJhbnNhY3Rpb24pID0+IHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3Qgc3RyZWFrSWQgPSBnZW5lcmF0ZVN0cmVha0lkKHVzZXJJZCwgaGFiaXRJZCk7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHN0cmVha3NDb2xsZWN0aW9uID0gZ2V0SGFiaXRTdHJlYWtzQ29sbGVjdGlvbigpO1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBzdHJlYWtEb2NSZWYgPSBkb2Moc3RyZWFrc0NvbGxlY3Rpb24sIHN0cmVha0lkKTtcbiAgICAgICAgICAgICAgICAgICAgY29uc3Qgc3RyZWFrRG9jID0gYXdhaXQgdHJhbnNhY3Rpb24uZ2V0KHN0cmVha0RvY1JlZik7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKCFzdHJlYWtEb2MuZXhpc3RzKCkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIlN0cmVhayBkYXRhIG5vdCBmb3VuZFwiKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHN0cmVhayA9IHRyYW5zZm9ybUZpcmVzdG9yZVRvU3RyZWFrKHN0cmVha0RvYy5kYXRhKCkpO1xuXG4gICAgICAgICAgICAgICAgICAgIC8vIFZhbGlkYXRlIHVzZXIgb3duZXJzaGlwXG4gICAgICAgICAgICAgICAgICAgIGlmICghdmFsaWRhdGVVc2VyT3duZXJzaGlwKHVzZXJJZCwgc3RyZWFrLnVzZXJJZCkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIlVuYXV0aG9yaXplZCBhY2Nlc3MgdG8gc3RyZWFrIGRhdGFcIik7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICBjb25zdCByZXNldFN0cmVhazogSGFiaXRTdHJlYWsgPSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAuLi5zdHJlYWssXG4gICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50U3RyZWFrOiAwLFxuICAgICAgICAgICAgICAgICAgICAgICAgbGFzdENvbXBsZXRpb25EYXRlOiBcIlwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgc3RyZWFrU3RhcnREYXRlOiByZXNldERhdGUsXG4gICAgICAgICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICAgICAgICAgY29uc3Qgc3RyZWFrRGF0YSA9IHRyYW5zZm9ybVN0cmVha1RvRmlyZXN0b3JlKHJlc2V0U3RyZWFrKTtcbiAgICAgICAgICAgICAgICAgICAgdHJhbnNhY3Rpb24uc2V0KHN0cmVha0RvY1JlZiwgc3RyZWFrRGF0YSk7XG5cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlc2V0U3RyZWFrO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICBjb25zdCBtZXNzYWdlID0gZ2V0VXNlckZyaWVuZGx5RXJyb3JNZXNzYWdlKGVycm9yKTtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgRmFpbGVkIHRvIHJlc2V0IHN0cmVhazogJHttZXNzYWdlfWApO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLy8gUHJpdmF0ZSBoZWxwZXIgbWV0aG9kc1xuXG4gICAgLyoqXG4gICAgICogQ2FsY3VsYXRlIHN0cmVhayBmcm9tIGNvbXBsZXRpb24gcmVjb3Jkc1xuICAgICAqL1xuICAgIHByaXZhdGUgY2FsY3VsYXRlU3RyZWFrRnJvbUNvbXBsZXRpb25zKFxuICAgICAgICBjb21wbGV0aW9uczogSGFiaXRDb21wbGV0aW9uW10sXG4gICAgICAgIGhhYml0SWQ6IHN0cmluZyxcbiAgICAgICAgdXNlcklkOiBzdHJpbmcsXG4gICAgKTogSGFiaXRTdHJlYWsge1xuICAgICAgICBpZiAoY29tcGxldGlvbnMubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIGhhYml0SWQsXG4gICAgICAgICAgICAgICAgdXNlcklkLFxuICAgICAgICAgICAgICAgIGN1cnJlbnRTdHJlYWs6IDAsXG4gICAgICAgICAgICAgICAgYmVzdFN0cmVhazogMCxcbiAgICAgICAgICAgICAgICBsYXN0Q29tcGxldGlvbkRhdGU6IFwiXCIsXG4gICAgICAgICAgICAgICAgc3RyZWFrU3RhcnREYXRlOiBnZXRDdXJyZW50RGF0ZVN0cmluZyhnZXRVc2VyVGltZXpvbmUoKSksXG4gICAgICAgICAgICAgICAgZnJlZXplc0F2YWlsYWJsZTogMCxcbiAgICAgICAgICAgICAgICBmcmVlemVzVXNlZDogMCxcbiAgICAgICAgICAgICAgICBtaWxlc3RvbmVzOiBbXSxcbiAgICAgICAgICAgIH07XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCB0aW1lem9uZSA9IGNvbXBsZXRpb25zWzBdPy50aW1lem9uZSB8fCBnZXRVc2VyVGltZXpvbmUoKTtcbiAgICAgICAgY29uc3QgY29tcGxldGlvbkRhdGVzID0gY29tcGxldGlvbnMubWFwKChjb21wKSA9PlxuICAgICAgICAgICAgdGltZXN0YW1wVG9EYXRlU3RyaW5nKGNvbXAuY29tcGxldGVkQXQsIHRpbWV6b25lKSxcbiAgICAgICAgKTtcblxuICAgICAgICAvLyBSZW1vdmUgZHVwbGljYXRlcyBhbmQgc29ydFxuICAgICAgICBjb25zdCB1bmlxdWVEYXRlcyA9IFsuLi5uZXcgU2V0KGNvbXBsZXRpb25EYXRlcyldLnNvcnQoKTtcblxuICAgICAgICAvLyBDYWxjdWxhdGUgY3VycmVudCBzdHJlYWsgKGZyb20gbW9zdCByZWNlbnQgY29tcGxldGlvbiBiYWNrd2FyZHMpXG4gICAgICAgIGxldCBjdXJyZW50U3RyZWFrID0gMDtcbiAgICAgICAgbGV0IHN0cmVha1N0YXJ0RGF0ZSA9IFwiXCI7XG4gICAgICAgIGNvbnN0IHRvZGF5ID0gZ2V0Q3VycmVudERhdGVTdHJpbmcodGltZXpvbmUpO1xuICAgICAgICBjb25zdCB5ZXN0ZXJkYXkgPSBmb3JtYXREYXRlVG9TdHJpbmcoXG4gICAgICAgICAgICBuZXcgRGF0ZShEYXRlLm5vdygpIC0gMjQgKiA2MCAqIDYwICogMTAwMCksXG4gICAgICAgICAgICB0aW1lem9uZSxcbiAgICAgICAgKTtcblxuICAgICAgICAvLyBDaGVjayBpZiB0aGVyZSdzIGEgY29tcGxldGlvbiB0b2RheSBvciB5ZXN0ZXJkYXkgdG8gc3RhcnQgY291bnRpbmdcbiAgICAgICAgY29uc3QgbGFzdENvbXBsZXRpb25EYXRlID0gdW5pcXVlRGF0ZXNbdW5pcXVlRGF0ZXMubGVuZ3RoIC0gMV07XG4gICAgICAgIGlmIChsYXN0Q29tcGxldGlvbkRhdGUgPT09IHRvZGF5IHx8IGxhc3RDb21wbGV0aW9uRGF0ZSA9PT0geWVzdGVyZGF5KSB7XG4gICAgICAgICAgICBjdXJyZW50U3RyZWFrID0gMTtcbiAgICAgICAgICAgIHN0cmVha1N0YXJ0RGF0ZSA9IGxhc3RDb21wbGV0aW9uRGF0ZTtcblxuICAgICAgICAgICAgLy8gQ291bnQgYmFja3dhcmRzIGZvciBjb25zZWN1dGl2ZSBkYXlzXG4gICAgICAgICAgICBmb3IgKGxldCBpID0gdW5pcXVlRGF0ZXMubGVuZ3RoIC0gMjsgaSA+PSAwOyBpLS0pIHtcbiAgICAgICAgICAgICAgICBjb25zdCBjdXJyZW50RGF0ZSA9IHVuaXF1ZURhdGVzW2kgKyAxXTtcbiAgICAgICAgICAgICAgICBjb25zdCBwcmV2aW91c0RhdGUgPSB1bmlxdWVEYXRlc1tpXTtcblxuICAgICAgICAgICAgICAgIGlmIChhcmVDb25zZWN1dGl2ZURheXMocHJldmlvdXNEYXRlLCBjdXJyZW50RGF0ZSkpIHtcbiAgICAgICAgICAgICAgICAgICAgY3VycmVudFN0cmVhaysrO1xuICAgICAgICAgICAgICAgICAgICBzdHJlYWtTdGFydERhdGUgPSBwcmV2aW91c0RhdGU7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgLy8gQ2FsY3VsYXRlIGJlc3Qgc3RyZWFrIChsb25nZXN0IGNvbnNlY3V0aXZlIHNlcXVlbmNlKVxuICAgICAgICBsZXQgYmVzdFN0cmVhayA9IDA7XG4gICAgICAgIGxldCB0ZW1wU3RyZWFrID0gMTtcblxuICAgICAgICBmb3IgKGxldCBpID0gMTsgaSA8IHVuaXF1ZURhdGVzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICBpZiAoYXJlQ29uc2VjdXRpdmVEYXlzKHVuaXF1ZURhdGVzW2kgLSAxXSwgdW5pcXVlRGF0ZXNbaV0pKSB7XG4gICAgICAgICAgICAgICAgdGVtcFN0cmVhaysrO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBiZXN0U3RyZWFrID0gTWF0aC5tYXgoYmVzdFN0cmVhaywgdGVtcFN0cmVhayk7XG4gICAgICAgICAgICAgICAgdGVtcFN0cmVhayA9IDE7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgYmVzdFN0cmVhayA9IE1hdGgubWF4KGJlc3RTdHJlYWssIHRlbXBTdHJlYWssIGN1cnJlbnRTdHJlYWspO1xuXG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBoYWJpdElkLFxuICAgICAgICAgICAgdXNlcklkLFxuICAgICAgICAgICAgY3VycmVudFN0cmVhayxcbiAgICAgICAgICAgIGJlc3RTdHJlYWssXG4gICAgICAgICAgICBsYXN0Q29tcGxldGlvbkRhdGUsXG4gICAgICAgICAgICBzdHJlYWtTdGFydERhdGUsXG4gICAgICAgICAgICBmcmVlemVzQXZhaWxhYmxlOiAwLFxuICAgICAgICAgICAgZnJlZXplc1VzZWQ6IDAsXG4gICAgICAgICAgICBtaWxlc3RvbmVzOiBbXSxcbiAgICAgICAgfTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBNZXJnZSBjYWxjdWxhdGVkIHN0cmVhayB3aXRoIGV4aXN0aW5nIHN0cmVhayBkYXRhXG4gICAgICovXG4gICAgcHJpdmF0ZSBtZXJnZVN0cmVha0RhdGEoXG4gICAgICAgIGNhbGN1bGF0ZWQ6IEhhYml0U3RyZWFrLFxuICAgICAgICBleGlzdGluZzogSGFiaXRTdHJlYWsgfCBudWxsLFxuICAgICk6IEhhYml0U3RyZWFrIHtcbiAgICAgICAgaWYgKCFleGlzdGluZykge1xuICAgICAgICAgICAgcmV0dXJuIGNhbGN1bGF0ZWQ7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgLi4uY2FsY3VsYXRlZCxcbiAgICAgICAgICAgIGZyZWV6ZXNBdmFpbGFibGU6IGV4aXN0aW5nLmZyZWV6ZXNBdmFpbGFibGUsXG4gICAgICAgICAgICBmcmVlemVzVXNlZDogZXhpc3RpbmcuZnJlZXplc1VzZWQsXG4gICAgICAgICAgICBtaWxlc3RvbmVzOiBleGlzdGluZy5taWxlc3RvbmVzLFxuICAgICAgICAgICAgLy8gRW5zdXJlIGJlc3Qgc3RyZWFrIG5ldmVyIGRlY3JlYXNlc1xuICAgICAgICAgICAgYmVzdFN0cmVhazogTWF0aC5tYXgoY2FsY3VsYXRlZC5iZXN0U3RyZWFrLCBleGlzdGluZy5iZXN0U3RyZWFrKSxcbiAgICAgICAgfTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBDaGVjayBpZiBhIGRhdGUgaXMgd2l0aGluIHRoZSBjdXJyZW50IHN0cmVhayBwZXJpb2RcbiAgICAgKi9cbiAgICBwcml2YXRlIGlzRGF0ZUluQ3VycmVudFN0cmVhayhcbiAgICAgICAgZGF0ZTogc3RyaW5nLFxuICAgICAgICBzdHJlYWs6IEhhYml0U3RyZWFrIHwgbnVsbCxcbiAgICApOiBib29sZWFuIHtcbiAgICAgICAgaWYgKCFzdHJlYWsgfHwgc3RyZWFrLmN1cnJlbnRTdHJlYWsgPT09IDAgfHwgIXN0cmVhay5zdHJlYWtTdGFydERhdGUpIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IHN0cmVha1N0YXJ0ID0gcGFyc2VEYXRlU3RyaW5nKHN0cmVhay5zdHJlYWtTdGFydERhdGUpO1xuICAgICAgICBjb25zdCBjaGVja0RhdGUgPSBwYXJzZURhdGVTdHJpbmcoZGF0ZSk7XG4gICAgICAgIGNvbnN0IHN0cmVha0VuZCA9IG5ldyBEYXRlKHN0cmVha1N0YXJ0KTtcbiAgICAgICAgc3RyZWFrRW5kLnNldERhdGUoc3RyZWFrRW5kLmdldERhdGUoKSArIHN0cmVhay5jdXJyZW50U3RyZWFrIC0gMSk7XG5cbiAgICAgICAgcmV0dXJuIGNoZWNrRGF0ZSA+PSBzdHJlYWtTdGFydCAmJiBjaGVja0RhdGUgPD0gc3RyZWFrRW5kO1xuICAgIH1cbn1cblxuLy8gRXhwb3J0IHNpbmdsZXRvbiBpbnN0YW5jZVxuZXhwb3J0IGNvbnN0IHN0cmVha1NlcnZpY2UgPSBuZXcgU3RyZWFrU2VydmljZSgpO1xuIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7QUFBQSxJQUFBQSxVQUFBLEdBQUFDLE9BQUE7QUFVQSxJQUFBQyxlQUFBLEdBQUFELE9BQUE7QUFDQSxJQUFBRSxhQUFBLEdBQUFGLE9BQUE7QUFPQSxJQUFBRyxVQUFBLEdBQUFILE9BQUE7QUFVQSxJQUFBSSxjQUFBLEdBQUFKLE9BQUE7QUFJQSxJQUFBSyxZQUFBLEdBQUFMLE9BQUE7QUFLQSxJQUFBTSxtQkFBQSxHQUFBTixPQUFBO0FBTzhCLElBUWpCTyxhQUFhLEdBQUFDLE9BQUEsQ0FBQUQsYUFBQTtFQUFBLFNBQUFBLGNBQUE7SUFBQSxJQUFBRSxnQkFBQSxDQUFBQyxPQUFBLFFBQUFILGFBQUE7RUFBQTtFQUFBLFdBQUFJLGFBQUEsQ0FBQUQsT0FBQSxFQUFBSCxhQUFBO0lBQUFLLEdBQUE7SUFBQUMsS0FBQTtNQUFBLElBQUFDLGdCQUFBLE9BQUFDLGtCQUFBLENBQUFMLE9BQUEsRUFLdEIsV0FBc0JNLE9BQWUsRUFBRUMsTUFBYyxFQUF3QjtRQUFBLElBQUFDLEtBQUE7UUFDekUsSUFBSSxDQUFDRixPQUFPLElBQUksQ0FBQ0MsTUFBTSxFQUFFO1VBQ3JCLE1BQU0sSUFBSUUs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