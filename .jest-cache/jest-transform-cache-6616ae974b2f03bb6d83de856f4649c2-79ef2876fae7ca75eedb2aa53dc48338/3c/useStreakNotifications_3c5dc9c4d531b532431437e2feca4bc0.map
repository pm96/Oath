{"version":3,"names":["_streakNotificationService","require","_errorHandling","_react","_useAuth2","useStreakNotifications","_useAuth","useAuth","user","_useState","useState","_useState2","_slicedToArray2","default","preferences","setPreferences","_useState3","_useState4","loading","setLoading","_useState5","_useState6","error","setError","loadPreferences","useCallback","_asyncToGenerator2","userPreferences","streakNotificationService","getUserNotificationPreferences","uid","err","message","getUserFriendlyErrorMessage","console","updatePreferences","_ref2","newPreferences","Error","updateNotificationPreferences","prev","Object","assign","_x","apply","arguments","sendMilestoneNotification","_ref3","habitId","habitName","milestone","success","_x2","_x3","_x4","sendStreakRiskReminder","_ref4","currentStreak","_x5","_x6","_x7","sendRecoveryNotification","_ref5","previousBestStreak","_x8","_x9","_x0","sendWeeklyProgressNotification","_ref6","weeklyCompletions","_x1","_x10","_x11","_x12","toggleNotificationType","_ref7","type","enabled","_defineProperty2","_x13","_x14","updateReminderTime","_ref8","hours","reminderTime","_x15","useEffect"],"sources":["useStreakNotifications.ts"],"sourcesContent":["import {\n    NotificationPreferences,\n    streakNotificationService,\n} from \"@/services/firebase/streakNotificationService\";\nimport { getUserFriendlyErrorMessage } from \"@/utils/errorHandling\";\nimport { useCallback, useEffect, useState } from \"react\";\nimport { useAuth } from \"./useAuth\";\n\n/**\n * useStreakNotifications Hook\n *\n * Custom hook for managing streak notification preferences and sending notifications\n * Requirements: 11.1, 11.2, 11.3, 11.4, 11.5\n */\nexport function useStreakNotifications() {\n    const { user } = useAuth();\n    const [preferences, setPreferences] =\n        useState<NotificationPreferences | null>(null);\n    const [loading, setLoading] = useState(false);\n    const [error, setError] = useState<string | null>(null);\n\n    /**\n     * Load user notification preferences\n     */\n    const loadPreferences = useCallback(async () => {\n        if (!user) return;\n\n        try {\n            setLoading(true);\n            setError(null);\n\n            const userPreferences =\n                await streakNotificationService.getUserNotificationPreferences(\n                    user.uid,\n                );\n            setPreferences(userPreferences);\n        } catch (err) {\n            const message = getUserFriendlyErrorMessage(err);\n            setError(message);\n            console.error(\"Error loading notification preferences:\", err);\n        } finally {\n            setLoading(false);\n        }\n    }, [user]);\n\n    /**\n     * Update notification preferences\n     */\n    const updatePreferences = useCallback(\n        async (newPreferences: Partial<NotificationPreferences>) => {\n            if (!user) {\n                throw new Error(\"User must be authenticated\");\n            }\n\n            try {\n                setLoading(true);\n                setError(null);\n\n                await streakNotificationService.updateNotificationPreferences(\n                    user.uid,\n                    newPreferences,\n                );\n\n                // Update local state\n                setPreferences((prev) =>\n                    prev ? { ...prev, ...newPreferences } : null,\n                );\n\n                return true;\n            } catch (err) {\n                const message = getUserFriendlyErrorMessage(err);\n                setError(message);\n                console.error(\"Error updating notification preferences:\", err);\n                return false;\n            } finally {\n                setLoading(false);\n            }\n        },\n        [user],\n    );\n\n    /**\n     * Send milestone notification\n     * Requirements: 11.2\n     */\n    const sendMilestoneNotification = useCallback(\n        async (\n            habitId: string,\n            habitName: string,\n            milestone: { days: number; achievedAt: any; celebrated: boolean },\n        ) => {\n            if (!user) {\n                throw new Error(\"User must be authenticated\");\n            }\n\n            try {\n                const success =\n                    await streakNotificationService.sendMilestoneNotification(\n                        user.uid,\n                        habitId,\n                        habitName,\n                        milestone,\n                    );\n                return success;\n            } catch (err) {\n                const message = getUserFriendlyErrorMessage(err);\n                setError(message);\n                console.error(\"Error sending milestone notification:\", err);\n                return false;\n            }\n        },\n        [user],\n    );\n\n    /**\n     * Send streak risk reminder\n     * Requirements: 11.1\n     */\n    const sendStreakRiskReminder = useCallback(\n        async (habitId: string, habitName: string, currentStreak: number) => {\n            if (!user) {\n                throw new Error(\"User must be authenticated\");\n            }\n\n            try {\n                const success = await streakNotificationService.sendStreakRiskReminder(\n                    user.uid,\n                    habitId,\n                    habitName,\n                    currentStreak,\n                );\n                return success;\n            } catch (err) {\n                const message = getUserFriendlyErrorMessage(err);\n                setError(message);\n                console.error(\"Error sending streak risk reminder:\", err);\n                return false;\n            }\n        },\n        [user],\n    );\n\n    /**\n     * Send recovery notification\n     * Requirements: 11.3\n     */\n    const sendRecoveryNotification = useCallback(\n        async (habitId: string, habitName: string, previousBestStreak: number) => {\n            if (!user) {\n                throw new Error(\"User must be authenticated\");\n            }\n\n            try {\n                const success =\n                    await streakNotificationService.sendRecoveryNotification(\n                        user.uid,\n                        habitId,\n                        habitName,\n                        previousBestStreak,\n                    );\n                return success;\n            } catch (err) {\n                const message = getUserFriendlyErrorMessage(err);\n                setError(message);\n                console.error(\"Error sending recovery notification:\", err);\n                return false;\n            }\n        },\n        [user],\n    );\n\n    /**\n     * Send weekly progress notification\n     * Requirements: 11.4\n     */\n    const sendWeeklyProgressNotification = useCallback(\n        async (\n            habitId: string,\n            habitName: string,\n            currentStreak: number,\n            weeklyCompletions: number,\n        ) => {\n            if (!user) {\n                throw new Error(\"User must be authenticated\");\n            }\n\n            try {\n                const success =\n                    await streakNotificationService.sendWeeklyProgressNotification(\n                        user.uid,\n                        habitId,\n                        habitName,\n                        currentStreak,\n                        weeklyCompletions,\n                    );\n                return success;\n            } catch (err) {\n                const message = getUserFriendlyErrorMessage(err);\n                setError(message);\n                console.error(\"Error sending weekly progress notification:\", err);\n                return false;\n            }\n        },\n        [user],\n    );\n\n    /**\n     * Toggle specific notification type\n     */\n    const toggleNotificationType = useCallback(\n        async (type: keyof NotificationPreferences, enabled: boolean) => {\n            return await updatePreferences({ [type]: enabled });\n        },\n        [updatePreferences],\n    );\n\n    /**\n     * Update reminder time (hours before day end)\n     */\n    const updateReminderTime = useCallback(\n        async (hours: number) => {\n            if (hours < 1 || hours > 12) {\n                throw new Error(\"Reminder time must be between 1 and 12 hours\");\n            }\n\n            return await updatePreferences({ reminderTime: hours });\n        },\n        [updatePreferences],\n    );\n\n    // Load preferences when user changes\n    useEffect(() => {\n        if (user) {\n            loadPreferences();\n        } else {\n            setPreferences(null);\n            setError(null);\n        }\n    }, [user, loadPreferences]);\n\n    return {\n        preferences,\n        loading,\n        error,\n        loadPreferences,\n        updatePreferences,\n        sendMilestoneNotification,\n        sendStreakRiskReminder,\n        sendRecoveryNotification,\n        sendWeeklyProgressNotification,\n        toggleNotificationType,\n        updateReminderTime,\n    };\n}\n"],"mappings":"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","ignoreList":[]}