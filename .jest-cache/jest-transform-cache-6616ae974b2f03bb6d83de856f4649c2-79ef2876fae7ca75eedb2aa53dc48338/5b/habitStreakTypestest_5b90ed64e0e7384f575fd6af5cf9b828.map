{"version":3,"names":["_firestore","require","_habitStreakSchemas","_habitStreaks","_dateUtils","describe","test","expect","isValidDifficulty","toBe","validCompletion","id","habitId","userId","completedAt","Timestamp","now","timezone","difficulty","notes","isValidHabitCompletion","Object","assign","MILESTONE_DAYS","toEqual","DIFFICULTY_MULTIPLIERS","easy","medium","hard","date","Date","dateString","formatDateToString","parseDateString","getFullYear","getMonth","getDate","areConsecutiveDays","getDaysDifference","isValidDateString","getCurrentDateString","getUserTimezone","length","toBeGreaterThan","timestamp","completionId","generateCompletionId","seconds","streakId","generateStreakId","analyticsId","generateAnalyticsId","validDoc","createdAt","validateCompletionDocument","currentStreak","bestStreak","lastCompletionDate","streakStartDate","freezesAvailable","freezesUsed","milestones","updatedAt","validateStreakDocument","totalCompletions","completionRate30Days","averageStreakLength","bestDayOfWeek","consistencyScore","lastUpdated","validateAnalyticsDocument"],"sources":["habitStreakTypes.test.ts"],"sourcesContent":["import { Timestamp } from \"firebase/firestore\";\nimport {\n    generateAnalyticsId,\n    generateCompletionId,\n    generateStreakId,\n    validateAnalyticsDocument,\n    validateCompletionDocument,\n    validateStreakDocument,\n} from \"../services/firebase/habitStreakSchemas\";\nimport {\n    DIFFICULTY_MULTIPLIERS,\n    HabitCompletion,\n    isValidDifficulty,\n    isValidHabitCompletion,\n    MILESTONE_DAYS\n} from \"../types/habit-streaks\";\nimport {\n    areConsecutiveDays,\n    formatDateToString,\n    getCurrentDateString,\n    getDaysDifference,\n    getUserTimezone,\n    isValidDateString,\n    parseDateString,\n} from \"../utils/dateUtils\";\n\ndescribe(\"Habit Streak Types and Validation\", () => {\n    describe(\"Type Validation\", () => {\n        test(\"should validate difficulty levels correctly\", () => {\n            expect(isValidDifficulty(\"easy\")).toBe(true);\n            expect(isValidDifficulty(\"medium\")).toBe(true);\n            expect(isValidDifficulty(\"hard\")).toBe(true);\n            expect(isValidDifficulty(\"invalid\")).toBe(false);\n            expect(isValidDifficulty(null)).toBe(false);\n        });\n\n        test(\"should validate habit completion objects\", () => {\n            const validCompletion: HabitCompletion = {\n                id: \"test-id\",\n                habitId: \"habit-1\",\n                userId: \"user-1\",\n                completedAt: Timestamp.now(),\n                timezone: \"America/New_York\",\n                difficulty: \"medium\",\n                notes: \"Test completion\",\n            };\n\n            expect(isValidHabitCompletion(validCompletion)).toBe(true);\n            expect(\n                isValidHabitCompletion({ ...validCompletion, difficulty: \"invalid\" }),\n            ).toBe(false);\n            expect(isValidHabitCompletion({ ...validCompletion, habitId: \"\" })).toBe(\n                false,\n            );\n        });\n\n        test(\"should validate milestone constants\", () => {\n            expect(MILESTONE_DAYS).toEqual([7, 30, 60, 100, 365]);\n            expect(DIFFICULTY_MULTIPLIERS.easy).toBe(1);\n            expect(DIFFICULTY_MULTIPLIERS.medium).toBe(1.5);\n            expect(DIFFICULTY_MULTIPLIERS.hard).toBe(2);\n        });\n    });\n\n    describe(\"Date Utilities\", () => {\n        test(\"should format dates correctly\", () => {\n            const date = new Date(\"2024-01-15T10:30:00Z\");\n            const dateString = formatDateToString(date, \"UTC\");\n            expect(dateString).toBe(\"2024-01-15\");\n        });\n\n        test(\"should parse date strings correctly\", () => {\n            const dateString = \"2024-01-15\";\n            const date = parseDateString(dateString);\n            expect(date.getFullYear()).toBe(2024);\n            expect(date.getMonth()).toBe(0); // January is 0\n            expect(date.getDate()).toBe(15);\n        });\n\n        test(\"should detect consecutive days\", () => {\n            expect(areConsecutiveDays(\"2024-01-15\", \"2024-01-16\")).toBe(true);\n            expect(areConsecutiveDays(\"2024-01-15\", \"2024-01-17\")).toBe(false);\n            expect(areConsecutiveDays(\"2024-01-31\", \"2024-02-01\")).toBe(true);\n        });\n\n        test(\"should calculate days difference\", () => {\n            expect(getDaysDifference(\"2024-01-15\", \"2024-01-20\")).toBe(5);\n            expect(getDaysDifference(\"2024-01-15\", \"2024-01-15\")).toBe(0);\n            expect(getDaysDifference(\"2024-01-20\", \"2024-01-15\")).toBe(-5);\n        });\n\n        test(\"should validate date strings\", () => {\n            expect(isValidDateString(\"2024-01-15\")).toBe(true);\n            expect(isValidDateString(\"2024-13-01\")).toBe(false);\n            expect(isValidDateString(\"invalid-date\")).toBe(false);\n            expect(isValidDateString(\"24-01-15\")).toBe(false);\n        });\n\n        test(\"should get current date string\", () => {\n            const dateString = getCurrentDateString(\"UTC\");\n            expect(isValidDateString(dateString)).toBe(true);\n        });\n\n        test(\"should get user timezone\", () => {\n            const timezone = getUserTimezone();\n            expect(typeof timezone).toBe(\"string\");\n            expect(timezone.length).toBeGreaterThan(0);\n        });\n    });\n\n    describe(\"Firestore Schema Validation\", () => {\n        test(\"should generate correct document IDs\", () => {\n            const userId = \"user-123\";\n            const habitId = \"habit-456\";\n            const timestamp = Timestamp.now();\n\n            const completionId = generateCompletionId(userId, habitId, timestamp);\n            expect(completionId).toBe(`${userId}_${habitId}_${timestamp.seconds}`);\n\n            const streakId = generateStreakId(userId, habitId);\n            expect(streakId).toBe(`${userId}_${habitId}`);\n\n            const analyticsId = generateAnalyticsId(userId, habitId);\n            expect(analyticsId).toBe(`${userId}_${habitId}`);\n        });\n\n        test(\"should validate Firestore completion documents\", () => {\n            const validDoc = {\n                habitId: \"habit-1\",\n                userId: \"user-1\",\n                completedAt: Timestamp.now(),\n                timezone: \"America/New_York\",\n                difficulty: \"medium\",\n                createdAt: Timestamp.now(),\n            };\n\n            expect(validateCompletionDocument(validDoc)).toBe(true);\n            expect(validateCompletionDocument({ ...validDoc, habitId: \"\" })).toBe(\n                false,\n            );\n            expect(\n                validateCompletionDocument({ ...validDoc, difficulty: \"invalid\" }),\n            ).toBe(false);\n        });\n\n        test(\"should validate Firestore streak documents\", () => {\n            const validDoc = {\n                habitId: \"habit-1\",\n                userId: \"user-1\",\n                currentStreak: 5,\n                bestStreak: 10,\n                lastCompletionDate: \"2024-01-15\",\n                streakStartDate: \"2024-01-11\",\n                freezesAvailable: 2,\n                freezesUsed: 0,\n                milestones: [],\n                updatedAt: Timestamp.now(),\n            };\n\n            expect(validateStreakDocument(validDoc)).toBe(true);\n            expect(validateStreakDocument({ ...validDoc, currentStreak: -1 })).toBe(\n                false,\n            );\n            expect(\n                validateStreakDocument({\n                    ...validDoc,\n                    lastCompletionDate: \"invalid-date\",\n                }),\n            ).toBe(false);\n        });\n\n        test(\"should validate Firestore analytics documents\", () => {\n            const validDoc = {\n                habitId: \"habit-1\",\n                userId: \"user-1\",\n                totalCompletions: 50,\n                completionRate30Days: 85.5,\n                averageStreakLength: 7.2,\n                bestDayOfWeek: \"Monday\",\n                consistencyScore: 78.5,\n                lastUpdated: Timestamp.now(),\n            };\n\n            expect(validateAnalyticsDocument(validDoc)).toBe(true);\n            expect(\n                validateAnalyticsDocument({ ...validDoc, completionRate30Days: 150 }),\n            ).toBe(false);\n            expect(\n                validateAnalyticsDocument({ ...validDoc, totalCompletions: -1 }),\n            ).toBe(false);\n        });\n    });\n});\n"],"mappings":"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","ignoreList":[]}