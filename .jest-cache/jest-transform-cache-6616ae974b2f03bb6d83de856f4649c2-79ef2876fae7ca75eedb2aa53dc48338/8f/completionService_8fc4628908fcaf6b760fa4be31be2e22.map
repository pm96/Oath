{"version":3,"names":["_firestore","require","_firebaseConfig","_dateUtils","_errorHandling","_collections","_habitStreakSchemas","CompletionService","exports","_classCallCheck2","default","_createClass2","key","value","_recordCompletion","_asyncToGenerator2","completion","habitId","userId","Error","userTimezone","timezone","getUserTimezone","completionDateString","timestampToDateString","completedAt","currentDateString","getCurrentDateString","retryWithBackoff","runTransaction","db","_ref2","transaction","completionsCollection","getHabitCompletionsCollection","existingCompletionsQuery","query","where","existingSnapshot","getDocs","existingCompletions","docs","map","doc","transformFirestoreToCompletion","id","data","filter","comp","compDateString","length","completionData","notes","difficulty","createdAt","serverTimestamp","completionRef","set","newCompletion","Object","assign","_x2","apply","arguments","error","message","getUserFriendlyErrorMessage","recordCompletion","_x","_getCompletionHistory","_this","limit","undefined","startAfter","completionsQuery","orderBy","completionsSnapshot","completions","slice","totalCount","period","calculatePeriodFromCompletions","completionRate","calculateCompletionRate","startDate","endDate","rate","description","getCompletionHistory","_x3","_x4","_calculateCompletionRate","allCompletions","completionsInRange","completionDate","start","Date","end","totalDays","Math","ceil","getTime","uniqueCompletionDates","Set","completedDays","size","round","_x5","_x6","_x7","_x8","_getGroupedCompletions","_this2","months","formatDateToString","now","weeklyGroups","groupCompletionsByWeek","monthlyGroups","groupCompletionsByMonth","weekly","monthly","getGroupedCompletions","_x9","_x0","_getCompletionDetail","completionId","_this3","completionDoc","empty","validateUserOwnership","dayOfWeek","getDayName","timeOfDay","toDate","toLocaleTimeString","relativeTime","getRelativeTimeString","getCompletionDetail","_x1","_x10","_getCompletionStatistics","today","weekStart","monthStart","quarterStart","firstCompletion","getFirstCompletion","allTimeStart","_yield$Promise$all","Promise","all","_yield$Promise$all2","_slicedToArray2","quarterly","allTime","getCompletionStatistics","_x11","_x12","_this4","weekGroups","Map","forEach","getWeekStart","weekKey","has","get","push","Array","from","entries","_ref7","_ref8","weekCompletions","weekEnd","getWeekEnd","uniqueDates","c","completionCount","sort","a","b","localeCompare","monthGroups","monthKey","substring","_ref9","_ref0","month","monthCompletions","_month$split","split","_month$split2","year","monthNum","monthName","parseInt","toLocaleDateString","daysInMonth","getDate","dateString","date","getDay","daysToMonday","monday","setDate","sunday","dates","timestamp","diffMs","diffDays","floor","weeks","years","_getFirstCompletion","firstCompletionQuery","snapshot","firstDoc","_unused","_x13","_x14","completionService"],"sources":["completionService.ts"],"sourcesContent":["import {\n    doc,\n    getDocs,\n    orderBy,\n    query,\n    runTransaction,\n    serverTimestamp,\n    Timestamp,\n    where,\n} from \"firebase/firestore\";\nimport { db } from \"../../firebaseConfig\";\nimport { HabitCompletion } from \"../../types/habit-streaks\";\nimport {\n    formatDateToString,\n    getCurrentDateString,\n    getDayName,\n    getUserTimezone,\n    timestampToDateString,\n} from \"../../utils/dateUtils\";\nimport {\n    getUserFriendlyErrorMessage,\n    retryWithBackoff,\n} from \"../../utils/errorHandling\";\nimport { getHabitCompletionsCollection } from \"./collections\";\nimport {\n    transformFirestoreToCompletion,\n    validateUserOwnership,\n} from \"./habitStreakSchemas\";\n\n/**\n * Completion tracking interfaces and types\n */\nexport interface CompletionHistory {\n    completions: HabitCompletion[];\n    totalCount: number;\n    completionRate: number;\n    period: string;\n}\n\nexport interface CompletionRate {\n    period: string;\n    startDate: string;\n    endDate: string;\n    totalDays: number;\n    completedDays: number;\n    rate: number; // Percentage (0-100)\n}\n\nexport interface GroupedCompletions {\n    weekly: WeeklyGroup[];\n    monthly: MonthlyGroup[];\n}\n\nexport interface WeeklyGroup {\n    weekStart: string; // YYYY-MM-DD format (Monday)\n    weekEnd: string; // YYYY-MM-DD format (Sunday)\n    completions: HabitCompletion[];\n    completionCount: number;\n    completionRate: number; // Percentage for that week\n}\n\nexport interface MonthlyGroup {\n    month: string; // YYYY-MM format\n    monthName: string; // \"January 2024\"\n    completions: HabitCompletion[];\n    completionCount: number;\n    completionRate: number; // Percentage for that month\n}\n\nexport interface CompletionDetail {\n    completion: HabitCompletion;\n    dayOfWeek: string;\n    timeOfDay: string;\n    relativeTime: string; // \"2 days ago\", \"Today\", etc.\n}\n\n/**\n * CompletionService Implementation\n *\n * Handles habit completion tracking, history storage and retrieval,\n * completion rate calculations, and grouping logic for analytics.\n * Requirements: 5.1, 5.2, 5.3, 5.4, 5.5, 12.1\n */\nexport class CompletionService {\n    /**\n     * Record a new habit completion with timestamp validation\n     * Requirements: 5.1, 12.1\n     */\n    async recordCompletion(\n        completion: Omit<HabitCompletion, \"id\">,\n    ): Promise<HabitCompletion> {\n        if (!completion.habitId || !completion.userId) {\n            throw new Error(\"Habit ID and User ID are required\");\n        }\n\n        // Validate timezone-aware completion\n        const userTimezone = completion.timezone || getUserTimezone();\n        const completionDateString = timestampToDateString(\n            completion.completedAt,\n            userTimezone,\n        );\n        const currentDateString = getCurrentDateString(userTimezone);\n\n        // Ensure completion is for current day or earlier (prevent future completions)\n        if (completionDateString > currentDateString) {\n            throw new Error(\"Cannot record completions for future dates\");\n        }\n\n        try {\n            return await retryWithBackoff(async () => {\n                return await runTransaction(db, async (transaction) => {\n                    // Check for existing completion on the same date\n                    const completionsCollection = getHabitCompletionsCollection();\n                    const existingCompletionsQuery = query(\n                        completionsCollection,\n                        where(\"habitId\", \"==\", completion.habitId),\n                        where(\"userId\", \"==\", completion.userId),\n                    );\n                    const existingSnapshot = await getDocs(existingCompletionsQuery);\n\n                    const existingCompletions = existingSnapshot.docs\n                        .map((doc) => transformFirestoreToCompletion(doc.id, doc.data()))\n                        .filter((comp) => {\n                            const compDateString = timestampToDateString(\n                                comp.completedAt,\n                                userTimezone,\n                            );\n                            return compDateString === completionDateString;\n                        });\n\n                    if (existingCompletions.length > 0) {\n                        throw new Error(\"Habit already completed for this date\");\n                    }\n\n                    // Create completion record with metadata\n                    const completionData = {\n                        habitId: completion.habitId,\n                        userId: completion.userId,\n                        completedAt: completion.completedAt,\n                        timezone: userTimezone,\n                        notes: completion.notes || \"\",\n                        difficulty: completion.difficulty,\n                        createdAt: serverTimestamp(),\n                    };\n\n                    const completionRef = doc(completionsCollection);\n                    transaction.set(completionRef, completionData);\n\n                    const newCompletion: HabitCompletion = {\n                        id: completionRef.id,\n                        ...completion,\n                        timezone: userTimezone,\n                    };\n\n                    return newCompletion;\n                });\n            });\n        } catch (error) {\n            const message = getUserFriendlyErrorMessage(error);\n            throw new Error(`Failed to record completion: ${message}`);\n        }\n    }\n\n    /**\n     * Get completion history for a habit with pagination\n     * Requirements: 5.2, 5.4\n     */\n    async getCompletionHistory(\n        habitId: string,\n        userId: string,\n        limit: number = 50,\n        startAfter?: Timestamp,\n    ): Promise<CompletionHistory> {\n        if (!habitId || !userId) {\n            throw new Error(\"Habit ID and User ID are required\");\n        }\n\n        try {\n            return await retryWithBackoff(async () => {\n                const completionsCollection = getHabitCompletionsCollection();\n                let completionsQuery = query(\n                    completionsCollection,\n                    where(\"habitId\", \"==\", habitId),\n                    where(\"userId\", \"==\", userId),\n                    orderBy(\"completedAt\", \"desc\"),\n                );\n\n                // Add pagination if startAfter is provided\n                if (startAfter) {\n                    completionsQuery = query(\n                        completionsQuery,\n                        where(\"completedAt\", \"<\", startAfter),\n                    );\n                }\n\n                const completionsSnapshot = await getDocs(completionsQuery);\n                const completions = completionsSnapshot.docs\n                    .slice(0, limit)\n                    .map((doc) => transformFirestoreToCompletion(doc.id, doc.data()));\n\n                // Calculate completion rate for the period\n                const totalCount = completions.length;\n                const period = this.calculatePeriodFromCompletions(completions);\n                const completionRate = await this.calculateCompletionRate(\n                    habitId,\n                    userId,\n                    period.startDate,\n                    period.endDate,\n                );\n\n                return {\n                    completions,\n                    totalCount,\n                    completionRate: completionRate.rate,\n                    period: period.description,\n                };\n            });\n        } catch (error) {\n            const message = getUserFriendlyErrorMessage(error);\n            throw new Error(`Failed to get completion history: ${message}`);\n        }\n    }\n\n    /**\n     * Calculate completion rate for a specific time period\n     * Requirements: 5.3, 5.5\n     */\n    async calculateCompletionRate(\n        habitId: string,\n        userId: string,\n        startDate: string,\n        endDate: string,\n    ): Promise<CompletionRate> {\n        if (!habitId || !userId || !startDate || !endDate) {\n            throw new Error(\n                \"All parameters are required for completion rate calculation\",\n            );\n        }\n\n        try {\n            return await retryWithBackoff(async () => {\n                const completionsCollection = getHabitCompletionsCollection();\n                const completionsQuery = query(\n                    completionsCollection,\n                    where(\"habitId\", \"==\", habitId),\n                    where(\"userId\", \"==\", userId),\n                );\n\n                const completionsSnapshot = await getDocs(completionsQuery);\n                const allCompletions = completionsSnapshot.docs.map((doc) =>\n                    transformFirestoreToCompletion(doc.id, doc.data()),\n                );\n\n                // Filter completions within the date range\n                const timezone = getUserTimezone();\n                const completionsInRange = allCompletions.filter((completion) => {\n                    const completionDate = timestampToDateString(\n                        completion.completedAt,\n                        timezone,\n                    );\n                    return completionDate >= startDate && completionDate <= endDate;\n                });\n\n                // Calculate total days in the period\n                const start = new Date(startDate);\n                const end = new Date(endDate);\n                const totalDays =\n                    Math.ceil((end.getTime() - start.getTime()) / (1000 * 60 * 60 * 24)) +\n                    1;\n\n                // Get unique completion dates\n                const uniqueCompletionDates = new Set(\n                    completionsInRange.map((completion) =>\n                        timestampToDateString(completion.completedAt, timezone),\n                    ),\n                );\n\n                const completedDays = uniqueCompletionDates.size;\n                const rate = totalDays > 0 ? (completedDays / totalDays) * 100 : 0;\n\n                return {\n                    period: `${startDate} to ${endDate}`,\n                    startDate,\n                    endDate,\n                    totalDays,\n                    completedDays,\n                    rate: Math.round(rate * 100) / 100, // Round to 2 decimal places\n                };\n            });\n        } catch (error) {\n            const message = getUserFriendlyErrorMessage(error);\n            throw new Error(`Failed to calculate completion rate: ${message}`);\n        }\n    }\n\n    /**\n     * Get completions grouped by weekly and monthly periods\n     * Requirements: 5.2\n     */\n    async getGroupedCompletions(\n        habitId: string,\n        userId: string,\n        months: number = 6,\n    ): Promise<GroupedCompletions> {\n        if (!habitId || !userId) {\n            throw new Error(\"Habit ID and User ID are required\");\n        }\n\n        try {\n            return await retryWithBackoff(async () => {\n                const timezone = getUserTimezone();\n                const endDate = getCurrentDateString(timezone);\n                const startDate = formatDateToString(\n                    new Date(Date.now() - months * 30 * 24 * 60 * 60 * 1000),\n                    timezone,\n                );\n\n                // Get all completions in the period\n                const completionsCollection = getHabitCompletionsCollection();\n                const completionsQuery = query(\n                    completionsCollection,\n                    where(\"habitId\", \"==\", habitId),\n                    where(\"userId\", \"==\", userId),\n                    orderBy(\"completedAt\", \"desc\"),\n                );\n\n                const completionsSnapshot = await getDocs(completionsQuery);\n                const allCompletions = completionsSnapshot.docs\n                    .map((doc) => transformFirestoreToCompletion(doc.id, doc.data()))\n                    .filter((completion) => {\n                        const completionDate = timestampToDateString(\n                            completion.completedAt,\n                            timezone,\n                        );\n                        return completionDate >= startDate && completionDate <= endDate;\n                    });\n\n                // Group by weeks and months\n                const weeklyGroups = this.groupCompletionsByWeek(\n                    allCompletions,\n                    timezone,\n                );\n                const monthlyGroups = this.groupCompletionsByMonth(\n                    allCompletions,\n                    timezone,\n                );\n\n                return {\n                    weekly: weeklyGroups,\n                    monthly: monthlyGroups,\n                };\n            });\n        } catch (error) {\n            const message = getUserFriendlyErrorMessage(error);\n            throw new Error(`Failed to get grouped completions: ${message}`);\n        }\n    }\n\n    /**\n     * Get detailed information about a specific completion\n     * Requirements: 5.4\n     */\n    async getCompletionDetail(\n        completionId: string,\n        userId: string,\n    ): Promise<CompletionDetail> {\n        if (!completionId || !userId) {\n            throw new Error(\"Completion ID and User ID are required\");\n        }\n\n        try {\n            return await retryWithBackoff(async () => {\n                const completionsCollection = getHabitCompletionsCollection();\n                const completionDoc = await getDocs(\n                    query(completionsCollection, where(\"__name__\", \"==\", completionId)),\n                );\n\n                if (completionDoc.empty) {\n                    throw new Error(\"Completion not found\");\n                }\n\n                const completionData = completionDoc.docs[0].data();\n                const completion = transformFirestoreToCompletion(\n                    completionDoc.docs[0].id,\n                    completionData,\n                );\n\n                // Validate user ownership\n                if (!validateUserOwnership(userId, completion.userId)) {\n                    throw new Error(\"Unauthorized access to completion data\");\n                }\n\n                const timezone = completion.timezone || getUserTimezone();\n                const completionDate = timestampToDateString(\n                    completion.completedAt,\n                    timezone,\n                );\n\n                return {\n                    completion,\n                    dayOfWeek: getDayName(completionDate),\n                    timeOfDay: completion.completedAt.toDate().toLocaleTimeString(),\n                    relativeTime: this.getRelativeTimeString(completion.completedAt),\n                };\n            });\n        } catch (error) {\n            const message = getUserFriendlyErrorMessage(error);\n            throw new Error(`Failed to get completion detail: ${message}`);\n        }\n    }\n\n    /**\n     * Get completion statistics for multiple time periods\n     * Requirements: 5.3, 5.5\n     */\n    async getCompletionStatistics(\n        habitId: string,\n        userId: string,\n    ): Promise<{\n        weekly: CompletionRate;\n        monthly: CompletionRate;\n        quarterly: CompletionRate;\n        allTime: CompletionRate;\n    }> {\n        if (!habitId || !userId) {\n            throw new Error(\"Habit ID and User ID are required\");\n        }\n\n        try {\n            const timezone = getUserTimezone();\n            const today = getCurrentDateString(timezone);\n\n            // Calculate different time periods\n            const weekStart = formatDateToString(\n                new Date(Date.now() - 7 * 24 * 60 * 60 * 1000),\n                timezone,\n            );\n            const monthStart = formatDateToString(\n                new Date(Date.now() - 30 * 24 * 60 * 60 * 1000),\n                timezone,\n            );\n            const quarterStart = formatDateToString(\n                new Date(Date.now() - 90 * 24 * 60 * 60 * 1000),\n                timezone,\n            );\n\n            // Get the first completion date for all-time calculation\n            const firstCompletion = await this.getFirstCompletion(habitId, userId);\n            const allTimeStart = firstCompletion\n                ? timestampToDateString(firstCompletion.completedAt, timezone)\n                : today;\n\n            // Calculate rates for all periods\n            const [weekly, monthly, quarterly, allTime] = await Promise.all([\n                this.calculateCompletionRate(habitId, userId, weekStart, today),\n                this.calculateCompletionRate(habitId, userId, monthStart, today),\n                this.calculateCompletionRate(habitId, userId, quarterStart, today),\n                this.calculateCompletionRate(habitId, userId, allTimeStart, today),\n            ]);\n\n            return {\n                weekly,\n                monthly,\n                quarterly,\n                allTime,\n            };\n        } catch (error) {\n            const message = getUserFriendlyErrorMessage(error);\n            throw new Error(`Failed to get completion statistics: ${message}`);\n        }\n    }\n\n    // Private helper methods\n\n    /**\n     * Group completions by week (Monday to Sunday)\n     */\n    private groupCompletionsByWeek(\n        completions: HabitCompletion[],\n        timezone: string,\n    ): WeeklyGroup[] {\n        const weekGroups = new Map<string, HabitCompletion[]>();\n\n        completions.forEach((completion) => {\n            const completionDate = timestampToDateString(\n                completion.completedAt,\n                timezone,\n            );\n            const weekStart = this.getWeekStart(completionDate);\n            const weekKey = weekStart;\n\n            if (!weekGroups.has(weekKey)) {\n                weekGroups.set(weekKey, []);\n            }\n            weekGroups.get(weekKey)!.push(completion);\n        });\n\n        return Array.from(weekGroups.entries())\n            .map(([weekStart, weekCompletions]) => {\n                const weekEnd = this.getWeekEnd(weekStart);\n                const uniqueDates = new Set(\n                    weekCompletions.map((c) =>\n                        timestampToDateString(c.completedAt, timezone),\n                    ),\n                );\n\n                return {\n                    weekStart,\n                    weekEnd,\n                    completions: weekCompletions,\n                    completionCount: weekCompletions.length,\n                    completionRate: (uniqueDates.size / 7) * 100, // 7 days in a week\n                };\n            })\n            .sort((a, b) => b.weekStart.localeCompare(a.weekStart));\n    }\n\n    /**\n     * Group completions by month\n     */\n    private groupCompletionsByMonth(\n        completions: HabitCompletion[],\n        timezone: string,\n    ): MonthlyGroup[] {\n        const monthGroups = new Map<string, HabitCompletion[]>();\n\n        completions.forEach((completion) => {\n            const completionDate = timestampToDateString(\n                completion.completedAt,\n                timezone,\n            );\n            const monthKey = completionDate.substring(0, 7); // YYYY-MM\n\n            if (!monthGroups.has(monthKey)) {\n                monthGroups.set(monthKey, []);\n            }\n            monthGroups.get(monthKey)!.push(completion);\n        });\n\n        return Array.from(monthGroups.entries())\n            .map(([month, monthCompletions]) => {\n                const [year, monthNum] = month.split(\"-\");\n                const monthName = new Date(\n                    parseInt(year),\n                    parseInt(monthNum) - 1,\n                    1,\n                ).toLocaleDateString(\"en-US\", { month: \"long\", year: \"numeric\" });\n\n                const daysInMonth = new Date(\n                    parseInt(year),\n                    parseInt(monthNum),\n                    0,\n                ).getDate();\n                const uniqueDates = new Set(\n                    monthCompletions.map((c) =>\n                        timestampToDateString(c.completedAt, timezone),\n                    ),\n                );\n\n                return {\n                    month,\n                    monthName,\n                    completions: monthCompletions,\n                    completionCount: monthCompletions.length,\n                    completionRate: (uniqueDates.size / daysInMonth) * 100,\n                };\n            })\n            .sort((a, b) => b.month.localeCompare(a.month));\n    }\n\n    /**\n     * Get the Monday of the week for a given date\n     */\n    private getWeekStart(dateString: string): string {\n        const date = new Date(dateString);\n        const dayOfWeek = date.getDay();\n        const daysToMonday = dayOfWeek === 0 ? 6 : dayOfWeek - 1; // Sunday = 0, Monday = 1\n\n        const monday = new Date(date);\n        monday.setDate(date.getDate() - daysToMonday);\n\n        return formatDateToString(monday);\n    }\n\n    /**\n     * Get the Sunday of the week for a given Monday\n     */\n    private getWeekEnd(weekStart: string): string {\n        const monday = new Date(weekStart);\n        const sunday = new Date(monday);\n        sunday.setDate(monday.getDate() + 6);\n\n        return formatDateToString(sunday);\n    }\n\n    /**\n     * Calculate period description from completions\n     */\n    private calculatePeriodFromCompletions(completions: HabitCompletion[]): {\n        startDate: string;\n        endDate: string;\n        description: string;\n    } {\n        if (completions.length === 0) {\n            const today = getCurrentDateString();\n            return {\n                startDate: today,\n                endDate: today,\n                description: \"No completions\",\n            };\n        }\n\n        const timezone = getUserTimezone();\n        const dates = completions\n            .map((c) => timestampToDateString(c.completedAt, timezone))\n            .sort();\n\n        const startDate = dates[0];\n        const endDate = dates[dates.length - 1];\n\n        return {\n            startDate,\n            endDate,\n            description: `${startDate} to ${endDate}`,\n        };\n    }\n\n    /**\n     * Get relative time string for a timestamp\n     */\n    private getRelativeTimeString(timestamp: Timestamp): string {\n        const now = new Date();\n        const completionDate = timestamp.toDate();\n        const diffMs = now.getTime() - completionDate.getTime();\n        const diffDays = Math.floor(diffMs / (1000 * 60 * 60 * 24));\n\n        if (diffDays === 0) {\n            return \"Today\";\n        } else if (diffDays === 1) {\n            return \"Yesterday\";\n        } else if (diffDays < 7) {\n            return `${diffDays} days ago`;\n        } else if (diffDays < 30) {\n            const weeks = Math.floor(diffDays / 7);\n            return weeks === 1 ? \"1 week ago\" : `${weeks} weeks ago`;\n        } else if (diffDays < 365) {\n            const months = Math.floor(diffDays / 30);\n            return months === 1 ? \"1 month ago\" : `${months} months ago`;\n        } else {\n            const years = Math.floor(diffDays / 365);\n            return years === 1 ? \"1 year ago\" : `${years} years ago`;\n        }\n    }\n\n    /**\n     * Get the first completion for a habit\n     */\n    private async getFirstCompletion(\n        habitId: string,\n        userId: string,\n    ): Promise<HabitCompletion | null> {\n        try {\n            const completionsCollection = getHabitCompletionsCollection();\n            const firstCompletionQuery = query(\n                completionsCollection,\n                where(\"habitId\", \"==\", habitId),\n                where(\"userId\", \"==\", userId),\n                orderBy(\"completedAt\", \"asc\"),\n            );\n\n            const snapshot = await getDocs(firstCompletionQuery);\n            if (snapshot.empty) {\n                return null;\n            }\n\n            const firstDoc = snapshot.docs[0];\n            return transformFirestoreToCompletion(firstDoc.id, firstDoc.data());\n        } catch {\n            return null; // Return null if there's an error getting first completion\n        }\n    }\n}\n\n// Export singleton instance\nexport const completionService = new CompletionService();\n"],"mappings":";;;;;;;;;AAAA,IAAAA,UAAA,GAAAC,OAAA;AAUA,IAAAC,eAAA,GAAAD,OAAA;AAEA,IAAAE,UAAA,GAAAF,OAAA;AAOA,IAAAG,cAAA,GAAAH,OAAA;AAIA,IAAAI,YAAA,GAAAJ,OAAA;AACA,IAAAK,mBAAA,GAAAL,OAAA;AAG8B,IAwDjBM,iBAAiB,GAAAC,OAAA,CAAAD,iBAAA;EAAA,SAAAA,kBAAA;IAAA,IAAAE,gBAAA,CAAAC,OAAA,QAAAH,iBAAA;EAAA;EAAA,WAAAI,aAAA,CAAAD,OAAA,EAAAH,iBAAA;IAAAK,GAAA;IAAAC,KAAA;MAAA,IAAAC,iBAAA,OAAAC,kBAAA,CAAAL,OAAA,EAK1B,WACIM,UAAuC,EACf;QACxB,IAAI,CAACA,UAAU,CAACC,OAAO,IAAI,CAACD,UAAU,CAACE,MAAM,EAAE;UAC3C,MAAM,IAAIC,KAAK,CAAC,mCAAmC,CAAC;QACxD;QAGA,IAAMC,YAAY,GAAGJ,UAAU,CAACK,QAAQ,IAAI,IAAAC,0BAAe,EAAC,CAAC;QAC7D,IAAMC,oBAAoB,GAAG,IAAAC,gCAAqB,EAC9CR,UAAU,CAACS,WAAW,EACtBL,YACJ,CAAC;QACD,IAAMM,iBAAiB,GAAG,IAAAC,+BAAoB,EAACP,YAAY,CAAC;QAG5D,IAAIG,oBAAoB,GAAGG,iBAAiB,EAAE;UAC1C,MAAM,IAAIP,KAAK,CAAC,4CAA4C,CAAC;QACjE;QAEA,IAAI;UACA,aAAa,IAAAS,+BAAgB,MAAAb,kBAAA,CAAAL,OAAA,EAAC,aAAY;YACtC,aAAa,IAAAmB,yBAAc,EAACC,kBAAE;cAAA,IAAAC,KAAA,OAAAhB,kBAAA,CAAAL,OAAA,EAAE,WAAOsB,WAAW,EAAK;gBAEnD,IAAMC,qBAAqB,GAAG,IAAAC,0CAA6B,EAAC,CAAC;gBAC7D,IAAMC,wBAAwB,GAAG,IAAAC,gBAAK,EAClCH,qBAAqB,EACrB,IAAAI,gBAAK,EAAC,SAAS,EAAE,IAAI,EAAErB,UAAU,CAACC,OAAO,CAAC,EAC1C,IAAAoB,gBAAK,EAAC,QAAQ,EAAE,IAAI,EAAErB,UAAU,CAACE,MAAM,CAC3C,CAAC;gBACD,IAAMoB,gBAAgB,SAAS,IAAAC,kBAAO,EAACJ,wBAAwB,CAAC;gBAEhE,IAAMK,mBAAmB,GAAGF,gBAAgB,CAACG,IAAI,CAC5CC,GAAG,CAAC,UAACC,GAAG;kBAAA,OAAK,IAAAC,kDAA8B,EAACD,GAAG,CAACE,EAAE,EAAEF,GAAG,CAACG,IAAI,CAAC,CAAC,CAAC;gBAAA,EAAC,CAChEC,MAAM,CAAC,UAACC,IAAI,EAAK;kBACd,IAAMC,cAAc,GAAG,IAAAzB,gCAAqB,EACxCwB,IAAI,CAACvB,WAAW,EAChBL,YACJ,CAAC;kBACD,OAAO6B,cAAc,KAAK1B,oBAAoB;gBAClD,CAAC,CAAC;gBAEN,IAAIiB,mBAAmB,CAACU,MAAM,GAAG,CAAC,EAAE;kBAChC,MAAM,IAAI/B,KAAK,CAAC,uCAAuC,CAAC;gBAC5D;gBAGA,IAAMgC,cAAc,GAAG;kBACnBlC,OAAO,EAAED,UAAU,CAACC,OAAO;kBAC3BC,MAAM,EAAEF,UAAU,CAACE,MAAM;kBACzBO,WAAW,EAAET,UAAU,CAACS,WAAW;kBACnCJ,QAAQ,EAAED,YAAY;kBACtBgC,KAAK,EAAEpC,UAAU,CAACoC,KAAK,IAAI,EAAE;kBAC7BC,UAAU,EAAErC,UAAU,CAACqC,UAAU;kBACjCC,SAAS,EAAE,IAAAC,0BAAe,EAAC;gBAC/B,CAAC;gBAED,IAAMC,aAAa,GAAG,IAAAb,cAAG,EAACV,qBAAqB,CAAC;gBAChDD,WAAW,CAACyB,GAAG,CAACD,aAAa,EAAEL,cAAc,CAAC;gBAE9C,IAAMO,aAA8B,GAAAC,MAAA,CAAAC,MAAA;kBAChCf,EAAE,EAAEW,aAAa,CAACX;gBAAE,GACjB7B,UAAU;kBACbK,QAAQ,EAAED;gBAAY,EACzB;gBAED,OAAOsC,aAAa;cACxB,CAAC;cAAA,iBAAAG,GAAA;gBAAA,OAAA9B,KAAA,CAAA+B,KAAA,OAAAC,SAAA;cAAA;YAAA,IAAC;UACN,CAAC,EAAC;QACN,CAAC,CAAC,OAAOC,KAAK,EAAE;UACZ,IAAMC,OAAO,GAAG,IAAAC,0CAA2B,EAACF,KAAK,CAAC;UAClD,MAAM,IAAI7C,KAAK,CAAC,gCAAgC8C,OAAO,EAAE,CAAC;QAC9D;MACJ,CAAC;MAAA,SAzEKE,gBAAgBA,CAAAC,EAAA;QAAA,OAAAtD,iBAAA,CAAAgD,KAAA,OAAAC,SAAA;MAAA;MAAA,OAAhBI,gBAAgB;IAAA;EAAA;IAAAvD,GAAA;IAAAC,KAAA;MAAA,IAAAwD,qBAAA,OAAAtD,kBAAA,CAAAL,OAAA,EA+EtB,WACIO,OAAe,EACfC,MAAc,EAGY;QAAA,IAAAoD,KAAA;QAAA,IAF1BC,KAAa,GAAAR,SAAA,CAAAb,MAAA,QAAAa,SAAA,QAAAS,SAAA,GAAAT,SAAA,MAAG,EAAE;QAAA,IAClBU,UAAsB,GAAAV,SAAA,CAAAb,MAAA,OAAAa,SAAA,MAAAS,SAAA;QAEtB,IAAI,CAACvD,OAAO,IAAI,CAACC,MAAM,EAAE;UACrB,MAAM,IAAIC,KAAK,CAAC,mCAAmC,CAAC;QACxD;QAEA,IAAI;UACA,aAAa,IAAAS,+BAAgB,MAAAb,kBAAA,CAAAL,OAAA,EAAC,aAAY;YACtC,IAAMuB,qBAAqB,GAAG,IAAAC,0CAA6B,EAAC,CAAC;YAC7D,IAAIwC,gBAAgB,GAAG,IAAAtC,gBAAK,EACxBH,qBAAqB,EACrB,IAAAI,gBAAK,EAAC,SAAS,EAAE,IAAI,EAAEpB,OAAO,CAAC,EAC/B,IAAAoB,gBAAK,EAAC,QAAQ,EAAE,IAAI,EAAEnB,MAAM,CAAC,EAC7B,IAAAyD,kBAAO,EAAC,aAAa,EAAE,MAAM,CACjC,CAAC;YAGD,IAAIF,UAAU,EAAE;cACZC,gBAAgB,GAAG,IAAAtC,gBAAK,EACpBsC,gBAAgB,EAChB,IAAArC,gBAAK,EAAC,aAAa,EAAE,GAAG,EAAEoC,UAAU,CACxC,CAAC;YACL;YAEA,IAAMG,mBAAmB,SAAS,IAAArC,kBAAO,EAACmC,gBAAgB,CAAC;YAC3D,IAAMG,WAAW,GAAGD,mBAAmB,CAACnC,IAAI,CACvCqC,KAAK,CAAC,CAAC,EAAEP,KAAK,CAAC,CACf7B,GAAG,CAAC,UAACC,GAAG;cAAA,OAAK,IAAAC,kDAA8B,EAACD,GAAG,CAACE,EAAE,EAAEF,GAAG,CAACG,IAAI,CAAC,CAAC,CAAC;YAAA,EAAC;YAGrE,IAAMiC,UAAU,GAAGF,WAAW,CAAC3B,MAAM;YACrC,IAAM8B,MAAM,GAAGV,KAAI,CAACW,8BAA8B,CAACJ,WAAW,CAAC;YAC/D,IAAMK,cAAc,SAASZ,KAAI,CAACa,uBAAuB,CACrDlE,OAAO,EACPC,MAAM,EACN8D,MAAM,CAACI,SAAS,EAChBJ,MAAM,CAACK,OACX,CAAC;YAED,OAAO;cACHR,WAAW,EAAXA,WAAW;cACXE,UAAU,EAAVA,UAAU;cACVG,cAAc,EAAEA,cAAc,CAACI,IAAI;cACnCN,MAAM,EAAEA,MAAM,CAACO;YACnB,CAAC;UACL,CAAC,EAAC;QACN,CAAC,CAAC,OAAOvB,KAAK,EAAE;UACZ,IAAMC,OAAO,GAAG,IAAAC,0CAA2B,EAACF,KAAK,CAAC;UAClD,MAAM,IAAI7C,KAAK,CAAC,qCAAqC8C,OAAO,EAAE,CAAC;QACnE;MACJ,CAAC;MAAA,SAtDKuB,oBAAoBA,CAAAC,GAAA,EAAAC,GAAA;QAAA,OAAArB,qBAAA,CAAAP,KAAA,OAAAC,SAAA;MAAA;MAAA,OAApByB,oBAAoB;IAAA;EAAA;IAAA5E,GAAA;IAAAC,KAAA;MAAA,IAAA8E,wBAAA,OAAA5E,kBAAA,CAAAL,OAAA,EA4D1B,WACIO,OAAe,EACfC,MAAc,EACdkE,SAAiB,EACjBC,OAAe,EACQ;QACvB,IAAI,CAACpE,OAAO,IAAI,CAACC,MAAM,IAAI,CAACkE,SAAS,IAAI,CAACC,OAAO,EAAE;UAC/C,MAAM,IAAIlE,KAAK,CACX,6DACJ,CAAC;QACL;QAEA,IAAI;UACA,aAAa,IAAAS,+BAAgB,MAAAb,kBAAA,CAAAL,OAAA,EAAC,aAAY;YACtC,IAAMuB,qBAAqB,GAAG,IAAAC,0CAA6B,EAAC,CAAC;YAC7D,IAAMwC,gBAAgB,GAAG,IAAAtC,gBAAK,EAC1BH,qBAAqB,EACrB,IAAAI,gBAAK,EAAC,SAAS,EAAE,IAAI,EAAEpB,OAAO,CAAC,EAC/B,IAAAoB,gBAAK,EAAC,QAAQ,EAAE,IAAI,EAAEnB,MAAM,CAChC,CAAC;YAED,IAAM0D,mBAAmB,SAAS,IAAArC,kBAAO,EAACmC,gBAAgB,CAAC;YAC3D,IAAMkB,cAAc,GAAGhB,mBAAmB,CAACnC,IAAI,CAACC,GAAG,CAAC,UAACC,GAAG;cAAA,OACpD,IAAAC,kDAA8B,EAACD,GAAG,CAACE,EAAE,EAAEF,GAAG,CAACG,IAAI,CAAC,CAAC,CAAC;YAAA,CACtD,CAAC;YAGD,IAAMzB,QAAQ,GAAG,IAAAC,0BAAe,EAAC,CAAC;YAClC,IAAMuE,kBAAkB,GAAGD,cAAc,CAAC7C,MAAM,CAAC,UAAC/B,UAAU,EAAK;cAC7D,IAAM8E,cAAc,GAAG,IAAAtE,gCAAqB,EACxCR,UAAU,CAACS,WAAW,EACtBJ,QACJ,CAAC;cACD,OAAOyE,cAAc,IAAIV,SAAS,IAAIU,cAAc,IAAIT,OAAO;YACnE,CAAC,CAAC;YAGF,IAAMU,KAAK,GAAG,IAAIC,IAAI,CAACZ,SAAS,CAAC;YACjC,IAAMa,GAAG,GAAG,IAAID,IAAI,CAACX,OAAO,CAAC;YAC7B,IAAMa,SAAS,GACXC,IAAI,CAACC,IAAI,CAAC,CAACH,GAAG,CAACI,OAAO,CAAC,CAAC,GAAGN,KAAK,CAACM,OAAO,CAAC,CAAC,KAAK,IAAI,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,CAAC,CAAC,GACpE,CAAC;YAGL,IAAMC,qBAAqB,GAAG,IAAIC,GAAG,CACjCV,kBAAkB,CAACnD,GAAG,CAAC,UAAC1B,UAAU;cAAA,OAC9B,IAAAQ,gCAAqB,EAACR,UAAU,CAACS,WAAW,EAAEJ,QAAQ,CAAC;YAAA,CAC3D,CACJ,CAAC;YAED,IAAMmF,aAAa,GAAGF,qBAAqB,CAACG,IAAI;YAChD,IAAMnB,IAAI,GAAGY,SAAS,GAAG,CAAC,GAAIM,aAAa,GAAGN,SAAS,GAAI,GAAG,GAAG,CAAC;YAElE,OAAO;cACHlB,MAAM,EAAE,GAAGI,SAAS,OAAOC,OAAO,EAAE;cACpCD,SAAS,EAATA,SAAS;cACTC,OAAO,EAAPA,OAAO;cACPa,SAAS,EAATA,SAAS;cACTM,aAAa,EAAbA,aAAa;cACblB,IAAI,EAAEa,IAAI,CAACO,KAAK,CAACpB,IAAI,GAAG,GAAG,CAAC,GAAG;YACnC,CAAC;UACL,CAAC,EAAC;QACN,CAAC,CAAC,OAAOtB,KAAK,EAAE;UACZ,IAAMC,OAAO,GAAG,IAAAC,0CAA2B,EAACF,KAAK,CAAC;UAClD,MAAM,IAAI7C,KAAK,CAAC,wCAAwC8C,OAAO,EAAE,CAAC;QACtE;MACJ,CAAC;MAAA,SAlEKkB,uBAAuBA,CAAAwB,GAAA,EAAAC,GAAA,EAAAC,GAAA,EAAAC,GAAA;QAAA,OAAAnB,wBAAA,CAAA7B,KAAA,OAAAC,SAAA;MAAA;MAAA,OAAvBoB,uBAAuB;IAAA;EAAA;IAAAvE,GAAA;IAAAC,KAAA;MAAA,IAAAkG,sBAAA,OAAAhG,kBAAA,CAAAL,OAAA,EAwE7B,WACIO,OAAe,EACfC,MAAc,EAEa;QAAA,IAAA8F,MAAA;QAAA,IAD3BC,MAAc,GAAAlD,SAAA,CAAAb,MAAA,QAAAa,SAAA,QAAAS,SAAA,GAAAT,SAAA,MAAG,CAAC;QAElB,IAAI,CAAC9C,OAAO,IAAI,CAACC,MAAM,EAAE;UACrB,MAAM,IAAIC,KAAK,CAAC,mCAAmC,CAAC;QACxD;QAEA,IAAI;UACA,aAAa,IAAAS,+BAAgB,MAAAb,kBAAA,CAAAL,OAAA,EAAC,aAAY;YACtC,IAAMW,QAAQ,GAAG,IAAAC,0BAAe,EAAC,CAAC;YAClC,IAAM+D,OAAO,GAAG,IAAA1D,+BAAoB,EAACN,QAAQ,CAAC;YAC9C,IAAM+D,SAAS,GAAG,IAAA8B,6BAAkB,EAChC,IAAIlB,IAAI,CAACA,IAAI,CAACmB,GAAG,CAAC,CAAC,GAAGF,MAAM,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,IAAI,CAAC,EACxD5F,QACJ,CAAC;YAGD,IAAMY,qBAAqB,GAAG,IAAAC,0CAA6B,EAAC,CAAC;YAC7D,IAAMwC,gBAAgB,GAAG,IAAAtC,gBAAK,EAC1BH,qBAAqB,EACrB,IAAAI,gBAAK,EAAC,SAAS,EAAE,IAAI,EAAEpB,OAAO,CAAC,EAC/B,IAAAoB,gBAAK,EAAC,QAAQ,EAAE,IAAI,EAAEnB,MAAM,CAAC,EAC7B,IAAAyD,kBAAO,EAAC,aAAa,EAAE,MAAM,CACjC,CAAC;YAED,IAAMC,mBAAmB,SAAS,IAAArC,kBAAO,EAACmC,gBAAgB,CAAC;YAC3D,IAAMkB,cAAc,GAAGhB,mBAAmB,CAACnC,IAAI,CAC1CC,GAAG,CAAC,UAACC,GAAG;cAAA,OAAK,IAAAC,kDAA8B,EAACD,GAAG,CAACE,EAAE,EAAEF,GAAG,CAACG,IAAI,CAAC,CAAC,CAAC;YAAA,EAAC,CAChEC,MAAM,CAAC,UAAC/B,UAAU,EAAK;cACpB,IAAM8E,cAAc,GAAG,IAAAtE,gCAAqB,EACxCR,UAAU,CAACS,WAAW,EACtBJ,QACJ,CAAC;cACD,OAAOyE,cAAc,IAAIV,SAAS,IAAIU,cAAc,IAAIT,OAAO;YACnE,CAAC,CAAC;YAGN,IAAM+B,YAAY,GAAGJ,MAAI,CAACK,sBAAsB,CAC5CzB,cAAc,EACdvE,QACJ,CAAC;YACD,IAAMiG,aAAa,GAAGN,MAAI,CAACO,uBAAuB,CAC9C3B,cAAc,EACdvE,QACJ,CAAC;YAED,OAAO;cACHmG,MAAM,EAAEJ,YAAY;cACpBK,OAAO,EAAEH;YACb,CAAC;UACL,CAAC,EAAC;QACN,CAAC,CAAC,OAAOtD,KAAK,EAAE;UACZ,IAAMC,OAAO,GAAG,IAAAC,0CAA2B,EAACF,KAAK,CAAC;UAClD,MAAM,IAAI7C,KAAK,CAAC,sCAAsC8C,OAAO,EAAE,CAAC;QACpE;MACJ,CAAC;MAAA,SAzDKyD,qBAAqBA,CAAAC,GAAA,EAAAC,GAAA;QAAA,OAAAb,sBAAA,CAAAjD,KAAA,OAAAC,SAAA;MAAA;MAAA,OAArB2D,qBAAqB;IAAA;EAAA;IAAA9G,GAAA;IAAAC,KAAA;MAAA,IAAAgH,oBAAA,OAAA9G,kBAAA,CAAAL,OAAA,EA+D3B,WACIoH,YAAoB,EACpB5G,MAAc,EACW;QAAA,IAAA6G,MAAA;QACzB,IAAI,CAACD,YAAY,IAAI,CAAC5G,MAAM,EAAE;UAC1B,MAAM,IAAIC,KAAK,CAAC,wCAAwC,CAAC;QAC7D;QAEA,IAAI;UACA,aAAa,IAAAS,+BAAgB,MAAAb,kBAAA,CAAAL,OAAA,EAAC,aAAY;YACtC,IAAMuB,qBAAqB,GAAG,IAAAC,0CAA6B,EAAC,CAAC;YAC7D,IAAM8F,aAAa,SAAS,IAAAzF,kBAAO,EAC/B,IAAAH,gBAAK,EAACH,qBAAqB,EAAE,IAAAI,gBAAK,EAAC,UAAU,EAAE,IAAI,EAAEyF,YAAY,CAAC,CACtE,CAAC;YAED,IAAIE,aAAa,CAACC,KAAK,EAAE;cACrB,MAAM,IAAI9G,KAAK,CAAC,sBAAsB,CAAC;YAC3C;YAEA,IAAMgC,cAAc,GAAG6E,aAAa,CAACvF,IAAI,CAAC,CAAC,CAAC,CAACK,IAAI,CAAC,CAAC;YACnD,IAAM9B,UAAU,GAAG,IAAA4B,kDAA8B,EAC7CoF,aAAa,CAACvF,IAAI,CAAC,CAAC,CAAC,CAACI,EAAE,EACxBM,cACJ,CAAC;YAGD,IAAI,CAAC,IAAA+E,yCAAqB,EAAChH,MAAM,EAAEF,UAAU,CAACE,MAAM,CAAC,EAAE;cACnD,MAAM,IAAIC,KAAK,CAAC,wCAAwC,CAAC;YAC7D;YAEA,IAAME,QAAQ,GAAGL,UAAU,CAACK,QAAQ,IAAI,IAAAC,0BAAe,EAAC,CAAC;YACzD,IAAMwE,cAAc,GAAG,IAAAtE,gCAAqB,EACxCR,UAAU,CAACS,WAAW,EACtBJ,QACJ,CAAC;YAED,OAAO;cACHL,UAAU,EAAVA,UAAU;cACVmH,SAAS,EAAE,IAAAC,qBAAU,EAACtC,cAAc,CAAC;cACrCuC,SAAS,EAAErH,UAAU,CAACS,WAAW,CAAC6G,MAAM,CAAC,CAAC,CAACC,kBAAkB,CAAC,CAAC;cAC/DC,YAAY,EAAET,MAAI,CAACU,qBAAqB,CAACzH,UAAU,CAACS,WAAW;YACnE,CAAC;UACL,CAAC,EAAC;QACN,CAAC,CAAC,OAAOuC,KAAK,EAAE;UACZ,IAAMC,OAAO,GAAG,IAAAC,0CAA2B,EAACF,KAAK,CAAC;UAClD,MAAM,IAAI7C,KAAK,CAAC,oCAAoC8C,OAAO,EAAE,CAAC;QAClE;MACJ,CAAC;MAAA,SA/CKyE,mBAAmBA,CAAAC,GAAA,EAAAC,IAAA;QAAA,OAAAf,oBAAA,CAAA/D,KAAA,OAAAC,SAAA;MAAA;MAAA,OAAnB2E,mBAAmB;IAAA;EAAA;IAAA9H,GAAA;IAAAC,KAAA;MAAA,IAAAgI,wBAAA,OAAA9H,kBAAA,CAAAL,OAAA,EAqDzB,WACIO,OAAe,EACfC,MAAc,EAMf;QACC,IAAI,CAACD,OAAO,IAAI,CAACC,MAAM,EAAE;UACrB,MAAM,IAAIC,KAAK,CAAC,mCAAmC,CAAC;QACxD;QAEA,IAAI;UACA,IAAME,QAAQ,GAAG,IAAAC,0BAAe,EAAC,CAAC;UAClC,IAAMwH,KAAK,GAAG,IAAAnH,+BAAoB,EAACN,QAAQ,CAAC;UAG5C,IAAM0H,SAAS,GAAG,IAAA7B,6BAAkB,EAChC,IAAIlB,IAAI,CAACA,IAAI,CAACmB,GAAG,CAAC,CAAC,GAAG,CAAC,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,IAAI,CAAC,EAC9C9F,QACJ,CAAC;UACD,IAAM2H,UAAU,GAAG,IAAA9B,6BAAkB,EACjC,IAAIlB,IAAI,CAACA,IAAI,CAACmB,GAAG,CAAC,CAAC,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,IAAI,CAAC,EAC/C9F,QACJ,CAAC;UACD,IAAM4H,YAAY,GAAG,IAAA/B,6BAAkB,EACnC,IAAIlB,IAAI,CAACA,IAAI,CAACmB,GAAG,CAAC,CAAC,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,IAAI,CAAC,EAC/C9F,QACJ,CAAC;UAGD,IAAM6H,eAAe,SAAS,IAAI,CAACC,kBAAkB,CAAClI,OAAO,EAAEC,MAAM,CAAC;UACtE,IAAMkI,YAAY,GAAGF,eAAe,GAC9B,IAAA1H,gCAAqB,EAAC0H,eAAe,CAACzH,WAAW,EAAEJ,QAAQ,CAAC,GAC5DyH,KAAK;UAGX,IAAAO,kBAAA,SAAoDC,OAAO,CAACC,GAAG,CAAC,CAC5D,IAAI,CAACpE,uBAAuB,CAAClE,OAAO,EAAEC,MAAM,EAAE6H,SAAS,EAAED,KAAK,CAAC,EAC/D,IAAI,CAAC3D,uBAAuB,CAAClE,OAAO,EAAEC,MAAM,EAAE8H,UAAU,EAAEF,KAAK,CAAC,EAChE,IAAI,CAAC3D,uBAAuB,CAAClE,OAAO,EAAEC,MAAM,EAAE+H,YAAY,EAAEH,KAAK,CAAC,EAClE,IAAI,CAAC3D,uBAAuB,CAAClE,OAAO,EAAEC,MAAM,EAAEkI,YAAY,EAAEN,KAAK,CAAC,CACrE,CAAC;YAAAU,mBAAA,OAAAC,eAAA,CAAA/I,OAAA,EAAA2I,kBAAA;YALK7B,MAAM,GAAAgC,mBAAA;YAAE/B,OAAO,GAAA+B,mBAAA;YAAEE,SAAS,GAAAF,mBAAA;YAAEG,OAAO,GAAAH,mBAAA;UAO1C,OAAO;YACHhC,MAAM,EAANA,MAAM;YACNC,OAAO,EAAPA,OAAO;YACPiC,SAAS,EAATA,SAAS;YACTC,OAAO,EAAPA;UACJ,CAAC;QACL,CAAC,CAAC,OAAO3F,KAAK,EAAE;UACZ,IAAMC,OAAO,GAAG,IAAAC,0CAA2B,EAACF,KAAK,CAAC;UAClD,MAAM,IAAI7C,KAAK,CAAC,wCAAwC8C,OAAO,EAAE,CAAC;QACtE;MACJ,CAAC;MAAA,SAvDK2F,uBAAuBA,CAAAC,IAAA,EAAAC,IAAA;QAAA,OAAAjB,wBAAA,CAAA/E,KAAA,OAAAC,SAAA;MAAA;MAAA,OAAvB6F,uBAAuB;IAAA;EAAA;IAAAhJ,GAAA;IAAAC,KAAA,EA8D7B,SAAQwG,sBAAsBA,CAC1BxC,WAA8B,EAC9BxD,QAAgB,EACH;MAAA,IAAA0I,MAAA;MACb,IAAMC,UAAU,GAAG,IAAIC,GAAG,CAA4B,CAAC;MAEvDpF,WAAW,CAACqF,OAAO,CAAC,UAAClJ,UAAU,EAAK;QAChC,IAAM8E,cAAc,GAAG,IAAAtE,gCAAqB,EACxCR,UAAU,CAACS,WAAW,EACtBJ,QACJ,CAAC;QACD,IAAM0H,SAAS,GAAGgB,MAAI,CAACI,YAAY,CAACrE,cAAc,CAAC;QACnD,IAAMsE,OAAO,GAAGrB,SAAS;QAEzB,IAAI,CAACiB,UAAU,CAACK,GAAG,CAACD,OAAO,CAAC,EAAE;UAC1BJ,UAAU,CAACvG,GAAG,CAAC2G,OAAO,EAAE,EAAE,CAAC;QAC/B;QACAJ,UAAU,CAACM,GAAG,CAACF,OAAO,CAAC,CAAEG,IAAI,CAACvJ,UAAU,CAAC;MAC7C,CAAC,CAAC;MAEF,OAAOwJ,KAAK,CAACC,IAAI,CAACT,UAAU,CAACU,OAAO,CAAC,CAAC,CAAC,CAClChI,GAAG,CAAC,UAAAiI,KAAA,EAAkC;QAAA,IAAAC,KAAA,OAAAnB,eAAA,CAAA/I,OAAA,EAAAiK,KAAA;UAAhC5B,SAAS,GAAA6B,KAAA;UAAEC,eAAe,GAAAD,KAAA;QAC7B,IAAME,OAAO,GAAGf,MAAI,CAACgB,UAAU,CAAChC,SAAS,CAAC;QAC1C,IAAMiC,WAAW,GAAG,IAAIzE,GAAG,CACvBsE,eAAe,CAACnI,GAAG,CAAC,UAACuI,CAAC;UAAA,OAClB,IAAAzJ,gCAAqB,EAACyJ,CAAC,CAACxJ,WAAW,EAAEJ,QAAQ,CAAC;QAAA,CAClD,CACJ,CAAC;QAED,OAAO;UACH0H,SAAS,EAATA,SAAS;UACT+B,OAAO,EAAPA,OAAO;UACPjG,WAAW,EAAEgG,eAAe;UAC5BK,eAAe,EAAEL,eAAe,CAAC3H,MAAM;UACvCgC,cAAc,EAAG8F,WAAW,CAACvE,IAAI,GAAG,CAAC,GAAI;QAC7C,CAAC;MACL,CAAC,CAAC,CACD0E,IAAI,CAAC,UAACC,CAAC,EAAEC,CAAC;QAAA,OAAKA,CAAC,CAACtC,SAAS,CAACuC,aAAa,CAACF,CAAC,CAACrC,SAAS,CAAC;MAAA,EAAC;IAC/D;EAAC;IAAAnI,GAAA;IAAAC,KAAA,EAKD,SAAQ0G,uBAAuBA,CAC3B1C,WAA8B,EAC9BxD,QAAgB,EACF;MACd,IAAMkK,WAAW,GAAG,IAAItB,GAAG,CAA4B,CAAC;MAExDpF,WAAW,CAACqF,OAAO,CAAC,UAAClJ,UAAU,EAAK;QAChC,IAAM8E,cAAc,GAAG,IAAAtE,gCAAqB,EACxCR,UAAU,CAACS,WAAW,EACtBJ,QACJ,CAAC;QACD,IAAMmK,QAAQ,GAAG1F,cAAc,CAAC2F,SAAS,CAAC,CAAC,EAAE,CAAC,CAAC;QAE/C,IAAI,CAACF,WAAW,CAAClB,GAAG,CAACmB,QAAQ,CAAC,EAAE;UAC5BD,WAAW,CAAC9H,GAAG,CAAC+H,QAAQ,EAAE,EAAE,CAAC;QACjC;QACAD,WAAW,CAACjB,GAAG,CAACkB,QAAQ,CAAC,CAAEjB,IAAI,CAACvJ,UAAU,CAAC;MAC/C,CAAC,CAAC;MAEF,OAAOwJ,KAAK,CAACC,IAAI,CAACc,WAAW,CAACb,OAAO,CAAC,CAAC,CAAC,CACnChI,GAAG,CAAC,UAAAgJ,KAAA,EAA+B;QAAA,IAAAC,KAAA,OAAAlC,eAAA,CAAA/I,OAAA,EAAAgL,KAAA;UAA7BE,KAAK,GAAAD,KAAA;UAAEE,gBAAgB,GAAAF,KAAA;QAC1B,IAAAG,YAAA,GAAyBF,KAAK,CAACG,KAAK,CAAC,GAAG,CAAC;UAAAC,aAAA,OAAAvC,eAAA,CAAA/I,OAAA,EAAAoL,YAAA;UAAlCG,IAAI,GAAAD,aAAA;UAAEE,QAAQ,GAAAF,aAAA;QACrB,IAAMG,SAAS,GAAG,IAAInG,IAAI,CACtBoG,QAAQ,CAACH,IAAI,CAAC,EACdG,QAAQ,CAACF,QAAQ,CAAC,GAAG,CAAC,EACtB,CACJ,CAAC,CAACG,kBAAkB,CAAC,OAAO,EAAE;UAAET,KAAK,EAAE,MAAM;UAAEK,IAAI,EAAE;QAAU,CAAC,CAAC;QAEjE,IAAMK,WAAW,GAAG,IAAItG,IAAI,CACxBoG,QAAQ,CAACH,IAAI,CAAC,EACdG,QAAQ,CAACF,QAAQ,CAAC,EAClB,CACJ,CAAC,CAACK,OAAO,CAAC,CAAC;QACX,IAAMvB,WAAW,GAAG,IAAIzE,GAAG,CACvBsF,gBAAgB,CAACnJ,GAAG,CAAC,UAACuI,CAAC;UAAA,OACnB,IAAAzJ,gCAAqB,EAACyJ,CAAC,CAACxJ,WAAW,EAAEJ,QAAQ,CAAC;QAAA,CAClD,CACJ,CAAC;QAED,OAAO;UACHuK,KAAK,EAALA,KAAK;UACLO,SAAS,EAATA,SAAS;UACTtH,WAAW,EAAEgH,gBAAgB;UAC7BX,eAAe,EAAEW,gBAAgB,CAAC3I,MAAM;UACxCgC,cAAc,EAAG8F,WAAW,CAACvE,IAAI,GAAG6F,WAAW,GAAI;QACvD,CAAC;MACL,CAAC,CAAC,CACDnB,IAAI,CAAC,UAACC,CAAC,EAAEC,CAAC;QAAA,OAAKA,CAAC,CAACO,KAAK,CAACN,aAAa,CAACF,CAAC,CAACQ,KAAK,CAAC;MAAA,EAAC;IACvD;EAAC;IAAAhL,GAAA;IAAAC,KAAA,EAKD,SAAQsJ,YAAYA,CAACqC,UAAkB,EAAU;MAC7C,IAAMC,IAAI,GAAG,IAAIzG,IAAI,CAACwG,UAAU,CAAC;MACjC,IAAMrE,SAAS,GAAGsE,IAAI,CAACC,MAAM,CAAC,CAAC;MAC/B,IAAMC,YAAY,GAAGxE,SAAS,KAAK,CAAC,GAAG,CAAC,GAAGA,SAAS,GAAG,CAAC;MAExD,IAAMyE,MAAM,GAAG,IAAI5G,IAAI,CAACyG,IAAI,CAAC;MAC7BG,MAAM,CAACC,OAAO,CAACJ,IAAI,CAACF,OAAO,CAAC,CAAC,GAAGI,YAAY,CAAC;MAE7C,OAAO,IAAAzF,6BAAkB,EAAC0F,MAAM,CAAC;IACrC;EAAC;IAAAhM,GAAA;IAAAC,KAAA,EAKD,SAAQkK,UAAUA,CAAChC,SAAiB,EAAU;MAC1C,IAAM6D,MAAM,GAAG,IAAI5G,IAAI,CAAC+C,SAAS,CAAC;MAClC,IAAM+D,MAAM,GAAG,IAAI9G,IAAI,CAAC4G,MAAM,CAAC;MAC/BE,MAAM,CAACD,OAAO,CAACD,MAAM,CAACL,OAAO,CAAC,CAAC,GAAG,CAAC,CAAC;MAEpC,OAAO,IAAArF,6BAAkB,EAAC4F,MAAM,CAAC;IACrC;EAAC;IAAAlM,GAAA;IAAAC,KAAA,EAKD,SAAQoE,8BAA8BA,CAACJ,WAA8B,EAInE;MACE,IAAIA,WAAW,CAAC3B,MAAM,KAAK,CAAC,EAAE;QAC1B,IAAM4F,KAAK,GAAG,IAAAnH,+BAAoB,EAAC,CAAC;QACpC,OAAO;UACHyD,SAAS,EAAE0D,KAAK;UAChBzD,OAAO,EAAEyD,KAAK;UACdvD,WAAW,EAAE;QACjB,CAAC;MACL;MAEA,IAAMlE,QAAQ,GAAG,IAAAC,0BAAe,EAAC,CAAC;MAClC,IAAMyL,KAAK,GAAGlI,WAAW,CACpBnC,GAAG,CAAC,UAACuI,CAAC;QAAA,OAAK,IAAAzJ,gCAAqB,EAACyJ,CAAC,CAACxJ,WAAW,EAAEJ,QAAQ,CAAC;MAAA,EAAC,CAC1D8J,IAAI,CAAC,CAAC;MAEX,IAAM/F,SAAS,GAAG2H,KAAK,CAAC,CAAC,CAAC;MAC1B,IAAM1H,OAAO,GAAG0H,KAAK,CAACA,KAAK,CAAC7J,MAAM,GAAG,CAAC,CAAC;MAEvC,OAAO;QACHkC,SAAS,EAATA,SAAS;QACTC,OAAO,EAAPA,OAAO;QACPE,WAAW,EAAE,GAAGH,SAAS,OAAOC,OAAO;MAC3C,CAAC;IACL;EAAC;IAAAzE,GAAA;IAAAC,KAAA,EAKD,SAAQ4H,qBAAqBA,CAACuE,SAAoB,EAAU;MACxD,IAAM7F,GAAG,GAAG,IAAInB,IAAI,CAAC,CAAC;MACtB,IAAMF,cAAc,GAAGkH,SAAS,CAAC1E,MAAM,CAAC,CAAC;MACzC,IAAM2E,MAAM,GAAG9F,GAAG,CAACd,OAAO,CAAC,CAAC,GAAGP,cAAc,CAACO,OAAO,CAAC,CAAC;MACvD,IAAM6G,QAAQ,GAAG/G,IAAI,CAACgH,KAAK,CAACF,MAAM,IAAI,IAAI,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,CAAC,CAAC;MAE3D,IAAIC,QAAQ,KAAK,CAAC,EAAE;QAChB,OAAO,OAAO;MAClB,CAAC,MAAM,IAAIA,QAAQ,KAAK,CAAC,EAAE;QACvB,OAAO,WAAW;MACtB,CAAC,MAAM,IAAIA,QAAQ,GAAG,CAAC,EAAE;QACrB,OAAO,GAAGA,QAAQ,WAAW;MACjC,CAAC,MAAM,IAAIA,QAAQ,GAAG,EAAE,EAAE;QACtB,IAAME,KAAK,GAAGjH,IAAI,CAACgH,KAAK,CAACD,QAAQ,GAAG,CAAC,CAAC;QACtC,OAAOE,KAAK,KAAK,CAAC,GAAG,YAAY,GAAG,GAAGA,KAAK,YAAY;MAC5D,CAAC,MAAM,IAAIF,QAAQ,GAAG,GAAG,EAAE;QACvB,IAAMjG,MAAM,GAAGd,IAAI,CAACgH,KAAK,CAACD,QAAQ,GAAG,EAAE,CAAC;QACxC,OAAOjG,MAAM,KAAK,CAAC,GAAG,aAAa,GAAG,GAAGA,MAAM,aAAa;MAChE,CAAC,MAAM;QACH,IAAMoG,KAAK,GAAGlH,IAAI,CAACgH,KAAK,CAACD,QAAQ,GAAG,GAAG,CAAC;QACxC,OAAOG,KAAK,KAAK,CAAC,GAAG,YAAY,GAAG,GAAGA,KAAK,YAAY;MAC5D;IACJ;EAAC;IAAAzM,GAAA;IAAAC,KAAA;MAAA,IAAAyM,mBAAA,OAAAvM,kBAAA,CAAAL,OAAA,EAKD,WACIO,OAAe,EACfC,MAAc,EACiB;QAC/B,IAAI;UACA,IAAMe,qBAAqB,GAAG,IAAAC,0CAA6B,EAAC,CAAC;UAC7D,IAAMqL,oBAAoB,GAAG,IAAAnL,gBAAK,EAC9BH,qBAAqB,EACrB,IAAAI,gBAAK,EAAC,SAAS,EAAE,IAAI,EAAEpB,OAAO,CAAC,EAC/B,IAAAoB,gBAAK,EAAC,QAAQ,EAAE,IAAI,EAAEnB,MAAM,CAAC,EAC7B,IAAAyD,kBAAO,EAAC,aAAa,EAAE,KAAK,CAChC,CAAC;UAED,IAAM6I,QAAQ,SAAS,IAAAjL,kBAAO,EAACgL,oBAAoB,CAAC;UACpD,IAAIC,QAAQ,CAACvF,KAAK,EAAE;YAChB,OAAO,IAAI;UACf;UAEA,IAAMwF,QAAQ,GAAGD,QAAQ,CAAC/K,IAAI,CAAC,CAAC,CAAC;UACjC,OAAO,IAAAG,kDAA8B,EAAC6K,QAAQ,CAAC5K,EAAE,EAAE4K,QAAQ,CAAC3K,IAAI,CAAC,CAAC,CAAC;QACvE,CAAC,CAAC,OAAA4K,OAAA,EAAM;UACJ,OAAO,IAAI;QACf;MACJ,CAAC;MAAA,SAvBavE,kBAAkBA,CAAAwE,IAAA,EAAAC,IAAA;QAAA,OAAAN,mBAAA,CAAAxJ,KAAA,OAAAC,SAAA;MAAA;MAAA,OAAlBoF,kBAAkB;IAAA;EAAA;AAAA;AA2B7B,IAAM0E,iBAAiB,GAAArN,OAAA,CAAAqN,iBAAA,GAAG,IAAItN,iBAAiB,CAAC,CAAC","ignoreList":[]}