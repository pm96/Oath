{"version":3,"names":["_firebaseConfig","require","_errorHandling","_asyncStorage","_interopRequireDefault","_firestore","_collections","_habitStreakSchemas","SyncService","exports","_classCallCheck2","default","syncListeners","Map","pendingOperations","syncStatus","isOnline","lastSync","syncInProgress","statusCallbacks","Set","initializeSync","_createClass2","key","value","_initializeSync","_asyncToGenerator2","loadPendingOperations","online","updateSyncStatus","processPendingOperations","startConnectivityMonitoring","error","console","apply","arguments","_startRealtimeSync","userId","_this","Error","stopRealtimeSync","streaksCollection","getHabitStreaksCollection","streaksQuery","query","where","streakListener","onSnapshot","snapshot","docChanges","forEach","_ref","change","streakData","doc","data","handleRealtimeStreakUpdate","id","type","_x2","handleSyncError","completionsCollection","getHabitCompletionsCollection","completionsQuery","completionListener","_ref2","completionData","handleRealtimeCompletionUpdate","_x3","set","startRealtimeSync","_x","streakKey","completionKey","get","delete","_cacheData","version","length","undefined","checksum","generateChecksum","cachedData","timestamp","Timestamp","now","AsyncStorage","setItem","JSON","stringify","cacheData","_x4","_x5","_getCachedData","cachedString","getItem","parse","expectedChecksum","warn","removeItem","getCachedData","_x6","_updateAggregateRecord","docId","entry","current","updateAggregateRecord","_x7","_x8","_x9","_getCachedStreakMap","record","CACHE_KEYS","STREAKS","Object","values","reduce","acc","streak","habitId","getCachedStreakMap","_getCachedCompletionsMap","COMPLETIONS","getCachedCompletionsMap","_cleanupCachePrefix","prefix","activeDocIds","allKeys","getAllKeys","prefixWithSeparator","allowedKeys","Array","from","map","keysToRemove","filter","startsWith","has","multiRemove","cleanupCachePrefix","_x0","_x1","_queueOperation","operation","syncOp","assign","generateOperationId","retryCount","savePendingOperations","size","queueOperation","_x10","_processPendingOperations","operations","sort","a","b","toMillis","executeOperation","lastAttempt","_executeOperation","_this2","retryWithBackoff","runTransaction","db","_ref4","transaction","executeCompletionOperation","executeStreakOperation","executeMilestoneOperation","_x12","_x11","_handleRealtimeStreakUpdate","changeType","removeCacheKey","transformFirestoreToStreak","cacheKey","cachedStreak","hasConflict","resolvedStreak","resolveStreakConflict","_x13","_x14","_x15","_handleRealtimeCompletionUpdate","completion","transformFirestoreToCompletion","_x16","_x17","_x18","_resolveStreakConflict","localStreak","remoteStreak","lastCompletionDate","currentStreak","_x19","_x20","local","remote","bestStreak","freezesAvailable","freezesUsed","_executeCompletionOperation","action","completionRef","createdAt","serverTimestamp","updateRef","update","updatedAt","deleteRef","_x21","_x22","_executeStreakOperation","streakId","generateStreakId","streakRef","transformStreakToFirestore","_x23","_x24","_executeMilestoneOperation","log","_x25","_x26","str","hash","i","char","charCodeAt","toString","Date","Math","random","substr","_savePendingOperations","serialized","op","_op$lastAttempt","PENDING_OPS","_loadPendingOperations","_this3","stored","clear","fromMillis","_this4","setInterval","wasOnline","_error$message","code","message","includes","updates","_this5","callback","onSyncStatusChange","_this6","add","getSyncStatus","_forceSyncUserData","syncUserStreaks","syncUserCompletions","forceSyncUserData","_x27","_syncUserStreaks","_this7","getDocs","streakEntries","docs","docSnap","aggregateRecord","Promise","all","_ref7","_ref6","_x29","_x28","_syncUserCompletions","_this8","completionEntries","_ref9","_ref8","_x31","_x30","_clearCache","LAST_SYNC","clearCache","getInstance","instance","syncService"],"sources":["syncService.ts"],"sourcesContent":["/**\n * Data Synchronization Service\n *\n * Handles cross-device data synchronization, offline caching, and conflict resolution\n * Requirements: 10.1, 10.2, 10.3, 10.4, 10.5\n */\n\nimport { db } from \"@/firebaseConfig\";\nimport { HabitCompletion, HabitStreak } from \"@/types\";\nimport { isOnline, retryWithBackoff } from \"@/utils/errorHandling\";\nimport AsyncStorage from \"@react-native-async-storage/async-storage\";\nimport { Unsubscribe } from \"firebase/auth\";\nimport {\n    Timestamp,\n    doc,\n    getDocs,\n    onSnapshot,\n    query,\n    runTransaction,\n    serverTimestamp,\n    where,\n} from \"firebase/firestore\";\nimport {\n    getHabitCompletionsCollection,\n    getHabitStreaksCollection,\n} from \"./collections\";\nimport {\n    generateStreakId,\n    transformFirestoreToCompletion,\n    transformFirestoreToStreak,\n    transformStreakToFirestore,\n} from \"./habitStreakSchemas\";\n\n/**\n * Sync operation types\n */\nexport interface SyncOperation {\n    id: string;\n    type: \"completion\" | \"streak\" | \"milestone\";\n    action: \"create\" | \"update\" | \"delete\";\n    data: any;\n    timestamp: Timestamp;\n    userId: string;\n    habitId?: string;\n    retryCount: number;\n    lastAttempt?: Timestamp;\n}\n\n/**\n * Cached data structure\n */\nexport interface CachedData<T> {\n    data: T;\n    timestamp: Timestamp;\n    version: number;\n    checksum: string;\n}\n\n/**\n * Sync status\n */\nexport interface SyncStatus {\n    isOnline: boolean;\n    lastSync: Timestamp | null;\n    pendingOperations: number;\n    syncInProgress: boolean;\n}\n/**\n * Data Synchronization Service Implementation\n */\nexport class SyncService {\n    private static instance: SyncService;\n    private syncListeners: Map<string, Unsubscribe> = new Map();\n    private pendingOperations: Map<string, SyncOperation> = new Map();\n    private syncStatus: SyncStatus = {\n        isOnline: true,\n        lastSync: null,\n        pendingOperations: 0,\n        syncInProgress: false,\n    };\n    private statusCallbacks: Set<(status: SyncStatus) => void> = new Set();\n\n    // Cache keys\n    private static readonly CACHE_KEYS = {\n        STREAKS: \"@habit_streaks_cache\",\n        COMPLETIONS: \"@habit_completions_cache\",\n        PENDING_OPS: \"@pending_sync_operations\",\n        LAST_SYNC: \"@last_sync_timestamp\",\n    };\n\n    private constructor() {\n        this.initializeSync();\n    }\n\n    public static getInstance(): SyncService {\n        if (!SyncService.instance) {\n            SyncService.instance = new SyncService();\n        }\n        return SyncService.instance;\n    }\n\n    /**\n     * Initialize synchronization system\n     * Requirements: 10.1, 10.4\n     */\n    private async initializeSync(): Promise<void> {\n        try {\n            // Load pending operations from storage\n            await this.loadPendingOperations();\n\n            // Check connectivity and start sync if online\n            const online = await isOnline();\n            this.updateSyncStatus({ isOnline: online });\n\n            if (online) {\n                await this.processPendingOperations();\n            }\n\n            // Set up connectivity monitoring\n            this.startConnectivityMonitoring();\n        } catch (error) {\n            console.error(\"Failed to initialize sync service:\", error);\n        }\n    }\n\n    /**\n     * Start real-time synchronization for a user's habit data\n     * Requirements: 10.1\n     */\n    async startRealtimeSync(userId: string): Promise<void> {\n        if (!userId) {\n            throw new Error(\"User ID is required for sync\");\n        }\n\n        // Stop existing listeners for this user\n        this.stopRealtimeSync(userId);\n\n        try {\n            // Set up streak data listener\n            const streaksCollection = getHabitStreaksCollection();\n            const streaksQuery = query(\n                streaksCollection,\n                where(\"userId\", \"==\", userId),\n            );\n            const streakListener = onSnapshot(\n                streaksQuery,\n                (snapshot) => {\n                    snapshot.docChanges().forEach(async (change) => {\n                        const streakData = change.doc.data();\n                        await this.handleRealtimeStreakUpdate(\n                            change.doc.id,\n                            streakData,\n                            change.type,\n                        );\n                    });\n                },\n                (error) => {\n                    console.error(\"Streak sync error:\", error);\n                    this.handleSyncError(error);\n                },\n            );\n\n            // Set up completion data listener\n            const completionsCollection = getHabitCompletionsCollection();\n            const completionsQuery = query(\n                completionsCollection,\n                where(\"userId\", \"==\", userId),\n            );\n            const completionListener = onSnapshot(\n                completionsQuery,\n                (snapshot) => {\n                    snapshot.docChanges().forEach(async (change) => {\n                        const completionData = change.doc.data();\n                        await this.handleRealtimeCompletionUpdate(\n                            change.doc.id,\n                            completionData,\n                            change.type,\n                        );\n                    });\n                },\n                (error) => {\n                    console.error(\"Completion sync error:\", error);\n                    this.handleSyncError(error);\n                },\n            );\n\n            // Store listeners\n            this.syncListeners.set(`streaks_${userId}`, streakListener);\n            this.syncListeners.set(`completions_${userId}`, completionListener);\n        } catch (error) {\n            console.error(\"Failed to start realtime sync:\", error);\n            throw error;\n        }\n    }\n    /**\n     * Stop real-time synchronization for a user\n     */\n    stopRealtimeSync(userId: string): void {\n        const streakKey = `streaks_${userId}`;\n        const completionKey = `completions_${userId}`;\n\n        const streakListener = this.syncListeners.get(streakKey);\n        if (streakListener) {\n            streakListener();\n            this.syncListeners.delete(streakKey);\n        }\n\n        const completionListener = this.syncListeners.get(completionKey);\n        if (completionListener) {\n            completionListener();\n            this.syncListeners.delete(completionKey);\n        }\n    }\n\n    /**\n     * Cache data locally with integrity verification\n     * Requirements: 10.4\n     */\n    async cacheData<T>(key: string, data: T, version: number = 1): Promise<void> {\n        try {\n            const checksum = this.generateChecksum(data);\n            const cachedData: CachedData<T> = {\n                data,\n                timestamp: Timestamp.now(),\n                version,\n                checksum,\n            };\n\n            await AsyncStorage.setItem(key, JSON.stringify(cachedData));\n        } catch (error) {\n            console.error(\"Failed to cache data:\", error);\n            // Don't throw - caching failure shouldn't break the app\n        }\n    }\n\n    /**\n     * Retrieve cached data with integrity verification\n     * Requirements: 10.4, 12.5\n     */\n    async getCachedData<T>(key: string): Promise<T | null> {\n        try {\n            const cachedString = await AsyncStorage.getItem(key);\n            if (!cachedString) {\n                return null;\n            }\n\n            const cachedData: CachedData<T> = JSON.parse(cachedString);\n\n            // Verify data integrity\n            const expectedChecksum = this.generateChecksum(cachedData.data);\n            if (cachedData.checksum !== expectedChecksum) {\n                console.warn(\"Cache integrity check failed, removing corrupted data\");\n                await AsyncStorage.removeItem(key);\n                return null;\n            }\n\n            return cachedData.data;\n        } catch (error) {\n            console.error(\"Failed to retrieve cached data:\", error);\n            return null;\n        }\n    }\n\n    private async updateAggregateRecord<T>(\n        key: string,\n        docId: string,\n        entry?: T,\n    ): Promise<void> {\n        const current =\n            (await this.getCachedData<Record<string, T>>(key)) || {};\n\n        if (entry) {\n            current[docId] = entry;\n        } else {\n            delete current[docId];\n        }\n\n        await this.cacheData(key, current);\n    }\n\n    async getCachedStreakMap(): Promise<Record<string, HabitStreak>> {\n        const record =\n            (await this.getCachedData<Record<string, HabitStreak>>(\n                SyncService.CACHE_KEYS.STREAKS,\n            )) || {};\n\n        return Object.values(record).reduce(\n            (acc, streak) => {\n                if (streak.habitId) {\n                    acc[streak.habitId] = streak;\n                }\n                return acc;\n            },\n            {} as Record<string, HabitStreak>,\n        );\n    }\n\n    async getCachedCompletionsMap(): Promise<Record<string, HabitCompletion>> {\n        return (\n            (await this.getCachedData<Record<string, HabitCompletion>>(\n                SyncService.CACHE_KEYS.COMPLETIONS,\n            )) || {}\n        );\n    }\n\n    /**\n     * Remove cached entries for a prefix that are no longer active\n     */\n    private async cleanupCachePrefix(\n        prefix: string,\n        activeDocIds?: Set<string>,\n    ): Promise<void> {\n        try {\n            const allKeys = await AsyncStorage.getAllKeys();\n            if (!allKeys || allKeys.length === 0) {\n                return;\n            }\n\n            const prefixWithSeparator = `${prefix}_`;\n            const allowedKeys =\n                activeDocIds &&\n                new Set(\n                    Array.from(activeDocIds.values()).map(\n                        (id) => `${prefixWithSeparator}${id}`,\n                    ),\n                );\n\n            const keysToRemove = allKeys.filter((key) => {\n                if (!key.startsWith(prefixWithSeparator)) {\n                    return false;\n                }\n\n                if (!allowedKeys) {\n                    return true;\n                }\n\n                return !allowedKeys.has(key);\n            });\n\n            if (keysToRemove.length > 0) {\n                await AsyncStorage.multiRemove(keysToRemove);\n            }\n        } catch (error) {\n            console.error(\"Failed to clean up cache prefix:\", error);\n        }\n    }\n\n    /**\n     * Queue operation for offline sync\n     * Requirements: 10.4\n     */\n    async queueOperation(\n        operation: Omit<SyncOperation, \"id\" | \"retryCount\" | \"timestamp\">,\n    ): Promise<void> {\n        const syncOp: SyncOperation = {\n            ...operation,\n            id: this.generateOperationId(),\n            timestamp: Timestamp.now(),\n            retryCount: 0,\n        };\n\n        this.pendingOperations.set(syncOp.id, syncOp);\n        await this.savePendingOperations();\n\n        this.updateSyncStatus({\n            pendingOperations: this.pendingOperations.size,\n        });\n\n        // Try to process immediately if online\n        if (this.syncStatus.isOnline) {\n            await this.processPendingOperations();\n        }\n    }\n\n    /**\n     * Process pending operations when connection is restored\n     * Requirements: 10.4, 10.5\n     */\n    async processPendingOperations(): Promise<void> {\n        if (this.syncStatus.syncInProgress || this.pendingOperations.size === 0) {\n            return;\n        }\n\n        this.updateSyncStatus({ syncInProgress: true });\n\n        try {\n            const operations = Array.from(this.pendingOperations.values()).sort(\n                (a, b) => a.timestamp.toMillis() - b.timestamp.toMillis(),\n            );\n\n            for (const operation of operations) {\n                try {\n                    await this.executeOperation(operation);\n                    this.pendingOperations.delete(operation.id);\n                } catch (error) {\n                    console.error(\"Failed to execute operation:\", error);\n\n                    // Increment retry count\n                    operation.retryCount++;\n                    operation.lastAttempt = Timestamp.now();\n\n                    // Remove operation if max retries exceeded\n                    if (operation.retryCount >= 3) {\n                        console.warn(\n                            \"Max retries exceeded, removing operation:\",\n                            operation.id,\n                        );\n                        this.pendingOperations.delete(operation.id);\n                    }\n                }\n            }\n\n            await this.savePendingOperations();\n            this.updateSyncStatus({\n                pendingOperations: this.pendingOperations.size,\n                lastSync: Timestamp.now(),\n            });\n        } finally {\n            this.updateSyncStatus({ syncInProgress: false });\n        }\n    }\n\n    /**\n     * Execute a sync operation with atomic updates\n     * Requirements: 10.2\n     */\n    private async executeOperation(operation: SyncOperation): Promise<void> {\n        return await retryWithBackoff(async () => {\n            return await runTransaction(db, async (transaction) => {\n                switch (operation.type) {\n                    case \"completion\":\n                        await this.executeCompletionOperation(operation, transaction);\n                        break;\n                    case \"streak\":\n                        await this.executeStreakOperation(operation, transaction);\n                        break;\n                    case \"milestone\":\n                        await this.executeMilestoneOperation(operation, transaction);\n                        break;\n                    default:\n                        throw new Error(`Unknown operation type: ${operation.type}`);\n                }\n            });\n        });\n    }\n\n    /**\n     * Handle real-time streak updates with conflict resolution\n     * Requirements: 10.1, 10.5\n     */\n    private async handleRealtimeStreakUpdate(\n        docId: string,\n        data: any,\n        changeType: \"added\" | \"modified\" | \"removed\",\n    ): Promise<void> {\n        try {\n            if (changeType === \"removed\") {\n                // Remove from cache\n                const removeCacheKey = `${SyncService.CACHE_KEYS.STREAKS}_${docId}`;\n                await AsyncStorage.removeItem(removeCacheKey);\n                await this.updateAggregateRecord(\n                    SyncService.CACHE_KEYS.STREAKS,\n                    docId,\n                );\n                return;\n            }\n\n            const streak = transformFirestoreToStreak(data);\n\n            // Check for conflicts with local data\n            const cacheKey = `${SyncService.CACHE_KEYS.STREAKS}_${docId}`;\n            const cachedStreak = await this.getCachedData<HabitStreak>(cacheKey);\n\n            if (cachedStreak && this.hasConflict(cachedStreak, streak)) {\n                const resolvedStreak = await this.resolveStreakConflict(\n                    cachedStreak,\n                    streak,\n                );\n                await this.cacheData(cacheKey, resolvedStreak);\n            } else {\n                await this.cacheData(cacheKey, streak);\n            }\n\n            await this.updateAggregateRecord(\n                SyncService.CACHE_KEYS.STREAKS,\n                docId,\n                streak,\n            );\n        } catch (error) {\n            console.error(\"Error handling realtime streak update:\", error);\n        }\n    }\n\n    /**\n     * Handle real-time completion updates\n     * Requirements: 10.1\n     */\n    private async handleRealtimeCompletionUpdate(\n        docId: string,\n        data: any,\n        changeType: \"added\" | \"modified\" | \"removed\",\n    ): Promise<void> {\n        try {\n            if (changeType === \"removed\") {\n                const removeCacheKey = `${SyncService.CACHE_KEYS.COMPLETIONS}_${docId}`;\n                await AsyncStorage.removeItem(removeCacheKey);\n                await this.updateAggregateRecord(\n                    SyncService.CACHE_KEYS.COMPLETIONS,\n                    docId,\n                );\n                return;\n            }\n\n            const completion = transformFirestoreToCompletion(docId, data);\n            const cacheKey = `${SyncService.CACHE_KEYS.COMPLETIONS}_${docId}`;\n            await this.cacheData(cacheKey, completion);\n            await this.updateAggregateRecord(\n                SyncService.CACHE_KEYS.COMPLETIONS,\n                docId,\n                completion,\n            );\n        } catch (error) {\n            console.error(\"Error handling realtime completion update:\", error);\n        }\n    }\n\n    /**\n     * Resolve conflicts using timestamp priority\n     * Requirements: 10.5\n     */\n    private async resolveStreakConflict(\n        localStreak: HabitStreak,\n        remoteStreak: HabitStreak,\n    ): Promise<HabitStreak> {\n        // Use the streak with the most recent lastCompletionDate\n        // If dates are equal, prefer the one with higher currentStreak\n\n        if (!localStreak.lastCompletionDate && remoteStreak.lastCompletionDate) {\n            return remoteStreak;\n        }\n\n        if (localStreak.lastCompletionDate && !remoteStreak.lastCompletionDate) {\n            return localStreak;\n        }\n\n        if (localStreak.lastCompletionDate && remoteStreak.lastCompletionDate) {\n            if (localStreak.lastCompletionDate > remoteStreak.lastCompletionDate) {\n                return localStreak;\n            } else if (\n                localStreak.lastCompletionDate < remoteStreak.lastCompletionDate\n            ) {\n                return remoteStreak;\n            } else {\n                // Same date, use higher streak\n                return localStreak.currentStreak >= remoteStreak.currentStreak\n                    ? localStreak\n                    : remoteStreak;\n            }\n        }\n\n        // Fallback to remote if no clear winner\n        return remoteStreak;\n    }\n\n    /**\n     * Check if there's a conflict between local and remote data\n     */\n    private hasConflict(local: HabitStreak, remote: HabitStreak): boolean {\n        return (\n            local.currentStreak !== remote.currentStreak ||\n            local.bestStreak !== remote.bestStreak ||\n            local.lastCompletionDate !== remote.lastCompletionDate ||\n            local.freezesAvailable !== remote.freezesAvailable ||\n            local.freezesUsed !== remote.freezesUsed\n        );\n    }\n    /**\n     * Execute completion operation\n     */\n    private async executeCompletionOperation(\n        operation: SyncOperation,\n        transaction: any,\n    ): Promise<void> {\n        const completionsCollection = getHabitCompletionsCollection();\n\n        switch (operation.action) {\n            case \"create\":\n                const completionRef = doc(completionsCollection);\n                transaction.set(completionRef, {\n                    ...operation.data,\n                    createdAt: serverTimestamp(),\n                });\n                break;\n            case \"update\":\n                const updateRef = doc(completionsCollection, operation.data.id);\n                transaction.update(updateRef, {\n                    ...operation.data,\n                    updatedAt: serverTimestamp(),\n                });\n                break;\n            case \"delete\":\n                const deleteRef = doc(completionsCollection, operation.data.id);\n                transaction.delete(deleteRef);\n                break;\n        }\n    }\n\n    /**\n     * Execute streak operation\n     */\n    private async executeStreakOperation(\n        operation: SyncOperation,\n        transaction: any,\n    ): Promise<void> {\n        const streaksCollection = getHabitStreaksCollection();\n        const streakId = generateStreakId(operation.userId, operation.habitId!);\n        const streakRef = doc(streaksCollection, streakId);\n\n        switch (operation.action) {\n            case \"create\":\n            case \"update\":\n                const streakData = transformStreakToFirestore(operation.data);\n                transaction.set(streakRef, streakData);\n                break;\n            case \"delete\":\n                transaction.delete(streakRef);\n                break;\n        }\n    }\n\n    /**\n     * Execute milestone operation\n     */\n    private async executeMilestoneOperation(\n        operation: SyncOperation,\n        transaction: any,\n    ): Promise<void> {\n        // Milestone operations are typically part of streak updates\n        // This is a placeholder for future milestone-specific operations\n        console.log(\"Executing milestone operation:\", operation);\n    }\n\n    /**\n     * Generate checksum for data integrity\n     */\n    private generateChecksum(data: any): string {\n        const str = JSON.stringify(data);\n        let hash = 0;\n        for (let i = 0; i < str.length; i++) {\n            const char = str.charCodeAt(i);\n            hash = (hash << 5) - hash + char;\n            hash = hash & hash; // Convert to 32-bit integer\n        }\n        return hash.toString();\n    }\n\n    /**\n     * Generate unique operation ID\n     */\n    private generateOperationId(): string {\n        return `op_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;\n    }\n\n    /**\n     * Save pending operations to storage\n     */\n    private async savePendingOperations(): Promise<void> {\n        try {\n            const operations = Array.from(this.pendingOperations.values());\n            const serialized = operations.map((op) => ({\n                ...op,\n                timestamp: op.timestamp.toMillis(),\n                lastAttempt: op.lastAttempt?.toMillis(),\n            }));\n\n            await AsyncStorage.setItem(\n                SyncService.CACHE_KEYS.PENDING_OPS,\n                JSON.stringify(serialized),\n            );\n        } catch (error) {\n            console.error(\"Failed to save pending operations:\", error);\n        }\n    }\n\n    /**\n     * Load pending operations from storage\n     */\n    private async loadPendingOperations(): Promise<void> {\n        try {\n            const stored = await AsyncStorage.getItem(\n                SyncService.CACHE_KEYS.PENDING_OPS,\n            );\n            if (!stored) return;\n\n            const operations = JSON.parse(stored);\n            this.pendingOperations.clear();\n\n            operations.forEach((op: any) => {\n                const operation: SyncOperation = {\n                    ...op,\n                    timestamp: Timestamp.fromMillis(op.timestamp),\n                    lastAttempt: op.lastAttempt\n                        ? Timestamp.fromMillis(op.lastAttempt)\n                        : undefined,\n                };\n                this.pendingOperations.set(operation.id, operation);\n            });\n        } catch (error) {\n            console.error(\"Failed to load pending operations:\", error);\n        }\n    }\n    /**\n     * Start connectivity monitoring\n     */\n    private startConnectivityMonitoring(): void {\n        // Check connectivity every 30 seconds\n        setInterval(async () => {\n            const online = await isOnline();\n            const wasOnline = this.syncStatus.isOnline;\n\n            this.updateSyncStatus({ isOnline: online });\n\n            // If we just came back online, process pending operations\n            if (online && !wasOnline) {\n                console.log(\"Connection restored, processing pending operations\");\n                await this.processPendingOperations();\n            }\n        }, 30000);\n    }\n\n    /**\n     * Handle sync errors\n     */\n    private handleSyncError(error: any): void {\n        console.error(\"Sync error:\", error);\n\n        // Update sync status based on error type\n        if (error.code === \"unavailable\" || error.message?.includes(\"network\")) {\n            this.updateSyncStatus({ isOnline: false });\n        }\n    }\n\n    /**\n     * Update sync status and notify listeners\n     */\n    private updateSyncStatus(updates: Partial<SyncStatus>): void {\n        this.syncStatus = { ...this.syncStatus, ...updates };\n\n        // Notify all status callbacks\n        this.statusCallbacks.forEach((callback) => {\n            try {\n                callback(this.syncStatus);\n            } catch (error) {\n                console.error(\"Error in sync status callback:\", error);\n            }\n        });\n    }\n\n    /**\n     * Subscribe to sync status updates\n     */\n    onSyncStatusChange(callback: (status: SyncStatus) => void): () => void {\n        this.statusCallbacks.add(callback);\n\n        // Call immediately with current status\n        callback(this.syncStatus);\n\n        // Return unsubscribe function\n        return () => {\n            this.statusCallbacks.delete(callback);\n        };\n    }\n\n    /**\n     * Get current sync status\n     */\n    getSyncStatus(): SyncStatus {\n        return { ...this.syncStatus };\n    }\n\n    /**\n     * Force sync all data for a user\n     * Requirements: 10.1, 10.3\n     */\n    async forceSyncUserData(userId: string): Promise<void> {\n        if (!this.syncStatus.isOnline) {\n            throw new Error(\"Cannot force sync while offline\");\n        }\n\n        try {\n            this.updateSyncStatus({ syncInProgress: true });\n\n            // Sync all streak data\n            await this.syncUserStreaks(userId);\n\n            // Sync all completion data\n            await this.syncUserCompletions(userId);\n\n            this.updateSyncStatus({ lastSync: Timestamp.now() });\n        } finally {\n            this.updateSyncStatus({ syncInProgress: false });\n        }\n    }\n\n    /**\n     * Sync user streaks from server\n     */\n    private async syncUserStreaks(userId: string): Promise<void> {\n        try {\n            const streaksCollection = getHabitStreaksCollection();\n            const streaksQuery = query(\n                streaksCollection,\n                where(\"userId\", \"==\", userId),\n            );\n            const snapshot = await getDocs(streaksQuery);\n\n            const streakEntries = snapshot.docs.map((docSnap) => ({\n                id: docSnap.id,\n                streak: transformFirestoreToStreak(docSnap.data()),\n            }));\n\n            const aggregateRecord: Record<string, HabitStreak> = {};\n\n            await Promise.all(\n                streakEntries.map(async ({ id, streak }) => {\n                    aggregateRecord[id] = streak;\n                    await this.cacheData(\n                        `${SyncService.CACHE_KEYS.STREAKS}_${id}`,\n                        streak,\n                    );\n                }),\n            );\n\n            await this.cacheData(\n                SyncService.CACHE_KEYS.STREAKS,\n                aggregateRecord,\n            );\n\n            await this.cleanupCachePrefix(\n                SyncService.CACHE_KEYS.STREAKS,\n                new Set(streakEntries.map((entry) => entry.id)),\n            );\n        } catch (error) {\n            console.error(\"Failed to sync streaks:\", error);\n        }\n    }\n\n    /**\n     * Sync user completions from server\n     */\n    private async syncUserCompletions(userId: string): Promise<void> {\n        try {\n            const completionsCollection = getHabitCompletionsCollection();\n            const completionsQuery = query(\n                completionsCollection,\n                where(\"userId\", \"==\", userId),\n            );\n            const snapshot = await getDocs(completionsQuery);\n\n            const completionEntries = snapshot.docs.map((docSnap) => ({\n                id: docSnap.id,\n                completion: transformFirestoreToCompletion(docSnap.id, docSnap.data()),\n            }));\n\n            const aggregateRecord: Record<string, HabitCompletion> = {};\n\n            await Promise.all(\n                completionEntries.map(async ({ id, completion }) => {\n                    aggregateRecord[id] = completion;\n                    await this.cacheData(\n                        `${SyncService.CACHE_KEYS.COMPLETIONS}_${id}`,\n                        completion,\n                    );\n                }),\n            );\n\n            await this.cacheData(\n                SyncService.CACHE_KEYS.COMPLETIONS,\n                aggregateRecord,\n            );\n\n            await this.cleanupCachePrefix(\n                SyncService.CACHE_KEYS.COMPLETIONS,\n                new Set(completionEntries.map((entry) => entry.id)),\n            );\n        } catch (error) {\n            console.error(\"Failed to sync completions:\", error);\n        }\n    }\n\n    /**\n     * Clear all cached data\n     */\n    async clearCache(): Promise<void> {\n        try {\n            await AsyncStorage.multiRemove([\n                SyncService.CACHE_KEYS.STREAKS,\n                SyncService.CACHE_KEYS.COMPLETIONS,\n                SyncService.CACHE_KEYS.PENDING_OPS,\n                SyncService.CACHE_KEYS.LAST_SYNC,\n            ]);\n            await this.cleanupCachePrefix(SyncService.CACHE_KEYS.STREAKS);\n            await this.cleanupCachePrefix(SyncService.CACHE_KEYS.COMPLETIONS);\n\n            this.pendingOperations.clear();\n            this.updateSyncStatus({\n                pendingOperations: 0,\n                lastSync: null,\n            });\n        } catch (error) {\n            console.error(\"Failed to clear cache:\", error);\n        }\n    }\n}\n\n// Export singleton instance\nexport const syncService = SyncService.getInstance();\n"],"mappings":"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","ignoreList":[]}