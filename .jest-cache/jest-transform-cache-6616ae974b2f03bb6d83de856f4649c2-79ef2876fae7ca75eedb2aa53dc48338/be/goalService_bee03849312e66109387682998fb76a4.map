{"version":3,"names":["_errorHandling","require","_firestore","_collections","calculateNextDeadline","frequency","targetDays","lastCompletion","now","Date","currentDay","getDay","dayMap","Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","targetDayNumbers","map","day","sort","a","b","deadline","setHours","setDate","getDate","daysToAdd","found","i","checkDay","includes","firstTargetDay","fallback","getHours","createGoal","_x","_x2","_createGoal","apply","arguments","_asyncToGenerator2","default","userId","goalInput","validationError","validateGoalInput","Error","retryWithBackoff","goalsCollection","getGoalsCollection","nextDeadline","goalData","ownerId","description","trim","latestCompletionDate","currentStatus","Timestamp","fromDate","isShared","createdAt","serverTimestamp","redSince","difficulty","docRef","addDoc","streakService","initializeHabitStreak","id","streakError","console","warn","error","message","getUserFriendlyErrorMessage","updateGoal","_x3","_x4","_updateGoal","goalId","updates","goalDoc","getGoalDoc","firestoreUpdates","Object","assign","updateDoc","completeGoal","_x5","_x6","_completeGoal","goal","completion","habitId","completedAt","timezone","Intl","DateTimeFormat","resolvedOptions","timeZone","notes","result","recordCompletionWithMilestoneCheck","newMilestones","length","log","getUserGoals","callback","onError","q","query","where","unsubscribe","onSnapshot","snapshot","goals","docs","doc","_data$latestCompletio","_data$createdAt","_data$redSince","data","toDate","getGoalStreak","_x7","_x8","_getGoalStreak","getHabitStreak","getGoalCalendar","_x9","_x0","_getGoalCalendar","days","undefined","userTimezone","getHabitCalendar"],"sources":["goalService.ts"],"sourcesContent":["import {\n    getUserFriendlyErrorMessage,\n    retryWithBackoff,\n    validateGoalInput,\n} from \"@/utils/errorHandling\";\nimport {\n    addDoc,\n    onSnapshot,\n    query,\n    serverTimestamp,\n    Timestamp,\n    updateDoc,\n    where,\n} from \"firebase/firestore\";\nimport { getGoalDoc, getGoalsCollection, Goal } from \"./collections\";\n\n/**\n * Input type for creating a new goal\n */\nexport interface GoalInput {\n    description: string;\n    frequency: \"daily\" | \"weekly\" | \"3x_a_week\";\n    targetDays: string[]; // e.g., ['Monday', 'Wednesday', 'Friday']\n    difficulty: \"easy\" | \"medium\" | \"hard\";\n}\n\n/**\n * Calculate the next deadline based on frequency and target days\n */\nexport function calculateNextDeadline(\n    frequency: \"daily\" | \"weekly\" | \"3x_a_week\",\n    targetDays: string[],\n    lastCompletion?: Date,\n): Date {\n    const now = lastCompletion || new Date();\n    const currentDay = now.getDay(); // 0 = Sunday, 1 = Monday, etc.\n\n    // Map day names to numbers\n    const dayMap: { [key: string]: number } = {\n        Sunday: 0,\n        Monday: 1,\n        Tuesday: 2,\n        Wednesday: 3,\n        Thursday: 4,\n        Friday: 5,\n        Saturday: 6,\n    };\n\n    // Convert target days to numbers\n    const targetDayNumbers = targetDays\n        .map((day) => dayMap[day])\n        .sort((a, b) => a - b);\n\n    if (frequency === \"daily\") {\n        // Next deadline is end of today (23:59:59) or tomorrow if already completed today\n        const deadline = new Date(now);\n        deadline.setHours(23, 59, 59, 999);\n\n        // If we just completed it, set deadline to tomorrow\n        if (lastCompletion) {\n            deadline.setDate(deadline.getDate() + 1);\n        }\n\n        return deadline;\n    }\n\n    if (frequency === \"weekly\" || frequency === \"3x_a_week\") {\n        // Find the next occurrence of any target day\n        let daysToAdd = 0;\n        let found = false;\n\n        // Look for the next target day in the next 7 days\n        for (let i = 1; i <= 7; i++) {\n            const checkDay = (currentDay + i) % 7;\n            if (targetDayNumbers.includes(checkDay)) {\n                daysToAdd = i;\n                found = true;\n                break;\n            }\n        }\n\n        // If no target day found in next 7 days, use the first target day next week\n        if (!found) {\n            const firstTargetDay = targetDayNumbers[0];\n            daysToAdd = (firstTargetDay - currentDay + 7) % 7;\n            if (daysToAdd === 0) daysToAdd = 7;\n        }\n\n        const deadline = new Date(now);\n        deadline.setDate(deadline.getDate() + daysToAdd);\n        deadline.setHours(23, 59, 59, 999);\n\n        return deadline;\n    }\n\n    // Fallback: 24 hours from now\n    const fallback = new Date(now);\n    fallback.setHours(fallback.getHours() + 24);\n    return fallback;\n}\n\n/**\n * Create a new goal\n * Requirement 2.1: Validate goal inputs and handle errors\n * Now initializes streak tracking for the new habit\n */\nexport async function createGoal(\n    userId: string,\n    goalInput: GoalInput,\n): Promise<string> {\n    // Validate input\n    const validationError = validateGoalInput(goalInput);\n    if (validationError) {\n        throw new Error(validationError);\n    }\n\n    try {\n        return await retryWithBackoff(async () => {\n            const goalsCollection = getGoalsCollection();\n\n            const nextDeadline = calculateNextDeadline(\n                goalInput.frequency,\n                goalInput.targetDays,\n            );\n\n            const goalData = {\n                ownerId: userId,\n                description: goalInput.description.trim(),\n                frequency: goalInput.frequency,\n                targetDays: goalInput.targetDays,\n                latestCompletionDate: null,\n                currentStatus: \"Green\" as const,\n                nextDeadline: Timestamp.fromDate(nextDeadline),\n                isShared: true,\n                createdAt: serverTimestamp(),\n                redSince: null,\n                difficulty: goalInput.difficulty,\n            };\n\n            const docRef = await addDoc(goalsCollection, goalData);\n\n            // Initialize streak tracking for the new habit\n            try {\n                await streakService.initializeHabitStreak(docRef.id, userId);\n            } catch (streakError) {\n                console.warn(\"Failed to initialize streak tracking:\", streakError);\n                // Don't fail goal creation if streak initialization fails\n            }\n\n            return docRef.id;\n        });\n    } catch (error) {\n        const message = getUserFriendlyErrorMessage(error);\n        throw new Error(message);\n    }\n}\n\n/**\n * Update a goal\n * Includes retry logic for network errors\n */\nexport async function updateGoal(\n    goalId: string,\n    updates: Partial<Omit<Goal, \"id\">>,\n): Promise<void> {\n    if (!goalId) {\n        throw new Error(\"Goal ID is required\");\n    }\n\n    try {\n        await retryWithBackoff(async () => {\n            const goalDoc = getGoalDoc(goalId);\n\n            // Convert Date objects to Timestamps\n            const firestoreUpdates: any = { ...updates };\n            if (updates.latestCompletionDate) {\n                firestoreUpdates.latestCompletionDate = Timestamp.fromDate(\n                    updates.latestCompletionDate,\n                );\n            }\n            if (updates.nextDeadline) {\n                firestoreUpdates.nextDeadline = Timestamp.fromDate(\n                    updates.nextDeadline,\n                );\n            }\n            if (updates.createdAt) {\n                firestoreUpdates.createdAt = Timestamp.fromDate(updates.createdAt);\n            }\n            if (updates.redSince) {\n                firestoreUpdates.redSince = Timestamp.fromDate(updates.redSince);\n            }\n\n            await updateDoc(goalDoc, firestoreUpdates);\n        });\n    } catch (error) {\n        const message = getUserFriendlyErrorMessage(error);\n        throw new Error(message);\n    }\n}\n\n/**\n * Complete a goal - updates completion date, recalculates deadline, sets status to Green\n * Includes validation and error handling\n * Now integrates with streak system for habit tracking\n */\nexport async function completeGoal(goalId: string, goal: Goal): Promise<void> {\n    if (!goalId) {\n        throw new Error(\"Goal ID is required\");\n    }\n\n    if (!goal) {\n        throw new Error(\"Goal data is required\");\n    }\n\n    try {\n        const now = new Date();\n        const nextDeadline = calculateNextDeadline(\n            goal.frequency,\n            goal.targetDays,\n            now,\n        );\n\n        // Update goal status\n        await updateGoal(goalId, {\n            latestCompletionDate: now,\n            nextDeadline: nextDeadline,\n            currentStatus: \"Green\",\n            redSince: null,\n        });\n\n        // Record completion in streak system\n        const completion: Omit<HabitCompletion, \"id\"> = {\n            habitId: goalId, // Use goal ID as habit ID for integration\n            userId: goal.ownerId,\n            completedAt: Timestamp.fromDate(now),\n            timezone: Intl.DateTimeFormat().resolvedOptions().timeZone,\n            notes: \"\",\n            difficulty: goal.difficulty,\n        };\n\n        // Record completion and check for milestones\n        const result =\n            await streakService.recordCompletionWithMilestoneCheck(completion);\n\n        // Log milestone achievements for potential celebration\n        if (result.newMilestones.length > 0) {\n            console.log(\n                `New milestones achieved for goal ${goalId}:`,\n                result.newMilestones,\n            );\n        }\n    } catch (error) {\n        const message = getUserFriendlyErrorMessage(error);\n        throw new Error(message);\n    }\n}\n\n/**\n * Subscribe to user's goals with real-time updates\n * Includes error handling for snapshot listener\n */\nexport function getUserGoals(\n    userId: string,\n    callback: (goals: Goal[]) => void,\n    onError?: (error: Error) => void,\n): () => void {\n    if (!userId) {\n        const error = new Error(\"User ID is required\");\n        if (onError) onError(error);\n        return () => { };\n    }\n\n    const goalsCollection = getGoalsCollection();\n    const q = query(goalsCollection, where(\"ownerId\", \"==\", userId));\n\n    const unsubscribe = onSnapshot(\n        q,\n        (snapshot) => {\n            try {\n                const goals: Goal[] = snapshot.docs.map((doc) => {\n                    const data = doc.data();\n                    return {\n                        id: doc.id,\n                        ownerId: data.ownerId,\n                        description: data.description,\n                        frequency: data.frequency,\n                        targetDays: data.targetDays,\n                        latestCompletionDate: data.latestCompletionDate?.toDate() || null,\n                        currentStatus: data.currentStatus,\n                        nextDeadline: data.nextDeadline.toDate(),\n                        isShared: data.isShared,\n                        createdAt: data.createdAt?.toDate() || new Date(),\n                        redSince: data.redSince?.toDate() || null,\n                        difficulty: data.difficulty || \"medium\", // Default to medium for existing goals\n                    };\n                });\n                callback(goals);\n            } catch (error) {\n                console.error(\"Error processing goals snapshot:\", error);\n                if (onError) {\n                    onError(\n                        error instanceof Error\n                            ? error\n                            : new Error(\"Failed to process goals data\"),\n                    );\n                }\n            }\n        },\n        (error) => {\n            console.error(\"Error in goals snapshot listener:\", error);\n            if (onError) {\n                const message = getUserFriendlyErrorMessage(error);\n                onError(new Error(message));\n            }\n        },\n    );\n\n    return unsubscribe;\n}\n\n/**\n * Get streak information for a goal/habit\n * Integrates with the streak system to provide streak data\n */\nexport async function getGoalStreak(goalId: string, userId: string) {\n    try {\n        return await streakService.getHabitStreak(goalId, userId);\n    } catch (error) {\n        console.warn(\"Failed to get streak for goal:\", error);\n        return null;\n    }\n}\n\n/**\n * Get calendar data for a goal/habit\n * Integrates with the streak system to provide calendar visualization\n */\nexport async function getGoalCalendar(\n    goalId: string,\n    userId: string,\n    days: number = 90,\n    timezone?: string,\n) {\n    try {\n        const userTimezone =\n            timezone || Intl.DateTimeFormat().resolvedOptions().timeZone;\n        return await streakService.getHabitCalendar(\n            goalId,\n            userId,\n            days,\n            userTimezone,\n        );\n    } catch (error) {\n        console.warn(\"Failed to get calendar for goal:\", error);\n        return [];\n    }\n}\n"],"mappings":"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","ignoreList":[]}