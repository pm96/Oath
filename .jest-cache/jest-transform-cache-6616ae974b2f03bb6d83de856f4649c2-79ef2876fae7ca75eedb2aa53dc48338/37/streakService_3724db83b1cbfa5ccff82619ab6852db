d5e035958f73597a879ba429c67c8576
var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault").default;
Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.streakService = exports.StreakService = void 0;
var _toConsumableArray2 = _interopRequireDefault(require("@babel/runtime/helpers/toConsumableArray"));
var _asyncToGenerator2 = _interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));
var _classCallCheck2 = _interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));
var _createClass2 = _interopRequireDefault(require("@babel/runtime/helpers/createClass"));
var _firestore = require("firebase/firestore");
var _firebaseConfig = require("../../firebaseConfig");
var _habitStreaks = require("../../types/habit-streaks");
var _dateUtils = require("../../utils/dateUtils");
var _errorHandling = require("../../utils/errorHandling");
var _collections = require("./collections");
var _habitStreakSchemas = require("./habitStreakSchemas");
var StreakService = exports.StreakService = function () {
  function StreakService() {
    (0, _classCallCheck2.default)(this, StreakService);
  }
  return (0, _createClass2.default)(StreakService, [{
    key: "calculateStreak",
    value: (function () {
      var _calculateStreak = (0, _asyncToGenerator2.default)(function* (habitId, userId) {
        var _this = this;
        if (!habitId || !userId) {
          throw new Error("Habit ID and User ID are required");
        }
        try {
          return yield (0, _errorHandling.retryWithBackoff)((0, _asyncToGenerator2.default)(function* () {
            return yield (0, _firestore.runTransaction)(_firebaseConfig.db, function () {
              var _ref2 = (0, _asyncToGenerator2.default)(function* (transaction) {
                var streakId = (0, _habitStreakSchemas.generateStreakId)(userId, habitId);
                var streaksCollection = (0, _collections.getHabitStreaksCollection)();
                var streakDocRef = (0, _firestore.doc)(streaksCollection, streakId);
                var streakDoc = yield transaction.get(streakDocRef);
                var completionsCollection = (0, _collections.getHabitCompletionsCollection)();
                var completionsQuery = (0, _firestore.query)(completionsCollection, (0, _firestore.where)("habitId", "==", habitId), (0, _firestore.where)("userId", "==", userId));
                var completionsSnapshot = yield (0, _firestore.getDocs)(completionsQuery);
                var completions = completionsSnapshot.docs.map(function (doc) {
                  return (0, _habitStreakSchemas.transformFirestoreToCompletion)(doc.id, doc.data());
                }).sort(function (a, b) {
                  return a.completedAt.toMillis() - b.completedAt.toMillis();
                });
                var calculatedStreak = _this.calculateStreakFromCompletions(completions, habitId, userId);
                var existingStreak = null;
                if (streakDoc.exists()) {
                  existingStreak = (0, _habitStreakSchemas.transformFirestoreToStreak)(streakDoc.data());
                }
                var updatedStreak = _this.mergeStreakData(calculatedStreak, existingStreak);
                var streakData = (0, _habitStreakSchemas.transformStreakToFirestore)(updatedStreak);
                transaction.set(streakDocRef, streakData);
                return updatedStreak;
              });
              return function (_x3) {
                return _ref2.apply(this, arguments);
              };
            }());
          }));
        } catch (error) {
          var message = (0, _errorHandling.getUserFriendlyErrorMessage)(error);
          throw new Error(`Failed to calculate streak: ${message}`);
        }
      });
      function calculateStreak(_x, _x2) {
        return _calculateStreak.apply(this, arguments);
      }
      return calculateStreak;
    }())
  }, {
    key: "recordCompletion",
    value: (function () {
      var _recordCompletion = (0, _asyncToGenerator2.default)(function* (completion) {
        if (!completion.habitId || !completion.userId) {
          throw new Error("Habit ID and User ID are required");
        }
        var userTimezone = completion.timezone || (0, _dateUtils.getUserTimezone)();
        var completionDateString = (0, _dateUtils.timestampToDateString)(completion.completedAt, userTimezone);
        var currentDateString = (0, _dateUtils.getCurrentDateString)(userTimezone);
        if (completionDateString > currentDateString) {
          throw new Error("Cannot record completions for future dates");
        }
        try {
          return yield (0, _errorHandling.retryWithBackoff)((0, _asyncToGenerator2.default)(function* () {
            return yield (0, _firestore.runTransaction)(_firebaseConfig.db, function () {
              var _ref4 = (0, _asyncToGenerator2.default)(function* (transaction) {
                var completionsCollection = (0, _collections.getHabitCompletionsCollection)();
                var existingCompletionsQuery = (0, _firestore.query)(completionsCollection, (0, _firestore.where)("habitId", "==", completion.habitId), (0, _firestore.where)("userId", "==", completion.userId));
                var existingSnapshot = yield (0, _firestore.getDocs)(existingCompletionsQuery);
                var existingCompletions = existingSnapshot.docs.map(function (doc) {
                  return (0, _habitStreakSchemas.transformFirestoreToCompletion)(doc.id, doc.data());
                }).filter(function (comp) {
                  var compDateString = (0, _dateUtils.timestampToDateString)(comp.completedAt, userTimezone);
                  return compDateString === completionDateString;
                });
                if (existingCompletions.length > 0) {
                  throw new Error("Habit already completed for this date");
                }
                var completionData = {
                  habitId: completion.habitId,
                  userId: completion.userId,
                  completedAt: completion.completedAt,
                  timezone: userTimezone,
                  notes: completion.notes || "",
                  difficulty: completion.difficulty,
                  createdAt: (0, _firestore.serverTimestamp)()
                };
                var completionRef = (0, _firestore.doc)(completionsCollection);
                transaction.set(completionRef, completionData);
                var newCompletion = Object.assign({
                  id: completionRef.id
                }, completion, {
                  timezone: userTimezone
                });
                return newCompletion;
              });
              return function (_x5) {
                return _ref4.apply(this, arguments);
              };
            }());
          }));
        } catch (error) {
          var message = (0, _errorHandling.getUserFriendlyErrorMessage)(error);
          throw new Error(`Failed to record completion: ${message}`);
        }
      });
      function recordCompletion(_x4) {
        return _recordCompletion.apply(this, arguments);
      }
      return recordCompletion;
    }())
  }, {
    key: "useStreakFreeze",
    value: (function () {
      var _useStreakFreeze = (0, _asyncToGenerator2.default)(function* (habitId, userId, missedDate) {
        if (!habitId || !userId || !missedDate) {
          throw new Error("Habit ID, User ID, and missed date are required");
        }
        try {
          return yield (0, _errorHandling.retryWithBackoff)((0, _asyncToGenerator2.default)(function* () {
            return yield (0, _firestore.runTransaction)(_firebaseConfig.db, function () {
              var _ref6 = (0, _asyncToGenerator2.default)(function* (transaction) {
                var streakId = (0, _habitStreakSchemas.generateStreakId)(userId, habitId);
                var streaksCollection = (0, _collections.getHabitStreaksCollection)();
                var streakDocRef = (0, _firestore.doc)(streaksCollection, streakId);
                var streakDoc = yield transaction.get(streakDocRef);
                if (!streakDoc.exists()) {
                  throw new Error("Streak data not found");
                }
                var streak = (0, _habitStreakSchemas.transformFirestoreToStreak)(streakDoc.data());
                if (!(0, _habitStreakSchemas.validateUserOwnership)(userId, streak.userId)) {
                  throw new Error("Unauthorized access to streak data");
                }
                if (streak.freezesAvailable <= 0) {
                  return false;
                }
                var updatedStreak = Object.assign({}, streak, {
                  freezesAvailable: streak.freezesAvailable - 1,
                  freezesUsed: streak.freezesUsed + 1
                });
                var protectedCompletion = {
                  habitId: habitId,
                  userId: userId,
                  completedAt: _firestore.Timestamp.fromDate((0, _dateUtils.parseDateString)(missedDate)),
                  timezone: (0, _dateUtils.getUserTimezone)(),
                  notes: "Protected by streak freeze",
                  difficulty: "easy",
                  createdAt: (0, _firestore.serverTimestamp)()
                };
                var completionsCollection = (0, _collections.getHabitCompletionsCollection)();
                var completionRef = (0, _firestore.doc)(completionsCollection);
                transaction.set(completionRef, protectedCompletion);
                var streakData = (0, _habitStreakSchemas.transformStreakToFirestore)(updatedStreak);
                transaction.set(streakDocRef, streakData);
                return true;
              });
              return function (_x9) {
                return _ref6.apply(this, arguments);
              };
            }());
          }));
        } catch (error) {
          var message = (0, _errorHandling.getUserFriendlyErrorMessage)(error);
          throw new Error(`Failed to use streak freeze: ${message}`);
        }
      });
      function useStreakFreeze(_x6, _x7, _x8) {
        return _useStreakFreeze.apply(this, arguments);
      }
      return useStreakFreeze;
    }())
  }, {
    key: "getHabitCalendar",
    value: (function () {
      var _getHabitCalendar = (0, _asyncToGenerator2.default)(function* (habitId, userId, days, timezone) {
        var _this2 = this;
        if (!habitId || !userId) {
          throw new Error("Habit ID and User ID are required");
        }
        try {
          return yield (0, _errorHandling.retryWithBackoff)((0, _asyncToGenerator2.default)(function* () {
            var endDate = (0, _dateUtils.getCurrentDateString)(timezone);
            var startDate = (0, _dateUtils.formatDateToString)(new Date(Date.now() - (days - 1) * 24 * 60 * 60 * 1000), timezone);
            var completionsCollection = (0, _collections.getHabitCompletionsCollection)();
            var completionsQuery = (0, _firestore.query)(completionsCollection, (0, _firestore.where)("habitId", "==", habitId), (0, _firestore.where)("userId", "==", userId));
            var completionsSnapshot = yield (0, _firestore.getDocs)(completionsQuery);
            var completions = completionsSnapshot.docs.map(function (doc) {
              return (0, _habitStreakSchemas.transformFirestoreToCompletion)(doc.id, doc.data());
            }).filter(function (completion) {
              var compDateString = (0, _dateUtils.timestampToDateString)(completion.completedAt, timezone);
              return compDateString >= startDate && compDateString <= endDate;
            });
            var streak = yield _this2.getHabitStreak(habitId, userId);
            var dateRange = (0, _dateUtils.generateDateRange)(startDate, endDate);
            var calendarDays = dateRange.map(function (date) {
              var completion = completions.find(function (comp) {
                return (0, _dateUtils.timestampToDateString)(comp.completedAt, timezone) === date;
              });
              var isInStreak = _this2.isDateInCurrentStreak(date, streak);
              return {
                date: date,
                completed: !!completion,
                isToday: (0, _dateUtils.isToday)(date, timezone),
                isInStreak: isInStreak,
                completionTime: completion ? completion.completedAt.toDate().toLocaleTimeString() : undefined,
                notes: completion == null ? void 0 : completion.notes
              };
            });
            return calendarDays;
          }));
        } catch (error) {
          var message = (0, _errorHandling.getUserFriendlyErrorMessage)(error);
          throw new Error(`Failed to get habit calendar: ${message}`);
        }
      });
      function getHabitCalendar(_x0, _x1, _x10, _x11) {
        return _getHabitCalendar.apply(this, arguments);
      }
      return getHabitCalendar;
    }())
  }, {
    key: "checkMilestones",
    value: (function () {
      var _checkMilestones = (0, _asyncToGenerator2.default)(function* (streak) {
        var newMilestones = [];
        var existingMilestoneDays = streak.milestones.map(function (m) {
          return m.days;
        });
        for (var milestoneDay of _habitStreaks.MILESTONE_DAYS) {
          if (streak.currentStreak >= milestoneDay && !existingMilestoneDays.includes(milestoneDay)) {
            var milestone = {
              days: milestoneDay,
              achievedAt: _firestore.Timestamp.now(),
              celebrated: false
            };
            newMilestones.push(milestone);
            if (milestoneDay === 30) {
              streak.freezesAvailable += 1;
            }
          }
        }
        if (newMilestones.length > 0) {
          var updatedStreak = Object.assign({}, streak, {
            milestones: [].concat((0, _toConsumableArray2.default)(streak.milestones), newMilestones)
          });
          var streakId = (0, _habitStreakSchemas.generateStreakId)(streak.userId, streak.habitId);
          var streaksCollection = (0, _collections.getHabitStreaksCollection)();
          var streakDocRef = (0, _firestore.doc)(streaksCollection, streakId);
          var streakData = (0, _habitStreakSchemas.transformStreakToFirestore)(updatedStreak);
          yield (0, _firestore.runTransaction)(_firebaseConfig.db, function () {
            var _ref8 = (0, _asyncToGenerator2.default)(function* (transaction) {
              transaction.set(streakDocRef, streakData);
            });
            return function (_x13) {
              return _ref8.apply(this, arguments);
            };
          }());
        }
        return newMilestones;
      });
      function checkMilestones(_x12) {
        return _checkMilestones.apply(this, arguments);
      }
      return checkMilestones;
    }())
  }, {
    key: "getHabitStreak",
    value: (function () {
      var _getHabitStreak = (0, _asyncToGenerator2.default)(function* (habitId, userId) {
        if (!habitId || !userId) {
          throw new Error("Habit ID and User ID are required");
        }
        try {
          var streakId = (0, _habitStreakSchemas.generateStreakId)(userId, habitId);
          var streaksCollection = (0, _collections.getHabitStreaksCollection)();
          var streakDocRef = (0, _firestore.doc)(streaksCollection, streakId);
          var streakDoc = yield (0, _firestore.getDoc)(streakDocRef);
          if (!streakDoc.exists()) {
            return null;
          }
          var streakData = streakDoc.data();
          if (!(0, _habitStreakSchemas.validateStreakDocument)(streakData)) {
            throw new Error("Invalid streak data format");
          }
          return (0, _habitStreakSchemas.transformFirestoreToStreak)(streakData);
        } catch (error) {
          var message = (0, _errorHandling.getUserFriendlyErrorMessage)(error);
          throw new Error(`Failed to get habit streak: ${message}`);
        }
      });
      function getHabitStreak(_x14, _x15) {
        return _getHabitStreak.apply(this, arguments);
      }
      return getHabitStreak;
    }())
  }, {
    key: "initializeHabitStreak",
    value: (function () {
      var _initializeHabitStreak = (0, _asyncToGenerator2.default)(function* (habitId, userId) {
        if (!habitId || !userId) {
          throw new Error("Habit ID and User ID are required");
        }
        var currentDate = (0, _dateUtils.getCurrentDateString)((0, _dateUtils.getUserTimezone)());
        var initialStreak = {
          habitId: habitId,
          userId: userId,
          currentStreak: 0,
          bestStreak: 0,
          lastCompletionDate: "",
          streakStartDate: currentDate,
          freezesAvailable: 0,
          freezesUsed: 0,
          milestones: []
        };
        try {
          var streakId = (0, _habitStreakSchemas.generateStreakId)(userId, habitId);
          var streaksCollection = (0, _collections.getHabitStreaksCollection)();
          var streakDocRef = (0, _firestore.doc)(streaksCollection, streakId);
          var streakData = (0, _habitStreakSchemas.transformStreakToFirestore)(initialStreak);
          yield (0, _firestore.runTransaction)(_firebaseConfig.db, function () {
            var _ref9 = (0, _asyncToGenerator2.default)(function* (transaction) {
              transaction.set(streakDocRef, streakData);
            });
            return function (_x18) {
              return _ref9.apply(this, arguments);
            };
          }());
          return initialStreak;
        } catch (error) {
          var message = (0, _errorHandling.getUserFriendlyErrorMessage)(error);
          throw new Error(`Failed to initialize habit streak: ${message}`);
        }
      });
      function initializeHabitStreak(_x16, _x17) {
        return _initializeHabitStreak.apply(this, arguments);
      }
      return initializeHabitStreak;
    }())
  }, {
    key: "resetStreak",
    value: (function () {
      var _resetStreak = (0, _asyncToGenerator2.default)(function* (habitId, userId, resetDate) {
        if (!habitId || !userId || !resetDate) {
          throw new Error("Habit ID, User ID, and reset date are required");
        }
        try {
          return yield (0, _errorHandling.retryWithBackoff)((0, _asyncToGenerator2.default)(function* () {
            return yield (0, _firestore.runTransaction)(_firebaseConfig.db, function () {
              var _ref1 = (0, _asyncToGenerator2.default)(function* (transaction) {
                var streakId = (0, _habitStreakSchemas.generateStreakId)(userId, habitId);
                var streaksCollection = (0, _collections.getHabitStreaksCollection)();
                var streakDocRef = (0, _firestore.doc)(streaksCollection, streakId);
                var streakDoc = yield transaction.get(streakDocRef);
                if (!streakDoc.exists()) {
                  throw new Error("Streak data not found");
                }
                var streak = (0, _habitStreakSchemas.transformFirestoreToStreak)(streakDoc.data());
                if (!(0, _habitStreakSchemas.validateUserOwnership)(userId, streak.userId)) {
                  throw new Error("Unauthorized access to streak data");
                }
                var resetStreak = Object.assign({}, streak, {
                  currentStreak: 0,
                  lastCompletionDate: "",
                  streakStartDate: resetDate
                });
                var streakData = (0, _habitStreakSchemas.transformStreakToFirestore)(resetStreak);
                transaction.set(streakDocRef, streakData);
                return resetStreak;
              });
              return function (_x22) {
                return _ref1.apply(this, arguments);
              };
            }());
          }));
        } catch (error) {
          var message = (0, _errorHandling.getUserFriendlyErrorMessage)(error);
          throw new Error(`Failed to reset streak: ${message}`);
        }
      });
      function resetStreak(_x19, _x20, _x21) {
        return _resetStreak.apply(this, arguments);
      }
      return resetStreak;
    }())
  }, {
    key: "calculateStreakFromCompletions",
    value: function calculateStreakFromCompletions(completions, habitId, userId) {
      var _completions$;
      if (completions.length === 0) {
        return {
          habitId: habitId,
          userId: userId,
          currentStreak: 0,
          bestStreak: 0,
          lastCompletionDate: "",
          streakStartDate: (0, _dateUtils.getCurrentDateString)((0, _dateUtils.getUserTimezone)()),
          freezesAvailable: 0,
          freezesUsed: 0,
          milestones: []
        };
      }
      var timezone = ((_completions$ = completions[0]) == null ? void 0 : _completions$.timezone) || (0, _dateUtils.getUserTimezone)();
      var completionDates = completions.map(function (comp) {
        return (0, _dateUtils.timestampToDateString)(comp.completedAt, timezone);
      });
      var uniqueDates = (0, _toConsumableArray2.default)(new Set(completionDates)).sort();
      var currentStreak = 0;
      var streakStartDate = "";
      var today = (0, _dateUtils.getCurrentDateString)(timezone);
      var yesterday = (0, _dateUtils.formatDateToString)(new Date(Date.now() - 24 * 60 * 60 * 1000), timezone);
      var lastCompletionDate = uniqueDates[uniqueDates.length - 1];
      if (lastCompletionDate === today || lastCompletionDate === yesterday) {
        currentStreak = 1;
        streakStartDate = lastCompletionDate;
        for (var i = uniqueDates.length - 2; i >= 0; i--) {
          var currentDate = uniqueDates[i + 1];
          var previousDate = uniqueDates[i];
          if ((0, _dateUtils.areConsecutiveDays)(previousDate, currentDate)) {
            currentStreak++;
            streakStartDate = previousDate;
          } else {
            break;
          }
        }
      }
      var bestStreak = 0;
      var tempStreak = 1;
      for (var _i = 1; _i < uniqueDates.length; _i++) {
        if ((0, _dateUtils.areConsecutiveDays)(uniqueDates[_i - 1], uniqueDates[_i])) {
          tempStreak++;
        } else {
          bestStreak = Math.max(bestStreak, tempStreak);
          tempStreak = 1;
        }
      }
      bestStreak = Math.max(bestStreak, tempStreak, currentStreak);
      return {
        habitId: habitId,
        userId: userId,
        currentStreak: currentStreak,
        bestStreak: bestStreak,
        lastCompletionDate: lastCompletionDate,
        streakStartDate: streakStartDate,
        freezesAvailable: 0,
        freezesUsed: 0,
        milestones: []
      };
    }
  }, {
    key: "mergeStreakData",
    value: function mergeStreakData(calculated, existing) {
      if (!existing) {
        return calculated;
      }
      return Object.assign({}, calculated, {
        freezesAvailable: existing.freezesAvailable,
        freezesUsed: existing.freezesUsed,
        milestones: existing.milestones,
        bestStreak: Math.max(calculated.bestStreak, existing.bestStreak)
      });
    }
  }, {
    key: "isDateInCurrentStreak",
    value: function isDateInCurrentStreak(date, streak) {
      if (!streak || streak.currentStreak === 0 || !streak.streakStartDate) {
        return false;
      }
      var streakStart = (0, _dateUtils.parseDateString)(streak.streakStartDate);
      var checkDate = (0, _dateUtils.parseDateString)(date);
      var streakEnd = new Date(streakStart);
      streakEnd.setDate(streakEnd.getDate() + streak.currentStreak - 1);
      return checkDate >= streakStart && checkDate <= streakEnd;
    }
  }]);
}();
var streakService = exports.streakService = new StreakService();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfZmlyZXN0b3JlIiwicmVxdWlyZSIsIl9maXJlYmFzZUNvbmZpZyIsIl9oYWJpdFN0cmVha3MiLCJfZGF0ZVV0aWxzIiwiX2Vycm9ySGFuZGxpbmciLCJfY29sbGVjdGlvbnMiLCJfaGFiaXRTdHJlYWtTY2hlbWFzIiwiU3RyZWFrU2VydmljZSIsImV4cG9ydHMiLCJfY2xhc3NDYWxsQ2hlY2syIiwiZGVmYXVsdCIsIl9jcmVhdGVDbGFzczIiLCJrZXkiLCJ2YWx1ZSIsIl9jYWxjdWxhdGVTdHJlYWsiLCJfYXN5bmNUb0dlbmVyYXRvcjIiLCJoYWJpdElkIiwidXNlcklkIiwiX3RoaXMiLCJFcnJvciIsInJldHJ5V2l0aEJhY2tvZmYiLCJydW5UcmFuc2FjdGlvbiIsImRiIiwiX3JlZjIiLCJ0cmFuc2FjdGlvbiIsInN0cmVha0lkIiwiZ2VuZXJhdGVTdHJlYWtJZCIsInN0cmVha3NDb2xsZWN0aW9uIiwiZ2V0SGFiaXRTdHJlYWtzQ29sbGVjdGlvbiIsInN0cmVha0RvY1JlZiIsImRvYyIsInN0cmVha0RvYyIsImdldCIsImNvbXBsZXRpb25zQ29sbGVjdGlvbiIsImdldEhhYml0Q29tcGxldGlvbnNDb2xsZWN0aW9uIiwiY29tcGxldGlvbnNRdWVyeSIsInF1ZXJ5Iiwid2hlcmUiLCJjb21wbGV0aW9uc1NuYXBzaG90IiwiZ2V0RG9jcyIsImNvbXBsZXRpb25zIiwiZG9jcyIsIm1hcCIsInRyYW5zZm9ybUZpcmVzdG9yZVRvQ29tcGxldGlvbiIsImlkIiwiZGF0YSIsInNvcnQiLCJhIiwiYiIsImNvbXBsZXRlZEF0IiwidG9NaWxsaXMiLCJjYWxjdWxhdGVkU3RyZWFrIiwiY2FsY3VsYXRlU3RyZWFrRnJvbUNvbXBsZXRpb25zIiwiZXhpc3RpbmdTdHJlYWsiLCJleGlzdHMiLCJ0cmFuc2Zvcm1GaXJlc3RvcmVUb1N0cmVhayIsInVwZGF0ZWRTdHJlYWsiLCJtZXJnZVN0cmVha0RhdGEiLCJzdHJlYWtEYXRhIiwidHJhbnNmb3JtU3RyZWFrVG9GaXJlc3RvcmUiLCJzZXQiLCJfeDMiLCJhcHBseSIsImFyZ3VtZW50cyIsImVycm9yIiwibWVzc2FnZSIsImdldFVzZXJGcmllbmRseUVycm9yTWVzc2FnZSIsImNhbGN1bGF0ZVN0cmVhayIsIl94IiwiX3gyIiwiX3JlY29yZENvbXBsZXRpb24iLCJjb21wbGV0aW9uIiwidXNlclRpbWV6b25lIiwidGltZXpvbmUiLCJnZXRVc2VyVGltZXpvbmUiLCJjb21wbGV0aW9uRGF0ZVN0cmluZyIsInRpbWVzdGFtcFRvRGF0ZVN0cmluZyIsImN1cnJlbnREYXRlU3RyaW5nIiwiZ2V0Q3VycmVudERhdGVTdHJpbmciLCJfcmVmNCIsImV4aXN0aW5nQ29tcGxldGlvbnNRdWVyeSIsImV4aXN0aW5nU25hcHNob3QiLCJleGlzdGluZ0NvbXBsZXRpb25zIiwiZmlsdGVyIiwiY29tcCIsImNvbXBEYXRlU3RyaW5nIiwibGVuZ3RoIiwiY29tcGxldGlvbkRhdGEiLCJub3RlcyIsImRpZmZpY3VsdHkiLCJjcmVhdGVkQXQiLCJzZXJ2ZXJUaW1lc3RhbXAiLCJjb21wbGV0aW9uUmVmIiwibmV3Q29tcGxldGlvbiIsIk9iamVjdCIsImFzc2lnbiIsIl94NSIsInJlY29yZENvbXBsZXRpb24iLCJfeDQiLCJfdXNlU3RyZWFrRnJlZXplIiwibWlzc2VkRGF0ZSIsIl9yZWY2Iiwic3RyZWFrIiwidmFsaWRhdGVVc2VyT3duZXJzaGlwIiwiZnJlZXplc0F2YWlsYWJsZSIsImZyZWV6ZXNVc2VkIiwicHJvdGVjdGVkQ29tcGxldGlvbiIsIlRpbWVzdGFtcCIsImZyb21EYXRlIiwicGFyc2VEYXRlU3RyaW5nIiwiX3g5IiwidXNlU3RyZWFrRnJlZXplIiwiX3g2IiwiX3g3IiwiX3g4IiwiX2dldEhhYml0Q2FsZW5kYXIiLCJkYXlzIiwiX3RoaXMyIiwiZW5kRGF0ZSIsInN0YXJ0RGF0ZSIsImZvcm1hdERhdGVUb1N0cmluZyIsIkRhdGUiLCJub3ciLCJnZXRIYWJpdFN0cmVhayIsImRhdGVSYW5nZSIsImdlbmVyYXRlRGF0ZVJhbmdlIiwiY2FsZW5kYXJEYXlzIiwiZGF0ZSIsImZpbmQiLCJpc0luU3RyZWFrIiwiaXNEYXRlSW5DdXJyZW50U3RyZWFrIiwiY29tcGxldGVkIiwiaXNUb2RheSIsImNvbXBsZXRpb25UaW1lIiwidG9EYXRlIiwidG9Mb2NhbGVUaW1lU3RyaW5nIiwidW5kZWZpbmVkIiwiZ2V0SGFiaXRDYWxlbmRhciIsIl94MCIsIl94MSIsIl94MTAiLCJfeDExIiwiX2NoZWNrTWlsZXN0b25lcyIsIm5ld01pbGVzdG9uZXMiLCJleGlzdGluZ01pbGVzdG9uZURheXMiLCJtaWxlc3RvbmVzIiwibSIsIm1pbGVzdG9uZURheSIsIk1JTEVTVE9ORV9EQVlTIiwiY3VycmVudFN0cmVhayIsImluY2x1ZGVzIiwibWlsZXN0b25lIiwiYWNoaWV2ZWRBdCIsImNlbGVicmF0ZWQiLCJwdXNoIiwiY29uY2F0IiwiX3RvQ29uc3VtYWJsZUFycmF5MiIsIl9yZWY4IiwiX3gxMyIsImNoZWNrTWlsZXN0b25lcyIsIl94MTIiLCJfZ2V0SGFiaXRTdHJlYWsiLCJnZXREb2MiLCJ2YWxpZGF0ZVN0cmVha0RvY3VtZW50IiwiX3gxNCIsIl94MTUiLCJfaW5pdGlhbGl6ZUhhYml0U3RyZWFrIiwiY3VycmVudERhdGUiLCJpbml0aWFsU3RyZWFrIiwiYmVzdFN0cmVhayIsImxhc3RDb21wbGV0aW9uRGF0ZSIsInN0cmVha1N0YXJ0RGF0ZSIsIl9yZWY5IiwiX3gxOCIsImluaXRpYWxpemVIYWJpdFN0cmVhayIsIl94MTYiLCJfeDE3IiwiX3Jlc2V0U3RyZWFrIiwicmVzZXREYXRlIiwiX3JlZjEiLCJyZXNldFN0cmVhayIsIl94MjIiLCJfeDE5IiwiX3gyMCIsIl94MjEiLCJfY29tcGxldGlvbnMkIiwiY29tcGxldGlvbkRhdGVzIiwidW5pcXVlRGF0ZXMiLCJTZXQiLCJ0b2RheSIsInllc3RlcmRheSIsImkiLCJwcmV2aW91c0RhdGUiLCJhcmVDb25zZWN1dGl2ZURheXMiLCJ0ZW1wU3RyZWFrIiwiTWF0aCIsIm1heCIsImNhbGN1bGF0ZWQiLCJleGlzdGluZyIsInN0cmVha1N0YXJ0IiwiY2hlY2tEYXRlIiwic3RyZWFrRW5kIiwic2V0RGF0ZSIsImdldERhdGUiLCJzdHJlYWtTZXJ2aWNlIl0sInNvdXJjZXMiOlsic3RyZWFrU2VydmljZS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xuICAgIGRvYyxcbiAgICBnZXREb2MsXG4gICAgZ2V0RG9jcyxcbiAgICBxdWVyeSxcbiAgICBydW5UcmFuc2FjdGlvbixcbiAgICBzZXJ2ZXJUaW1lc3RhbXAsXG4gICAgVGltZXN0YW1wLFxuICAgIHdoZXJlLFxufSBmcm9tIFwiZmlyZWJhc2UvZmlyZXN0b3JlXCI7XG5pbXBvcnQgeyBkYiB9IGZyb20gXCIuLi8uLi9maXJlYmFzZUNvbmZpZ1wiO1xuaW1wb3J0IHtcbiAgICBDYWxlbmRhckRheSxcbiAgICBIYWJpdENvbXBsZXRpb24sXG4gICAgSGFiaXRTdHJlYWssXG4gICAgTUlMRVNUT05FX0RBWVMsXG4gICAgU3RyZWFrTWlsZXN0b25lLFxufSBmcm9tIFwiLi4vLi4vdHlwZXMvaGFiaXQtc3RyZWFrc1wiO1xuaW1wb3J0IHtcbiAgICBhcmVDb25zZWN1dGl2ZURheXMsXG4gICAgZm9ybWF0RGF0ZVRvU3RyaW5nLFxuICAgIGdlbmVyYXRlRGF0ZVJhbmdlLFxuICAgIGdldEN1cnJlbnREYXRlU3RyaW5nLFxuICAgIGdldFVzZXJUaW1lem9uZSxcbiAgICBpc1RvZGF5LFxuICAgIHBhcnNlRGF0ZVN0cmluZyxcbiAgICB0aW1lc3RhbXBUb0RhdGVTdHJpbmcsXG59IGZyb20gXCIuLi8uLi91dGlscy9kYXRlVXRpbHNcIjtcbmltcG9ydCB7XG4gICAgZ2V0VXNlckZyaWVuZGx5RXJyb3JNZXNzYWdlLFxuICAgIHJldHJ5V2l0aEJhY2tvZmYsXG59IGZyb20gXCIuLi8uLi91dGlscy9lcnJvckhhbmRsaW5nXCI7XG5pbXBvcnQge1xuICAgIGdldEhhYml0Q29tcGxldGlvbnNDb2xsZWN0aW9uLFxuICAgIGdldEhhYml0U3RyZWFrc0NvbGxlY3Rpb24sXG59IGZyb20gXCIuL2NvbGxlY3Rpb25zXCI7XG5pbXBvcnQgeyBTdHJlYWtTZXJ2aWNlIGFzIElTdHJlYWtTZXJ2aWNlIH0gZnJvbSBcIi4vaGFiaXRTdHJlYWtJbnRlcmZhY2VzXCI7XG5pbXBvcnQge1xuICAgIGdlbmVyYXRlU3RyZWFrSWQsXG4gICAgdHJhbnNmb3JtRmlyZXN0b3JlVG9Db21wbGV0aW9uLFxuICAgIHRyYW5zZm9ybUZpcmVzdG9yZVRvU3RyZWFrLFxuICAgIHRyYW5zZm9ybVN0cmVha1RvRmlyZXN0b3JlLFxuICAgIHZhbGlkYXRlU3RyZWFrRG9jdW1lbnQsXG4gICAgdmFsaWRhdGVVc2VyT3duZXJzaGlwXG59IGZyb20gXCIuL2hhYml0U3RyZWFrU2NoZW1hc1wiO1xuXG4vKipcbiAqIFN0cmVha1NlcnZpY2UgSW1wbGVtZW50YXRpb25cbiAqXG4gKiBIYW5kbGVzIGFsbCBzdHJlYWsgY2FsY3VsYXRpb24sIHRyYWNraW5nLCBhbmQgbWFuYWdlbWVudCBmdW5jdGlvbmFsaXR5XG4gKiB3aXRoIHRpbWV6b25lIGF3YXJlbmVzcyBhbmQgZGF0YSBpbnRlZ3JpdHkgcHJvdGVjdGlvbi5cbiAqL1xuZXhwb3J0IGNsYXNzIFN0cmVha1NlcnZpY2UgaW1wbGVtZW50cyBJU3RyZWFrU2VydmljZSB7XG4gICAgLyoqXG4gICAgICogQ2FsY3VsYXRlIGFuZCB1cGRhdGUgc3RyZWFrIGluZm9ybWF0aW9uIGZvciBhIGhhYml0XG4gICAgICogUmVxdWlyZW1lbnRzOiAxLjEsIDEuMiwgMS4zXG4gICAgICovXG4gICAgYXN5bmMgY2FsY3VsYXRlU3RyZWFrKGhhYml0SWQ6IHN0cmluZywgdXNlcklkOiBzdHJpbmcpOiBQcm9taXNlPEhhYml0U3RyZWFrPiB7XG4gICAgICAgIGlmICghaGFiaXRJZCB8fCAhdXNlcklkKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJIYWJpdCBJRCBhbmQgVXNlciBJRCBhcmUgcmVxdWlyZWRcIik7XG4gICAgICAgIH1cblxuICAgICAgICB0cnkge1xuICAgICAgICAgICAgcmV0dXJuIGF3YWl0IHJldHJ5V2l0aEJhY2tvZmYoYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgICAgIHJldHVybiBhd2FpdCBydW5UcmFuc2FjdGlvbihkYiwgYXN5bmMgKHRyYW5zYWN0aW9uKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIC8vIEdldCBjdXJyZW50IHN0cmVhayBkYXRhXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHN0cmVha0lkID0gZ2VuZXJhdGVTdHJlYWtJZCh1c2VySWQsIGhhYml0SWQpO1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBzdHJlYWtzQ29sbGVjdGlvbiA9IGdldEhhYml0U3RyZWFrc0NvbGxlY3Rpb24oKTtcbiAgICAgICAgICAgICAgICAgICAgY29uc3Qgc3RyZWFrRG9jUmVmID0gZG9jKHN0cmVha3NDb2xsZWN0aW9uLCBzdHJlYWtJZCk7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHN0cmVha0RvYyA9IGF3YWl0IHRyYW5zYWN0aW9uLmdldChzdHJlYWtEb2NSZWYpO1xuXG4gICAgICAgICAgICAgICAgICAgIC8vIEdldCBhbGwgY29tcGxldGlvbnMgZm9yIHRoaXMgaGFiaXRcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgY29tcGxldGlvbnNDb2xsZWN0aW9uID0gZ2V0SGFiaXRDb21wbGV0aW9uc0NvbGxlY3Rpb24oKTtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgY29tcGxldGlvbnNRdWVyeSA9IHF1ZXJ5KFxuICAgICAgICAgICAgICAgICAgICAgICAgY29tcGxldGlvbnNDb2xsZWN0aW9uLFxuICAgICAgICAgICAgICAgICAgICAgICAgd2hlcmUoXCJoYWJpdElkXCIsIFwiPT1cIiwgaGFiaXRJZCksXG4gICAgICAgICAgICAgICAgICAgICAgICB3aGVyZShcInVzZXJJZFwiLCBcIj09XCIsIHVzZXJJZCksXG4gICAgICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGNvbXBsZXRpb25zU25hcHNob3QgPSBhd2FpdCBnZXREb2NzKGNvbXBsZXRpb25zUXVlcnkpO1xuXG4gICAgICAgICAgICAgICAgICAgIC8vIFRyYW5zZm9ybSBjb21wbGV0aW9ucyBhbmQgc29ydCBieSBkYXRlXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGNvbXBsZXRpb25zID0gY29tcGxldGlvbnNTbmFwc2hvdC5kb2NzXG4gICAgICAgICAgICAgICAgICAgICAgICAubWFwKChkb2MpID0+IHRyYW5zZm9ybUZpcmVzdG9yZVRvQ29tcGxldGlvbihkb2MuaWQsIGRvYy5kYXRhKCkpKVxuICAgICAgICAgICAgICAgICAgICAgICAgLnNvcnQoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgKGEsIGIpID0+IGEuY29tcGxldGVkQXQudG9NaWxsaXMoKSAtIGIuY29tcGxldGVkQXQudG9NaWxsaXMoKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICk7XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gQ2FsY3VsYXRlIHN0cmVhayBmcm9tIGNvbXBsZXRpb25zXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGNhbGN1bGF0ZWRTdHJlYWsgPSB0aGlzLmNhbGN1bGF0ZVN0cmVha0Zyb21Db21wbGV0aW9ucyhcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbXBsZXRpb25zLFxuICAgICAgICAgICAgICAgICAgICAgICAgaGFiaXRJZCxcbiAgICAgICAgICAgICAgICAgICAgICAgIHVzZXJJZCxcbiAgICAgICAgICAgICAgICAgICAgKTtcblxuICAgICAgICAgICAgICAgICAgICAvLyBNZXJnZSB3aXRoIGV4aXN0aW5nIGRhdGEgaWYgYXZhaWxhYmxlXG4gICAgICAgICAgICAgICAgICAgIGxldCBleGlzdGluZ1N0cmVhazogSGFiaXRTdHJlYWsgfCBudWxsID0gbnVsbDtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHN0cmVha0RvYy5leGlzdHMoKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgZXhpc3RpbmdTdHJlYWsgPSB0cmFuc2Zvcm1GaXJlc3RvcmVUb1N0cmVhayhzdHJlYWtEb2MuZGF0YSgpKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHVwZGF0ZWRTdHJlYWsgPSB0aGlzLm1lcmdlU3RyZWFrRGF0YShcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhbGN1bGF0ZWRTdHJlYWssXG4gICAgICAgICAgICAgICAgICAgICAgICBleGlzdGluZ1N0cmVhayxcbiAgICAgICAgICAgICAgICAgICAgKTtcblxuICAgICAgICAgICAgICAgICAgICAvLyBTYXZlIHVwZGF0ZWQgc3RyZWFrXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHN0cmVha0RhdGEgPSB0cmFuc2Zvcm1TdHJlYWtUb0ZpcmVzdG9yZSh1cGRhdGVkU3RyZWFrKTtcbiAgICAgICAgICAgICAgICAgICAgdHJhbnNhY3Rpb24uc2V0KHN0cmVha0RvY1JlZiwgc3RyZWFrRGF0YSk7XG5cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVwZGF0ZWRTdHJlYWs7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgIGNvbnN0IG1lc3NhZ2UgPSBnZXRVc2VyRnJpZW5kbHlFcnJvck1lc3NhZ2UoZXJyb3IpO1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBGYWlsZWQgdG8gY2FsY3VsYXRlIHN0cmVhazogJHttZXNzYWdlfWApO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogUmVjb3JkIGEgbmV3IGhhYml0IGNvbXBsZXRpb24gYW5kIHVwZGF0ZSBzdHJlYWtcbiAgICAgKiBSZXF1aXJlbWVudHM6IDUuMSwgMTIuMVxuICAgICAqL1xuICAgIGFzeW5jIHJlY29yZENvbXBsZXRpb24oXG4gICAgICAgIGNvbXBsZXRpb246IE9taXQ8SGFiaXRDb21wbGV0aW9uLCBcImlkXCI+LFxuICAgICk6IFByb21pc2U8SGFiaXRDb21wbGV0aW9uPiB7XG4gICAgICAgIGlmICghY29tcGxldGlvbi5oYWJpdElkIHx8ICFjb21wbGV0aW9uLnVzZXJJZCkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiSGFiaXQgSUQgYW5kIFVzZXIgSUQgYXJlIHJlcXVpcmVkXCIpO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gVmFsaWRhdGUgdGltZXpvbmUtYXdhcmUgY29tcGxldGlvblxuICAgICAgICBjb25zdCB1c2VyVGltZXpvbmUgPSBjb21wbGV0aW9uLnRpbWV6b25lIHx8IGdldFVzZXJUaW1lem9uZSgpO1xuICAgICAgICBjb25zdCBjb21wbGV0aW9uRGF0ZVN0cmluZyA9IHRpbWVzdGFtcFRvRGF0ZVN0cmluZyhcbiAgICAgICAgICAgIGNvbXBsZXRpb24uY29tcGxldGVkQXQsXG4gICAgICAgICAgICB1c2VyVGltZXpvbmUsXG4gICAgICAgICk7XG4gICAgICAgIGNvbnN0IGN1cnJlbnREYXRlU3RyaW5nID0gZ2V0Q3VycmVudERhdGVTdHJpbmcodXNlclRpbWV6b25lKTtcblxuICAgICAgICAvLyBFbnN1cmUgY29tcGxldGlvbiBpcyBmb3IgY3VycmVudCBkYXkgb3IgZWFybGllciAocHJldmVudCBmdXR1cmUgY29tcGxldGlvbnMpXG4gICAgICAgIGlmIChjb21wbGV0aW9uRGF0ZVN0cmluZyA+IGN1cnJlbnREYXRlU3RyaW5nKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJDYW5ub3QgcmVjb3JkIGNvbXBsZXRpb25zIGZvciBmdXR1cmUgZGF0ZXNcIik7XG4gICAgICAgIH1cblxuICAgICAgICB0cnkge1xuICAgICAgICAgICAgcmV0dXJuIGF3YWl0IHJldHJ5V2l0aEJhY2tvZmYoYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgICAgIHJldHVybiBhd2FpdCBydW5UcmFuc2FjdGlvbihkYiwgYXN5bmMgKHRyYW5zYWN0aW9uKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIC8vIENoZWNrIGZvciBleGlzdGluZyBjb21wbGV0aW9uIG9uIHRoZSBzYW1lIGRhdGVcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgY29tcGxldGlvbnNDb2xsZWN0aW9uID0gZ2V0SGFiaXRDb21wbGV0aW9uc0NvbGxlY3Rpb24oKTtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgZXhpc3RpbmdDb21wbGV0aW9uc1F1ZXJ5ID0gcXVlcnkoXG4gICAgICAgICAgICAgICAgICAgICAgICBjb21wbGV0aW9uc0NvbGxlY3Rpb24sXG4gICAgICAgICAgICAgICAgICAgICAgICB3aGVyZShcImhhYml0SWRcIiwgXCI9PVwiLCBjb21wbGV0aW9uLmhhYml0SWQpLFxuICAgICAgICAgICAgICAgICAgICAgICAgd2hlcmUoXCJ1c2VySWRcIiwgXCI9PVwiLCBjb21wbGV0aW9uLnVzZXJJZCksXG4gICAgICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGV4aXN0aW5nU25hcHNob3QgPSBhd2FpdCBnZXREb2NzKGV4aXN0aW5nQ29tcGxldGlvbnNRdWVyeSk7XG5cbiAgICAgICAgICAgICAgICAgICAgY29uc3QgZXhpc3RpbmdDb21wbGV0aW9ucyA9IGV4aXN0aW5nU25hcHNob3QuZG9jc1xuICAgICAgICAgICAgICAgICAgICAgICAgLm1hcCgoZG9jKSA9PiB0cmFuc2Zvcm1GaXJlc3RvcmVUb0NvbXBsZXRpb24oZG9jLmlkLCBkb2MuZGF0YSgpKSlcbiAgICAgICAgICAgICAgICAgICAgICAgIC5maWx0ZXIoKGNvbXApID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBjb21wRGF0ZVN0cmluZyA9IHRpbWVzdGFtcFRvRGF0ZVN0cmluZyhcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29tcC5jb21wbGV0ZWRBdCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdXNlclRpbWV6b25lLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNvbXBEYXRlU3RyaW5nID09PSBjb21wbGV0aW9uRGF0ZVN0cmluZztcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgICAgIGlmIChleGlzdGluZ0NvbXBsZXRpb25zLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkhhYml0IGFscmVhZHkgY29tcGxldGVkIGZvciB0aGlzIGRhdGVcIik7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAvLyBDcmVhdGUgY29tcGxldGlvbiByZWNvcmQgd2l0aCBtZXRhZGF0YVxuICAgICAgICAgICAgICAgICAgICBjb25zdCBjb21wbGV0aW9uRGF0YSA9IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGhhYml0SWQ6IGNvbXBsZXRpb24uaGFiaXRJZCxcbiAgICAgICAgICAgICAgICAgICAgICAgIHVzZXJJZDogY29tcGxldGlvbi51c2VySWQsXG4gICAgICAgICAgICAgICAgICAgICAgICBjb21wbGV0ZWRBdDogY29tcGxldGlvbi5jb21wbGV0ZWRBdCxcbiAgICAgICAgICAgICAgICAgICAgICAgIHRpbWV6b25lOiB1c2VyVGltZXpvbmUsXG4gICAgICAgICAgICAgICAgICAgICAgICBub3RlczogY29tcGxldGlvbi5ub3RlcyB8fCBcIlwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgZGlmZmljdWx0eTogY29tcGxldGlvbi5kaWZmaWN1bHR5LFxuICAgICAgICAgICAgICAgICAgICAgICAgY3JlYXRlZEF0OiBzZXJ2ZXJUaW1lc3RhbXAoKSxcbiAgICAgICAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgICAgICAgICBjb25zdCBjb21wbGV0aW9uUmVmID0gZG9jKGNvbXBsZXRpb25zQ29sbGVjdGlvbik7XG4gICAgICAgICAgICAgICAgICAgIHRyYW5zYWN0aW9uLnNldChjb21wbGV0aW9uUmVmLCBjb21wbGV0aW9uRGF0YSk7XG5cbiAgICAgICAgICAgICAgICAgICAgY29uc3QgbmV3Q29tcGxldGlvbjogSGFiaXRDb21wbGV0aW9uID0ge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWQ6IGNvbXBsZXRpb25SZWYuaWQsXG4gICAgICAgICAgICAgICAgICAgICAgICAuLi5jb21wbGV0aW9uLFxuICAgICAgICAgICAgICAgICAgICAgICAgdGltZXpvbmU6IHVzZXJUaW1lem9uZSxcbiAgICAgICAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmV3Q29tcGxldGlvbjtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgY29uc3QgbWVzc2FnZSA9IGdldFVzZXJGcmllbmRseUVycm9yTWVzc2FnZShlcnJvcik7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYEZhaWxlZCB0byByZWNvcmQgY29tcGxldGlvbjogJHttZXNzYWdlfWApO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogVXNlIGEgc3RyZWFrIGZyZWV6ZSB0byBwcm90ZWN0IGZyb20gYSBtaXNzZWQgZGF5XG4gICAgICogUmVxdWlyZW1lbnRzOiA0LjEsIDQuMiwgNC41XG4gICAgICovXG4gICAgYXN5bmMgdXNlU3RyZWFrRnJlZXplKFxuICAgICAgICBoYWJpdElkOiBzdHJpbmcsXG4gICAgICAgIHVzZXJJZDogc3RyaW5nLFxuICAgICAgICBtaXNzZWREYXRlOiBzdHJpbmcsXG4gICAgKTogUHJvbWlzZTxib29sZWFuPiB7XG4gICAgICAgIGlmICghaGFiaXRJZCB8fCAhdXNlcklkIHx8ICFtaXNzZWREYXRlKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJIYWJpdCBJRCwgVXNlciBJRCwgYW5kIG1pc3NlZCBkYXRlIGFyZSByZXF1aXJlZFwiKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICByZXR1cm4gYXdhaXQgcmV0cnlXaXRoQmFja29mZihhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGF3YWl0IHJ1blRyYW5zYWN0aW9uKGRiLCBhc3luYyAodHJhbnNhY3Rpb24pID0+IHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3Qgc3RyZWFrSWQgPSBnZW5lcmF0ZVN0cmVha0lkKHVzZXJJZCwgaGFiaXRJZCk7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHN0cmVha3NDb2xsZWN0aW9uID0gZ2V0SGFiaXRTdHJlYWtzQ29sbGVjdGlvbigpO1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBzdHJlYWtEb2NSZWYgPSBkb2Moc3RyZWFrc0NvbGxlY3Rpb24sIHN0cmVha0lkKTtcbiAgICAgICAgICAgICAgICAgICAgY29uc3Qgc3RyZWFrRG9jID0gYXdhaXQgdHJhbnNhY3Rpb24uZ2V0KHN0cmVha0RvY1JlZik7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKCFzdHJlYWtEb2MuZXhpc3RzKCkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIlN0cmVhayBkYXRhIG5vdCBmb3VuZFwiKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHN0cmVhayA9IHRyYW5zZm9ybUZpcmVzdG9yZVRvU3RyZWFrKHN0cmVha0RvYy5kYXRhKCkpO1xuXG4gICAgICAgICAgICAgICAgICAgIC8vIFZhbGlkYXRlIHVzZXIgb3duZXJzaGlwXG4gICAgICAgICAgICAgICAgICAgIGlmICghdmFsaWRhdGVVc2VyT3duZXJzaGlwKHVzZXJJZCwgc3RyZWFrLnVzZXJJZCkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIlVuYXV0aG9yaXplZCBhY2Nlc3MgdG8gc3RyZWFrIGRhdGFcIik7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAvLyBDaGVjayBpZiBmcmVlemUgaXMgYXZhaWxhYmxlXG4gICAgICAgICAgICAgICAgICAgIGlmIChzdHJlYWsuZnJlZXplc0F2YWlsYWJsZSA8PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAvLyBVc2UgdGhlIGZyZWV6ZVxuICAgICAgICAgICAgICAgICAgICBjb25zdCB1cGRhdGVkU3RyZWFrOiBIYWJpdFN0cmVhayA9IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIC4uLnN0cmVhayxcbiAgICAgICAgICAgICAgICAgICAgICAgIGZyZWV6ZXNBdmFpbGFibGU6IHN0cmVhay5mcmVlemVzQXZhaWxhYmxlIC0gMSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGZyZWV6ZXNVc2VkOiBzdHJlYWsuZnJlZXplc1VzZWQgKyAxLFxuICAgICAgICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAgICAgICAgIC8vIENyZWF0ZSBhIFwicHJvdGVjdGVkXCIgY29tcGxldGlvbiByZWNvcmQgZm9yIHRoZSBtaXNzZWQgZGF0ZVxuICAgICAgICAgICAgICAgICAgICBjb25zdCBwcm90ZWN0ZWRDb21wbGV0aW9uID0ge1xuICAgICAgICAgICAgICAgICAgICAgICAgaGFiaXRJZCxcbiAgICAgICAgICAgICAgICAgICAgICAgIHVzZXJJZCxcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbXBsZXRlZEF0OiBUaW1lc3RhbXAuZnJvbURhdGUocGFyc2VEYXRlU3RyaW5nKG1pc3NlZERhdGUpKSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHRpbWV6b25lOiBnZXRVc2VyVGltZXpvbmUoKSxcbiAgICAgICAgICAgICAgICAgICAgICAgIG5vdGVzOiBcIlByb3RlY3RlZCBieSBzdHJlYWsgZnJlZXplXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICBkaWZmaWN1bHR5OiBcImVhc3lcIiBhcyBjb25zdCxcbiAgICAgICAgICAgICAgICAgICAgICAgIGNyZWF0ZWRBdDogc2VydmVyVGltZXN0YW1wKCksXG4gICAgICAgICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICAgICAgICAgY29uc3QgY29tcGxldGlvbnNDb2xsZWN0aW9uID0gZ2V0SGFiaXRDb21wbGV0aW9uc0NvbGxlY3Rpb24oKTtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgY29tcGxldGlvblJlZiA9IGRvYyhjb21wbGV0aW9uc0NvbGxlY3Rpb24pO1xuICAgICAgICAgICAgICAgICAgICB0cmFuc2FjdGlvbi5zZXQoY29tcGxldGlvblJlZiwgcHJvdGVjdGVkQ29tcGxldGlvbik7XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gVXBkYXRlIHN0cmVhayBkYXRhXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHN0cmVha0RhdGEgPSB0cmFuc2Zvcm1TdHJlYWtUb0ZpcmVzdG9yZSh1cGRhdGVkU3RyZWFrKTtcbiAgICAgICAgICAgICAgICAgICAgdHJhbnNhY3Rpb24uc2V0KHN0cmVha0RvY1JlZiwgc3RyZWFrRGF0YSk7XG5cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgIGNvbnN0IG1lc3NhZ2UgPSBnZXRVc2VyRnJpZW5kbHlFcnJvck1lc3NhZ2UoZXJyb3IpO1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBGYWlsZWQgdG8gdXNlIHN0cmVhayBmcmVlemU6ICR7bWVzc2FnZX1gKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEdldCBjYWxlbmRhciBkYXRhIGZvciBhIGhhYml0IHNob3dpbmcgY29tcGxldGlvbiBzdGF0dXNcbiAgICAgKiBSZXF1aXJlbWVudHM6IDIuMSwgMi4yLCAyLjMsIDIuNCwgMi41XG4gICAgICovXG4gICAgYXN5bmMgZ2V0SGFiaXRDYWxlbmRhcihcbiAgICAgICAgaGFiaXRJZDogc3RyaW5nLFxuICAgICAgICB1c2VySWQ6IHN0cmluZyxcbiAgICAgICAgZGF5czogbnVtYmVyLFxuICAgICAgICB0aW1lem9uZTogc3RyaW5nLFxuICAgICk6IFByb21pc2U8Q2FsZW5kYXJEYXlbXT4ge1xuICAgICAgICBpZiAoIWhhYml0SWQgfHwgIXVzZXJJZCkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiSGFiaXQgSUQgYW5kIFVzZXIgSUQgYXJlIHJlcXVpcmVkXCIpO1xuICAgICAgICB9XG5cbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIHJldHVybiBhd2FpdCByZXRyeVdpdGhCYWNrb2ZmKGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgICAgICAvLyBHZXQgZGF0ZSByYW5nZSBmb3IgY2FsZW5kYXJcbiAgICAgICAgICAgICAgICBjb25zdCBlbmREYXRlID0gZ2V0Q3VycmVudERhdGVTdHJpbmcodGltZXpvbmUpO1xuICAgICAgICAgICAgICAgIGNvbnN0IHN0YXJ0RGF0ZSA9IGZvcm1hdERhdGVUb1N0cmluZyhcbiAgICAgICAgICAgICAgICAgICAgbmV3IERhdGUoRGF0ZS5ub3coKSAtIChkYXlzIC0gMSkgKiAyNCAqIDYwICogNjAgKiAxMDAwKSxcbiAgICAgICAgICAgICAgICAgICAgdGltZXpvbmUsXG4gICAgICAgICAgICAgICAgKTtcblxuICAgICAgICAgICAgICAgIC8vIEdldCBjb21wbGV0aW9ucyBmb3IgdGhlIGRhdGUgcmFuZ2VcbiAgICAgICAgICAgICAgICBjb25zdCBjb21wbGV0aW9uc0NvbGxlY3Rpb24gPSBnZXRIYWJpdENvbXBsZXRpb25zQ29sbGVjdGlvbigpO1xuICAgICAgICAgICAgICAgIGNvbnN0IGNvbXBsZXRpb25zUXVlcnkgPSBxdWVyeShcbiAgICAgICAgICAgICAgICAgICAgY29tcGxldGlvbnNDb2xsZWN0aW9uLFxuICAgICAgICAgICAgICAgICAgICB3aGVyZShcImhhYml0SWRcIiwgXCI9PVwiLCBoYWJpdElkKSxcbiAgICAgICAgICAgICAgICAgICAgd2hlcmUoXCJ1c2VySWRcIiwgXCI9PVwiLCB1c2VySWQpLFxuICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICAgICAgY29uc3QgY29tcGxldGlvbnNTbmFwc2hvdCA9IGF3YWl0IGdldERvY3MoY29tcGxldGlvbnNRdWVyeSk7XG5cbiAgICAgICAgICAgICAgICBjb25zdCBjb21wbGV0aW9ucyA9IGNvbXBsZXRpb25zU25hcHNob3QuZG9jc1xuICAgICAgICAgICAgICAgICAgICAubWFwKChkb2MpID0+IHRyYW5zZm9ybUZpcmVzdG9yZVRvQ29tcGxldGlvbihkb2MuaWQsIGRvYy5kYXRhKCkpKVxuICAgICAgICAgICAgICAgICAgICAuZmlsdGVyKChjb21wbGV0aW9uKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBjb21wRGF0ZVN0cmluZyA9IHRpbWVzdGFtcFRvRGF0ZVN0cmluZyhcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb21wbGV0aW9uLmNvbXBsZXRlZEF0LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRpbWV6b25lLFxuICAgICAgICAgICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBjb21wRGF0ZVN0cmluZyA+PSBzdGFydERhdGUgJiYgY29tcERhdGVTdHJpbmcgPD0gZW5kRGF0ZTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAvLyBHZXQgc3RyZWFrIGRhdGEgZm9yIGhpZ2hsaWdodGluZ1xuICAgICAgICAgICAgICAgIGNvbnN0IHN0cmVhayA9IGF3YWl0IHRoaXMuZ2V0SGFiaXRTdHJlYWsoaGFiaXRJZCwgdXNlcklkKTtcblxuICAgICAgICAgICAgICAgIC8vIEdlbmVyYXRlIGNhbGVuZGFyIGRheXNcbiAgICAgICAgICAgICAgICBjb25zdCBkYXRlUmFuZ2UgPSBnZW5lcmF0ZURhdGVSYW5nZShzdGFydERhdGUsIGVuZERhdGUpO1xuICAgICAgICAgICAgICAgIGNvbnN0IGNhbGVuZGFyRGF5czogQ2FsZW5kYXJEYXlbXSA9IGRhdGVSYW5nZS5tYXAoKGRhdGUpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgY29tcGxldGlvbiA9IGNvbXBsZXRpb25zLmZpbmQoXG4gICAgICAgICAgICAgICAgICAgICAgICAoY29tcCkgPT5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aW1lc3RhbXBUb0RhdGVTdHJpbmcoY29tcC5jb21wbGV0ZWRBdCwgdGltZXpvbmUpID09PSBkYXRlLFxuICAgICAgICAgICAgICAgICAgICApO1xuXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGlzSW5TdHJlYWsgPSB0aGlzLmlzRGF0ZUluQ3VycmVudFN0cmVhayhkYXRlLCBzdHJlYWspO1xuXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBkYXRlLFxuICAgICAgICAgICAgICAgICAgICAgICAgY29tcGxldGVkOiAhIWNvbXBsZXRpb24sXG4gICAgICAgICAgICAgICAgICAgICAgICBpc1RvZGF5OiBpc1RvZGF5KGRhdGUsIHRpbWV6b25lKSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGlzSW5TdHJlYWssXG4gICAgICAgICAgICAgICAgICAgICAgICBjb21wbGV0aW9uVGltZTogY29tcGxldGlvblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgID8gY29tcGxldGlvbi5jb21wbGV0ZWRBdC50b0RhdGUoKS50b0xvY2FsZVRpbWVTdHJpbmcoKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDogdW5kZWZpbmVkLFxuICAgICAgICAgICAgICAgICAgICAgICAgbm90ZXM6IGNvbXBsZXRpb24/Lm5vdGVzLFxuICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgcmV0dXJuIGNhbGVuZGFyRGF5cztcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgY29uc3QgbWVzc2FnZSA9IGdldFVzZXJGcmllbmRseUVycm9yTWVzc2FnZShlcnJvcik7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYEZhaWxlZCB0byBnZXQgaGFiaXQgY2FsZW5kYXI6ICR7bWVzc2FnZX1gKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENoZWNrIGZvciBuZXcgbWlsZXN0b25lcyBhbmQgcmV0dXJuIGFueSB0aGF0IHNob3VsZCBiZSBjZWxlYnJhdGVkXG4gICAgICogUmVxdWlyZW1lbnRzOiAzLjEsIDMuMiwgNC40XG4gICAgICovXG4gICAgYXN5bmMgY2hlY2tNaWxlc3RvbmVzKHN0cmVhazogSGFiaXRTdHJlYWspOiBQcm9taXNlPFN0cmVha01pbGVzdG9uZVtdPiB7XG4gICAgICAgIGNvbnN0IG5ld01pbGVzdG9uZXM6IFN0cmVha01pbGVzdG9uZVtdID0gW107XG4gICAgICAgIGNvbnN0IGV4aXN0aW5nTWlsZXN0b25lRGF5cyA9IHN0cmVhay5taWxlc3RvbmVzLm1hcCgobSkgPT4gbS5kYXlzKTtcblxuICAgICAgICBmb3IgKGNvbnN0IG1pbGVzdG9uZURheSBvZiBNSUxFU1RPTkVfREFZUykge1xuICAgICAgICAgICAgaWYgKFxuICAgICAgICAgICAgICAgIHN0cmVhay5jdXJyZW50U3RyZWFrID49IG1pbGVzdG9uZURheSAmJlxuICAgICAgICAgICAgICAgICFleGlzdGluZ01pbGVzdG9uZURheXMuaW5jbHVkZXMobWlsZXN0b25lRGF5KVxuICAgICAgICAgICAgKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgbWlsZXN0b25lOiBTdHJlYWtNaWxlc3RvbmUgPSB7XG4gICAgICAgICAgICAgICAgICAgIGRheXM6IG1pbGVzdG9uZURheSxcbiAgICAgICAgICAgICAgICAgICAgYWNoaWV2ZWRBdDogVGltZXN0YW1wLm5vdygpLFxuICAgICAgICAgICAgICAgICAgICBjZWxlYnJhdGVkOiBmYWxzZSxcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIG5ld01pbGVzdG9uZXMucHVzaChtaWxlc3RvbmUpO1xuXG4gICAgICAgICAgICAgICAgLy8gQXdhcmQgc3RyZWFrIGZyZWV6ZSBmb3IgMzAtZGF5IG1pbGVzdG9uZXNcbiAgICAgICAgICAgICAgICBpZiAobWlsZXN0b25lRGF5ID09PSAzMCkge1xuICAgICAgICAgICAgICAgICAgICBzdHJlYWsuZnJlZXplc0F2YWlsYWJsZSArPSAxO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIC8vIFVwZGF0ZSBzdHJlYWsgd2l0aCBuZXcgbWlsZXN0b25lc1xuICAgICAgICBpZiAobmV3TWlsZXN0b25lcy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICBjb25zdCB1cGRhdGVkU3RyZWFrOiBIYWJpdFN0cmVhayA9IHtcbiAgICAgICAgICAgICAgICAuLi5zdHJlYWssXG4gICAgICAgICAgICAgICAgbWlsZXN0b25lczogWy4uLnN0cmVhay5taWxlc3RvbmVzLCAuLi5uZXdNaWxlc3RvbmVzXSxcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIGNvbnN0IHN0cmVha0lkID0gZ2VuZXJhdGVTdHJlYWtJZChzdHJlYWsudXNlcklkLCBzdHJlYWsuaGFiaXRJZCk7XG4gICAgICAgICAgICBjb25zdCBzdHJlYWtzQ29sbGVjdGlvbiA9IGdldEhhYml0U3RyZWFrc0NvbGxlY3Rpb24oKTtcbiAgICAgICAgICAgIGNvbnN0IHN0cmVha0RvY1JlZiA9IGRvYyhzdHJlYWtzQ29sbGVjdGlvbiwgc3RyZWFrSWQpO1xuICAgICAgICAgICAgY29uc3Qgc3RyZWFrRGF0YSA9IHRyYW5zZm9ybVN0cmVha1RvRmlyZXN0b3JlKHVwZGF0ZWRTdHJlYWspO1xuXG4gICAgICAgICAgICBhd2FpdCBydW5UcmFuc2FjdGlvbihkYiwgYXN5bmMgKHRyYW5zYWN0aW9uKSA9PiB7XG4gICAgICAgICAgICAgICAgdHJhbnNhY3Rpb24uc2V0KHN0cmVha0RvY1JlZiwgc3RyZWFrRGF0YSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBuZXdNaWxlc3RvbmVzO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEdldCBzdHJlYWsgaW5mb3JtYXRpb24gZm9yIGEgc3BlY2lmaWMgaGFiaXRcbiAgICAgKi9cbiAgICBhc3luYyBnZXRIYWJpdFN0cmVhayhcbiAgICAgICAgaGFiaXRJZDogc3RyaW5nLFxuICAgICAgICB1c2VySWQ6IHN0cmluZyxcbiAgICApOiBQcm9taXNlPEhhYml0U3RyZWFrIHwgbnVsbD4ge1xuICAgICAgICBpZiAoIWhhYml0SWQgfHwgIXVzZXJJZCkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiSGFiaXQgSUQgYW5kIFVzZXIgSUQgYXJlIHJlcXVpcmVkXCIpO1xuICAgICAgICB9XG5cbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGNvbnN0IHN0cmVha0lkID0gZ2VuZXJhdGVTdHJlYWtJZCh1c2VySWQsIGhhYml0SWQpO1xuICAgICAgICAgICAgY29uc3Qgc3RyZWFrc0NvbGxlY3Rpb24gPSBnZXRIYWJpdFN0cmVha3NDb2xsZWN0aW9uKCk7XG4gICAgICAgICAgICBjb25zdCBzdHJlYWtEb2NSZWYgPSBkb2Moc3RyZWFrc0NvbGxlY3Rpb24sIHN0cmVha0lkKTtcbiAgICAgICAgICAgIGNvbnN0IHN0cmVha0RvYyA9IGF3YWl0IGdldERvYyhzdHJlYWtEb2NSZWYpO1xuXG4gICAgICAgICAgICBpZiAoIXN0cmVha0RvYy5leGlzdHMoKSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBjb25zdCBzdHJlYWtEYXRhID0gc3RyZWFrRG9jLmRhdGEoKTtcbiAgICAgICAgICAgIGlmICghdmFsaWRhdGVTdHJlYWtEb2N1bWVudChzdHJlYWtEYXRhKSkge1xuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkludmFsaWQgc3RyZWFrIGRhdGEgZm9ybWF0XCIpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4gdHJhbnNmb3JtRmlyZXN0b3JlVG9TdHJlYWsoc3RyZWFrRGF0YSk7XG4gICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICBjb25zdCBtZXNzYWdlID0gZ2V0VXNlckZyaWVuZGx5RXJyb3JNZXNzYWdlKGVycm9yKTtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgRmFpbGVkIHRvIGdldCBoYWJpdCBzdHJlYWs6ICR7bWVzc2FnZX1gKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEluaXRpYWxpemUgc3RyZWFrIGRhdGEgZm9yIGEgbmV3IGhhYml0XG4gICAgICovXG4gICAgYXN5bmMgaW5pdGlhbGl6ZUhhYml0U3RyZWFrKFxuICAgICAgICBoYWJpdElkOiBzdHJpbmcsXG4gICAgICAgIHVzZXJJZDogc3RyaW5nLFxuICAgICk6IFByb21pc2U8SGFiaXRTdHJlYWs+IHtcbiAgICAgICAgaWYgKCFoYWJpdElkIHx8ICF1c2VySWQpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkhhYml0IElEIGFuZCBVc2VyIElEIGFyZSByZXF1aXJlZFwiKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IGN1cnJlbnREYXRlID0gZ2V0Q3VycmVudERhdGVTdHJpbmcoZ2V0VXNlclRpbWV6b25lKCkpO1xuICAgICAgICBjb25zdCBpbml0aWFsU3RyZWFrOiBIYWJpdFN0cmVhayA9IHtcbiAgICAgICAgICAgIGhhYml0SWQsXG4gICAgICAgICAgICB1c2VySWQsXG4gICAgICAgICAgICBjdXJyZW50U3RyZWFrOiAwLFxuICAgICAgICAgICAgYmVzdFN0cmVhazogMCxcbiAgICAgICAgICAgIGxhc3RDb21wbGV0aW9uRGF0ZTogXCJcIixcbiAgICAgICAgICAgIHN0cmVha1N0YXJ0RGF0ZTogY3VycmVudERhdGUsXG4gICAgICAgICAgICBmcmVlemVzQXZhaWxhYmxlOiAwLFxuICAgICAgICAgICAgZnJlZXplc1VzZWQ6IDAsXG4gICAgICAgICAgICBtaWxlc3RvbmVzOiBbXSxcbiAgICAgICAgfTtcblxuICAgICAgICB0cnkge1xuICAgICAgICAgICAgY29uc3Qgc3RyZWFrSWQgPSBnZW5lcmF0ZVN0cmVha0lkKHVzZXJJZCwgaGFiaXRJZCk7XG4gICAgICAgICAgICBjb25zdCBzdHJlYWtzQ29sbGVjdGlvbiA9IGdldEhhYml0U3RyZWFrc0NvbGxlY3Rpb24oKTtcbiAgICAgICAgICAgIGNvbnN0IHN0cmVha0RvY1JlZiA9IGRvYyhzdHJlYWtzQ29sbGVjdGlvbiwgc3RyZWFrSWQpO1xuICAgICAgICAgICAgY29uc3Qgc3RyZWFrRGF0YSA9IHRyYW5zZm9ybVN0cmVha1RvRmlyZXN0b3JlKGluaXRpYWxTdHJlYWspO1xuXG4gICAgICAgICAgICBhd2FpdCBydW5UcmFuc2FjdGlvbihkYiwgYXN5bmMgKHRyYW5zYWN0aW9uKSA9PiB7XG4gICAgICAgICAgICAgICAgdHJhbnNhY3Rpb24uc2V0KHN0cmVha0RvY1JlZiwgc3RyZWFrRGF0YSk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgcmV0dXJuIGluaXRpYWxTdHJlYWs7XG4gICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICBjb25zdCBtZXNzYWdlID0gZ2V0VXNlckZyaWVuZGx5RXJyb3JNZXNzYWdlKGVycm9yKTtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgRmFpbGVkIHRvIGluaXRpYWxpemUgaGFiaXQgc3RyZWFrOiAke21lc3NhZ2V9YCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBSZXNldCBhIHN0cmVhayAodXNlZCB3aGVuIHN0cmVhayBpcyBicm9rZW4gYW5kIG5vIGZyZWV6ZSBhdmFpbGFibGUpXG4gICAgICogUmVxdWlyZW1lbnRzOiAxLjJcbiAgICAgKi9cbiAgICBhc3luYyByZXNldFN0cmVhayhcbiAgICAgICAgaGFiaXRJZDogc3RyaW5nLFxuICAgICAgICB1c2VySWQ6IHN0cmluZyxcbiAgICAgICAgcmVzZXREYXRlOiBzdHJpbmcsXG4gICAgKTogUHJvbWlzZTxIYWJpdFN0cmVhaz4ge1xuICAgICAgICBpZiAoIWhhYml0SWQgfHwgIXVzZXJJZCB8fCAhcmVzZXREYXRlKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJIYWJpdCBJRCwgVXNlciBJRCwgYW5kIHJlc2V0IGRhdGUgYXJlIHJlcXVpcmVkXCIpO1xuICAgICAgICB9XG5cbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIHJldHVybiBhd2FpdCByZXRyeVdpdGhCYWNrb2ZmKGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgICAgICByZXR1cm4gYXdhaXQgcnVuVHJhbnNhY3Rpb24oZGIsIGFzeW5jICh0cmFuc2FjdGlvbikgPT4ge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBzdHJlYWtJZCA9IGdlbmVyYXRlU3RyZWFrSWQodXNlcklkLCBoYWJpdElkKTtcbiAgICAgICAgICAgICAgICAgICAgY29uc3Qgc3RyZWFrc0NvbGxlY3Rpb24gPSBnZXRIYWJpdFN0cmVha3NDb2xsZWN0aW9uKCk7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHN0cmVha0RvY1JlZiA9IGRvYyhzdHJlYWtzQ29sbGVjdGlvbiwgc3RyZWFrSWQpO1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBzdHJlYWtEb2MgPSBhd2FpdCB0cmFuc2FjdGlvbi5nZXQoc3RyZWFrRG9jUmVmKTtcblxuICAgICAgICAgICAgICAgICAgICBpZiAoIXN0cmVha0RvYy5leGlzdHMoKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiU3RyZWFrIGRhdGEgbm90IGZvdW5kXCIpO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgY29uc3Qgc3RyZWFrID0gdHJhbnNmb3JtRmlyZXN0b3JlVG9TdHJlYWsoc3RyZWFrRG9jLmRhdGEoKSk7XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gVmFsaWRhdGUgdXNlciBvd25lcnNoaXBcbiAgICAgICAgICAgICAgICAgICAgaWYgKCF2YWxpZGF0ZVVzZXJPd25lcnNoaXAodXNlcklkLCBzdHJlYWsudXNlcklkKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiVW5hdXRob3JpemVkIGFjY2VzcyB0byBzdHJlYWsgZGF0YVwiKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHJlc2V0U3RyZWFrOiBIYWJpdFN0cmVhayA9IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIC4uLnN0cmVhayxcbiAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnRTdHJlYWs6IDAsXG4gICAgICAgICAgICAgICAgICAgICAgICBsYXN0Q29tcGxldGlvbkRhdGU6IFwiXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICBzdHJlYWtTdGFydERhdGU6IHJlc2V0RGF0ZSxcbiAgICAgICAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgICAgICAgICBjb25zdCBzdHJlYWtEYXRhID0gdHJhbnNmb3JtU3RyZWFrVG9GaXJlc3RvcmUocmVzZXRTdHJlYWspO1xuICAgICAgICAgICAgICAgICAgICB0cmFuc2FjdGlvbi5zZXQoc3RyZWFrRG9jUmVmLCBzdHJlYWtEYXRhKTtcblxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVzZXRTdHJlYWs7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgIGNvbnN0IG1lc3NhZ2UgPSBnZXRVc2VyRnJpZW5kbHlFcnJvck1lc3NhZ2UoZXJyb3IpO1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBGYWlsZWQgdG8gcmVzZXQgc3RyZWFrOiAke21lc3NhZ2V9YCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBQcml2YXRlIGhlbHBlciBtZXRob2RzXG5cbiAgICAvKipcbiAgICAgKiBDYWxjdWxhdGUgc3RyZWFrIGZyb20gY29tcGxldGlvbiByZWNvcmRzXG4gICAgICovXG4gICAgcHJpdmF0ZSBjYWxjdWxhdGVTdHJlYWtGcm9tQ29tcGxldGlvbnMoXG4gICAgICAgIGNvbXBsZXRpb25zOiBIYWJpdENvbXBsZXRpb25bXSxcbiAgICAgICAgaGFiaXRJZDogc3RyaW5nLFxuICAgICAgICB1c2VySWQ6IHN0cmluZyxcbiAgICApOiBIYWJpdFN0cmVhayB7XG4gICAgICAgIGlmIChjb21wbGV0aW9ucy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgaGFiaXRJZCxcbiAgICAgICAgICAgICAgICB1c2VySWQsXG4gICAgICAgICAgICAgICAgY3VycmVudFN0cmVhazogMCxcbiAgICAgICAgICAgICAgICBiZXN0U3RyZWFrOiAwLFxuICAgICAgICAgICAgICAgIGxhc3RDb21wbGV0aW9uRGF0ZTogXCJcIixcbiAgICAgICAgICAgICAgICBzdHJlYWtTdGFydERhdGU6IGdldEN1cnJlbnREYXRlU3RyaW5nKGdldFVzZXJUaW1lem9uZSgpKSxcbiAgICAgICAgICAgICAgICBmcmVlemVzQXZhaWxhYmxlOiAwLFxuICAgICAgICAgICAgICAgIGZyZWV6ZXNVc2VkOiAwLFxuICAgICAgICAgICAgICAgIG1pbGVzdG9uZXM6IFtdLFxuICAgICAgICAgICAgfTtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IHRpbWV6b25lID0gY29tcGxldGlvbnNbMF0/LnRpbWV6b25lIHx8IGdldFVzZXJUaW1lem9uZSgpO1xuICAgICAgICBjb25zdCBjb21wbGV0aW9uRGF0ZXMgPSBjb21wbGV0aW9ucy5tYXAoKGNvbXApID0+XG4gICAgICAgICAgICB0aW1lc3RhbXBUb0RhdGVTdHJpbmcoY29tcC5jb21wbGV0ZWRBdCwgdGltZXpvbmUpLFxuICAgICAgICApO1xuXG4gICAgICAgIC8vIFJlbW92ZSBkdXBsaWNhdGVzIGFuZCBzb3J0XG4gICAgICAgIGNvbnN0IHVuaXF1ZURhdGVzID0gWy4uLm5ldyBTZXQoY29tcGxldGlvbkRhdGVzKV0uc29ydCgpO1xuXG4gICAgICAgIC8vIENhbGN1bGF0ZSBjdXJyZW50IHN0cmVhayAoZnJvbSBtb3N0IHJlY2VudCBjb21wbGV0aW9uIGJhY2t3YXJkcylcbiAgICAgICAgbGV0IGN1cnJlbnRTdHJlYWsgPSAwO1xuICAgICAgICBsZXQgc3RyZWFrU3RhcnREYXRlID0gXCJcIjtcbiAgICAgICAgY29uc3QgdG9kYXkgPSBnZXRDdXJyZW50RGF0ZVN0cmluZyh0aW1lem9uZSk7XG4gICAgICAgIGNvbnN0IHllc3RlcmRheSA9IGZvcm1hdERhdGVUb1N0cmluZyhcbiAgICAgICAgICAgIG5ldyBEYXRlKERhdGUubm93KCkgLSAyNCAqIDYwICogNjAgKiAxMDAwKSxcbiAgICAgICAgICAgIHRpbWV6b25lLFxuICAgICAgICApO1xuXG4gICAgICAgIC8vIENoZWNrIGlmIHRoZXJlJ3MgYSBjb21wbGV0aW9uIHRvZGF5IG9yIHllc3RlcmRheSB0byBzdGFydCBjb3VudGluZ1xuICAgICAgICBjb25zdCBsYXN0Q29tcGxldGlvbkRhdGUgPSB1bmlxdWVEYXRlc1t1bmlxdWVEYXRlcy5sZW5ndGggLSAxXTtcbiAgICAgICAgaWYgKGxhc3RDb21wbGV0aW9uRGF0ZSA9PT0gdG9kYXkgfHwgbGFzdENvbXBsZXRpb25EYXRlID09PSB5ZXN0ZXJkYXkpIHtcbiAgICAgICAgICAgIGN1cnJlbnRTdHJlYWsgPSAxO1xuICAgICAgICAgICAgc3RyZWFrU3RhcnREYXRlID0gbGFzdENvbXBsZXRpb25EYXRlO1xuXG4gICAgICAgICAgICAvLyBDb3VudCBiYWNrd2FyZHMgZm9yIGNvbnNlY3V0aXZlIGRheXNcbiAgICAgICAgICAgIGZvciAobGV0IGkgPSB1bmlxdWVEYXRlcy5sZW5ndGggLSAyOyBpID49IDA7IGktLSkge1xuICAgICAgICAgICAgICAgIGNvbnN0IGN1cnJlbnREYXRlID0gdW5pcXVlRGF0ZXNbaSArIDFdO1xuICAgICAgICAgICAgICAgIGNvbnN0IHByZXZpb3VzRGF0ZSA9IHVuaXF1ZURhdGVzW2ldO1xuXG4gICAgICAgICAgICAgICAgaWYgKGFyZUNvbnNlY3V0aXZlRGF5cyhwcmV2aW91c0RhdGUsIGN1cnJlbnREYXRlKSkge1xuICAgICAgICAgICAgICAgICAgICBjdXJyZW50U3RyZWFrKys7XG4gICAgICAgICAgICAgICAgICAgIHN0cmVha1N0YXJ0RGF0ZSA9IHByZXZpb3VzRGF0ZTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICAvLyBDYWxjdWxhdGUgYmVzdCBzdHJlYWsgKGxvbmdlc3QgY29uc2VjdXRpdmUgc2VxdWVuY2UpXG4gICAgICAgIGxldCBiZXN0U3RyZWFrID0gMDtcbiAgICAgICAgbGV0IHRlbXBTdHJlYWsgPSAxO1xuXG4gICAgICAgIGZvciAobGV0IGkgPSAxOyBpIDwgdW5pcXVlRGF0ZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIGlmIChhcmVDb25zZWN1dGl2ZURheXModW5pcXVlRGF0ZXNbaSAtIDFdLCB1bmlxdWVEYXRlc1tpXSkpIHtcbiAgICAgICAgICAgICAgICB0ZW1wU3RyZWFrKys7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGJlc3RTdHJlYWsgPSBNYXRoLm1heChiZXN0U3RyZWFrLCB0ZW1wU3RyZWFrKTtcbiAgICAgICAgICAgICAgICB0ZW1wU3RyZWFrID0gMTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBiZXN0U3RyZWFrID0gTWF0aC5tYXgoYmVzdFN0cmVhaywgdGVtcFN0cmVhaywgY3VycmVudFN0cmVhayk7XG5cbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIGhhYml0SWQsXG4gICAgICAgICAgICB1c2VySWQsXG4gICAgICAgICAgICBjdXJyZW50U3RyZWFrLFxuICAgICAgICAgICAgYmVzdFN0cmVhayxcbiAgICAgICAgICAgIGxhc3RDb21wbGV0aW9uRGF0ZSxcbiAgICAgICAgICAgIHN0cmVha1N0YXJ0RGF0ZSxcbiAgICAgICAgICAgIGZyZWV6ZXNBdmFpbGFibGU6IDAsXG4gICAgICAgICAgICBmcmVlemVzVXNlZDogMCxcbiAgICAgICAgICAgIG1pbGVzdG9uZXM6IFtdLFxuICAgICAgICB9O1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIE1lcmdlIGNhbGN1bGF0ZWQgc3RyZWFrIHdpdGggZXhpc3Rpbmcgc3RyZWFrIGRhdGFcbiAgICAgKi9cbiAgICBwcml2YXRlIG1lcmdlU3RyZWFrRGF0YShcbiAgICAgICAgY2FsY3VsYXRlZDogSGFiaXRTdHJlYWssXG4gICAgICAgIGV4aXN0aW5nOiBIYWJpdFN0cmVhayB8IG51bGwsXG4gICAgKTogSGFiaXRTdHJlYWsge1xuICAgICAgICBpZiAoIWV4aXN0aW5nKSB7XG4gICAgICAgICAgICByZXR1cm4gY2FsY3VsYXRlZDtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAuLi5jYWxjdWxhdGVkLFxuICAgICAgICAgICAgZnJlZXplc0F2YWlsYWJsZTogZXhpc3RpbmcuZnJlZXplc0F2YWlsYWJsZSxcbiAgICAgICAgICAgIGZyZWV6ZXNVc2VkOiBleGlzdGluZy5mcmVlemVzVXNlZCxcbiAgICAgICAgICAgIG1pbGVzdG9uZXM6IGV4aXN0aW5nLm1pbGVzdG9uZXMsXG4gICAgICAgICAgICAvLyBFbnN1cmUgYmVzdCBzdHJlYWsgbmV2ZXIgZGVjcmVhc2VzXG4gICAgICAgICAgICBiZXN0U3RyZWFrOiBNYXRoLm1heChjYWxjdWxhdGVkLmJlc3RTdHJlYWssIGV4aXN0aW5nLmJlc3RTdHJlYWspLFxuICAgICAgICB9O1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENoZWNrIGlmIGEgZGF0ZSBpcyB3aXRoaW4gdGhlIGN1cnJlbnQgc3RyZWFrIHBlcmlvZFxuICAgICAqL1xuICAgIHByaXZhdGUgaXNEYXRlSW5DdXJyZW50U3RyZWFrKFxuICAgICAgICBkYXRlOiBzdHJpbmcsXG4gICAgICAgIHN0cmVhazogSGFiaXRTdHJlYWsgfCBudWxsLFxuICAgICk6IGJvb2xlYW4ge1xuICAgICAgICBpZiAoIXN0cmVhayB8fCBzdHJlYWsuY3VycmVudFN0cmVhayA9PT0gMCB8fCAhc3RyZWFrLnN0cmVha1N0YXJ0RGF0ZSkge1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3Qgc3RyZWFrU3RhcnQgPSBwYXJzZURhdGVTdHJpbmcoc3RyZWFrLnN0cmVha1N0YXJ0RGF0ZSk7XG4gICAgICAgIGNvbnN0IGNoZWNrRGF0ZSA9IHBhcnNlRGF0ZVN0cmluZyhkYXRlKTtcbiAgICAgICAgY29uc3Qgc3RyZWFrRW5kID0gbmV3IERhdGUoc3RyZWFrU3RhcnQpO1xuICAgICAgICBzdHJlYWtFbmQuc2V0RGF0ZShzdHJlYWtFbmQuZ2V0RGF0ZSgpICsgc3RyZWFrLmN1cnJlbnRTdHJlYWsgLSAxKTtcblxuICAgICAgICByZXR1cm4gY2hlY2tEYXRlID49IHN0cmVha1N0YXJ0ICYmIGNoZWNrRGF0ZSA8PSBzdHJlYWtFbmQ7XG4gICAgfVxufVxuXG4vLyBFeHBvcnQgc2luZ2xldG9uIGluc3RhbmNlXG5leHBvcnQgY29uc3Qgc3RyZWFrU2VydmljZSA9IG5l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