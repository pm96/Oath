05cbfb44501b4b6ce5995b423db9989f
var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault").default;
Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.timestampToDateString = exports.parseDateString = exports.isValidDateString = exports.isToday = exports.isTimestampInCurrentDay = exports.getUserTimezone = exports.getHoursUntilEndOfDay = exports.getDaysDifference = exports.getDayOfWeek = exports.getDayName = exports.getDateNDaysFromNow = exports.getDateNDaysAgo = exports.getCurrentDateString = exports.getCalendarDateRange = exports.generateDateRange = exports.formatDateToString = exports.createTimestampFromDateTime = exports.areConsecutiveDays = void 0;
var _slicedToArray2 = _interopRequireDefault(require("@babel/runtime/helpers/slicedToArray"));
var _firestore = require("firebase/firestore");
var getCurrentDateString = exports.getCurrentDateString = function getCurrentDateString() {
  var timezone = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : "UTC";
  var now = new Date();
  return formatDateToString(now, timezone);
};
var formatDateToString = exports.formatDateToString = function formatDateToString(date) {
  var timezone = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : "UTC";
  var formatter = new Intl.DateTimeFormat("en-CA", {
    timeZone: timezone,
    year: "numeric",
    month: "2-digit",
    day: "2-digit"
  });
  return formatter.format(date);
};
var parseDateString = exports.parseDateString = function parseDateString(dateString) {
  var _dateString$split$map = dateString.split("-").map(Number),
    _dateString$split$map2 = (0, _slicedToArray2.default)(_dateString$split$map, 3),
    year = _dateString$split$map2[0],
    month = _dateString$split$map2[1],
    day = _dateString$split$map2[2];
  return new Date(year, month - 1, day);
};
var getUserTimezone = exports.getUserTimezone = function getUserTimezone() {
  return Intl.DateTimeFormat().resolvedOptions().timeZone;
};
var isTimestampInCurrentDay = exports.isTimestampInCurrentDay = function isTimestampInCurrentDay(timestamp, timezone) {
  var timestampDate = timestamp.toDate();
  var currentDateString = getCurrentDateString(timezone);
  var timestampDateString = formatDateToString(timestampDate, timezone);
  return currentDateString === timestampDateString;
};
var areConsecutiveDays = exports.areConsecutiveDays = function areConsecutiveDays(date1, date2) {
  var d1 = parseDateString(date1);
  var d2 = parseDateString(date2);
  var diffTime = Math.abs(d2.getTime() - d1.getTime());
  var diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
  return diffDays === 1;
};
var getDaysDifference = exports.getDaysDifference = function getDaysDifference(startDate, endDate) {
  var start = parseDateString(startDate);
  var end = parseDateString(endDate);
  var diffTime = end.getTime() - start.getTime();
  return Math.ceil(diffTime / (1000 * 60 * 60 * 24));
};
var generateDateRange = exports.generateDateRange = function generateDateRange(startDate, endDate) {
  var dates = [];
  var start = parseDateString(startDate);
  var end = parseDateString(endDate);
  var current = new Date(start);
  while (current <= end) {
    dates.push(formatDateToString(current));
    current.setDate(current.getDate() + 1);
  }
  return dates;
};
var getDateNDaysAgo = exports.getDateNDaysAgo = function getDateNDaysAgo(days) {
  var timezone = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : "UTC";
  var date = new Date();
  date.setDate(date.getDate() - days);
  return formatDateToString(date, timezone);
};
var getDateNDaysFromNow = exports.getDateNDaysFromNow = function getDateNDaysFromNow(days) {
  var timezone = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : "UTC";
  var date = new Date();
  date.setDate(date.getDate() + days);
  return formatDateToString(date, timezone);
};
var isToday = exports.isToday = function isToday(dateString, timezone) {
  var today = getCurrentDateString(timezone);
  return dateString === today;
};
var getDayOfWeek = exports.getDayOfWeek = function getDayOfWeek(dateString) {
  var date = parseDateString(dateString);
  return date.getDay();
};
var getDayName = exports.getDayName = function getDayName(dateString) {
  var date = parseDateString(dateString);
  return date.toLocaleDateString("en-US", {
    weekday: "long"
  });
};
var isValidDateString = exports.isValidDateString = function isValidDateString(dateString) {
  var regex = /^\d{4}-\d{2}-\d{2}$/;
  if (!regex.test(dateString)) {
    return false;
  }
  var date = parseDateString(dateString);
  return !isNaN(date.getTime());
};
var getCalendarDateRange = exports.getCalendarDateRange = function getCalendarDateRange() {
  var timezone = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : "UTC";
  var end = getCurrentDateString(timezone);
  var start = getDateNDaysAgo(89, timezone);
  return {
    start: start,
    end: end
  };
};
var timestampToDateString = exports.timestampToDateString = function timestampToDateString(timestamp, timezone) {
  return formatDateToString(timestamp.toDate(), timezone);
};
var createTimestampFromDateTime = exports.createTimestampFromDateTime = function createTimestampFromDateTime(dateString, timeString, timezone) {
  var _dateString$split$map3 = dateString.split("-").map(Number),
    _dateString$split$map4 = (0, _slicedToArray2.default)(_dateString$split$map3, 3),
    year = _dateString$split$map4[0],
    month = _dateString$split$map4[1],
    day = _dateString$split$map4[2];
  var _timeString$split$map = timeString.split(":").map(Number),
    _timeString$split$map2 = (0, _slicedToArray2.default)(_timeString$split$map, 2),
    hours = _timeString$split$map2[0],
    minutes = _timeString$split$map2[1];
  var date = new Date();
  date.setFullYear(year, month - 1, day);
  date.setHours(hours, minutes, 0, 0);
  return _firestore.Timestamp.fromDate(date);
};
var getHoursUntilEndOfDay = exports.getHoursUntilEndOfDay = function getHoursUntilEndOfDay(timezone) {
  var now = new Date();
  var endOfDay = new Date();
  var formatter = new Intl.DateTimeFormat("en-US", {
    timeZone: timezone,
    hour12: false,
    hour: "2-digit",
    minute: "2-digit"
  });
  endOfDay.setHours(23, 59, 59, 999);
  var diffMs = endOfDay.getTime() - now.getTime();
  return Math.max(0, diffMs / (1000 * 60 * 60));
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfZmlyZXN0b3JlIiwicmVxdWlyZSIsImdldEN1cnJlbnREYXRlU3RyaW5nIiwiZXhwb3J0cyIsInRpbWV6b25lIiwiYXJndW1lbnRzIiwibGVuZ3RoIiwidW5kZWZpbmVkIiwibm93IiwiRGF0ZSIsImZvcm1hdERhdGVUb1N0cmluZyIsImRhdGUiLCJmb3JtYXR0ZXIiLCJJbnRsIiwiRGF0ZVRpbWVGb3JtYXQiLCJ0aW1lWm9uZSIsInllYXIiLCJtb250aCIsImRheSIsImZvcm1hdCIsInBhcnNlRGF0ZVN0cmluZyIsImRhdGVTdHJpbmciLCJfZGF0ZVN0cmluZyRzcGxpdCRtYXAiLCJzcGxpdCIsIm1hcCIsIk51bWJlciIsIl9kYXRlU3RyaW5nJHNwbGl0JG1hcDIiLCJfc2xpY2VkVG9BcnJheTIiLCJkZWZhdWx0IiwiZ2V0VXNlclRpbWV6b25lIiwicmVzb2x2ZWRPcHRpb25zIiwiaXNUaW1lc3RhbXBJbkN1cnJlbnREYXkiLCJ0aW1lc3RhbXAiLCJ0aW1lc3RhbXBEYXRlIiwidG9EYXRlIiwiY3VycmVudERhdGVTdHJpbmciLCJ0aW1lc3RhbXBEYXRlU3RyaW5nIiwiYXJlQ29uc2VjdXRpdmVEYXlzIiwiZGF0ZTEiLCJkYXRlMiIsImQxIiwiZDIiLCJkaWZmVGltZSIsIk1hdGgiLCJhYnMiLCJnZXRUaW1lIiwiZGlmZkRheXMiLCJjZWlsIiwiZ2V0RGF5c0RpZmZlcmVuY2UiLCJzdGFydERhdGUiLCJlbmREYXRlIiwic3RhcnQiLCJlbmQiLCJnZW5lcmF0ZURhdGVSYW5nZSIsImRhdGVzIiwiY3VycmVudCIsInB1c2giLCJzZXREYXRlIiwiZ2V0RGF0ZSIsImdldERhdGVORGF5c0FnbyIsImRheXMiLCJnZXREYXRlTkRheXNGcm9tTm93IiwiaXNUb2RheSIsInRvZGF5IiwiZ2V0RGF5T2ZXZWVrIiwiZ2V0RGF5IiwiZ2V0RGF5TmFtZSIsInRvTG9jYWxlRGF0ZVN0cmluZyIsIndlZWtkYXkiLCJpc1ZhbGlkRGF0ZVN0cmluZyIsInJlZ2V4IiwidGVzdCIsImlzTmFOIiwiZ2V0Q2FsZW5kYXJEYXRlUmFuZ2UiLCJ0aW1lc3RhbXBUb0RhdGVTdHJpbmciLCJjcmVhdGVUaW1lc3RhbXBGcm9tRGF0ZVRpbWUiLCJ0aW1lU3RyaW5nIiwiX2RhdGVTdHJpbmckc3BsaXQkbWFwMyIsIl9kYXRlU3RyaW5nJHNwbGl0JG1hcDQiLCJfdGltZVN0cmluZyRzcGxpdCRtYXAiLCJfdGltZVN0cmluZyRzcGxpdCRtYXAyIiwiaG91cnMiLCJtaW51dGVzIiwic2V0RnVsbFllYXIiLCJzZXRIb3VycyIsIlRpbWVzdGFtcCIsImZyb21EYXRlIiwiZ2V0SG91cnNVbnRpbEVuZE9mRGF5IiwiZW5kT2ZEYXkiLCJob3VyMTIiLCJob3VyIiwibWludXRlIiwiZGlmZk1zIiwibWF4Il0sInNvdXJjZXMiOlsiZGF0ZVV0aWxzLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFRpbWVzdGFtcCB9IGZyb20gXCJmaXJlYmFzZS9maXJlc3RvcmVcIjtcblxuLyoqXG4gKiBEYXRlIHV0aWxpdHkgZnVuY3Rpb25zIGZvciBoYWJpdCB0cmFja2luZyB3aXRoIHRpbWV6b25lIGF3YXJlbmVzc1xuICovXG5cbi8qKlxuICogR2V0IHRoZSBjdXJyZW50IGRhdGUgaW4gWVlZWS1NTS1ERCBmb3JtYXQgZm9yIGEgc3BlY2lmaWMgdGltZXpvbmVcbiAqL1xuZXhwb3J0IGNvbnN0IGdldEN1cnJlbnREYXRlU3RyaW5nID0gKHRpbWV6b25lOiBzdHJpbmcgPSBcIlVUQ1wiKTogc3RyaW5nID0+IHtcbiAgICBjb25zdCBub3cgPSBuZXcgRGF0ZSgpO1xuICAgIHJldHVybiBmb3JtYXREYXRlVG9TdHJpbmcobm93LCB0aW1lem9uZSk7XG59O1xuXG4vKipcbiAqIEZvcm1hdCBhIERhdGUgb2JqZWN0IHRvIFlZWVktTU0tREQgc3RyaW5nIGluIGEgc3BlY2lmaWMgdGltZXpvbmVcbiAqL1xuZXhwb3J0IGNvbnN0IGZvcm1hdERhdGVUb1N0cmluZyA9IChcbiAgICBkYXRlOiBEYXRlLFxuICAgIHRpbWV6b25lOiBzdHJpbmcgPSBcIlVUQ1wiLFxuKTogc3RyaW5nID0+IHtcbiAgICBjb25zdCBmb3JtYXR0ZXIgPSBuZXcgSW50bC5EYXRlVGltZUZvcm1hdChcImVuLUNBXCIsIHtcbiAgICAgICAgdGltZVpvbmU6IHRpbWV6b25lLFxuICAgICAgICB5ZWFyOiBcIm51bWVyaWNcIixcbiAgICAgICAgbW9udGg6IFwiMi1kaWdpdFwiLFxuICAgICAgICBkYXk6IFwiMi1kaWdpdFwiLFxuICAgIH0pO1xuXG4gICAgcmV0dXJuIGZvcm1hdHRlci5mb3JtYXQoZGF0ZSk7XG59O1xuXG4vKipcbiAqIFBhcnNlIGEgWVlZWS1NTS1ERCBzdHJpbmcgdG8gYSBEYXRlIG9iamVjdFxuICovXG5leHBvcnQgY29uc3QgcGFyc2VEYXRlU3RyaW5nID0gKGRhdGVTdHJpbmc6IHN0cmluZyk6IERhdGUgPT4ge1xuICAgIGNvbnN0IFt5ZWFyLCBtb250aCwgZGF5XSA9IGRhdGVTdHJpbmcuc3BsaXQoXCItXCIpLm1hcChOdW1iZXIpO1xuICAgIHJldHVybiBuZXcgRGF0ZSh5ZWFyLCBtb250aCAtIDEsIGRheSk7XG59O1xuXG4vKipcbiAqIEdldCB0aGUgdXNlcidzIGN1cnJlbnQgdGltZXpvbmVcbiAqL1xuZXhwb3J0IGNvbnN0IGdldFVzZXJUaW1lem9uZSA9ICgpOiBzdHJpbmcgPT4ge1xuICAgIHJldHVybiBJbnRsLkRhdGVUaW1lRm9ybWF0KCkucmVzb2x2ZWRPcHRpb25zKCkudGltZVpvbmU7XG59O1xuXG4vKipcbiAqIENoZWNrIGlmIGEgdGltZXN0YW1wIGlzIHdpdGhpbiB0aGUgY3VycmVudCBkYXkgaW4gYSBzcGVjaWZpYyB0aW1lem9uZVxuICovXG5leHBvcnQgY29uc3QgaXNUaW1lc3RhbXBJbkN1cnJlbnREYXkgPSAoXG4gICAgdGltZXN0YW1wOiBUaW1lc3RhbXAsXG4gICAgdGltZXpvbmU6IHN0cmluZyxcbik6IGJvb2xlYW4gPT4ge1xuICAgIGNvbnN0IHRpbWVzdGFtcERhdGUgPSB0aW1lc3RhbXAudG9EYXRlKCk7XG4gICAgY29uc3QgY3VycmVudERhdGVTdHJpbmcgPSBnZXRDdXJyZW50RGF0ZVN0cmluZyh0aW1lem9uZSk7XG4gICAgY29uc3QgdGltZXN0YW1wRGF0ZVN0cmluZyA9IGZvcm1hdERhdGVUb1N0cmluZyh0aW1lc3RhbXBEYXRlLCB0aW1lem9uZSk7XG5cbiAgICByZXR1cm4gY3VycmVudERhdGVTdHJpbmcgPT09IHRpbWVzdGFtcERhdGVTdHJpbmc7XG59O1xuXG4vKipcbiAqIENoZWNrIGlmIHR3byBkYXRlcyBhcmUgY29uc2VjdXRpdmUgZGF5c1xuICovXG5leHBvcnQgY29uc3QgYXJlQ29uc2VjdXRpdmVEYXlzID0gKGRhdGUxOiBzdHJpbmcsIGRhdGUyOiBzdHJpbmcpOiBib29sZWFuID0+IHtcbiAgICBjb25zdCBkMSA9IHBhcnNlRGF0ZVN0cmluZyhkYXRlMSk7XG4gICAgY29uc3QgZDIgPSBwYXJzZURhdGVTdHJpbmcoZGF0ZTIpO1xuXG4gICAgY29uc3QgZGlmZlRpbWUgPSBNYXRoLmFicyhkMi5nZXRUaW1lKCkgLSBkMS5nZXRUaW1lKCkpO1xuICAgIGNvbnN0IGRpZmZEYXlzID0gTWF0aC5jZWlsKGRpZmZUaW1lIC8gKDEwMDAgKiA2MCAqIDYwICogMjQpKTtcblxuICAgIHJldHVybiBkaWZmRGF5cyA9PT0gMTtcbn07XG5cbi8qKlxuICogR2V0IHRoZSBkaWZmZXJlbmNlIGluIGRheXMgYmV0d2VlbiB0d28gZGF0ZSBzdHJpbmdzXG4gKi9cbmV4cG9ydCBjb25zdCBnZXREYXlzRGlmZmVyZW5jZSA9IChcbiAgICBzdGFydERhdGU6IHN0cmluZyxcbiAgICBlbmREYXRlOiBzdHJpbmcsXG4pOiBudW1iZXIgPT4ge1xuICAgIGNvbnN0IHN0YXJ0ID0gcGFyc2VEYXRlU3RyaW5nKHN0YXJ0RGF0ZSk7XG4gICAgY29uc3QgZW5kID0gcGFyc2VEYXRlU3RyaW5nKGVuZERhdGUpO1xuXG4gICAgY29uc3QgZGlmZlRpbWUgPSBlbmQuZ2V0VGltZSgpIC0gc3RhcnQuZ2V0VGltZSgpO1xuICAgIHJldHVybiBNYXRoLmNlaWwoZGlmZlRpbWUgLyAoMTAwMCAqIDYwICogNjAgKiAyNCkpO1xufTtcblxuLyoqXG4gKiBHZW5lcmF0ZSBhbiBhcnJheSBvZiBkYXRlIHN0cmluZ3MgZm9yIGEgZ2l2ZW4gcmFuZ2VcbiAqL1xuZXhwb3J0IGNvbnN0IGdlbmVyYXRlRGF0ZVJhbmdlID0gKFxuICAgIHN0YXJ0RGF0ZTogc3RyaW5nLFxuICAgIGVuZERhdGU6IHN0cmluZyxcbik6IHN0cmluZ1tdID0+IHtcbiAgICBjb25zdCBkYXRlczogc3RyaW5nW10gPSBbXTtcbiAgICBjb25zdCBzdGFydCA9IHBhcnNlRGF0ZVN0cmluZyhzdGFydERhdGUpO1xuICAgIGNvbnN0IGVuZCA9IHBhcnNlRGF0ZVN0cmluZyhlbmREYXRlKTtcblxuICAgIGNvbnN0IGN1cnJlbnQgPSBuZXcgRGF0ZShzdGFydCk7XG4gICAgd2hpbGUgKGN1cnJlbnQgPD0gZW5kKSB7XG4gICAgICAgIGRhdGVzLnB1c2goZm9ybWF0RGF0ZVRvU3RyaW5nKGN1cnJlbnQpKTtcbiAgICAgICAgY3VycmVudC5zZXREYXRlKGN1cnJlbnQuZ2V0RGF0ZSgpICsgMSk7XG4gICAgfVxuXG4gICAgcmV0dXJuIGRhdGVzO1xufTtcblxuLyoqXG4gKiBHZXQgdGhlIGRhdGUgc3RyaW5nIGZvciBOIGRheXMgYWdvIGZyb20gdG9kYXlcbiAqL1xuZXhwb3J0IGNvbnN0IGdldERhdGVORGF5c0FnbyA9IChcbiAgICBkYXlzOiBudW1iZXIsXG4gICAgdGltZXpvbmU6IHN0cmluZyA9IFwiVVRDXCIsXG4pOiBzdHJpbmcgPT4ge1xuICAgIGNvbnN0IGRhdGUgPSBuZXcgRGF0ZSgpO1xuICAgIGRhdGUuc2V0RGF0ZShkYXRlLmdldERhdGUoKSAtIGRheXMpO1xuICAgIHJldHVybiBmb3JtYXREYXRlVG9TdHJpbmcoZGF0ZSwgdGltZXpvbmUpO1xufTtcblxuLyoqXG4gKiBHZXQgdGhlIGRhdGUgc3RyaW5nIGZvciBOIGRheXMgZnJvbSB0b2RheVxuICovXG5leHBvcnQgY29uc3QgZ2V0RGF0ZU5EYXlzRnJvbU5vdyA9IChcbiAgICBkYXlzOiBudW1iZXIsXG4gICAgdGltZXpvbmU6IHN0cmluZyA9IFwiVVRDXCIsXG4pOiBzdHJpbmcgPT4ge1xuICAgIGNvbnN0IGRhdGUgPSBuZXcgRGF0ZSgpO1xuICAgIGRhdGUuc2V0RGF0ZShkYXRlLmdldERhdGUoKSArIGRheXMpO1xuICAgIHJldHVybiBmb3JtYXREYXRlVG9TdHJpbmcoZGF0ZSwgdGltZXpvbmUpO1xufTtcblxuLyoqXG4gKiBDaGVjayBpZiBhIGRhdGUgc3RyaW5nIHJlcHJlc2VudHMgdG9kYXkgaW4gYSBzcGVjaWZpYyB0aW1lem9uZVxuICovXG5leHBvcnQgY29uc3QgaXNUb2RheSA9IChkYXRlU3RyaW5nOiBzdHJpbmcsIHRpbWV6b25lOiBzdHJpbmcpOiBib29sZWFuID0+IHtcbiAgICBjb25zdCB0b2RheSA9IGdldEN1cnJlbnREYXRlU3RyaW5nKHRpbWV6b25lKTtcbiAgICByZXR1cm4gZGF0ZVN0cmluZyA9PT0gdG9kYXk7XG59O1xuXG4vKipcbiAqIEdldCB0aGUgZGF5IG9mIHRoZSB3ZWVrIGZvciBhIGRhdGUgc3RyaW5nICgwID0gU3VuZGF5LCA2ID0gU2F0dXJkYXkpXG4gKi9cbmV4cG9ydCBjb25zdCBnZXREYXlPZldlZWsgPSAoZGF0ZVN0cmluZzogc3RyaW5nKTogbnVtYmVyID0+IHtcbiAgICBjb25zdCBkYXRlID0gcGFyc2VEYXRlU3RyaW5nKGRhdGVTdHJpbmcpO1xuICAgIHJldHVybiBkYXRlLmdldERheSgpO1xufTtcblxuLyoqXG4gKiBHZXQgdGhlIGRheSBuYW1lIGZvciBhIGRhdGUgc3RyaW5nXG4gKi9cbmV4cG9ydCBjb25zdCBnZXREYXlOYW1lID0gKGRhdGVTdHJpbmc6IHN0cmluZyk6IHN0cmluZyA9PiB7XG4gICAgY29uc3QgZGF0ZSA9IHBhcnNlRGF0ZVN0cmluZyhkYXRlU3RyaW5nKTtcbiAgICByZXR1cm4gZGF0ZS50b0xvY2FsZURhdGVTdHJpbmcoXCJlbi1VU1wiLCB7IHdlZWtkYXk6IFwibG9uZ1wiIH0pO1xufTtcblxuLyoqXG4gKiBWYWxpZGF0ZSBpZiBhIHN0cmluZyBpcyBpbiBZWVlZLU1NLUREIGZvcm1hdFxuICovXG5leHBvcnQgY29uc3QgaXNWYWxpZERhdGVTdHJpbmcgPSAoZGF0ZVN0cmluZzogc3RyaW5nKTogYm9vbGVhbiA9PiB7XG4gICAgY29uc3QgcmVnZXggPSAvXlxcZHs0fS1cXGR7Mn0tXFxkezJ9JC87XG4gICAgaWYgKCFyZWdleC50ZXN0KGRhdGVTdHJpbmcpKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG5cbiAgICBjb25zdCBkYXRlID0gcGFyc2VEYXRlU3RyaW5nKGRhdGVTdHJpbmcpO1xuICAgIHJldHVybiAhaXNOYU4oZGF0ZS5nZXRUaW1lKCkpO1xufTtcblxuLyoqXG4gKiBHZXQgdGhlIHN0YXJ0IGFuZCBlbmQgZGF0ZXMgZm9yIGEgY2FsZW5kYXIgdmlldyAoOTAgZGF5cylcbiAqL1xuZXhwb3J0IGNvbnN0IGdldENhbGVuZGFyRGF0ZVJhbmdlID0gKFxuICAgIHRpbWV6b25lOiBzdHJpbmcgPSBcIlVUQ1wiLFxuKTogeyBzdGFydDogc3RyaW5nOyBlbmQ6IHN0cmluZyB9ID0+IHtcbiAgICBjb25zdCBlbmQgPSBnZXRDdXJyZW50RGF0ZVN0cmluZyh0aW1lem9uZSk7XG4gICAgY29uc3Qgc3RhcnQgPSBnZXREYXRlTkRheXNBZ28oODksIHRpbWV6b25lKTsgLy8gOTAgZGF5cyB0b3RhbCBpbmNsdWRpbmcgdG9kYXlcblxuICAgIHJldHVybiB7IHN0YXJ0LCBlbmQgfTtcbn07XG5cbi8qKlxuICogQ29udmVydCBGaXJlc3RvcmUgVGltZXN0YW1wIHRvIGRhdGUgc3RyaW5nIGluIHRpbWV6b25lXG4gKi9cbmV4cG9ydCBjb25zdCB0aW1lc3RhbXBUb0RhdGVTdHJpbmcgPSAoXG4gICAgdGltZXN0YW1wOiBUaW1lc3RhbXAsXG4gICAgdGltZXpvbmU6IHN0cmluZyxcbik6IHN0cmluZyA9PiB7XG4gICAgcmV0dXJuIGZvcm1hdERhdGVUb1N0cmluZyh0aW1lc3RhbXAudG9EYXRlKCksIHRpbWV6b25lKTtcbn07XG5cbi8qKlxuICogQ3JlYXRlIGEgRmlyZXN0b3JlIFRpbWVzdGFtcCBmcm9tIGEgZGF0ZSBzdHJpbmcgYW5kIHRpbWVcbiAqL1xuZXhwb3J0IGNvbnN0IGNyZWF0ZVRpbWVzdGFtcEZyb21EYXRlVGltZSA9IChcbiAgICBkYXRlU3RyaW5nOiBzdHJpbmcsXG4gICAgdGltZVN0cmluZzogc3RyaW5nLFxuICAgIHRpbWV6b25lOiBzdHJpbmcsXG4pOiBUaW1lc3RhbXAgPT4ge1xuICAgIGNvbnN0IFt5ZWFyLCBtb250aCwgZGF5XSA9IGRhdGVTdHJpbmcuc3BsaXQoXCItXCIpLm1hcChOdW1iZXIpO1xuICAgIGNvbnN0IFtob3VycywgbWludXRlc10gPSB0aW1lU3RyaW5nLnNwbGl0KFwiOlwiKS5tYXAoTnVtYmVyKTtcblxuICAgIC8vIENyZWF0ZSBkYXRlIGluIHRoZSBzcGVjaWZpZWQgdGltZXpvbmVcbiAgICBjb25zdCBkYXRlID0gbmV3IERhdGUoKTtcbiAgICBkYXRlLnNldEZ1bGxZZWFyKHllYXIsIG1vbnRoIC0gMSwgZGF5KTtcbiAgICBkYXRlLnNldEhvdXJzKGhvdXJzLCBtaW51dGVzLCAwLCAwKTtcblxuICAgIHJldHVybiBUaW1lc3RhbXAuZnJvbURhdGUoZGF0ZSk7XG59O1xuXG4vKipcbiAqIEdldCB0aGUgdGltZSByZW1haW5pbmcgdW50aWwgZW5kIG9mIGRheSBpbiBhIHRpbWV6b25lIChpbiBob3VycylcbiAqL1xuZXhwb3J0IGNvbnN0IGdldEhvdXJzVW50aWxFbmRPZkRheSA9ICh0aW1lem9uZTogc3RyaW5nKTogbnVtYmVyID0+IHtcbiAgICBjb25zdCBub3cgPSBuZXcgRGF0ZSgpO1xuICAgIGNvbnN0IGVuZE9mRGF5ID0gbmV3IERhdGUoKTtcblxuICAgIC8vIFNldCB0byBlbmQgb2YgZGF5IGluIHRoZSBzcGVjaWZpZWQgdGltZXpvbmVcbiAgICBjb25zdCBmb3JtYXR0ZXIgPSBuZXcgSW50bC5EYXRlVGltZUZvcm1hdChcImVuLVVTXCIsIHtcbiAgICAgICAgdGltZVpvbmU6IHRpbWV6b25lLFxuICAgICAgICBob3VyMTI6IGZhbHNlLFxuICAgICAgICBob3VyOiBcIjItZGlnaXRcIixcbiAgICAgICAgbWludXRlOiBcIjItZGlnaXRcIixcbiAgICB9KTtcblxuICAgIGVuZE9mRGF5LnNldEhvdXJzKDIzLCA1OSwgNTksIDk5OSk7XG5cbiAgICBjb25zdCBkaWZmTXMgPSBlbmRPZkRheS5nZXRUaW1lKCkgLSBub3cuZ2V0VGltZSgpO1xuICAgIHJldHVybiBNYXRoLm1heCgwLCBkaWZmTXMgLyAoMTAwMCAqIDYwICogNjApKTtcbn07XG4iXSwibWFwcGluZ3MiOiI7Ozs7OztBQUFBLElBQUFBLFVBQUEsR0FBQUMsT0FBQTtBQVNPLElBQU1DLG9CQUFvQixHQUFBQyxPQUFBLENBQUFELG9CQUFBLEdBQUcsU0FBdkJBLG9CQUFvQkEsQ0FBQSxFQUF5QztFQUFBLElBQXJDRSxRQUFnQixHQUFBQyxTQUFBLENBQUFDLE1BQUEsUUFBQUQsU0FBQSxRQUFBRSxTQUFBLEdBQUFGLFNBQUEsTUFBRyxLQUFLO0VBQ3pELElBQU1HLEdBQUcsR0FBRyxJQUFJQyxJQUFJLENBQUMsQ0FBQztFQUN0QixPQUFPQyxrQkFBa0IsQ0FBQ0YsR0FBRyxFQUFFSixRQUFRLENBQUM7QUFDNUMsQ0FBQztBQUtNLElBQU1NLGtCQUFrQixHQUFBUCxPQUFBLENBQUFPLGtCQUFBLEdBQUcsU0FBckJBLGtCQUFrQkEsQ0FDM0JDLElBQVUsRUFFRDtFQUFBLElBRFRQLFFBQWdCLEdBQUFDLFNBQUEsQ0FBQUMsTUFBQSxRQUFBRCxTQUFBLFFBQUFFLFNBQUEsR0FBQUYsU0FBQSxNQUFHLEtBQUs7RUFFeEIsSUFBTU8sU0FBUyxHQUFHLElBQUlDLElBQUksQ0FBQ0MsY0FBYyxDQUFDLE9BQU8sRUFBRTtJQUMvQ0MsUUFBUSxFQUFFWCxRQUFRO0lBQ2xCWSxJQUFJLEVBQUUsU0FBUztJQUNmQyxLQUFLLEVBQUUsU0FBUztJQUNoQkMsR0FBRyxFQUFFO0VBQ1QsQ0FBQyxDQUFDO0VBRUYsT0FBT04sU0FBUyxDQUFDTyxNQUFNLENBQUNSLElBQUksQ0FBQztBQUNqQyxDQUFDO0FBS00sSUFBTVMsZUFBZSxHQUFBakIsT0FBQSxDQUFBaUIsZUFBQSxHQUFHLFNBQWxCQSxlQUFlQSxDQUFJQyxVQUFrQixFQUFXO0VBQ3pELElBQUFDLHFCQUFBLEdBQTJCRCxVQUFVLENBQUNFLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQ0MsR0FBRyxDQUFDQyxNQUFNLENBQUM7SUFBQUMsc0JBQUEsT0FBQUMsZUFBQSxDQUFBQyxPQUFBLEVBQUFOLHFCQUFBO0lBQXJETixJQUFJLEdBQUFVLHNCQUFBO0lBQUVULEtBQUssR0FBQVMsc0JBQUE7SUFBRVIsR0FBRyxHQUFBUSxzQkFBQTtFQUN2QixPQUFPLElBQUlqQixJQUFJLENBQUNPLElBQUksRUFBRUMsS0FBSyxHQUFHLENBQUMsRUFBRUMsR0FBRyxDQUFDO0FBQ3pDLENBQUM7QUFLTSxJQUFNVyxlQUFlLEdBQUExQixPQUFBLENBQUEwQixlQUFBLEdBQUcsU0FBbEJBLGVBQWVBLENBQUEsRUFBaUI7RUFDekMsT0FBT2hCLElBQUksQ0FBQ0MsY0FBYyxDQUFDLENBQUMsQ0FBQ2dCLGVBQWUsQ0FBQyxDQUFDLENBQUNmLFFBQVE7QUFDM0QsQ0FBQztBQUtNLElBQU1nQix1QkFBdUIsR0FBQTVCLE9BQUEsQ0FBQTRCLHVCQUFBLEdBQUcsU0FBMUJBLHVCQUF1QkEsQ0FDaENDLFNBQW9CLEVBQ3BCNUIsUUFBZ0IsRUFDTjtFQUNWLElBQU02QixhQUFhLEdBQUdELFNBQVMsQ0FBQ0UsTUFBTSxDQUFDLENBQUM7RUFDeEMsSUFBTUMsaUJBQWlCLEdBQUdqQyxvQkFBb0IsQ0FBQ0UsUUFBUSxDQUFDO0VBQ3hELElBQU1nQyxtQkFBbUIsR0FBRzFCLGtCQUFrQixDQUFDdUIsYUFBYSxFQUFFN0IsUUFBUSxDQUFDO0VBRXZFLE9BQU8rQixpQkFBaUIsS0FBS0MsbUJBQW1CO0FBQ3BELENBQUM7QUFLTSxJQUFNQyxrQkFBa0IsR0FBQWxDLE9BQUEsQ0FBQWtDLGtCQUFBLEdBQUcsU0FBckJBLGtCQUFrQkEsQ0FBSUMsS0FBYSxFQUFFQyxLQUFhLEVBQWM7RUFDekUsSUFBTUMsRUFBRSxHQUFHcEIsZUFBZSxDQUFDa0IsS0FBSyxDQUFDO0VBQ2pDLElBQU1HLEVBQUUsR0FBR3JCLGVBQWUsQ0FBQ21CLEtBQUssQ0FBQztFQUVqQyxJQUFNRyxRQUFRLEdBQUdDLElBQUksQ0FBQ0MsR0FBRyxDQUFDSCxFQUFFLENBQUNJLE9BQU8sQ0FBQyxDQUFDLEdBQUdMLEVBQUUsQ0FBQ0ssT0FBTyxDQUFDLENBQUMsQ0FBQztFQUN0RCxJQUFNQyxRQUFRLEdBQUdILElBQUksQ0FBQ0ksSUFBSSxDQUFDTCxRQUFRLElBQUksSUFBSSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxDQUFDLENBQUM7RUFFNUQsT0FBT0ksUUFBUSxLQUFLLENBQUM7QUFDekIsQ0FBQztBQUtNLElBQU1FLGlCQUFpQixHQUFBN0MsT0FBQSxDQUFBNkMsaUJBQUEsR0FBRyxTQUFwQkEsaUJBQWlCQSxDQUMxQkMsU0FBaUIsRUFDakJDLE9BQWUsRUFDTjtFQUNULElBQU1DLEtBQUssR0FBRy9CLGVBQWUsQ0FBQzZCLFNBQVMsQ0FBQztFQUN4QyxJQUFNRyxHQUFHLEdBQUdoQyxlQUFlLENBQUM4QixPQUFPLENBQUM7RUFFcEMsSUFBTVIsUUFBUSxHQUFHVSxHQUFHLENBQUNQLE9BQU8sQ0FBQyxDQUFDLEdBQUdNLEtBQUssQ0FBQ04sT0FBTyxDQUFDLENBQUM7RUFDaEQsT0FBT0YsSUFBSSxDQUFDSSxJQUFJLENBQUNMLFFBQVEsSUFBSSxJQUFJLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLENBQUMsQ0FBQztBQUN0RCxDQUFDO0FBS00sSUFBTVcsaUJBQWlCLEdBQUFsRCxPQUFBLENBQUFrRCxpQkFBQSxHQUFHLFNBQXBCQSxpQkFBaUJBLENBQzFCSixTQUFpQixFQUNqQkMsT0FBZSxFQUNKO0VBQ1gsSUFBTUksS0FBZSxHQUFHLEVBQUU7RUFDMUIsSUFBTUgsS0FBSyxHQUFHL0IsZUFBZSxDQUFDNkIsU0FBUyxDQUFDO0VBQ3hDLElBQU1HLEdBQUcsR0FBR2hDLGVBQWUsQ0FBQzhCLE9BQU8sQ0FBQztFQUVwQyxJQUFNSyxPQUFPLEdBQUcsSUFBSTlDLElBQUksQ0FBQzBDLEtBQUssQ0FBQztFQUMvQixPQUFPSSxPQUFPLElBQUlILEdBQUcsRUFBRTtJQUNuQkUsS0FBSyxDQUFDRSxJQUFJLENBQUM5QyxrQkFBa0IsQ0FBQzZDLE9BQU8sQ0FBQyxDQUFDO0lBQ3ZDQSxPQUFPLENBQUNFLE9BQU8sQ0FBQ0YsT0FBTyxDQUFDRyxPQUFPLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQztFQUMxQztFQUVBLE9BQU9KLEtBQUs7QUFDaEIsQ0FBQztBQUtNLElBQU1LLGVBQWUsR0FBQXhELE9BQUEsQ0FBQXdELGVBQUEsR0FBRyxTQUFsQkEsZUFBZUEsQ0FDeEJDLElBQVksRUFFSDtFQUFBLElBRFR4RCxRQUFnQixHQUFBQyxTQUFBLENBQUFDLE1BQUEsUUFBQUQsU0FBQSxRQUFBRSxTQUFBLEdBQUFGLFNBQUEsTUFBRyxLQUFLO0VBRXhCLElBQU1NLElBQUksR0FBRyxJQUFJRixJQUFJLENBQUMsQ0FBQztFQUN2QkUsSUFBSSxDQUFDOEMsT0FBTyxDQUFDOUMsSUFBSSxDQUFDK0MsT0FBTyxDQUFDLENBQUMsR0FBR0UsSUFBSSxDQUFDO0VBQ25DLE9BQU9sRCxrQkFBa0IsQ0FBQ0MsSUFBSSxFQUFFUCxRQUFRLENBQUM7QUFDN0MsQ0FBQztBQUtNLElBQU15RCxtQkFBbUIsR0FBQTFELE9BQUEsQ0FBQTBELG1CQUFBLEdBQUcsU0FBdEJBLG1CQUFtQkEsQ0FDNUJELElBQVksRUFFSDtFQUFBLElBRFR4RCxRQUFnQixHQUFBQyxTQUFBLENBQUFDLE1BQUEsUUFBQUQsU0FBQSxRQUFBRSxTQUFBLEdBQUFGLFNBQUEsTUFBRyxLQUFLO0VBRXhCLElBQU1NLElBQUksR0FBRyxJQUFJRixJQUFJLENBQUMsQ0FBQztFQUN2QkUsSUFBSSxDQUFDOEMsT0FBTyxDQUFDOUMsSUFBSSxDQUFDK0MsT0FBTyxDQUFDLENBQUMsR0FBR0UsSUFBSSxDQUFDO0VBQ25DLE9BQU9sRCxrQkFBa0IsQ0FBQ0MsSUFBSSxFQUFFUCxRQUFRLENBQUM7QUFDN0MsQ0FBQztBQUtNLElBQU0wRCxPQUFPLEdBQUEzRCxPQUFBLENBQUEyRCxPQUFBLEdBQUcsU0FBVkEsT0FBT0EsQ0FBSXpDLFVBQWtCLEVBQUVqQixRQUFnQixFQUFjO0VBQ3RFLElBQU0yRCxLQUFLLEdBQUc3RCxvQkFBb0IsQ0FBQ0UsUUFBUSxDQUFDO0VBQzVDLE9BQU9pQixVQUFVLEtBQUswQyxLQUFLO0FBQy9CLENBQUM7QUFLTSxJQUFNQyxZQUFZLEdBQUE3RCxPQUFBLENBQUE2RCxZQUFBLEdBQUcsU0FBZkEsWUFBWUEsQ0FBSTNDLFVBQWtCLEVBQWE7RUFDeEQsSUFBTVYsSUFBSSxHQUFHUyxlQUFlLENBQUNDLFVBQVUsQ0FBQztFQUN4QyxPQUFPVixJQUFJLENBQUNzRCxNQUFNLENBQUMsQ0FBQztBQUN4QixDQUFDO0FBS00sSUFBTUMsVUFBVSxHQUFBL0QsT0FBQSxDQUFBK0QsVUFBQSxHQUFHLFNBQWJBLFVBQVVBLENBQUk3QyxVQUFrQixFQUFhO0VBQ3RELElBQU1WLElBQUksR0FBR1MsZUFBZSxDQUFDQyxVQUFVLENBQUM7RUFDeEMsT0FBT1YsSUFBSSxDQUFDd0Qsa0JBQWtCLENBQUMsT0FBTyxFQUFFO0lBQUVDLE9BQU8sRUFBRTtFQUFPLENBQUMsQ0FBQztBQUNoRSxDQUFDO0FBS00sSUFBTUMsaUJBQWlCLEdBQUFsRSxPQUFBLENBQUFrRSxpQkFBQSxHQUFHLFNBQXBCQSxpQkFBaUJBLENBQUloRCxVQUFrQixFQUFjO0VBQzlELElBQU1pRCxLQUFLLEdBQUcscUJBQXFCO0VBQ25DLElBQUksQ0FBQ0EsS0FBSyxDQUFDQyxJQUFJLENBQUNsRCxVQUFVLENBQUMsRUFBRTtJQUN6QixPQUFPLEtBQUs7RUFDaEI7RUFFQSxJQUFNVixJQUFJLEdBQUdTLGVBQWUsQ0FBQ0MsVUFBVSxDQUFDO0VBQ3hDLE9BQU8sQ0FBQ21ELEtBQUssQ0FBQzdELElBQUksQ0FBQ2tDLE9BQU8sQ0FBQyxDQUFDLENBQUM7QUFDakMsQ0FBQztBQUtNLElBQU00QixvQkFBb0IsR0FBQXRFLE9BQUEsQ0FBQXNFLG9CQUFBLEdBQUcsU0FBdkJBLG9CQUFvQkEsQ0FBQSxFQUVJO0VBQUEsSUFEakNyRSxRQUFnQixHQUFBQyxTQUFBLENBQUFDLE1BQUEsUUFBQUQsU0FBQSxRQUFBRSxTQUFBLEdBQUFGLFNBQUEsTUFBRyxLQUFLO0VBRXhCLElBQU0rQyxHQUFHLEdBQUdsRCxvQkFBb0IsQ0FBQ0UsUUFBUSxDQUFDO0VBQzFDLElBQU0rQyxLQUFLLEdBQUdRLGVBQWUsQ0FBQyxFQUFFLEVBQUV2RCxRQUFRLENBQUM7RUFFM0MsT0FBTztJQUFFK0MsS0FBSyxFQUFMQSxLQUFLO0lBQUVDLEdBQUcsRUFBSEE7RUFBSSxDQUFDO0FBQ3pCLENBQUM7QUFLTSxJQUFNc0IscUJBQXFCLEdBQUF2RSxPQUFBLENBQUF1RSxxQkFBQSxHQUFHLFNBQXhCQSxxQkFBcUJBLENBQzlCMUMsU0FBb0IsRUFDcEI1QixRQUFnQixFQUNQO0VBQ1QsT0FBT00sa0JBQWtCLENBQUNzQixTQUFTLENBQUNFLE1BQU0sQ0FBQyxDQUFDLEVBQUU5QixRQUFRLENBQUM7QUFDM0QsQ0FBQztBQUtNLElBQU11RSwyQkFBMkIsR0FBQXhFLE9BQUEsQ0FBQXdFLDJCQUFBLEdBQUcsU0FBOUJBLDJCQUEyQkEsQ0FDcEN0RCxVQUFrQixFQUNsQnVELFVBQWtCLEVBQ2xCeEUsUUFBZ0IsRUFDSjtFQUNaLElBQUF5RSxzQkFBQSxHQUEyQnhELFVBQVUsQ0FBQ0UsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFDQyxHQUFHLENBQUNDLE1BQU0sQ0FBQztJQUFBcUQsc0JBQUEsT0FBQW5ELGVBQUEsQ0FBQUMsT0FBQSxFQUFBaUQsc0JBQUE7SUFBckQ3RCxJQUFJLEdBQUE4RCxzQkFBQTtJQUFFN0QsS0FBSyxHQUFBNkQsc0JBQUE7SUFBRTVELEdBQUcsR0FBQTRELHNCQUFBO0VBQ3ZCLElBQUFDLHFCQUFBLEdBQXlCSCxVQUFVLENBQUNyRCxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUNDLEdBQUcsQ0FBQ0MsTUFBTSxDQUFDO0lBQUF1RCxzQkFBQSxPQUFBckQsZUFBQSxDQUFBQyxPQUFBLEVBQUFtRCxxQkFBQTtJQUFuREUsS0FBSyxHQUFBRCxzQkFBQTtJQUFFRSxPQUFPLEdBQUFGLHNCQUFBO0VBR3JCLElBQU1yRSxJQUFJLEdBQUcsSUFBSUYsSUFBSSxDQUFDLENBQUM7RUFDdkJFLElBQUksQ0FBQ3dFLFdBQVcsQ0FBQ25FLElBQUksRUFBRUMsS0FBSyxHQUFHLENBQUMsRUFBRUMsR0FBRyxDQUFDO0VBQ3RDUCxJQUFJLENBQUN5RSxRQUFRLENBQUNILEtBQUssRUFBRUMsT0FBTyxFQUFFLENBQUMsRUFBRSxDQUFDLENBQUM7RUFFbkMsT0FBT0csb0JBQVMsQ0FBQ0MsUUFBUSxDQUFDM0UsSUFBSSxDQUFDO0FBQ25DLENBQUM7QUFLTSxJQUFNNEUscUJBQXFCLEdBQUFwRixPQUFBLENBQUFvRixxQkFBQSxHQUFHLFNBQXhCQSxxQkFBcUJBLENBQUluRixRQUFnQixFQUFhO0VBQy9ELElBQU1JLEdBQUcsR0FBRyxJQUFJQyxJQUFJLENBQUMsQ0FBQztFQUN0QixJQUFNK0UsUUFBUSxHQUFHLElBQUkvRSxJQUFJLENBQUMsQ0FBQztFQUczQixJQUFNRyxTQUFTLEdBQUcsSUFBSUMsSUFBSSxDQUFDQyxjQUFjLENBQUMsT0FBTyxFQUFFO0lBQy9DQyxRQUFRLEVBQUVYLFFBQVE7SUFDbEJxRixNQUFNLEVBQUUsS0FBSztJQUNiQyxJQUFJLEVBQUUsU0FBUztJQUNmQyxNQUFNLEVBQUU7RUFDWixDQUFDLENBQUM7RUFFRkgsUUFBUSxDQUFDSixRQUFRLENBQUMsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsR0FBRyxDQUFDO0VBRWxDLElBQU1RLE1BQU0sR0FBR0osUUFBUSxDQUFDM0MsT0FBTyxDQUFDLENBQUMsR0FBR3JDLEdBQUcsQ0FBQ3FDLE9BQU8sQ0FBQyxDQUFDO0VBQ2pELE9BQU9GLElBQUksQ0FBQ2tELEdBQUcsQ0FBQyxDQUFDLEVBQUVELE1BQU0sSUFBSSxJQUFJLEdBQUcsRUFBRSxHQUFHLEVBQUUsQ0FBQyxDQUFDO0FBQ2pELENBQUMiLCJpZ25vcmVMaXN0IjpbXX0=